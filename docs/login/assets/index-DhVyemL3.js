var Zy=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var BT=Zy((WT,Jy)=>{(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}})();function cl(e){const n=Object.create(null);for(const t of e.split(","))n[t]=1;return t=>t in n}const Ge={},jo=[],$n=()=>{},Ip=()=>!1,Fs=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),ll=e=>e.startsWith("onUpdate:"),pt=Object.assign,fl=(e,n)=>{const t=e.indexOf(n);t>-1&&e.splice(t,1)},e0=Object.prototype.hasOwnProperty,qe=(e,n)=>e0.call(e,n),Ie=Array.isArray,$o=e=>Ps(e)==="[object Map]",Ap=e=>Ps(e)==="[object Set]",De=e=>typeof e=="function",rt=e=>typeof e=="string",$r=e=>typeof e=="symbol",Ke=e=>e!==null&&typeof e=="object",Tp=e=>(Ke(e)||De(e))&&De(e.then)&&De(e.catch),Dp=Object.prototype.toString,Ps=e=>Dp.call(e),t0=e=>Ps(e).slice(8,-1),Np=e=>Ps(e)==="[object Object]",dl=e=>rt(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Di=cl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ms=e=>{const n=Object.create(null);return(t=>n[t]||(n[t]=e(t)))},n0=/-\w/g,wn=Ms(e=>e.replace(n0,n=>n.slice(1).toUpperCase())),r0=/\B([A-Z])/g,_o=Ms(e=>e.replace(r0,"-$1").toLowerCase()),Os=Ms(e=>e.charAt(0).toUpperCase()+e.slice(1)),pu=Ms(e=>e?`on${Os(e)}`:""),Vr=(e,n)=>!Object.is(e,n),vu=(e,...n)=>{for(let t=0;t<e.length;t++)e[t](...n)},Fp=(e,n,t,r=!1)=>{Object.defineProperty(e,n,{configurable:!0,enumerable:!1,writable:r,value:t})},o0=e=>{const n=parseFloat(e);return isNaN(n)?e:n},i0=e=>{const n=rt(e)?Number(e):NaN;return isNaN(n)?e:n};let Hf;const Bs=()=>Hf||(Hf=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function hl(e){if(Ie(e)){const n={};for(let t=0;t<e.length;t++){const r=e[t],o=rt(r)?c0(r):hl(r);if(o)for(const i in o)n[i]=o[i]}return n}else if(rt(e)||Ke(e))return e}const a0=/;(?![^(]*\))/g,s0=/:([^]+)/,u0=/\/\*[^]*?\*\//g;function c0(e){const n={};return e.replace(u0,"").split(a0).forEach(t=>{if(t){const r=t.split(s0);r.length>1&&(n[r[0].trim()]=r[1].trim())}}),n}function pl(e){let n="";if(rt(e))n=e;else if(Ie(e))for(let t=0;t<e.length;t++){const r=pl(e[t]);r&&(n+=r+" ")}else if(Ke(e))for(const t in e)e[t]&&(n+=t+" ");return n.trim()}const l0="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",f0=cl(l0);function Pp(e){return!!e||e===""}const Mp=e=>!!(e&&e.__v_isRef===!0),Bo=e=>rt(e)?e:e==null?"":Ie(e)||Ke(e)&&(e.toString===Dp||!De(e.toString))?Mp(e)?Bo(e.value):JSON.stringify(e,Op,2):String(e),Op=(e,n)=>Mp(n)?Op(e,n.value):$o(n)?{[`Map(${n.size})`]:[...n.entries()].reduce((t,[r,o],i)=>(t[mu(r,i)+" =>"]=o,t),{})}:Ap(n)?{[`Set(${n.size})`]:[...n.values()].map(t=>mu(t))}:$r(n)?mu(n):Ke(n)&&!Ie(n)&&!Np(n)?String(n):n,mu=(e,n="")=>{var t;return $r(e)?`Symbol(${(t=e.description)!=null?t:n})`:e};let Gt;class d0{constructor(n=!1){this.detached=n,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Gt,!n&&Gt&&(this.index=(Gt.scopes||(Gt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].pause();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let n,t;if(this.scopes)for(n=0,t=this.scopes.length;n<t;n++)this.scopes[n].resume();for(n=0,t=this.effects.length;n<t;n++)this.effects[n].resume()}}run(n){if(this._active){const t=Gt;try{return Gt=this,n()}finally{Gt=t}}}on(){++this._on===1&&(this.prevScope=Gt,Gt=this)}off(){this._on>0&&--this._on===0&&(Gt=this.prevScope,this.prevScope=void 0)}stop(n){if(this._active){this._active=!1;let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(this.effects.length=0,t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!n){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function h0(){return Gt}let je;const gu=new WeakSet;class Bp{constructor(n){this.fn=n,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Gt&&Gt.active&&Gt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,gu.has(this)&&(gu.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Wp(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Gf(this),Vp(this);const n=je,t=kn;je=this,kn=!0;try{return this.fn()}finally{Up(this),je=n,kn=t,this.flags&=-3}}stop(){if(this.flags&1){for(let n=this.deps;n;n=n.nextDep)gl(n);this.deps=this.depsTail=void 0,Gf(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?gu.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){vc(this)&&this.run()}get dirty(){return vc(this)}}let Lp=0,Ni,Fi;function Wp(e,n=!1){if(e.flags|=8,n){e.next=Fi,Fi=e;return}e.next=Ni,Ni=e}function vl(){Lp++}function ml(){if(--Lp>0)return;if(Fi){let n=Fi;for(Fi=void 0;n;){const t=n.next;n.next=void 0,n.flags&=-9,n=t}}let e;for(;Ni;){let n=Ni;for(Ni=void 0;n;){const t=n.next;if(n.next=void 0,n.flags&=-9,n.flags&1)try{n.trigger()}catch(r){e||(e=r)}n=t}}if(e)throw e}function Vp(e){for(let n=e.deps;n;n=n.nextDep)n.version=-1,n.prevActiveLink=n.dep.activeLink,n.dep.activeLink=n}function Up(e){let n,t=e.depsTail,r=t;for(;r;){const o=r.prevDep;r.version===-1?(r===t&&(t=o),gl(r),p0(r)):n=r,r.dep.activeLink=r.prevActiveLink,r.prevActiveLink=void 0,r=o}e.deps=n,e.depsTail=t}function vc(e){for(let n=e.deps;n;n=n.nextDep)if(n.dep.version!==n.version||n.dep.computed&&(zp(n.dep.computed)||n.dep.version!==n.version))return!0;return!!e._dirty}function zp(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===qi)||(e.globalVersion=qi,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!vc(e))))return;e.flags|=2;const n=e.dep,t=je,r=kn;je=e,kn=!0;try{Vp(e);const o=e.fn(e._value);(n.version===0||Vr(o,e._value))&&(e.flags|=128,e._value=o,n.version++)}catch(o){throw n.version++,o}finally{je=t,kn=r,Up(e),e.flags&=-3}}function gl(e,n=!1){const{dep:t,prevSub:r,nextSub:o}=e;if(r&&(r.nextSub=o,e.prevSub=void 0),o&&(o.prevSub=r,e.nextSub=void 0),t.subs===e&&(t.subs=r,!r&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)gl(i,!0)}!n&&!--t.sc&&t.map&&t.map.delete(t.key)}function p0(e){const{prevDep:n,nextDep:t}=e;n&&(n.nextDep=t,e.prevDep=void 0),t&&(t.prevDep=n,e.nextDep=void 0)}let kn=!0;const qp=[];function mr(){qp.push(kn),kn=!1}function gr(){const e=qp.pop();kn=e===void 0?!0:e}function Gf(e){const{cleanup:n}=e;if(e.cleanup=void 0,n){const t=je;je=void 0;try{n()}finally{je=t}}}let qi=0;class v0{constructor(n,t){this.sub=n,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class yl{constructor(n){this.computed=n,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(n){if(!je||!kn||je===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==je)t=this.activeLink=new v0(je,this),je.deps?(t.prevDep=je.depsTail,je.depsTail.nextDep=t,je.depsTail=t):je.deps=je.depsTail=t,Hp(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const r=t.nextDep;r.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=r),t.prevDep=je.depsTail,t.nextDep=void 0,je.depsTail.nextDep=t,je.depsTail=t,je.deps===t&&(je.deps=r)}return t}trigger(n){this.version++,qi++,this.notify(n)}notify(n){vl();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{ml()}}}function Hp(e){if(e.dep.sc++,e.sub.flags&4){const n=e.dep.computed;if(n&&!e.dep.subs){n.flags|=20;for(let r=n.deps;r;r=r.nextDep)Hp(r)}const t=e.dep.subs;t!==e&&(e.prevSub=t,t&&(t.nextSub=e)),e.dep.subs=e}}const mc=new WeakMap,fo=Symbol(""),gc=Symbol(""),Hi=Symbol("");function Dt(e,n,t){if(kn&&je){let r=mc.get(e);r||mc.set(e,r=new Map);let o=r.get(t);o||(r.set(t,o=new yl),o.map=r,o.key=t),o.track()}}function fr(e,n,t,r,o,i){const a=mc.get(e);if(!a){qi++;return}const s=u=>{u&&u.trigger()};if(vl(),n==="clear")a.forEach(s);else{const u=Ie(e),c=u&&dl(t);if(u&&t==="length"){const l=Number(r);a.forEach((f,d)=>{(d==="length"||d===Hi||!$r(d)&&d>=l)&&s(f)})}else switch((t!==void 0||a.has(void 0))&&s(a.get(t)),c&&s(a.get(Hi)),n){case"add":u?c&&s(a.get("length")):(s(a.get(fo)),$o(e)&&s(a.get(gc)));break;case"delete":u||(s(a.get(fo)),$o(e)&&s(a.get(gc)));break;case"set":$o(e)&&s(a.get(fo));break}}ml()}function Ao(e){const n=Ve(e);return n===e?n:(Dt(n,"iterate",Hi),xn(e)?n:n.map(An))}function Ls(e){return Dt(e=Ve(e),"iterate",Hi),e}function Nr(e,n){return yr(e)?ho(e)?ai(An(n)):ai(n):An(n)}const m0={__proto__:null,[Symbol.iterator](){return yu(this,Symbol.iterator,e=>Nr(this,e))},concat(...e){return Ao(this).concat(...e.map(n=>Ie(n)?Ao(n):n))},entries(){return yu(this,"entries",e=>(e[1]=Nr(this,e[1]),e))},every(e,n){return or(this,"every",e,n,void 0,arguments)},filter(e,n){return or(this,"filter",e,n,t=>t.map(r=>Nr(this,r)),arguments)},find(e,n){return or(this,"find",e,n,t=>Nr(this,t),arguments)},findIndex(e,n){return or(this,"findIndex",e,n,void 0,arguments)},findLast(e,n){return or(this,"findLast",e,n,t=>Nr(this,t),arguments)},findLastIndex(e,n){return or(this,"findLastIndex",e,n,void 0,arguments)},forEach(e,n){return or(this,"forEach",e,n,void 0,arguments)},includes(...e){return bu(this,"includes",e)},indexOf(...e){return bu(this,"indexOf",e)},join(e){return Ao(this).join(e)},lastIndexOf(...e){return bu(this,"lastIndexOf",e)},map(e,n){return or(this,"map",e,n,void 0,arguments)},pop(){return bi(this,"pop")},push(...e){return bi(this,"push",e)},reduce(e,...n){return jf(this,"reduce",e,n)},reduceRight(e,...n){return jf(this,"reduceRight",e,n)},shift(){return bi(this,"shift")},some(e,n){return or(this,"some",e,n,void 0,arguments)},splice(...e){return bi(this,"splice",e)},toReversed(){return Ao(this).toReversed()},toSorted(e){return Ao(this).toSorted(e)},toSpliced(...e){return Ao(this).toSpliced(...e)},unshift(...e){return bi(this,"unshift",e)},values(){return yu(this,"values",e=>Nr(this,e))}};function yu(e,n,t){const r=Ls(e),o=r[n]();return r!==e&&!xn(e)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=t(i.value)),i}),o}const g0=Array.prototype;function or(e,n,t,r,o,i){const a=Ls(e),s=a!==e&&!xn(e),u=a[n];if(u!==g0[n]){const f=u.apply(e,i);return s?An(f):f}let c=t;a!==e&&(s?c=function(f,d){return t.call(this,Nr(e,f),d,e)}:t.length>2&&(c=function(f,d){return t.call(this,f,d,e)}));const l=u.call(a,c,r);return s&&o?o(l):l}function jf(e,n,t,r){const o=Ls(e);let i=t;return o!==e&&(xn(e)?t.length>3&&(i=function(a,s,u){return t.call(this,a,s,u,e)}):i=function(a,s,u){return t.call(this,a,Nr(e,s),u,e)}),o[n](i,...r)}function bu(e,n,t){const r=Ve(e);Dt(r,"iterate",Hi);const o=r[n](...t);return(o===-1||o===!1)&&wl(t[0])?(t[0]=Ve(t[0]),r[n](...t)):o}function bi(e,n,t=[]){mr(),vl();const r=Ve(e)[n].apply(e,t);return ml(),gr(),r}const y0=cl("__proto__,__v_isRef,__isVue"),Gp=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter($r));function b0(e){$r(e)||(e=String(e));const n=Ve(this);return Dt(n,"has",e),n.hasOwnProperty(e)}class jp{constructor(n=!1,t=!1){this._isReadonly=n,this._isShallow=t}get(n,t,r){if(t==="__v_skip")return n.__v_skip;const o=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!o;if(t==="__v_isReadonly")return o;if(t==="__v_isShallow")return i;if(t==="__v_raw")return r===(o?i?A0:Yp:i?Xp:Kp).get(n)||Object.getPrototypeOf(n)===Object.getPrototypeOf(r)?n:void 0;const a=Ie(n);if(!o){let u;if(a&&(u=m0[t]))return u;if(t==="hasOwnProperty")return b0}const s=Reflect.get(n,t,Bt(n)?n:r);if(($r(t)?Gp.has(t):y0(t))||(o||Dt(n,"get",t),i))return s;if(Bt(s)){const u=a&&dl(t)?s:s.value;return o&&Ke(u)?bc(u):u}return Ke(s)?o?bc(s):Hn(s):s}}class $p extends jp{constructor(n=!1){super(!1,n)}set(n,t,r,o){let i=n[t];const a=Ie(n)&&dl(t);if(!this._isShallow){const c=yr(i);if(!xn(r)&&!yr(r)&&(i=Ve(i),r=Ve(r)),!a&&Bt(i)&&!Bt(r))return c||(i.value=r),!0}const s=a?Number(t)<n.length:qe(n,t),u=Reflect.set(n,t,r,Bt(n)?n:o);return n===Ve(o)&&(s?Vr(r,i)&&fr(n,"set",t,r):fr(n,"add",t,r)),u}deleteProperty(n,t){const r=qe(n,t);n[t];const o=Reflect.deleteProperty(n,t);return o&&r&&fr(n,"delete",t,void 0),o}has(n,t){const r=Reflect.has(n,t);return(!$r(t)||!Gp.has(t))&&Dt(n,"has",t),r}ownKeys(n){return Dt(n,"iterate",Ie(n)?"length":fo),Reflect.ownKeys(n)}}class x0 extends jp{constructor(n=!1){super(!0,n)}set(n,t){return!0}deleteProperty(n,t){return!0}}const w0=new $p,_0=new x0,C0=new $p(!0),yc=e=>e,ga=e=>Reflect.getPrototypeOf(e);function E0(e,n,t){return function(...r){const o=this.__v_raw,i=Ve(o),a=$o(i),s=e==="entries"||e===Symbol.iterator&&a,u=e==="keys"&&a,c=o[e](...r),l=t?yc:n?ai:An;return!n&&Dt(i,"iterate",u?gc:fo),{next(){const{value:f,done:d}=c.next();return d?{value:f,done:d}:{value:s?[l(f[0]),l(f[1])]:l(f),done:d}},[Symbol.iterator](){return this}}}}function ya(e){return function(...n){return e==="delete"?!1:e==="clear"?void 0:this}}function S0(e,n){const t={get(o){const i=this.__v_raw,a=Ve(i),s=Ve(o);e||(Vr(o,s)&&Dt(a,"get",o),Dt(a,"get",s));const{has:u}=ga(a),c=n?yc:e?ai:An;if(u.call(a,o))return c(i.get(o));if(u.call(a,s))return c(i.get(s));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!e&&Dt(Ve(o),"iterate",fo),o.size},has(o){const i=this.__v_raw,a=Ve(i),s=Ve(o);return e||(Vr(o,s)&&Dt(a,"has",o),Dt(a,"has",s)),o===s?i.has(o):i.has(o)||i.has(s)},forEach(o,i){const a=this,s=a.__v_raw,u=Ve(s),c=n?yc:e?ai:An;return!e&&Dt(u,"iterate",fo),s.forEach((l,f)=>o.call(i,c(l),c(f),a))}};return pt(t,e?{add:ya("add"),set:ya("set"),delete:ya("delete"),clear:ya("clear")}:{add(o){!n&&!xn(o)&&!yr(o)&&(o=Ve(o));const i=Ve(this);return ga(i).has.call(i,o)||(i.add(o),fr(i,"add",o,o)),this},set(o,i){!n&&!xn(i)&&!yr(i)&&(i=Ve(i));const a=Ve(this),{has:s,get:u}=ga(a);let c=s.call(a,o);c||(o=Ve(o),c=s.call(a,o));const l=u.call(a,o);return a.set(o,i),c?Vr(i,l)&&fr(a,"set",o,i):fr(a,"add",o,i),this},delete(o){const i=Ve(this),{has:a,get:s}=ga(i);let u=a.call(i,o);u||(o=Ve(o),u=a.call(i,o)),s&&s.call(i,o);const c=i.delete(o);return u&&fr(i,"delete",o,void 0),c},clear(){const o=Ve(this),i=o.size!==0,a=o.clear();return i&&fr(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{t[o]=E0(o,e,n)}),t}function bl(e,n){const t=S0(e,n);return(r,o,i)=>o==="__v_isReactive"?!e:o==="__v_isReadonly"?e:o==="__v_raw"?r:Reflect.get(qe(t,o)&&o in r?t:r,o,i)}const R0={get:bl(!1,!1)},k0={get:bl(!1,!0)},I0={get:bl(!0,!1)},Kp=new WeakMap,Xp=new WeakMap,Yp=new WeakMap,A0=new WeakMap;function T0(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function D0(e){return e.__v_skip||!Object.isExtensible(e)?0:T0(t0(e))}function Hn(e){return yr(e)?e:xl(e,!1,w0,R0,Kp)}function Qp(e){return xl(e,!1,C0,k0,Xp)}function bc(e){return xl(e,!0,_0,I0,Yp)}function xl(e,n,t,r,o){if(!Ke(e)||e.__v_raw&&!(n&&e.__v_isReactive))return e;const i=D0(e);if(i===0)return e;const a=o.get(e);if(a)return a;const s=new Proxy(e,i===2?r:t);return o.set(e,s),s}function ho(e){return yr(e)?ho(e.__v_raw):!!(e&&e.__v_isReactive)}function yr(e){return!!(e&&e.__v_isReadonly)}function xn(e){return!!(e&&e.__v_isShallow)}function wl(e){return e?!!e.__v_raw:!1}function Ve(e){const n=e&&e.__v_raw;return n?Ve(n):e}function Ws(e){return!qe(e,"__v_skip")&&Object.isExtensible(e)&&Fp(e,"__v_skip",!0),e}const An=e=>Ke(e)?Hn(e):e,ai=e=>Ke(e)?bc(e):e;function Bt(e){return e?e.__v_isRef===!0:!1}function Re(e){return Jp(e,!1)}function N0(e){return Jp(e,!0)}function Jp(e,n){return Bt(e)?e:new F0(e,n)}class F0{constructor(n,t){this.dep=new yl,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?n:Ve(n),this._value=t?n:An(n),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(n){const t=this._rawValue,r=this.__v_isShallow||xn(n)||yr(n);n=r?n:Ve(n),Vr(n,t)&&(this._rawValue=n,this._value=r?n:An(n),this.dep.trigger())}}function po(e){return Bt(e)?e.value:e}const P0={get:(e,n,t)=>n==="__v_raw"?e:po(Reflect.get(e,n,t)),set:(e,n,t,r)=>{const o=e[n];return Bt(o)&&!Bt(t)?(o.value=t,!0):Reflect.set(e,n,t,r)}};function Zp(e){return ho(e)?e:new Proxy(e,P0)}class M0{constructor(n,t,r){this.fn=n,this.setter=t,this._value=void 0,this.dep=new yl(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=qi-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=r}notify(){if(this.flags|=16,!(this.flags&8)&&je!==this)return Wp(this,!0),!0}get value(){const n=this.dep.track();return zp(this),n&&(n.version=this.dep.version),this._value}set value(n){this.setter&&this.setter(n)}}function O0(e,n,t=!1){let r,o;return De(e)?r=e:(r=e.get,o=e.set),new M0(r,o,t)}const ba={},Xa=new WeakMap;let no;function B0(e,n=!1,t=no){if(t){let r=Xa.get(t);r||Xa.set(t,r=[]),r.push(e)}}function L0(e,n,t=Ge){const{immediate:r,deep:o,once:i,scheduler:a,augmentJob:s,call:u}=t,c=y=>o?y:xn(y)||o===!1||o===0?dr(y,1):dr(y);let l,f,d,h,p=!1,v=!1;if(Bt(e)?(f=()=>e.value,p=xn(e)):ho(e)?(f=()=>c(e),p=!0):Ie(e)?(v=!0,p=e.some(y=>ho(y)||xn(y)),f=()=>e.map(y=>{if(Bt(y))return y.value;if(ho(y))return c(y);if(De(y))return u?u(y,2):y()})):De(e)?n?f=u?()=>u(e,2):e:f=()=>{if(d){mr();try{d()}finally{gr()}}const y=no;no=l;try{return u?u(e,3,[h]):e(h)}finally{no=y}}:f=$n,n&&o){const y=f,w=o===!0?1/0:o;f=()=>dr(y(),w)}const m=h0(),g=()=>{l.stop(),m&&m.active&&fl(m.effects,l)};if(i&&n){const y=n;n=(...w)=>{y(...w),g()}}let b=v?new Array(e.length).fill(ba):ba;const x=y=>{if(!(!(l.flags&1)||!l.dirty&&!y))if(n){const w=l.run();if(o||p||(v?w.some((_,S)=>Vr(_,b[S])):Vr(w,b))){d&&d();const _=no;no=l;try{const S=[w,b===ba?void 0:v&&b[0]===ba?[]:b,h];b=w,u?u(n,3,S):n(...S)}finally{no=_}}}else l.run()};return s&&s(x),l=new Bp(f),l.scheduler=a?()=>a(x,!1):x,h=y=>B0(y,!1,l),d=l.onStop=()=>{const y=Xa.get(l);if(y){if(u)u(y,4);else for(const w of y)w();Xa.delete(l)}},n?r?x(!0):b=l.run():a?a(x.bind(null,!0),!0):l.run(),g.pause=l.pause.bind(l),g.resume=l.resume.bind(l),g.stop=g,g}function dr(e,n=1/0,t){if(n<=0||!Ke(e)||e.__v_skip||(t=t||new Map,(t.get(e)||0)>=n))return e;if(t.set(e,n),n--,Bt(e))dr(e.value,n,t);else if(Ie(e))for(let r=0;r<e.length;r++)dr(e[r],n,t);else if(Ap(e)||$o(e))e.forEach(r=>{dr(r,n,t)});else if(Np(e)){for(const r in e)dr(e[r],n,t);for(const r of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,r)&&dr(e[r],n,t)}return e}function ia(e,n,t,r){try{return r?e(...r):e()}catch(o){Vs(o,n,t)}}function Tn(e,n,t,r){if(De(e)){const o=ia(e,n,t,r);return o&&Tp(o)&&o.catch(i=>{Vs(i,n,t)}),o}if(Ie(e)){const o=[];for(let i=0;i<e.length;i++)o.push(Tn(e[i],n,t,r));return o}}function Vs(e,n,t,r=!0){const o=n?n.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=n&&n.appContext.config||Ge;if(n){let s=n.parent;const u=n.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;s;){const l=s.ec;if(l){for(let f=0;f<l.length;f++)if(l[f](e,u,c)===!1)return}s=s.parent}if(i){mr(),ia(i,null,10,[e,u,c]),gr();return}}W0(e,t,o,r,a)}function W0(e,n,t,r=!0,o=!1){if(o)throw e;console.error(e)}const qt=[];let Ln=-1;const Ko=[];let Fr=null,Lo=0;const ev=Promise.resolve();let Ya=null;function $t(e){const n=Ya||ev;return e?n.then(this?e.bind(this):e):n}function V0(e){let n=Ln+1,t=qt.length;for(;n<t;){const r=n+t>>>1,o=qt[r],i=Gi(o);i<e||i===e&&o.flags&2?n=r+1:t=r}return n}function _l(e){if(!(e.flags&1)){const n=Gi(e),t=qt[qt.length-1];!t||!(e.flags&2)&&n>=Gi(t)?qt.push(e):qt.splice(V0(n),0,e),e.flags|=1,tv()}}function tv(){Ya||(Ya=ev.then(rv))}function U0(e){Ie(e)?Ko.push(...e):Fr&&e.id===-1?Fr.splice(Lo+1,0,e):e.flags&1||(Ko.push(e),e.flags|=1),tv()}function $f(e,n,t=Ln+1){for(;t<qt.length;t++){const r=qt[t];if(r&&r.flags&2){if(e&&r.id!==e.uid)continue;qt.splice(t,1),t--,r.flags&4&&(r.flags&=-2),r(),r.flags&4||(r.flags&=-2)}}}function nv(e){if(Ko.length){const n=[...new Set(Ko)].sort((t,r)=>Gi(t)-Gi(r));if(Ko.length=0,Fr){Fr.push(...n);return}for(Fr=n,Lo=0;Lo<Fr.length;Lo++){const t=Fr[Lo];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Fr=null,Lo=0}}const Gi=e=>e.id==null?e.flags&2?-1:1/0:e.id;function rv(e){try{for(Ln=0;Ln<qt.length;Ln++){const n=qt[Ln];n&&!(n.flags&8)&&(n.flags&4&&(n.flags&=-2),ia(n,n.i,n.i?15:14),n.flags&4||(n.flags&=-2))}}finally{for(;Ln<qt.length;Ln++){const n=qt[Ln];n&&(n.flags&=-2)}Ln=-1,qt.length=0,nv(),Ya=null,(qt.length||Ko.length)&&rv()}}let on=null,ov=null;function Qa(e){const n=on;return on=e,ov=e&&e.type.__scopeId||null,n}function Gn(e,n=on,t){if(!n||e._n)return e;const r=(...o)=>{r._d&&es(-1);const i=Qa(n);let a;try{a=e(...o)}finally{Qa(i),r._d&&es(1)}return a};return r._n=!0,r._c=!0,r._d=!0,r}function z0(e,n){if(on===null)return e;const t=Ks(on),r=e.dirs||(e.dirs=[]);for(let o=0;o<n.length;o++){let[i,a,s,u=Ge]=n[o];i&&(De(i)&&(i={mounted:i,updated:i}),i.deep&&dr(a),r.push({dir:i,instance:t,value:a,oldValue:void 0,arg:s,modifiers:u}))}return e}function Qr(e,n,t,r){const o=e.dirs,i=n&&n.dirs;for(let a=0;a<o.length;a++){const s=o[a];i&&(s.oldValue=i[a].value);let u=s.dir[r];u&&(mr(),Tn(u,t,8,[e.el,s,e,n]),gr())}}const iv=Symbol("_vte"),av=e=>e.__isTeleport,Pi=e=>e&&(e.disabled||e.disabled===""),Kf=e=>e&&(e.defer||e.defer===""),Xf=e=>typeof SVGElement<"u"&&e instanceof SVGElement,Yf=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,xc=(e,n)=>{const t=e&&e.to;return rt(t)?n?n(t):null:t},sv={name:"Teleport",__isTeleport:!0,process(e,n,t,r,o,i,a,s,u,c){const{mc:l,pc:f,pbc:d,o:{insert:h,querySelector:p,createText:v,createComment:m}}=c,g=Pi(n.props);let{shapeFlag:b,children:x,dynamicChildren:y}=n;if(e==null){const w=n.el=v(""),_=n.anchor=v("");h(w,t,r),h(_,t,r);const S=(E,C)=>{b&16&&l(x,E,C,o,i,a,s,u)},R=()=>{const E=n.target=xc(n.props,p),C=uv(E,n,v,h);E&&(a!=="svg"&&Xf(E)?a="svg":a!=="mathml"&&Yf(E)&&(a="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(E),g||(S(E,C),za(n,!1)))};g&&(S(t,_),za(n,!0)),Kf(n.props)?(n.el.__isMounted=!1,Vt(()=>{R(),delete n.el.__isMounted},i)):R()}else{if(Kf(n.props)&&e.el.__isMounted===!1){Vt(()=>{sv.process(e,n,t,r,o,i,a,s,u,c)},i);return}n.el=e.el,n.targetStart=e.targetStart;const w=n.anchor=e.anchor,_=n.target=e.target,S=n.targetAnchor=e.targetAnchor,R=Pi(e.props),E=R?t:_,C=R?w:S;if(a==="svg"||Xf(_)?a="svg":(a==="mathml"||Yf(_))&&(a="mathml"),y?(d(e.dynamicChildren,y,E,o,i,a,s),kl(e,n,!0)):u||f(e,n,E,C,o,i,a,s,!1),g)R?n.props&&e.props&&n.props.to!==e.props.to&&(n.props.to=e.props.to):xa(n,t,w,c,1);else if((n.props&&n.props.to)!==(e.props&&e.props.to)){const I=n.target=xc(n.props,p);I&&xa(n,I,null,c,0)}else R&&xa(n,_,S,c,1);za(n,g)}},remove(e,n,t,{um:r,o:{remove:o}},i){const{shapeFlag:a,children:s,anchor:u,targetStart:c,targetAnchor:l,target:f,props:d}=e;if(f&&(o(c),o(l)),i&&o(u),a&16){const h=i||!Pi(d);for(let p=0;p<s.length;p++){const v=s[p];r(v,n,t,h,!!v.dynamicChildren)}}},move:xa,hydrate:q0};function xa(e,n,t,{o:{insert:r},m:o},i=2){i===0&&r(e.targetAnchor,n,t);const{el:a,anchor:s,shapeFlag:u,children:c,props:l}=e,f=i===2;if(f&&r(a,n,t),(!f||Pi(l))&&u&16)for(let d=0;d<c.length;d++)o(c[d],n,t,2);f&&r(s,n,t)}function q0(e,n,t,r,o,i,{o:{nextSibling:a,parentNode:s,querySelector:u,insert:c,createText:l}},f){function d(v,m,g,b){m.anchor=f(a(v),m,s(v),t,r,o,i),m.targetStart=g,m.targetAnchor=b}const h=n.target=xc(n.props,u),p=Pi(n.props);if(h){const v=h._lpa||h.firstChild;if(n.shapeFlag&16)if(p)d(e,n,v,v&&a(v));else{n.anchor=a(e);let m=v;for(;m;){if(m&&m.nodeType===8){if(m.data==="teleport start anchor")n.targetStart=m;else if(m.data==="teleport anchor"){n.targetAnchor=m,h._lpa=n.targetAnchor&&a(n.targetAnchor);break}}m=a(m)}n.targetAnchor||uv(h,n,l,c),f(v&&a(v),n,h,t,r,o,i)}za(n,p)}else p&&n.shapeFlag&16&&d(e,n,e,a(e));return n.anchor&&a(n.anchor)}const H0=sv;function za(e,n){const t=e.ctx;if(t&&t.ut){let r,o;for(n?(r=e.el,o=e.anchor):(r=e.targetStart,o=e.targetAnchor);r&&r!==o;)r.nodeType===1&&r.setAttribute("data-v-owner",t.uid),r=r.nextSibling;t.ut()}}function uv(e,n,t,r){const o=n.targetStart=t(""),i=n.targetAnchor=t("");return o[iv]=i,e&&(r(o,e),r(i,e)),i}const cr=Symbol("_leaveCb"),wa=Symbol("_enterCb");function cv(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return _n(()=>{e.isMounted=!0}),Qt(()=>{e.isUnmounting=!0}),e}const hn=[Function,Array],lv={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:hn,onEnter:hn,onAfterEnter:hn,onEnterCancelled:hn,onBeforeLeave:hn,onLeave:hn,onAfterLeave:hn,onLeaveCancelled:hn,onBeforeAppear:hn,onAppear:hn,onAfterAppear:hn,onAppearCancelled:hn},fv=e=>{const n=e.subTree;return n.component?fv(n.component):n},G0={name:"BaseTransition",props:lv,setup(e,{slots:n}){const t=ot(),r=cv();return()=>{const o=n.default&&Cl(n.default(),!0);if(!o||!o.length)return;const i=dv(o),a=Ve(e),{mode:s}=a;if(r.isLeaving)return xu(i);const u=Qf(i);if(!u)return xu(i);let c=ji(u,a,r,t,f=>c=f);u.type!==Ht&&yo(u,c);let l=t.subTree&&Qf(t.subTree);if(l&&l.type!==Ht&&!io(l,u)&&fv(t).type!==Ht){let f=ji(l,a,r,t);if(yo(l,f),s==="out-in"&&u.type!==Ht)return r.isLeaving=!0,f.afterLeave=()=>{r.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,l=void 0},xu(i);s==="in-out"&&u.type!==Ht?f.delayLeave=(d,h,p)=>{const v=hv(r,l);v[String(l.key)]=l,d[cr]=()=>{h(),d[cr]=void 0,delete c.delayedLeave,l=void 0},c.delayedLeave=()=>{p(),delete c.delayedLeave,l=void 0}}:l=void 0}else l&&(l=void 0);return i}}};function dv(e){let n=e[0];if(e.length>1){for(const t of e)if(t.type!==Ht){n=t;break}}return n}const j0=G0;function hv(e,n){const{leavingVNodes:t}=e;let r=t.get(n.type);return r||(r=Object.create(null),t.set(n.type,r)),r}function ji(e,n,t,r,o){const{appear:i,mode:a,persisted:s=!1,onBeforeEnter:u,onEnter:c,onAfterEnter:l,onEnterCancelled:f,onBeforeLeave:d,onLeave:h,onAfterLeave:p,onLeaveCancelled:v,onBeforeAppear:m,onAppear:g,onAfterAppear:b,onAppearCancelled:x}=n,y=String(e.key),w=hv(t,e),_=(E,C)=>{E&&Tn(E,r,9,C)},S=(E,C)=>{const I=C[1];_(E,C),Ie(E)?E.every(k=>k.length<=1)&&I():E.length<=1&&I()},R={mode:a,persisted:s,beforeEnter(E){let C=u;if(!t.isMounted)if(i)C=m||u;else return;E[cr]&&E[cr](!0);const I=w[y];I&&io(e,I)&&I.el[cr]&&I.el[cr](),_(C,[E])},enter(E){let C=c,I=l,k=f;if(!t.isMounted)if(i)C=g||c,I=b||l,k=x||f;else return;let M=!1;const P=E[wa]=L=>{M||(M=!0,L?_(k,[E]):_(I,[E]),R.delayedLeave&&R.delayedLeave(),E[wa]=void 0)};C?S(C,[E,P]):P()},leave(E,C){const I=String(e.key);if(E[wa]&&E[wa](!0),t.isUnmounting)return C();_(d,[E]);let k=!1;const M=E[cr]=P=>{k||(k=!0,C(),P?_(v,[E]):_(p,[E]),E[cr]=void 0,w[I]===e&&delete w[I])};w[I]=e,h?S(h,[E,M]):M()},clone(E){const C=ji(E,n,t,r,o);return o&&o(C),C}};return R}function xu(e){if(Us(e))return e=Hr(e),e.children=null,e}function Qf(e){if(!Us(e))return av(e.type)&&e.children?dv(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:n,children:t}=e;if(t){if(n&16)return t[0];if(n&32&&De(t.default))return t.default()}}function yo(e,n){e.shapeFlag&6&&e.component?(e.transition=n,yo(e.component.subTree,n)):e.shapeFlag&128?(e.ssContent.transition=n.clone(e.ssContent),e.ssFallback.transition=n.clone(e.ssFallback)):e.transition=n}function Cl(e,n=!1,t){let r=[],o=0;for(let i=0;i<e.length;i++){let a=e[i];const s=t==null?a.key:String(t)+String(a.key!=null?a.key:i);a.type===mn?(a.patchFlag&128&&o++,r=r.concat(Cl(a.children,n,s))):(n||a.type!==Ht)&&r.push(s!=null?Hr(a,{key:s}):a)}if(o>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function El(e,n){return De(e)?pt({name:e.name},n,{setup:e}):e}function pv(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const Ja=new WeakMap;function Mi(e,n,t,r,o=!1){if(Ie(e)){e.forEach((p,v)=>Mi(p,n&&(Ie(n)?n[v]:n),t,r,o));return}if(Oi(r)&&!o){r.shapeFlag&512&&r.type.__asyncResolved&&r.component.subTree.component&&Mi(e,n,t,r.component.subTree);return}const i=r.shapeFlag&4?Ks(r.component):r.el,a=o?null:i,{i:s,r:u}=e,c=n&&n.r,l=s.refs===Ge?s.refs={}:s.refs,f=s.setupState,d=Ve(f),h=f===Ge?Ip:p=>qe(d,p);if(c!=null&&c!==u){if(Jf(n),rt(c))l[c]=null,h(c)&&(f[c]=null);else if(Bt(c)){c.value=null;const p=n;p.k&&(l[p.k]=null)}}if(De(u))ia(u,s,12,[a,l]);else{const p=rt(u),v=Bt(u);if(p||v){const m=()=>{if(e.f){const g=p?h(u)?f[u]:l[u]:u.value;if(o)Ie(g)&&fl(g,i);else if(Ie(g))g.includes(i)||g.push(i);else if(p)l[u]=[i],h(u)&&(f[u]=l[u]);else{const b=[i];u.value=b,e.k&&(l[e.k]=b)}}else p?(l[u]=a,h(u)&&(f[u]=a)):v&&(u.value=a,e.k&&(l[e.k]=a))};if(a){const g=()=>{m(),Ja.delete(e)};g.id=-1,Ja.set(e,g),Vt(g,t)}else Jf(e),m()}}}function Jf(e){const n=Ja.get(e);n&&(n.flags|=8,Ja.delete(e))}Bs().requestIdleCallback;Bs().cancelIdleCallback;const Oi=e=>!!e.type.__asyncLoader,Us=e=>e.type.__isKeepAlive;function vv(e,n){mv(e,"a",n)}function zs(e,n){mv(e,"da",n)}function mv(e,n,t=Ft){const r=e.__wdc||(e.__wdc=()=>{let o=t;for(;o;){if(o.isDeactivated)return;o=o.parent}return e()});if(qs(n,r,t),t){let o=t.parent;for(;o&&o.parent;)Us(o.parent.vnode)&&$0(r,n,t,o),o=o.parent}}function $0(e,n,t,r){const o=qs(n,e,r,!0);Hs(()=>{fl(r[n],o)},t)}function qs(e,n,t=Ft,r=!1){if(t){const o=t[e]||(t[e]=[]),i=n.__weh||(n.__weh=(...a)=>{mr();const s=aa(t),u=Tn(n,t,e,a);return s(),gr(),u});return r?o.unshift(i):o.push(i),i}}const br=e=>(n,t=Ft)=>{(!Ki||e==="sp")&&qs(e,(...r)=>n(...r),t)},K0=br("bm"),_n=br("m"),gv=br("bu"),yv=br("u"),Qt=br("bum"),Hs=br("um"),X0=br("sp"),Y0=br("rtg"),Q0=br("rtc");function J0(e,n=Ft){qs("ec",e,n)}const Z0="components";function eb(e,n){return nb(Z0,e,!0,n)||e}const tb=Symbol.for("v-ndc");function nb(e,n,t=!0,r=!1){const o=on||Ft;if(o){const i=o.type;{const s=Gb(i,!1);if(s&&(s===n||s===wn(n)||s===Os(wn(n))))return i}const a=Zf(o[e]||i[e],n)||Zf(o.appContext[e],n);return!a&&r?i:a}}function Zf(e,n){return e&&(e[n]||e[wn(n)]||e[Os(wn(n))])}function rb(e,n,t,r){let o;const i=t,a=Ie(e);if(a||rt(e)){const s=a&&ho(e);let u=!1,c=!1;s&&(u=!xn(e),c=yr(e),e=Ls(e)),o=new Array(e.length);for(let l=0,f=e.length;l<f;l++)o[l]=n(u?c?ai(An(e[l])):An(e[l]):e[l],l,void 0,i)}else if(typeof e=="number"){o=new Array(e);for(let s=0;s<e;s++)o[s]=n(s+1,s,void 0,i)}else if(Ke(e))if(e[Symbol.iterator])o=Array.from(e,(s,u)=>n(s,u,void 0,i));else{const s=Object.keys(e);o=new Array(s.length);for(let u=0,c=s.length;u<c;u++){const l=s[u];o[u]=n(e[l],l,u,i)}}else o=[];return o}const wc=e=>e?Bv(e)?Ks(e):wc(e.parent):null,Bi=pt(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>wc(e.parent),$root:e=>wc(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>xv(e),$forceUpdate:e=>e.f||(e.f=()=>{_l(e.update)}),$nextTick:e=>e.n||(e.n=$t.bind(e.proxy)),$watch:e=>pb.bind(e)}),wu=(e,n)=>e!==Ge&&!e.__isScriptSetup&&qe(e,n),ob={get({_:e},n){if(n==="__v_skip")return!0;const{ctx:t,setupState:r,data:o,props:i,accessCache:a,type:s,appContext:u}=e;if(n[0]!=="$"){const d=a[n];if(d!==void 0)switch(d){case 1:return r[n];case 2:return o[n];case 4:return t[n];case 3:return i[n]}else{if(wu(r,n))return a[n]=1,r[n];if(o!==Ge&&qe(o,n))return a[n]=2,o[n];if(qe(i,n))return a[n]=3,i[n];if(t!==Ge&&qe(t,n))return a[n]=4,t[n];_c&&(a[n]=0)}}const c=Bi[n];let l,f;if(c)return n==="$attrs"&&Dt(e.attrs,"get",""),c(e);if((l=s.__cssModules)&&(l=l[n]))return l;if(t!==Ge&&qe(t,n))return a[n]=4,t[n];if(f=u.config.globalProperties,qe(f,n))return f[n]},set({_:e},n,t){const{data:r,setupState:o,ctx:i}=e;return wu(o,n)?(o[n]=t,!0):r!==Ge&&qe(r,n)?(r[n]=t,!0):qe(e.props,n)||n[0]==="$"&&n.slice(1)in e?!1:(i[n]=t,!0)},has({_:{data:e,setupState:n,accessCache:t,ctx:r,appContext:o,props:i,type:a}},s){let u;return!!(t[s]||e!==Ge&&s[0]!=="$"&&qe(e,s)||wu(n,s)||qe(i,s)||qe(r,s)||qe(Bi,s)||qe(o.config.globalProperties,s)||(u=a.__cssModules)&&u[s])},defineProperty(e,n,t){return t.get!=null?e._.accessCache[n]=0:qe(t,"value")&&this.set(e,n,t.value,null),Reflect.defineProperty(e,n,t)}};function ed(e){return Ie(e)?e.reduce((n,t)=>(n[t]=null,n),{}):e}let _c=!0;function ib(e){const n=xv(e),t=e.proxy,r=e.ctx;_c=!1,n.beforeCreate&&td(n.beforeCreate,e,"bc");const{data:o,computed:i,methods:a,watch:s,provide:u,inject:c,created:l,beforeMount:f,mounted:d,beforeUpdate:h,updated:p,activated:v,deactivated:m,beforeDestroy:g,beforeUnmount:b,destroyed:x,unmounted:y,render:w,renderTracked:_,renderTriggered:S,errorCaptured:R,serverPrefetch:E,expose:C,inheritAttrs:I,components:k,directives:M,filters:P}=n;if(c&&ab(c,r,null),a)for(const V in a){const F=a[V];De(F)&&(r[V]=F.bind(t))}if(o){const V=o.call(t,t);Ke(V)&&(e.data=Hn(V))}if(_c=!0,i)for(const V in i){const F=i[V],H=De(F)?F.bind(t,t):De(F.get)?F.get.bind(t,t):$n,$=!De(F)&&De(F.set)?F.set.bind(t):$n,G=oe({get:H,set:$});Object.defineProperty(r,V,{enumerable:!0,configurable:!0,get:()=>G.value,set:O=>G.value=O})}if(s)for(const V in s)bv(s[V],r,t,V);if(u){const V=De(u)?u.call(t):u;Reflect.ownKeys(V).forEach(F=>{Yo(F,V[F])})}l&&td(l,e,"c");function q(V,F){Ie(F)?F.forEach(H=>V(H.bind(t))):F&&V(F.bind(t))}if(q(K0,f),q(_n,d),q(gv,h),q(yv,p),q(vv,v),q(zs,m),q(J0,R),q(Q0,_),q(Y0,S),q(Qt,b),q(Hs,y),q(X0,E),Ie(C))if(C.length){const V=e.exposed||(e.exposed={});C.forEach(F=>{Object.defineProperty(V,F,{get:()=>t[F],set:H=>t[F]=H,enumerable:!0})})}else e.exposed||(e.exposed={});w&&e.render===$n&&(e.render=w),I!=null&&(e.inheritAttrs=I),k&&(e.components=k),M&&(e.directives=M),E&&pv(e)}function ab(e,n,t=$n){Ie(e)&&(e=Cc(e));for(const r in e){const o=e[r];let i;Ke(o)?"default"in o?i=Xt(o.from||r,o.default,!0):i=Xt(o.from||r):i=Xt(o),Bt(i)?Object.defineProperty(n,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):n[r]=i}}function td(e,n,t){Tn(Ie(e)?e.map(r=>r.bind(n.proxy)):e.bind(n.proxy),n,t)}function bv(e,n,t,r){let o=r.includes(".")?Cv(t,r):()=>t[r];if(rt(e)){const i=n[e];De(i)&&$e(o,i)}else if(De(e))$e(o,e.bind(t));else if(Ke(e))if(Ie(e))e.forEach(i=>bv(i,n,t,r));else{const i=De(e.handler)?e.handler.bind(t):n[e.handler];De(i)&&$e(o,i,e)}}function xv(e){const n=e.type,{mixins:t,extends:r}=n,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=e.appContext,s=i.get(n);let u;return s?u=s:!o.length&&!t&&!r?u=n:(u={},o.length&&o.forEach(c=>Za(u,c,a,!0)),Za(u,n,a)),Ke(n)&&i.set(n,u),u}function Za(e,n,t,r=!1){const{mixins:o,extends:i}=n;i&&Za(e,i,t,!0),o&&o.forEach(a=>Za(e,a,t,!0));for(const a in n)if(!(r&&a==="expose")){const s=sb[a]||t&&t[a];e[a]=s?s(e[a],n[a]):n[a]}return e}const sb={data:nd,props:rd,emits:rd,methods:Ii,computed:Ii,beforeCreate:Wt,created:Wt,beforeMount:Wt,mounted:Wt,beforeUpdate:Wt,updated:Wt,beforeDestroy:Wt,beforeUnmount:Wt,destroyed:Wt,unmounted:Wt,activated:Wt,deactivated:Wt,errorCaptured:Wt,serverPrefetch:Wt,components:Ii,directives:Ii,watch:cb,provide:nd,inject:ub};function nd(e,n){return n?e?function(){return pt(De(e)?e.call(this,this):e,De(n)?n.call(this,this):n)}:n:e}function ub(e,n){return Ii(Cc(e),Cc(n))}function Cc(e){if(Ie(e)){const n={};for(let t=0;t<e.length;t++)n[e[t]]=e[t];return n}return e}function Wt(e,n){return e?[...new Set([].concat(e,n))]:n}function Ii(e,n){return e?pt(Object.create(null),e,n):n}function rd(e,n){return e?Ie(e)&&Ie(n)?[...new Set([...e,...n])]:pt(Object.create(null),ed(e),ed(n??{})):n}function cb(e,n){if(!e)return n;if(!n)return e;const t=pt(Object.create(null),e);for(const r in n)t[r]=Wt(e[r],n[r]);return t}function wv(){return{app:null,config:{isNativeTag:Ip,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let lb=0;function fb(e,n){return function(r,o=null){De(r)||(r=pt({},r)),o!=null&&!Ke(o)&&(o=null);const i=wv(),a=new WeakSet,s=[];let u=!1;const c=i.app={_uid:lb++,_component:r,_props:o,_container:null,_context:i,_instance:null,version:$b,get config(){return i.config},set config(l){},use(l,...f){return a.has(l)||(l&&De(l.install)?(a.add(l),l.install(c,...f)):De(l)&&(a.add(l),l(c,...f))),c},mixin(l){return i.mixins.includes(l)||i.mixins.push(l),c},component(l,f){return f?(i.components[l]=f,c):i.components[l]},directive(l,f){return f?(i.directives[l]=f,c):i.directives[l]},mount(l,f,d){if(!u){const h=c._ceVNode||Ne(r,o);return h.appContext=i,d===!0?d="svg":d===!1&&(d=void 0),e(h,l,d),u=!0,c._container=l,l.__vue_app__=c,Ks(h.component)}},onUnmount(l){s.push(l)},unmount(){u&&(Tn(s,c._instance,16),e(null,c._container),delete c._container.__vue_app__)},provide(l,f){return i.provides[l]=f,c},runWithContext(l){const f=Xo;Xo=c;try{return l()}finally{Xo=f}}};return c}}let Xo=null;function Yo(e,n){if(Ft){let t=Ft.provides;const r=Ft.parent&&Ft.parent.provides;r===t&&(t=Ft.provides=Object.create(r)),t[e]=n}}function Xt(e,n,t=!1){const r=ot();if(r||Xo){let o=Xo?Xo._context.provides:r?r.parent==null||r.ce?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return t&&De(n)?n.call(r&&r.proxy):n}}const db=Symbol.for("v-scx"),hb=()=>Xt(db);function $e(e,n,t){return _v(e,n,t)}function _v(e,n,t=Ge){const{immediate:r,deep:o,flush:i,once:a}=t,s=pt({},t),u=n&&r||!n&&i!=="post";let c;if(Ki){if(i==="sync"){const h=hb();c=h.__watcherHandles||(h.__watcherHandles=[])}else if(!u){const h=()=>{};return h.stop=$n,h.resume=$n,h.pause=$n,h}}const l=Ft;s.call=(h,p,v)=>Tn(h,l,p,v);let f=!1;i==="post"?s.scheduler=h=>{Vt(h,l&&l.suspense)}:i!=="sync"&&(f=!0,s.scheduler=(h,p)=>{p?h():_l(h)}),s.augmentJob=h=>{n&&(h.flags|=4),f&&(h.flags|=2,l&&(h.id=l.uid,h.i=l))};const d=L0(e,n,s);return Ki&&(c?c.push(d):u&&d()),d}function pb(e,n,t){const r=this.proxy,o=rt(e)?e.includes(".")?Cv(r,e):()=>r[e]:e.bind(r,r);let i;De(n)?i=n:(i=n.handler,t=n);const a=aa(this),s=_v(o,i.bind(r),t);return a(),s}function Cv(e,n){const t=n.split(".");return()=>{let r=e;for(let o=0;o<t.length&&r;o++)r=r[t[o]];return r}}const vb=(e,n)=>n==="modelValue"||n==="model-value"?e.modelModifiers:e[`${n}Modifiers`]||e[`${wn(n)}Modifiers`]||e[`${_o(n)}Modifiers`];function mb(e,n,...t){if(e.isUnmounted)return;const r=e.vnode.props||Ge;let o=t;const i=n.startsWith("update:"),a=i&&vb(r,n.slice(7));a&&(a.trim&&(o=t.map(l=>rt(l)?l.trim():l)),a.number&&(o=t.map(o0)));let s,u=r[s=pu(n)]||r[s=pu(wn(n))];!u&&i&&(u=r[s=pu(_o(n))]),u&&Tn(u,e,6,o);const c=r[s+"Once"];if(c){if(!e.emitted)e.emitted={};else if(e.emitted[s])return;e.emitted[s]=!0,Tn(c,e,6,o)}}const gb=new WeakMap;function Ev(e,n,t=!1){const r=t?gb:n.emitsCache,o=r.get(e);if(o!==void 0)return o;const i=e.emits;let a={},s=!1;if(!De(e)){const u=c=>{const l=Ev(c,n,!0);l&&(s=!0,pt(a,l))};!t&&n.mixins.length&&n.mixins.forEach(u),e.extends&&u(e.extends),e.mixins&&e.mixins.forEach(u)}return!i&&!s?(Ke(e)&&r.set(e,null),null):(Ie(i)?i.forEach(u=>a[u]=null):pt(a,i),Ke(e)&&r.set(e,a),a)}function Gs(e,n){return!e||!Fs(n)?!1:(n=n.slice(2).replace(/Once$/,""),qe(e,n[0].toLowerCase()+n.slice(1))||qe(e,_o(n))||qe(e,n))}function od(e){const{type:n,vnode:t,proxy:r,withProxy:o,propsOptions:[i],slots:a,attrs:s,emit:u,render:c,renderCache:l,props:f,data:d,setupState:h,ctx:p,inheritAttrs:v}=e,m=Qa(e);let g,b;try{if(t.shapeFlag&4){const y=o||r,w=y;g=Vn(c.call(w,y,l,f,h,d,p)),b=s}else{const y=n;g=Vn(y.length>1?y(f,{attrs:s,slots:a,emit:u}):y(f,null)),b=n.props?s:yb(s)}}catch(y){Li.length=0,Vs(y,e,1),g=Ne(Ht)}let x=g;if(b&&v!==!1){const y=Object.keys(b),{shapeFlag:w}=x;y.length&&w&7&&(i&&y.some(ll)&&(b=bb(b,i)),x=Hr(x,b,!1,!0))}return t.dirs&&(x=Hr(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(t.dirs):t.dirs),t.transition&&yo(x,t.transition),g=x,Qa(m),g}const yb=e=>{let n;for(const t in e)(t==="class"||t==="style"||Fs(t))&&((n||(n={}))[t]=e[t]);return n},bb=(e,n)=>{const t={};for(const r in e)(!ll(r)||!(r.slice(9)in n))&&(t[r]=e[r]);return t};function xb(e,n,t){const{props:r,children:o,component:i}=e,{props:a,children:s,patchFlag:u}=n,c=i.emitsOptions;if(n.dirs||n.transition)return!0;if(t&&u>=0){if(u&1024)return!0;if(u&16)return r?id(r,a,c):!!a;if(u&8){const l=n.dynamicProps;for(let f=0;f<l.length;f++){const d=l[f];if(a[d]!==r[d]&&!Gs(c,d))return!0}}}else return(o||s)&&(!s||!s.$stable)?!0:r===a?!1:r?a?id(r,a,c):!0:!!a;return!1}function id(e,n,t){const r=Object.keys(n);if(r.length!==Object.keys(e).length)return!0;for(let o=0;o<r.length;o++){const i=r[o];if(n[i]!==e[i]&&!Gs(t,i))return!0}return!1}function wb({vnode:e,parent:n},t){for(;n;){const r=n.subTree;if(r.suspense&&r.suspense.activeBranch===e&&(r.el=e.el),r===e)(e=n.vnode).el=t,n=n.parent;else break}}const Sv={},Rv=()=>Object.create(Sv),kv=e=>Object.getPrototypeOf(e)===Sv;function _b(e,n,t,r=!1){const o={},i=Rv();e.propsDefaults=Object.create(null),Iv(e,n,o,i);for(const a in e.propsOptions[0])a in o||(o[a]=void 0);t?e.props=r?o:Qp(o):e.type.props?e.props=o:e.props=i,e.attrs=i}function Cb(e,n,t,r){const{props:o,attrs:i,vnode:{patchFlag:a}}=e,s=Ve(o),[u]=e.propsOptions;let c=!1;if((r||a>0)&&!(a&16)){if(a&8){const l=e.vnode.dynamicProps;for(let f=0;f<l.length;f++){let d=l[f];if(Gs(e.emitsOptions,d))continue;const h=n[d];if(u)if(qe(i,d))h!==i[d]&&(i[d]=h,c=!0);else{const p=wn(d);o[p]=Ec(u,s,p,h,e,!1)}else h!==i[d]&&(i[d]=h,c=!0)}}}else{Iv(e,n,o,i)&&(c=!0);let l;for(const f in s)(!n||!qe(n,f)&&((l=_o(f))===f||!qe(n,l)))&&(u?t&&(t[f]!==void 0||t[l]!==void 0)&&(o[f]=Ec(u,s,f,void 0,e,!0)):delete o[f]);if(i!==s)for(const f in i)(!n||!qe(n,f))&&(delete i[f],c=!0)}c&&fr(e.attrs,"set","")}function Iv(e,n,t,r){const[o,i]=e.propsOptions;let a=!1,s;if(n)for(let u in n){if(Di(u))continue;const c=n[u];let l;o&&qe(o,l=wn(u))?!i||!i.includes(l)?t[l]=c:(s||(s={}))[l]=c:Gs(e.emitsOptions,u)||(!(u in r)||c!==r[u])&&(r[u]=c,a=!0)}if(i){const u=Ve(t),c=s||Ge;for(let l=0;l<i.length;l++){const f=i[l];t[f]=Ec(o,u,f,c[f],e,!qe(c,f))}}return a}function Ec(e,n,t,r,o,i){const a=e[t];if(a!=null){const s=qe(a,"default");if(s&&r===void 0){const u=a.default;if(a.type!==Function&&!a.skipFactory&&De(u)){const{propsDefaults:c}=o;if(t in c)r=c[t];else{const l=aa(o);r=c[t]=u.call(null,n),l()}}else r=u;o.ce&&o.ce._setProp(t,r)}a[0]&&(i&&!s?r=!1:a[1]&&(r===""||r===_o(t))&&(r=!0))}return r}const Eb=new WeakMap;function Av(e,n,t=!1){const r=t?Eb:n.propsCache,o=r.get(e);if(o)return o;const i=e.props,a={},s=[];let u=!1;if(!De(e)){const l=f=>{u=!0;const[d,h]=Av(f,n,!0);pt(a,d),h&&s.push(...h)};!t&&n.mixins.length&&n.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}if(!i&&!u)return Ke(e)&&r.set(e,jo),jo;if(Ie(i))for(let l=0;l<i.length;l++){const f=wn(i[l]);ad(f)&&(a[f]=Ge)}else if(i)for(const l in i){const f=wn(l);if(ad(f)){const d=i[l],h=a[f]=Ie(d)||De(d)?{type:d}:pt({},d),p=h.type;let v=!1,m=!0;if(Ie(p))for(let g=0;g<p.length;++g){const b=p[g],x=De(b)&&b.name;if(x==="Boolean"){v=!0;break}else x==="String"&&(m=!1)}else v=De(p)&&p.name==="Boolean";h[0]=v,h[1]=m,(v||qe(h,"default"))&&s.push(f)}}const c=[a,s];return Ke(e)&&r.set(e,c),c}function ad(e){return e[0]!=="$"&&!Di(e)}const Sl=e=>e==="_"||e==="_ctx"||e==="$stable",Rl=e=>Ie(e)?e.map(Vn):[Vn(e)],Sb=(e,n,t)=>{if(n._n)return n;const r=Gn((...o)=>Rl(n(...o)),t);return r._c=!1,r},Tv=(e,n,t)=>{const r=e._ctx;for(const o in e){if(Sl(o))continue;const i=e[o];if(De(i))n[o]=Sb(o,i,r);else if(i!=null){const a=Rl(i);n[o]=()=>a}}},Dv=(e,n)=>{const t=Rl(n);e.slots.default=()=>t},Nv=(e,n,t)=>{for(const r in n)(t||!Sl(r))&&(e[r]=n[r])},Rb=(e,n,t)=>{const r=e.slots=Rv();if(e.vnode.shapeFlag&32){const o=n._;o?(Nv(r,n,t),t&&Fp(r,"_",o,!0)):Tv(n,r)}else n&&Dv(e,n)},kb=(e,n,t)=>{const{vnode:r,slots:o}=e;let i=!0,a=Ge;if(r.shapeFlag&32){const s=n._;s?t&&s===1?i=!1:Nv(o,n,t):(i=!n.$stable,Tv(n,o)),a=n}else n&&(Dv(e,n),a={default:1});if(i)for(const s in o)!Sl(s)&&a[s]==null&&delete o[s]},Vt=Nb;function Ib(e){return Ab(e)}function Ab(e,n){const t=Bs();t.__VUE__=!0;const{insert:r,remove:o,patchProp:i,createElement:a,createText:s,createComment:u,setText:c,setElementText:l,parentNode:f,nextSibling:d,setScopeId:h=$n,insertStaticContent:p}=e,v=(D,N,U,X=null,Y=null,J=null,ce=void 0,ie=null,ue=!!N.dynamicChildren)=>{if(D===N)return;D&&!io(D,N)&&(X=z(D),O(D,Y,J,!0),D=null),N.patchFlag===-2&&(ue=!1,N.dynamicChildren=null);const{type:ne,ref:Ce,shapeFlag:fe}=N;switch(ne){case js:m(D,N,U,X);break;case Ht:g(D,N,U,X);break;case Cu:D==null&&b(N,U,X,ce);break;case mn:k(D,N,U,X,Y,J,ce,ie,ue);break;default:fe&1?w(D,N,U,X,Y,J,ce,ie,ue):fe&6?M(D,N,U,X,Y,J,ce,ie,ue):(fe&64||fe&128)&&ne.process(D,N,U,X,Y,J,ce,ie,ue,le)}Ce!=null&&Y?Mi(Ce,D&&D.ref,J,N||D,!N):Ce==null&&D&&D.ref!=null&&Mi(D.ref,null,J,D,!0)},m=(D,N,U,X)=>{if(D==null)r(N.el=s(N.children),U,X);else{const Y=N.el=D.el;N.children!==D.children&&c(Y,N.children)}},g=(D,N,U,X)=>{D==null?r(N.el=u(N.children||""),U,X):N.el=D.el},b=(D,N,U,X)=>{[D.el,D.anchor]=p(D.children,N,U,X,D.el,D.anchor)},x=({el:D,anchor:N},U,X)=>{let Y;for(;D&&D!==N;)Y=d(D),r(D,U,X),D=Y;r(N,U,X)},y=({el:D,anchor:N})=>{let U;for(;D&&D!==N;)U=d(D),o(D),D=U;o(N)},w=(D,N,U,X,Y,J,ce,ie,ue)=>{if(N.type==="svg"?ce="svg":N.type==="math"&&(ce="mathml"),D==null)_(N,U,X,Y,J,ce,ie,ue);else{const ne=D.el&&D.el._isVueCE?D.el:null;try{ne&&ne._beginPatch(),E(D,N,Y,J,ce,ie,ue)}finally{ne&&ne._endPatch()}}},_=(D,N,U,X,Y,J,ce,ie)=>{let ue,ne;const{props:Ce,shapeFlag:fe,transition:Ee,dirs:Se}=D;if(ue=D.el=a(D.type,J,Ce&&Ce.is,Ce),fe&8?l(ue,D.children):fe&16&&R(D.children,ue,null,X,Y,_u(D,J),ce,ie),Se&&Qr(D,null,X,"created"),S(ue,D,D.scopeId,ce,X),Ce){for(const We in Ce)We!=="value"&&!Di(We)&&i(ue,We,null,Ce[We],J,X);"value"in Ce&&i(ue,"value",null,Ce.value,J),(ne=Ce.onVnodeBeforeMount)&&Mn(ne,X,D)}Se&&Qr(D,null,X,"beforeMount");const Me=Tb(Y,Ee);Me&&Ee.beforeEnter(ue),r(ue,N,U),((ne=Ce&&Ce.onVnodeMounted)||Me||Se)&&Vt(()=>{ne&&Mn(ne,X,D),Me&&Ee.enter(ue),Se&&Qr(D,null,X,"mounted")},Y)},S=(D,N,U,X,Y)=>{if(U&&h(D,U),X)for(let J=0;J<X.length;J++)h(D,X[J]);if(Y){let J=Y.subTree;if(N===J||Pv(J.type)&&(J.ssContent===N||J.ssFallback===N)){const ce=Y.vnode;S(D,ce,ce.scopeId,ce.slotScopeIds,Y.parent)}}},R=(D,N,U,X,Y,J,ce,ie,ue=0)=>{for(let ne=ue;ne<D.length;ne++){const Ce=D[ne]=ie?Pr(D[ne]):Vn(D[ne]);v(null,Ce,N,U,X,Y,J,ce,ie)}},E=(D,N,U,X,Y,J,ce)=>{const ie=N.el=D.el;let{patchFlag:ue,dynamicChildren:ne,dirs:Ce}=N;ue|=D.patchFlag&16;const fe=D.props||Ge,Ee=N.props||Ge;let Se;if(U&&Jr(U,!1),(Se=Ee.onVnodeBeforeUpdate)&&Mn(Se,U,N,D),Ce&&Qr(N,D,U,"beforeUpdate"),U&&Jr(U,!0),(fe.innerHTML&&Ee.innerHTML==null||fe.textContent&&Ee.textContent==null)&&l(ie,""),ne?C(D.dynamicChildren,ne,ie,U,X,_u(N,Y),J):ce||F(D,N,ie,null,U,X,_u(N,Y),J,!1),ue>0){if(ue&16)I(ie,fe,Ee,U,Y);else if(ue&2&&fe.class!==Ee.class&&i(ie,"class",null,Ee.class,Y),ue&4&&i(ie,"style",fe.style,Ee.style,Y),ue&8){const Me=N.dynamicProps;for(let We=0;We<Me.length;We++){const Pe=Me[We],yt=fe[Pe],It=Ee[Pe];(It!==yt||Pe==="value")&&i(ie,Pe,yt,It,Y,U)}}ue&1&&D.children!==N.children&&l(ie,N.children)}else!ce&&ne==null&&I(ie,fe,Ee,U,Y);((Se=Ee.onVnodeUpdated)||Ce)&&Vt(()=>{Se&&Mn(Se,U,N,D),Ce&&Qr(N,D,U,"updated")},X)},C=(D,N,U,X,Y,J,ce)=>{for(let ie=0;ie<N.length;ie++){const ue=D[ie],ne=N[ie],Ce=ue.el&&(ue.type===mn||!io(ue,ne)||ue.shapeFlag&198)?f(ue.el):U;v(ue,ne,Ce,null,X,Y,J,ce,!0)}},I=(D,N,U,X,Y)=>{if(N!==U){if(N!==Ge)for(const J in N)!Di(J)&&!(J in U)&&i(D,J,N[J],null,Y,X);for(const J in U){if(Di(J))continue;const ce=U[J],ie=N[J];ce!==ie&&J!=="value"&&i(D,J,ie,ce,Y,X)}"value"in U&&i(D,"value",N.value,U.value,Y)}},k=(D,N,U,X,Y,J,ce,ie,ue)=>{const ne=N.el=D?D.el:s(""),Ce=N.anchor=D?D.anchor:s("");let{patchFlag:fe,dynamicChildren:Ee,slotScopeIds:Se}=N;Se&&(ie=ie?ie.concat(Se):Se),D==null?(r(ne,U,X),r(Ce,U,X),R(N.children||[],U,Ce,Y,J,ce,ie,ue)):fe>0&&fe&64&&Ee&&D.dynamicChildren?(C(D.dynamicChildren,Ee,U,Y,J,ce,ie),(N.key!=null||Y&&N===Y.subTree)&&kl(D,N,!0)):F(D,N,U,Ce,Y,J,ce,ie,ue)},M=(D,N,U,X,Y,J,ce,ie,ue)=>{N.slotScopeIds=ie,D==null?N.shapeFlag&512?Y.ctx.activate(N,U,X,ce,ue):P(N,U,X,Y,J,ce,ue):L(D,N,ue)},P=(D,N,U,X,Y,J,ce)=>{const ie=D.component=Vb(D,X,Y);if(Us(D)&&(ie.ctx.renderer=le),Ub(ie,!1,ce),ie.asyncDep){if(Y&&Y.registerDep(ie,q,ce),!D.el){const ue=ie.subTree=Ne(Ht);g(null,ue,N,U),D.placeholder=ue.el}}else q(ie,D,N,U,Y,J,ce)},L=(D,N,U)=>{const X=N.component=D.component;if(xb(D,N,U))if(X.asyncDep&&!X.asyncResolved){V(X,N,U);return}else X.next=N,X.update();else N.el=D.el,X.vnode=N},q=(D,N,U,X,Y,J,ce)=>{const ie=()=>{if(D.isMounted){let{next:fe,bu:Ee,u:Se,parent:Me,vnode:We}=D;{const dn=Fv(D);if(dn){fe&&(fe.el=We.el,V(D,fe,ce)),dn.asyncDep.then(()=>{D.isUnmounted||ie()});return}}let Pe=fe,yt;Jr(D,!1),fe?(fe.el=We.el,V(D,fe,ce)):fe=We,Ee&&vu(Ee),(yt=fe.props&&fe.props.onVnodeBeforeUpdate)&&Mn(yt,Me,fe,We),Jr(D,!0);const It=od(D),fn=D.subTree;D.subTree=It,v(fn,It,f(fn.el),z(fn),D,Y,J),fe.el=It.el,Pe===null&&wb(D,It.el),Se&&Vt(Se,Y),(yt=fe.props&&fe.props.onVnodeUpdated)&&Vt(()=>Mn(yt,Me,fe,We),Y)}else{let fe;const{el:Ee,props:Se}=N,{bm:Me,m:We,parent:Pe,root:yt,type:It}=D,fn=Oi(N);Jr(D,!1),Me&&vu(Me),!fn&&(fe=Se&&Se.onVnodeBeforeMount)&&Mn(fe,Pe,N),Jr(D,!0);{yt.ce&&yt.ce._def.shadowRoot!==!1&&yt.ce._injectChildStyle(It);const dn=D.subTree=od(D);v(null,dn,U,X,D,Y,J),N.el=dn.el}if(We&&Vt(We,Y),!fn&&(fe=Se&&Se.onVnodeMounted)){const dn=N;Vt(()=>Mn(fe,Pe,dn),Y)}(N.shapeFlag&256||Pe&&Oi(Pe.vnode)&&Pe.vnode.shapeFlag&256)&&D.a&&Vt(D.a,Y),D.isMounted=!0,N=U=X=null}};D.scope.on();const ue=D.effect=new Bp(ie);D.scope.off();const ne=D.update=ue.run.bind(ue),Ce=D.job=ue.runIfDirty.bind(ue);Ce.i=D,Ce.id=D.uid,ue.scheduler=()=>_l(Ce),Jr(D,!0),ne()},V=(D,N,U)=>{N.component=D;const X=D.vnode.props;D.vnode=N,D.next=null,Cb(D,N.props,X,U),kb(D,N.children,U),mr(),$f(D),gr()},F=(D,N,U,X,Y,J,ce,ie,ue=!1)=>{const ne=D&&D.children,Ce=D?D.shapeFlag:0,fe=N.children,{patchFlag:Ee,shapeFlag:Se}=N;if(Ee>0){if(Ee&128){$(ne,fe,U,X,Y,J,ce,ie,ue);return}else if(Ee&256){H(ne,fe,U,X,Y,J,ce,ie,ue);return}}Se&8?(Ce&16&&ae(ne,Y,J),fe!==ne&&l(U,fe)):Ce&16?Se&16?$(ne,fe,U,X,Y,J,ce,ie,ue):ae(ne,Y,J,!0):(Ce&8&&l(U,""),Se&16&&R(fe,U,X,Y,J,ce,ie,ue))},H=(D,N,U,X,Y,J,ce,ie,ue)=>{D=D||jo,N=N||jo;const ne=D.length,Ce=N.length,fe=Math.min(ne,Ce);let Ee;for(Ee=0;Ee<fe;Ee++){const Se=N[Ee]=ue?Pr(N[Ee]):Vn(N[Ee]);v(D[Ee],Se,U,null,Y,J,ce,ie,ue)}ne>Ce?ae(D,Y,J,!0,!1,fe):R(N,U,X,Y,J,ce,ie,ue,fe)},$=(D,N,U,X,Y,J,ce,ie,ue)=>{let ne=0;const Ce=N.length;let fe=D.length-1,Ee=Ce-1;for(;ne<=fe&&ne<=Ee;){const Se=D[ne],Me=N[ne]=ue?Pr(N[ne]):Vn(N[ne]);if(io(Se,Me))v(Se,Me,U,null,Y,J,ce,ie,ue);else break;ne++}for(;ne<=fe&&ne<=Ee;){const Se=D[fe],Me=N[Ee]=ue?Pr(N[Ee]):Vn(N[Ee]);if(io(Se,Me))v(Se,Me,U,null,Y,J,ce,ie,ue);else break;fe--,Ee--}if(ne>fe){if(ne<=Ee){const Se=Ee+1,Me=Se<Ce?N[Se].el:X;for(;ne<=Ee;)v(null,N[ne]=ue?Pr(N[ne]):Vn(N[ne]),U,Me,Y,J,ce,ie,ue),ne++}}else if(ne>Ee)for(;ne<=fe;)O(D[ne],Y,J,!0),ne++;else{const Se=ne,Me=ne,We=new Map;for(ne=Me;ne<=Ee;ne++){const Ct=N[ne]=ue?Pr(N[ne]):Vn(N[ne]);Ct.key!=null&&We.set(Ct.key,ne)}let Pe,yt=0;const It=Ee-Me+1;let fn=!1,dn=0;const rr=new Array(It);for(ne=0;ne<It;ne++)rr[ne]=0;for(ne=Se;ne<=fe;ne++){const Ct=D[ne];if(yt>=It){O(Ct,Y,J,!0);continue}let Pn;if(Ct.key!=null)Pn=We.get(Ct.key);else for(Pe=Me;Pe<=Ee;Pe++)if(rr[Pe-Me]===0&&io(Ct,N[Pe])){Pn=Pe;break}Pn===void 0?O(Ct,Y,J,!0):(rr[Pn-Me]=ne+1,Pn>=dn?dn=Pn:fn=!0,v(Ct,N[Pn],U,null,Y,J,ce,ie,ue),yt++)}const Io=fn?Db(rr):jo;for(Pe=Io.length-1,ne=It-1;ne>=0;ne--){const Ct=Me+ne,Pn=N[Ct],zf=N[Ct+1],qf=Ct+1<Ce?zf.el||zf.placeholder:X;rr[ne]===0?v(null,Pn,U,qf,Y,J,ce,ie,ue):fn&&(Pe<0||ne!==Io[Pe]?G(Pn,U,qf,2):Pe--)}}},G=(D,N,U,X,Y=null)=>{const{el:J,type:ce,transition:ie,children:ue,shapeFlag:ne}=D;if(ne&6){G(D.component.subTree,N,U,X);return}if(ne&128){D.suspense.move(N,U,X);return}if(ne&64){ce.move(D,N,U,le);return}if(ce===mn){r(J,N,U);for(let fe=0;fe<ue.length;fe++)G(ue[fe],N,U,X);r(D.anchor,N,U);return}if(ce===Cu){x(D,N,U);return}if(X!==2&&ne&1&&ie)if(X===0)ie.beforeEnter(J),r(J,N,U),Vt(()=>ie.enter(J),Y);else{const{leave:fe,delayLeave:Ee,afterLeave:Se}=ie,Me=()=>{D.ctx.isUnmounted?o(J):r(J,N,U)},We=()=>{J._isLeaving&&J[cr](!0),fe(J,()=>{Me(),Se&&Se()})};Ee?Ee(J,Me,We):We()}else r(J,N,U)},O=(D,N,U,X=!1,Y=!1)=>{const{type:J,props:ce,ref:ie,children:ue,dynamicChildren:ne,shapeFlag:Ce,patchFlag:fe,dirs:Ee,cacheIndex:Se}=D;if(fe===-2&&(Y=!1),ie!=null&&(mr(),Mi(ie,null,U,D,!0),gr()),Se!=null&&(N.renderCache[Se]=void 0),Ce&256){N.ctx.deactivate(D);return}const Me=Ce&1&&Ee,We=!Oi(D);let Pe;if(We&&(Pe=ce&&ce.onVnodeBeforeUnmount)&&Mn(Pe,N,D),Ce&6)be(D.component,U,X);else{if(Ce&128){D.suspense.unmount(U,X);return}Me&&Qr(D,null,N,"beforeUnmount"),Ce&64?D.type.remove(D,N,U,le,X):ne&&!ne.hasOnce&&(J!==mn||fe>0&&fe&64)?ae(ne,N,U,!1,!0):(J===mn&&fe&384||!Y&&Ce&16)&&ae(ue,N,U),X&&re(D)}(We&&(Pe=ce&&ce.onVnodeUnmounted)||Me)&&Vt(()=>{Pe&&Mn(Pe,N,D),Me&&Qr(D,null,N,"unmounted")},U)},re=D=>{const{type:N,el:U,anchor:X,transition:Y}=D;if(N===mn){he(U,X);return}if(N===Cu){y(D);return}const J=()=>{o(U),Y&&!Y.persisted&&Y.afterLeave&&Y.afterLeave()};if(D.shapeFlag&1&&Y&&!Y.persisted){const{leave:ce,delayLeave:ie}=Y,ue=()=>ce(U,J);ie?ie(D.el,J,ue):ue()}else J()},he=(D,N)=>{let U;for(;D!==N;)U=d(D),o(D),D=U;o(N)},be=(D,N,U)=>{const{bum:X,scope:Y,job:J,subTree:ce,um:ie,m:ue,a:ne}=D;sd(ue),sd(ne),X&&vu(X),Y.stop(),J&&(J.flags|=8,O(ce,D,N,U)),ie&&Vt(ie,N),Vt(()=>{D.isUnmounted=!0},N)},ae=(D,N,U,X=!1,Y=!1,J=0)=>{for(let ce=J;ce<D.length;ce++)O(D[ce],N,U,X,Y)},z=D=>{if(D.shapeFlag&6)return z(D.component.subTree);if(D.shapeFlag&128)return D.suspense.next();const N=d(D.anchor||D.el),U=N&&N[iv];return U?d(U):N};let Z=!1;const ee=(D,N,U)=>{D==null?N._vnode&&O(N._vnode,null,null,!0):v(N._vnode||null,D,N,null,null,null,U),N._vnode=D,Z||(Z=!0,$f(),nv(),Z=!1)},le={p:v,um:O,m:G,r:re,mt:P,mc:R,pc:F,pbc:C,n:z,o:e};return{render:ee,hydrate:void 0,createApp:fb(ee)}}function _u({type:e,props:n},t){return t==="svg"&&e==="foreignObject"||t==="mathml"&&e==="annotation-xml"&&n&&n.encoding&&n.encoding.includes("html")?void 0:t}function Jr({effect:e,job:n},t){t?(e.flags|=32,n.flags|=4):(e.flags&=-33,n.flags&=-5)}function Tb(e,n){return(!e||e&&!e.pendingBranch)&&n&&!n.persisted}function kl(e,n,t=!1){const r=e.children,o=n.children;if(Ie(r)&&Ie(o))for(let i=0;i<r.length;i++){const a=r[i];let s=o[i];s.shapeFlag&1&&!s.dynamicChildren&&((s.patchFlag<=0||s.patchFlag===32)&&(s=o[i]=Pr(o[i]),s.el=a.el),!t&&s.patchFlag!==-2&&kl(a,s)),s.type===js&&s.patchFlag!==-1&&(s.el=a.el),s.type===Ht&&!s.el&&(s.el=a.el)}}function Db(e){const n=e.slice(),t=[0];let r,o,i,a,s;const u=e.length;for(r=0;r<u;r++){const c=e[r];if(c!==0){if(o=t[t.length-1],e[o]<c){n[r]=o,t.push(r);continue}for(i=0,a=t.length-1;i<a;)s=i+a>>1,e[t[s]]<c?i=s+1:a=s;c<e[t[i]]&&(i>0&&(n[r]=t[i-1]),t[i]=r)}}for(i=t.length,a=t[i-1];i-- >0;)t[i]=a,a=n[a];return t}function Fv(e){const n=e.subTree.component;if(n)return n.asyncDep&&!n.asyncResolved?n:Fv(n)}function sd(e){if(e)for(let n=0;n<e.length;n++)e[n].flags|=8}const Pv=e=>e.__isSuspense;function Nb(e,n){n&&n.pendingBranch?Ie(e)?n.effects.push(...e):n.effects.push(e):U0(e)}const mn=Symbol.for("v-fgt"),js=Symbol.for("v-txt"),Ht=Symbol.for("v-cmt"),Cu=Symbol.for("v-stc"),Li=[];let an=null;function nn(e=!1){Li.push(an=e?null:[])}function Fb(){Li.pop(),an=Li[Li.length-1]||null}let $i=1;function es(e,n=!1){$i+=e,e<0&&an&&n&&(an.hasOnce=!0)}function Mv(e){return e.dynamicChildren=$i>0?an||jo:null,Fb(),$i>0&&an&&an.push(e),e}function hr(e,n,t,r,o,i){return Mv(Qe(e,n,t,r,o,i,!0))}function $s(e,n,t,r,o){return Mv(Ne(e,n,t,r,o,!0))}function ts(e){return e?e.__v_isVNode===!0:!1}function io(e,n){return e.type===n.type&&e.key===n.key}const Ov=({key:e})=>e??null,qa=({ref:e,ref_key:n,ref_for:t})=>(typeof e=="number"&&(e=""+e),e!=null?rt(e)||Bt(e)||De(e)?{i:on,r:e,k:n,f:!!t}:e:null);function Qe(e,n=null,t=null,r=0,o=null,i=e===mn?0:1,a=!1,s=!1){const u={__v_isVNode:!0,__v_skip:!0,type:e,props:n,key:n&&Ov(n),ref:n&&qa(n),scopeId:ov,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:on};return s?(Il(u,t),i&128&&e.normalize(u)):t&&(u.shapeFlag|=rt(t)?8:16),$i>0&&!a&&an&&(u.patchFlag>0||i&6)&&u.patchFlag!==32&&an.push(u),u}const Ne=Pb;function Pb(e,n=null,t=null,r=0,o=null,i=!1){if((!e||e===tb)&&(e=Ht),ts(e)){const s=Hr(e,n,!0);return t&&Il(s,t),$i>0&&!i&&an&&(s.shapeFlag&6?an[an.indexOf(e)]=s:an.push(s)),s.patchFlag=-2,s}if(jb(e)&&(e=e.__vccOpts),n){n=Mb(n);let{class:s,style:u}=n;s&&!rt(s)&&(n.class=pl(s)),Ke(u)&&(wl(u)&&!Ie(u)&&(u=pt({},u)),n.style=hl(u))}const a=rt(e)?1:Pv(e)?128:av(e)?64:Ke(e)?4:De(e)?2:0;return Qe(e,n,t,r,o,a,i,!0)}function Mb(e){return e?wl(e)||kv(e)?pt({},e):e:null}function Hr(e,n,t=!1,r=!1){const{props:o,ref:i,patchFlag:a,children:s,transition:u}=e,c=n?Bb(o||{},n):o,l={__v_isVNode:!0,__v_skip:!0,type:e.type,props:c,key:c&&Ov(c),ref:n&&n.ref?t&&i?Ie(i)?i.concat(qa(n)):[i,qa(n)]:qa(n):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:s,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:n&&e.type!==mn?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:u,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Hr(e.ssContent),ssFallback:e.ssFallback&&Hr(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return u&&r&&yo(l,u.clone(l)),l}function Ob(e=" ",n=0){return Ne(js,null,e,n)}function Qo(e="",n=!1){return n?(nn(),$s(Ht,null,e)):Ne(Ht,null,e)}function Vn(e){return e==null||typeof e=="boolean"?Ne(Ht):Ie(e)?Ne(mn,null,e.slice()):ts(e)?Pr(e):Ne(js,null,String(e))}function Pr(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Hr(e)}function Il(e,n){let t=0;const{shapeFlag:r}=e;if(n==null)n=null;else if(Ie(n))t=16;else if(typeof n=="object")if(r&65){const o=n.default;o&&(o._c&&(o._d=!1),Il(e,o()),o._c&&(o._d=!0));return}else{t=32;const o=n._;!o&&!kv(n)?n._ctx=on:o===3&&on&&(on.slots._===1?n._=1:(n._=2,e.patchFlag|=1024))}else De(n)?(n={default:n,_ctx:on},t=32):(n=String(n),r&64?(t=16,n=[Ob(n)]):t=8);e.children=n,e.shapeFlag|=t}function Bb(...e){const n={};for(let t=0;t<e.length;t++){const r=e[t];for(const o in r)if(o==="class")n.class!==r.class&&(n.class=pl([n.class,r.class]));else if(o==="style")n.style=hl([n.style,r.style]);else if(Fs(o)){const i=n[o],a=r[o];a&&i!==a&&!(Ie(i)&&i.includes(a))&&(n[o]=i?[].concat(i,a):a)}else o!==""&&(n[o]=r[o])}return n}function Mn(e,n,t,r=null){Tn(e,n,7,[t,r])}const Lb=wv();let Wb=0;function Vb(e,n,t){const r=e.type,o=(n?n.appContext:e.appContext)||Lb,i={uid:Wb++,vnode:e,type:r,parent:n,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new d0(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:n?n.provides:Object.create(o.provides),ids:n?n.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Av(r,o),emitsOptions:Ev(r,o),emit:null,emitted:null,propsDefaults:Ge,inheritAttrs:r.inheritAttrs,ctx:Ge,data:Ge,props:Ge,attrs:Ge,slots:Ge,refs:Ge,setupState:Ge,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=n?n.root:i,i.emit=mb.bind(null,i),e.ce&&e.ce(i),i}let Ft=null;const ot=()=>Ft||on;let ns,Sc;{const e=Bs(),n=(t,r)=>{let o;return(o=e[t])||(o=e[t]=[]),o.push(r),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};ns=n("__VUE_INSTANCE_SETTERS__",t=>Ft=t),Sc=n("__VUE_SSR_SETTERS__",t=>Ki=t)}const aa=e=>{const n=Ft;return ns(e),e.scope.on(),()=>{e.scope.off(),ns(n)}},ud=()=>{Ft&&Ft.scope.off(),ns(null)};function Bv(e){return e.vnode.shapeFlag&4}let Ki=!1;function Ub(e,n=!1,t=!1){n&&Sc(n);const{props:r,children:o}=e.vnode,i=Bv(e);_b(e,r,i,n),Rb(e,o,t||n);const a=i?zb(e,n):void 0;return n&&Sc(!1),a}function zb(e,n){const t=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,ob);const{setup:r}=t;if(r){mr();const o=e.setupContext=r.length>1?Hb(e):null,i=aa(e),a=ia(r,e,0,[e.props,o]),s=Tp(a);if(gr(),i(),(s||e.sp)&&!Oi(e)&&pv(e),s){if(a.then(ud,ud),n)return a.then(u=>{cd(e,u)}).catch(u=>{Vs(u,e,0)});e.asyncDep=a}else cd(e,a)}else Lv(e)}function cd(e,n,t){De(n)?e.type.__ssrInlineRender?e.ssrRender=n:e.render=n:Ke(n)&&(e.setupState=Zp(n)),Lv(e)}function Lv(e,n,t){const r=e.type;e.render||(e.render=r.render||$n);{const o=aa(e);mr();try{ib(e)}finally{gr(),o()}}}const qb={get(e,n){return Dt(e,"get",""),e[n]}};function Hb(e){const n=t=>{e.exposed=t||{}};return{attrs:new Proxy(e.attrs,qb),slots:e.slots,emit:e.emit,expose:n}}function Ks(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Zp(Ws(e.exposed)),{get(n,t){if(t in n)return n[t];if(t in Bi)return Bi[t](e)},has(n,t){return t in n||t in Bi}})):e.proxy}function Gb(e,n=!0){return De(e)?e.displayName||e.name:e.name||n&&e.__name}function jb(e){return De(e)&&"__vccOpts"in e}const oe=(e,n)=>O0(e,n,Ki);function se(e,n,t){try{es(-1);const r=arguments.length;return r===2?Ke(n)&&!Ie(n)?ts(n)?Ne(e,null,[n]):Ne(e,n):Ne(e,null,n):(r>3?t=Array.prototype.slice.call(arguments,2):r===3&&ts(t)&&(t=[t]),Ne(e,n,t))}finally{es(1)}}const $b="3.5.25";let Rc;const ld=typeof window<"u"&&window.trustedTypes;if(ld)try{Rc=ld.createPolicy("vue",{createHTML:e=>e})}catch{}const Wv=Rc?e=>Rc.createHTML(e):e=>e,Kb="http://www.w3.org/2000/svg",Xb="http://www.w3.org/1998/Math/MathML",ur=typeof document<"u"?document:null,fd=ur&&ur.createElement("template"),Yb={insert:(e,n,t)=>{n.insertBefore(e,t||null)},remove:e=>{const n=e.parentNode;n&&n.removeChild(e)},createElement:(e,n,t,r)=>{const o=n==="svg"?ur.createElementNS(Kb,e):n==="mathml"?ur.createElementNS(Xb,e):t?ur.createElement(e,{is:t}):ur.createElement(e);return e==="select"&&r&&r.multiple!=null&&o.setAttribute("multiple",r.multiple),o},createText:e=>ur.createTextNode(e),createComment:e=>ur.createComment(e),setText:(e,n)=>{e.nodeValue=n},setElementText:(e,n)=>{e.textContent=n},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>ur.querySelector(e),setScopeId(e,n){e.setAttribute(n,"")},insertStaticContent(e,n,t,r,o,i){const a=t?t.previousSibling:n.lastChild;if(o&&(o===i||o.nextSibling))for(;n.insertBefore(o.cloneNode(!0),t),!(o===i||!(o=o.nextSibling)););else{fd.innerHTML=Wv(r==="svg"?`<svg>${e}</svg>`:r==="mathml"?`<math>${e}</math>`:e);const s=fd.content;if(r==="svg"||r==="mathml"){const u=s.firstChild;for(;u.firstChild;)s.appendChild(u.firstChild);s.removeChild(u)}n.insertBefore(s,t)}return[a?a.nextSibling:n.firstChild,t?t.previousSibling:n.lastChild]}},Rr="transition",xi="animation",si=Symbol("_vtc"),Vv={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Uv=pt({},lv,Vv),Qb=e=>(e.displayName="Transition",e.props=Uv,e),rs=Qb((e,{slots:n})=>se(j0,zv(e),n)),Zr=(e,n=[])=>{Ie(e)?e.forEach(t=>t(...n)):e&&e(...n)},dd=e=>e?Ie(e)?e.some(n=>n.length>1):e.length>1:!1;function zv(e){const n={};for(const k in e)k in Vv||(n[k]=e[k]);if(e.css===!1)return n;const{name:t="v",type:r,duration:o,enterFromClass:i=`${t}-enter-from`,enterActiveClass:a=`${t}-enter-active`,enterToClass:s=`${t}-enter-to`,appearFromClass:u=i,appearActiveClass:c=a,appearToClass:l=s,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:d=`${t}-leave-active`,leaveToClass:h=`${t}-leave-to`}=e,p=Jb(o),v=p&&p[0],m=p&&p[1],{onBeforeEnter:g,onEnter:b,onEnterCancelled:x,onLeave:y,onLeaveCancelled:w,onBeforeAppear:_=g,onAppear:S=b,onAppearCancelled:R=x}=n,E=(k,M,P,L)=>{k._enterCancelled=L,Dr(k,M?l:s),Dr(k,M?c:a),P&&P()},C=(k,M)=>{k._isLeaving=!1,Dr(k,f),Dr(k,h),Dr(k,d),M&&M()},I=k=>(M,P)=>{const L=k?S:b,q=()=>E(M,k,P);Zr(L,[M,q]),hd(()=>{Dr(M,k?u:i),Bn(M,k?l:s),dd(L)||pd(M,r,v,q)})};return pt(n,{onBeforeEnter(k){Zr(g,[k]),Bn(k,i),Bn(k,a)},onBeforeAppear(k){Zr(_,[k]),Bn(k,u),Bn(k,c)},onEnter:I(!1),onAppear:I(!0),onLeave(k,M){k._isLeaving=!0;const P=()=>C(k,M);Bn(k,f),k._enterCancelled?(Bn(k,d),kc(k)):(kc(k),Bn(k,d)),hd(()=>{k._isLeaving&&(Dr(k,f),Bn(k,h),dd(y)||pd(k,r,m,P))}),Zr(y,[k,P])},onEnterCancelled(k){E(k,!1,void 0,!0),Zr(x,[k])},onAppearCancelled(k){E(k,!0,void 0,!0),Zr(R,[k])},onLeaveCancelled(k){C(k),Zr(w,[k])}})}function Jb(e){if(e==null)return null;if(Ke(e))return[Eu(e.enter),Eu(e.leave)];{const n=Eu(e);return[n,n]}}function Eu(e){return i0(e)}function Bn(e,n){n.split(/\s+/).forEach(t=>t&&e.classList.add(t)),(e[si]||(e[si]=new Set)).add(n)}function Dr(e,n){n.split(/\s+/).forEach(r=>r&&e.classList.remove(r));const t=e[si];t&&(t.delete(n),t.size||(e[si]=void 0))}function hd(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Zb=0;function pd(e,n,t,r){const o=e._endId=++Zb,i=()=>{o===e._endId&&r()};if(t!=null)return setTimeout(i,t);const{type:a,timeout:s,propCount:u}=qv(e,n);if(!a)return r();const c=a+"end";let l=0;const f=()=>{e.removeEventListener(c,d),i()},d=h=>{h.target===e&&++l>=u&&f()};setTimeout(()=>{l<u&&f()},s+1),e.addEventListener(c,d)}function qv(e,n){const t=window.getComputedStyle(e),r=p=>(t[p]||"").split(", "),o=r(`${Rr}Delay`),i=r(`${Rr}Duration`),a=vd(o,i),s=r(`${xi}Delay`),u=r(`${xi}Duration`),c=vd(s,u);let l=null,f=0,d=0;n===Rr?a>0&&(l=Rr,f=a,d=i.length):n===xi?c>0&&(l=xi,f=c,d=u.length):(f=Math.max(a,c),l=f>0?a>c?Rr:xi:null,d=l?l===Rr?i.length:u.length:0);const h=l===Rr&&/\b(?:transform|all)(?:,|$)/.test(r(`${Rr}Property`).toString());return{type:l,timeout:f,propCount:d,hasTransform:h}}function vd(e,n){for(;e.length<n.length;)e=e.concat(e);return Math.max(...n.map((t,r)=>md(t)+md(e[r])))}function md(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function kc(e){return(e?e.ownerDocument:document).body.offsetHeight}function ex(e,n,t){const r=e[si];r&&(n=(n?[n,...r]:[...r]).join(" ")),n==null?e.removeAttribute("class"):t?e.setAttribute("class",n):e.className=n}const gd=Symbol("_vod"),tx=Symbol("_vsh"),nx=Symbol(""),rx=/(?:^|;)\s*display\s*:/;function ox(e,n,t){const r=e.style,o=rt(t);let i=!1;if(t&&!o){if(n)if(rt(n))for(const a of n.split(";")){const s=a.slice(0,a.indexOf(":")).trim();t[s]==null&&Ha(r,s,"")}else for(const a in n)t[a]==null&&Ha(r,a,"");for(const a in t)a==="display"&&(i=!0),Ha(r,a,t[a])}else if(o){if(n!==t){const a=r[nx];a&&(t+=";"+a),r.cssText=t,i=rx.test(t)}}else n&&e.removeAttribute("style");gd in e&&(e[gd]=i?r.display:"",e[tx]&&(r.display="none"))}const yd=/\s*!important$/;function Ha(e,n,t){if(Ie(t))t.forEach(r=>Ha(e,n,r));else if(t==null&&(t=""),n.startsWith("--"))e.setProperty(n,t);else{const r=ix(e,n);yd.test(t)?e.setProperty(_o(r),t.replace(yd,""),"important"):e[r]=t}}const bd=["Webkit","Moz","ms"],Su={};function ix(e,n){const t=Su[n];if(t)return t;let r=wn(n);if(r!=="filter"&&r in e)return Su[n]=r;r=Os(r);for(let o=0;o<bd.length;o++){const i=bd[o]+r;if(i in e)return Su[n]=i}return n}const xd="http://www.w3.org/1999/xlink";function wd(e,n,t,r,o,i=f0(n)){r&&n.startsWith("xlink:")?t==null?e.removeAttributeNS(xd,n.slice(6,n.length)):e.setAttributeNS(xd,n,t):t==null||i&&!Pp(t)?e.removeAttribute(n):e.setAttribute(n,i?"":$r(t)?String(t):t)}function _d(e,n,t,r,o){if(n==="innerHTML"||n==="textContent"){t!=null&&(e[n]=n==="innerHTML"?Wv(t):t);return}const i=e.tagName;if(n==="value"&&i!=="PROGRESS"&&!i.includes("-")){const s=i==="OPTION"?e.getAttribute("value")||"":e.value,u=t==null?e.type==="checkbox"?"on":"":String(t);(s!==u||!("_value"in e))&&(e.value=u),t==null&&e.removeAttribute(n),e._value=t;return}let a=!1;if(t===""||t==null){const s=typeof e[n];s==="boolean"?t=Pp(t):t==null&&s==="string"?(t="",a=!0):s==="number"&&(t=0,a=!0)}try{e[n]=t}catch{}a&&e.removeAttribute(o||n)}function ax(e,n,t,r){e.addEventListener(n,t,r)}function sx(e,n,t,r){e.removeEventListener(n,t,r)}const Cd=Symbol("_vei");function ux(e,n,t,r,o=null){const i=e[Cd]||(e[Cd]={}),a=i[n];if(r&&a)a.value=r;else{const[s,u]=cx(n);if(r){const c=i[n]=dx(r,o);ax(e,s,c,u)}else a&&(sx(e,s,a,u),i[n]=void 0)}}const Ed=/(?:Once|Passive|Capture)$/;function cx(e){let n;if(Ed.test(e)){n={};let r;for(;r=e.match(Ed);)e=e.slice(0,e.length-r[0].length),n[r[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):_o(e.slice(2)),n]}let Ru=0;const lx=Promise.resolve(),fx=()=>Ru||(lx.then(()=>Ru=0),Ru=Date.now());function dx(e,n){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;Tn(hx(r,t.value),n,5,[r])};return t.value=e,t.attached=fx(),t}function hx(e,n){if(Ie(n)){const t=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{t.call(e),e._stopped=!0},n.map(r=>o=>!o._stopped&&r&&r(o))}else return n}const Sd=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,px=(e,n,t,r,o,i)=>{const a=o==="svg";n==="class"?ex(e,r,a):n==="style"?ox(e,t,r):Fs(n)?ll(n)||ux(e,n,t,r,i):(n[0]==="."?(n=n.slice(1),!0):n[0]==="^"?(n=n.slice(1),!1):vx(e,n,r,a))?(_d(e,n,r),!e.tagName.includes("-")&&(n==="value"||n==="checked"||n==="selected")&&wd(e,n,r,a,i,n!=="value")):e._isVueCE&&(/[A-Z]/.test(n)||!rt(r))?_d(e,wn(n),r,i,n):(n==="true-value"?e._trueValue=r:n==="false-value"&&(e._falseValue=r),wd(e,n,r,a))};function vx(e,n,t,r){if(r)return!!(n==="innerHTML"||n==="textContent"||n in e&&Sd(n)&&De(t));if(n==="spellcheck"||n==="draggable"||n==="translate"||n==="autocorrect"||n==="sandbox"&&e.tagName==="IFRAME"||n==="form"||n==="list"&&e.tagName==="INPUT"||n==="type"&&e.tagName==="TEXTAREA")return!1;if(n==="width"||n==="height"){const o=e.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return Sd(n)&&rt(t)?!1:n in e}const Hv=new WeakMap,Gv=new WeakMap,os=Symbol("_moveCb"),Rd=Symbol("_enterCb"),mx=e=>(delete e.props.mode,e),gx=mx({name:"TransitionGroup",props:pt({},Uv,{tag:String,moveClass:String}),setup(e,{slots:n}){const t=ot(),r=cv();let o,i;return yv(()=>{if(!o.length)return;const a=e.moveClass||`${e.name||"v"}-move`;if(!_x(o[0].el,t.vnode.el,a)){o=[];return}o.forEach(bx),o.forEach(xx);const s=o.filter(wx);kc(t.vnode.el),s.forEach(u=>{const c=u.el,l=c.style;Bn(c,a),l.transform=l.webkitTransform=l.transitionDuration="";const f=c[os]=d=>{d&&d.target!==c||(!d||d.propertyName.endsWith("transform"))&&(c.removeEventListener("transitionend",f),c[os]=null,Dr(c,a))};c.addEventListener("transitionend",f)}),o=[]}),()=>{const a=Ve(e),s=zv(a);let u=a.tag||mn;if(o=[],i)for(let c=0;c<i.length;c++){const l=i[c];l.el&&l.el instanceof Element&&(o.push(l),yo(l,ji(l,s,r,t)),Hv.set(l,{left:l.el.offsetLeft,top:l.el.offsetTop}))}i=n.default?Cl(n.default()):[];for(let c=0;c<i.length;c++){const l=i[c];l.key!=null&&yo(l,ji(l,s,r,t))}return Ne(u,null,i)}}}),yx=gx;function bx(e){const n=e.el;n[os]&&n[os](),n[Rd]&&n[Rd]()}function xx(e){Gv.set(e,{left:e.el.offsetLeft,top:e.el.offsetTop})}function wx(e){const n=Hv.get(e),t=Gv.get(e),r=n.left-t.left,o=n.top-t.top;if(r||o){const i=e.el.style;return i.transform=i.webkitTransform=`translate(${r}px,${o}px)`,i.transitionDuration="0s",e}}function _x(e,n,t){const r=e.cloneNode(),o=e[si];o&&o.forEach(s=>{s.split(/\s+/).forEach(u=>u&&r.classList.remove(u))}),t.split(/\s+/).forEach(s=>s&&r.classList.add(s)),r.style.display="none";const i=n.nodeType===1?n:n.parentNode;i.appendChild(r);const{hasTransform:a}=qv(r);return i.removeChild(r),a}const Cx=["ctrl","shift","alt","meta"],Ex={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,n)=>Cx.some(t=>e[`${t}Key`]&&!n.includes(t))},ku=(e,n)=>{const t=e._withMods||(e._withMods={}),r=n.join(".");return t[r]||(t[r]=((o,...i)=>{for(let a=0;a<n.length;a++){const s=Ex[n[a]];if(s&&s(o,n))return}return e(o,...i)}))},Sx=pt({patchProp:px},Yb);let kd;function Rx(){return kd||(kd=Ib(Sx))}const jv=((...e)=>{const n=Rx().createApp(...e),{mount:t}=n;return n.mount=r=>{const o=Ix(r);if(!o)return;const i=n._component;!De(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=t(o,!1,kx(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},n});function kx(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function Ix(e){return rt(e)?document.querySelector(e):e}const Wo=typeof document<"u";function $v(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function Ax(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&$v(e.default)}const ze=Object.assign;function Iu(e,n){const t={};for(const r in n){const o=n[r];t[r]=Dn(o)?o.map(e):e(o)}return t}const Wi=()=>{},Dn=Array.isArray;function Id(e,n){const t={};for(const r in e)t[r]=r in n?n[r]:e[r];return t}const Kv=/#/g,Tx=/&/g,Dx=/\//g,Nx=/=/g,Fx=/\?/g,Xv=/\+/g,Px=/%5B/g,Mx=/%5D/g,Yv=/%5E/g,Ox=/%60/g,Qv=/%7B/g,Bx=/%7C/g,Jv=/%7D/g,Lx=/%20/g;function Al(e){return e==null?"":encodeURI(""+e).replace(Bx,"|").replace(Px,"[").replace(Mx,"]")}function Wx(e){return Al(e).replace(Qv,"{").replace(Jv,"}").replace(Yv,"^")}function Ic(e){return Al(e).replace(Xv,"%2B").replace(Lx,"+").replace(Kv,"%23").replace(Tx,"%26").replace(Ox,"`").replace(Qv,"{").replace(Jv,"}").replace(Yv,"^")}function Vx(e){return Ic(e).replace(Nx,"%3D")}function Ux(e){return Al(e).replace(Kv,"%23").replace(Fx,"%3F")}function zx(e){return Ux(e).replace(Dx,"%2F")}function Xi(e){if(e==null)return null;try{return decodeURIComponent(""+e)}catch{}return""+e}const qx=/\/$/,Hx=e=>e.replace(qx,"");function Au(e,n,t="/"){let r,o={},i="",a="";const s=n.indexOf("#");let u=n.indexOf("?");return u=s>=0&&u>s?-1:u,u>=0&&(r=n.slice(0,u),i=n.slice(u,s>0?s:n.length),o=e(i.slice(1))),s>=0&&(r=r||n.slice(0,s),a=n.slice(s,n.length)),r=Kx(r??n,t),{fullPath:r+i+a,path:r,query:o,hash:Xi(a)}}function Gx(e,n){const t=n.query?e(n.query):"";return n.path+(t&&"?")+t+(n.hash||"")}function Ad(e,n){return!n||!e.toLowerCase().startsWith(n.toLowerCase())?e:e.slice(n.length)||"/"}function jx(e,n,t){const r=n.matched.length-1,o=t.matched.length-1;return r>-1&&r===o&&ui(n.matched[r],t.matched[o])&&Zv(n.params,t.params)&&e(n.query)===e(t.query)&&n.hash===t.hash}function ui(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function Zv(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const t in e)if(!$x(e[t],n[t]))return!1;return!0}function $x(e,n){return Dn(e)?Td(e,n):Dn(n)?Td(n,e):e===n}function Td(e,n){return Dn(n)?e.length===n.length&&e.every((t,r)=>t===n[r]):e.length===1&&e[0]===n}function Kx(e,n){if(e.startsWith("/"))return e;if(!e)return n;const t=n.split("/"),r=e.split("/"),o=r[r.length-1];(o===".."||o===".")&&r.push("");let i=t.length-1,a,s;for(a=0;a<r.length;a++)if(s=r[a],s!==".")if(s==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+r.slice(a).join("/")}const kr={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};let Ac=(function(e){return e.pop="pop",e.push="push",e})({}),Tu=(function(e){return e.back="back",e.forward="forward",e.unknown="",e})({});function Xx(e){if(!e)if(Wo){const n=document.querySelector("base");e=n&&n.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Hx(e)}const Yx=/^[^#]+#/;function Qx(e,n){return e.replace(Yx,"#")+n}function Jx(e,n){const t=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect();return{behavior:n.behavior,left:r.left-t.left-(n.left||0),top:r.top-t.top-(n.top||0)}}const Xs=()=>({left:window.scrollX,top:window.scrollY});function Zx(e){let n;if("el"in e){const t=e.el,r=typeof t=="string"&&t.startsWith("#"),o=typeof t=="string"?r?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!o)return;n=Jx(o,e)}else n=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(n):window.scrollTo(n.left!=null?n.left:window.scrollX,n.top!=null?n.top:window.scrollY)}function Dd(e,n){return(history.state?history.state.position-n:-1)+e}const Tc=new Map;function ew(e,n){Tc.set(e,n)}function tw(e){const n=Tc.get(e);return Tc.delete(e),n}function nw(e){return typeof e=="string"||e&&typeof e=="object"}function em(e){return typeof e=="string"||typeof e=="symbol"}let nt=(function(e){return e[e.MATCHER_NOT_FOUND=1]="MATCHER_NOT_FOUND",e[e.NAVIGATION_GUARD_REDIRECT=2]="NAVIGATION_GUARD_REDIRECT",e[e.NAVIGATION_ABORTED=4]="NAVIGATION_ABORTED",e[e.NAVIGATION_CANCELLED=8]="NAVIGATION_CANCELLED",e[e.NAVIGATION_DUPLICATED=16]="NAVIGATION_DUPLICATED",e})({});const tm=Symbol("");nt.MATCHER_NOT_FOUND+"",nt.NAVIGATION_GUARD_REDIRECT+"",nt.NAVIGATION_ABORTED+"",nt.NAVIGATION_CANCELLED+"",nt.NAVIGATION_DUPLICATED+"";function ci(e,n){return ze(new Error,{type:e,[tm]:!0},n)}function ir(e,n){return e instanceof Error&&tm in e&&(n==null||!!(e.type&n))}const rw=["params","query","hash"];function ow(e){if(typeof e=="string")return e;if(e.path!=null)return e.path;const n={};for(const t of rw)t in e&&(n[t]=e[t]);return JSON.stringify(n,null,2)}function iw(e){const n={};if(e===""||e==="?")return n;const t=(e[0]==="?"?e.slice(1):e).split("&");for(let r=0;r<t.length;++r){const o=t[r].replace(Xv," "),i=o.indexOf("="),a=Xi(i<0?o:o.slice(0,i)),s=i<0?null:Xi(o.slice(i+1));if(a in n){let u=n[a];Dn(u)||(u=n[a]=[u]),u.push(s)}else n[a]=s}return n}function Nd(e){let n="";for(let t in e){const r=e[t];if(t=Vx(t),r==null){r!==void 0&&(n+=(n.length?"&":"")+t);continue}(Dn(r)?r.map(o=>o&&Ic(o)):[r&&Ic(r)]).forEach(o=>{o!==void 0&&(n+=(n.length?"&":"")+t,o!=null&&(n+="="+o))})}return n}function aw(e){const n={};for(const t in e){const r=e[t];r!==void 0&&(n[t]=Dn(r)?r.map(o=>o==null?null:""+o):r==null?r:""+r)}return n}const sw=Symbol(""),Fd=Symbol(""),Ys=Symbol(""),nm=Symbol(""),Dc=Symbol("");function wi(){let e=[];function n(r){return e.push(r),()=>{const o=e.indexOf(r);o>-1&&e.splice(o,1)}}function t(){e=[]}return{add:n,list:()=>e.slice(),reset:t}}function Mr(e,n,t,r,o,i=a=>a()){const a=r&&(r.enterCallbacks[o]=r.enterCallbacks[o]||[]);return()=>new Promise((s,u)=>{const c=d=>{d===!1?u(ci(nt.NAVIGATION_ABORTED,{from:t,to:n})):d instanceof Error?u(d):nw(d)?u(ci(nt.NAVIGATION_GUARD_REDIRECT,{from:n,to:d})):(a&&r.enterCallbacks[o]===a&&typeof d=="function"&&a.push(d),s())},l=i(()=>e.call(r&&r.instances[o],n,t,c));let f=Promise.resolve(l);e.length<3&&(f=f.then(c)),f.catch(d=>u(d))})}function Du(e,n,t,r,o=i=>i()){const i=[];for(const a of e)for(const s in a.components){let u=a.components[s];if(!(n!=="beforeRouteEnter"&&!a.instances[s]))if($v(u)){const c=(u.__vccOpts||u)[n];c&&i.push(Mr(c,t,r,a,s,o))}else{let c=u();i.push(()=>c.then(l=>{if(!l)throw new Error(`Couldn't resolve component "${s}" at "${a.path}"`);const f=Ax(l)?l.default:l;a.mods[s]=l,a.components[s]=f;const d=(f.__vccOpts||f)[n];return d&&Mr(d,t,r,a,s,o)()}))}}return i}function uw(e,n){const t=[],r=[],o=[],i=Math.max(n.matched.length,e.matched.length);for(let a=0;a<i;a++){const s=n.matched[a];s&&(e.matched.find(c=>ui(c,s))?r.push(s):t.push(s));const u=e.matched[a];u&&(n.matched.find(c=>ui(c,u))||o.push(u))}return[t,r,o]}let cw=()=>location.protocol+"//"+location.host;function rm(e,n){const{pathname:t,search:r,hash:o}=n,i=e.indexOf("#");if(i>-1){let a=o.includes(e.slice(i))?e.slice(i).length:1,s=o.slice(a);return s[0]!=="/"&&(s="/"+s),Ad(s,"")}return Ad(t,e)+r+o}function lw(e,n,t,r){let o=[],i=[],a=null;const s=({state:d})=>{const h=rm(e,location),p=t.value,v=n.value;let m=0;if(d){if(t.value=h,n.value=d,a&&a===p){a=null;return}m=v?d.position-v.position:0}else r(h);o.forEach(g=>{g(t.value,p,{delta:m,type:Ac.pop,direction:m?m>0?Tu.forward:Tu.back:Tu.unknown})})};function u(){a=t.value}function c(d){o.push(d);const h=()=>{const p=o.indexOf(d);p>-1&&o.splice(p,1)};return i.push(h),h}function l(){if(document.visibilityState==="hidden"){const{history:d}=window;if(!d.state)return;d.replaceState(ze({},d.state,{scroll:Xs()}),"")}}function f(){for(const d of i)d();i=[],window.removeEventListener("popstate",s),window.removeEventListener("pagehide",l),document.removeEventListener("visibilitychange",l)}return window.addEventListener("popstate",s),window.addEventListener("pagehide",l),document.addEventListener("visibilitychange",l),{pauseListeners:u,listen:c,destroy:f}}function Pd(e,n,t,r=!1,o=!1){return{back:e,current:n,forward:t,replaced:r,position:window.history.length,scroll:o?Xs():null}}function fw(e){const{history:n,location:t}=window,r={value:rm(e,t)},o={value:n.state};o.value||i(r.value,{back:null,current:r.value,forward:null,position:n.length-1,replaced:!0,scroll:null},!0);function i(u,c,l){const f=e.indexOf("#"),d=f>-1?(t.host&&document.querySelector("base")?e:e.slice(f))+u:cw()+e+u;try{n[l?"replaceState":"pushState"](c,"",d),o.value=c}catch(h){console.error(h),t[l?"replace":"assign"](d)}}function a(u,c){i(u,ze({},n.state,Pd(o.value.back,u,o.value.forward,!0),c,{position:o.value.position}),!0),r.value=u}function s(u,c){const l=ze({},o.value,n.state,{forward:u,scroll:Xs()});i(l.current,l,!0),i(u,ze({},Pd(r.value,u,null),{position:l.position+1},c),!1),r.value=u}return{location:r,state:o,push:s,replace:a}}function dw(e){e=Xx(e);const n=fw(e),t=lw(e,n.state,n.location,n.replace);function r(i,a=!0){a||t.pauseListeners(),history.go(i)}const o=ze({location:"",base:e,go:r,createHref:Qx.bind(null,e)},n,t);return Object.defineProperty(o,"location",{enumerable:!0,get:()=>n.location.value}),Object.defineProperty(o,"state",{enumerable:!0,get:()=>n.state.value}),o}function hw(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),dw(e)}let so=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.Group=2]="Group",e})({});var ut=(function(e){return e[e.Static=0]="Static",e[e.Param=1]="Param",e[e.ParamRegExp=2]="ParamRegExp",e[e.ParamRegExpEnd=3]="ParamRegExpEnd",e[e.EscapeNext=4]="EscapeNext",e})(ut||{});const pw={type:so.Static,value:""},vw=/[a-zA-Z0-9_]/;function mw(e){if(!e)return[[]];if(e==="/")return[[pw]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function n(h){throw new Error(`ERR (${t})/"${c}": ${h}`)}let t=ut.Static,r=t;const o=[];let i;function a(){i&&o.push(i),i=[]}let s=0,u,c="",l="";function f(){c&&(t===ut.Static?i.push({type:so.Static,value:c}):t===ut.Param||t===ut.ParamRegExp||t===ut.ParamRegExpEnd?(i.length>1&&(u==="*"||u==="+")&&n(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),i.push({type:so.Param,value:c,regexp:l,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):n("Invalid state to consume buffer"),c="")}function d(){c+=u}for(;s<e.length;){if(u=e[s++],u==="\\"&&t!==ut.ParamRegExp){r=t,t=ut.EscapeNext;continue}switch(t){case ut.Static:u==="/"?(c&&f(),a()):u===":"?(f(),t=ut.Param):d();break;case ut.EscapeNext:d(),t=r;break;case ut.Param:u==="("?t=ut.ParamRegExp:vw.test(u)?d():(f(),t=ut.Static,u!=="*"&&u!=="?"&&u!=="+"&&s--);break;case ut.ParamRegExp:u===")"?l[l.length-1]=="\\"?l=l.slice(0,-1)+u:t=ut.ParamRegExpEnd:l+=u;break;case ut.ParamRegExpEnd:f(),t=ut.Static,u!=="*"&&u!=="?"&&u!=="+"&&s--,l="";break;default:n("Unknown state");break}}return t===ut.ParamRegExp&&n(`Unfinished custom RegExp for param "${c}"`),f(),a(),o}const Md="[^/]+?",gw={sensitive:!1,strict:!1,start:!0,end:!0};var Ut=(function(e){return e[e._multiplier=10]="_multiplier",e[e.Root=90]="Root",e[e.Segment=40]="Segment",e[e.SubSegment=30]="SubSegment",e[e.Static=40]="Static",e[e.Dynamic=20]="Dynamic",e[e.BonusCustomRegExp=10]="BonusCustomRegExp",e[e.BonusWildcard=-50]="BonusWildcard",e[e.BonusRepeatable=-20]="BonusRepeatable",e[e.BonusOptional=-8]="BonusOptional",e[e.BonusStrict=.7000000000000001]="BonusStrict",e[e.BonusCaseSensitive=.25]="BonusCaseSensitive",e})(Ut||{});const yw=/[.+*?^${}()[\]/\\]/g;function bw(e,n){const t=ze({},gw,n),r=[];let o=t.start?"^":"";const i=[];for(const c of e){const l=c.length?[]:[Ut.Root];t.strict&&!c.length&&(o+="/");for(let f=0;f<c.length;f++){const d=c[f];let h=Ut.Segment+(t.sensitive?Ut.BonusCaseSensitive:0);if(d.type===so.Static)f||(o+="/"),o+=d.value.replace(yw,"\\$&"),h+=Ut.Static;else if(d.type===so.Param){const{value:p,repeatable:v,optional:m,regexp:g}=d;i.push({name:p,repeatable:v,optional:m});const b=g||Md;if(b!==Md){h+=Ut.BonusCustomRegExp;try{`${b}`}catch(y){throw new Error(`Invalid custom RegExp for param "${p}" (${b}): `+y.message)}}let x=v?`((?:${b})(?:/(?:${b}))*)`:`(${b})`;f||(x=m&&c.length<2?`(?:/${x})`:"/"+x),m&&(x+="?"),o+=x,h+=Ut.Dynamic,m&&(h+=Ut.BonusOptional),v&&(h+=Ut.BonusRepeatable),b===".*"&&(h+=Ut.BonusWildcard)}l.push(h)}r.push(l)}if(t.strict&&t.end){const c=r.length-1;r[c][r[c].length-1]+=Ut.BonusStrict}t.strict||(o+="/?"),t.end?o+="$":t.strict&&!o.endsWith("/")&&(o+="(?:/|$)");const a=new RegExp(o,t.sensitive?"":"i");function s(c){const l=c.match(a),f={};if(!l)return null;for(let d=1;d<l.length;d++){const h=l[d]||"",p=i[d-1];f[p.name]=h&&p.repeatable?h.split("/"):h}return f}function u(c){let l="",f=!1;for(const d of e){(!f||!l.endsWith("/"))&&(l+="/"),f=!1;for(const h of d)if(h.type===so.Static)l+=h.value;else if(h.type===so.Param){const{value:p,repeatable:v,optional:m}=h,g=p in c?c[p]:"";if(Dn(g)&&!v)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const b=Dn(g)?g.join("/"):g;if(!b)if(m)d.length<2&&(l.endsWith("/")?l=l.slice(0,-1):f=!0);else throw new Error(`Missing required param "${p}"`);l+=b}}return l||"/"}return{re:a,score:r,keys:i,parse:s,stringify:u}}function xw(e,n){let t=0;for(;t<e.length&&t<n.length;){const r=n[t]-e[t];if(r)return r;t++}return e.length<n.length?e.length===1&&e[0]===Ut.Static+Ut.Segment?-1:1:e.length>n.length?n.length===1&&n[0]===Ut.Static+Ut.Segment?1:-1:0}function om(e,n){let t=0;const r=e.score,o=n.score;for(;t<r.length&&t<o.length;){const i=xw(r[t],o[t]);if(i)return i;t++}if(Math.abs(o.length-r.length)===1){if(Od(r))return 1;if(Od(o))return-1}return o.length-r.length}function Od(e){const n=e[e.length-1];return e.length>0&&n[n.length-1]<0}const ww={strict:!1,end:!0,sensitive:!1};function _w(e,n,t){const r=bw(mw(e.path),t),o=ze(r,{record:e,parent:n,children:[],alias:[]});return n&&!o.record.aliasOf==!n.record.aliasOf&&n.children.push(o),o}function Cw(e,n){const t=[],r=new Map;n=Id(ww,n);function o(f){return r.get(f)}function i(f,d,h){const p=!h,v=Ld(f);v.aliasOf=h&&h.record;const m=Id(n,f),g=[v];if("alias"in f){const y=typeof f.alias=="string"?[f.alias]:f.alias;for(const w of y)g.push(Ld(ze({},v,{components:h?h.record.components:v.components,path:w,aliasOf:h?h.record:v})))}let b,x;for(const y of g){const{path:w}=y;if(d&&w[0]!=="/"){const _=d.record.path,S=_[_.length-1]==="/"?"":"/";y.path=d.record.path+(w&&S+w)}if(b=_w(y,d,m),h?h.alias.push(b):(x=x||b,x!==b&&x.alias.push(b),p&&f.name&&!Wd(b)&&a(f.name)),im(b)&&u(b),v.children){const _=v.children;for(let S=0;S<_.length;S++)i(_[S],b,h&&h.children[S])}h=h||b}return x?()=>{a(x)}:Wi}function a(f){if(em(f)){const d=r.get(f);d&&(r.delete(f),t.splice(t.indexOf(d),1),d.children.forEach(a),d.alias.forEach(a))}else{const d=t.indexOf(f);d>-1&&(t.splice(d,1),f.record.name&&r.delete(f.record.name),f.children.forEach(a),f.alias.forEach(a))}}function s(){return t}function u(f){const d=Rw(f,t);t.splice(d,0,f),f.record.name&&!Wd(f)&&r.set(f.record.name,f)}function c(f,d){let h,p={},v,m;if("name"in f&&f.name){if(h=r.get(f.name),!h)throw ci(nt.MATCHER_NOT_FOUND,{location:f});m=h.record.name,p=ze(Bd(d.params,h.keys.filter(x=>!x.optional).concat(h.parent?h.parent.keys.filter(x=>x.optional):[]).map(x=>x.name)),f.params&&Bd(f.params,h.keys.map(x=>x.name))),v=h.stringify(p)}else if(f.path!=null)v=f.path,h=t.find(x=>x.re.test(v)),h&&(p=h.parse(v),m=h.record.name);else{if(h=d.name?r.get(d.name):t.find(x=>x.re.test(d.path)),!h)throw ci(nt.MATCHER_NOT_FOUND,{location:f,currentLocation:d});m=h.record.name,p=ze({},d.params,f.params),v=h.stringify(p)}const g=[];let b=h;for(;b;)g.unshift(b.record),b=b.parent;return{name:m,path:v,params:p,matched:g,meta:Sw(g)}}e.forEach(f=>i(f));function l(){t.length=0,r.clear()}return{addRoute:i,resolve:c,removeRoute:a,clearRoutes:l,getRoutes:s,getRecordMatcher:o}}function Bd(e,n){const t={};for(const r of n)r in e&&(t[r]=e[r]);return t}function Ld(e){const n={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:Ew(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(n,"mods",{value:{}}),n}function Ew(e){const n={},t=e.props||!1;if("component"in e)n.default=t;else for(const r in e.components)n[r]=typeof t=="object"?t[r]:t;return n}function Wd(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function Sw(e){return e.reduce((n,t)=>ze(n,t.meta),{})}function Rw(e,n){let t=0,r=n.length;for(;t!==r;){const i=t+r>>1;om(e,n[i])<0?r=i:t=i+1}const o=kw(e);return o&&(r=n.lastIndexOf(o,r-1)),r}function kw(e){let n=e;for(;n=n.parent;)if(im(n)&&om(e,n)===0)return n}function im({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function Vd(e){const n=Xt(Ys),t=Xt(nm),r=oe(()=>{const u=po(e.to);return n.resolve(u)}),o=oe(()=>{const{matched:u}=r.value,{length:c}=u,l=u[c-1],f=t.matched;if(!l||!f.length)return-1;const d=f.findIndex(ui.bind(null,l));if(d>-1)return d;const h=Ud(u[c-2]);return c>1&&Ud(l)===h&&f[f.length-1].path!==h?f.findIndex(ui.bind(null,u[c-2])):d}),i=oe(()=>o.value>-1&&Nw(t.params,r.value.params)),a=oe(()=>o.value>-1&&o.value===t.matched.length-1&&Zv(t.params,r.value.params));function s(u={}){if(Dw(u)){const c=n[po(e.replace)?"replace":"push"](po(e.to)).catch(Wi);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>c),c}return Promise.resolve()}return{route:r,href:oe(()=>r.value.href),isActive:i,isExactActive:a,navigate:s}}function Iw(e){return e.length===1?e[0]:e}const Aw=El({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Vd,setup(e,{slots:n}){const t=Hn(Vd(e)),{options:r}=Xt(Ys),o=oe(()=>({[zd(e.activeClass,r.linkActiveClass,"router-link-active")]:t.isActive,[zd(e.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=n.default&&Iw(n.default(t));return e.custom?i:se("a",{"aria-current":t.isExactActive?e.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:o.value},i)}}}),Tw=Aw;function Dw(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const n=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(n))return}return e.preventDefault&&e.preventDefault(),!0}}function Nw(e,n){for(const t in n){const r=n[t],o=e[t];if(typeof r=="string"){if(r!==o)return!1}else if(!Dn(o)||o.length!==r.length||r.some((i,a)=>i!==o[a]))return!1}return!0}function Ud(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const zd=(e,n,t)=>e??n??t,Fw=El({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:n,slots:t}){const r=Xt(Dc),o=oe(()=>e.route||r.value),i=Xt(Fd,0),a=oe(()=>{let c=po(i);const{matched:l}=o.value;let f;for(;(f=l[c])&&!f.components;)c++;return c}),s=oe(()=>o.value.matched[a.value]);Yo(Fd,oe(()=>a.value+1)),Yo(sw,s),Yo(Dc,o);const u=Re();return $e(()=>[u.value,s.value,e.name],([c,l,f],[d,h,p])=>{l&&(l.instances[f]=c,h&&h!==l&&c&&c===d&&(l.leaveGuards.size||(l.leaveGuards=h.leaveGuards),l.updateGuards.size||(l.updateGuards=h.updateGuards))),c&&l&&(!h||!ui(l,h)||!d)&&(l.enterCallbacks[f]||[]).forEach(v=>v(c))},{flush:"post"}),()=>{const c=o.value,l=e.name,f=s.value,d=f&&f.components[l];if(!d)return qd(t.default,{Component:d,route:c});const h=f.props[l],p=h?h===!0?c.params:typeof h=="function"?h(c):h:null,m=se(d,ze({},p,n,{onVnodeUnmounted:g=>{g.component.isUnmounted&&(f.instances[l]=null)},ref:u}));return qd(t.default,{Component:m,route:c})||m}}});function qd(e,n){if(!e)return null;const t=e(n);return t.length===1?t[0]:t}const Pw=Fw;function Mw(e){const n=Cw(e.routes,e),t=e.parseQuery||iw,r=e.stringifyQuery||Nd,o=e.history,i=wi(),a=wi(),s=wi(),u=N0(kr);let c=kr;Wo&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const l=Iu.bind(null,z=>""+z),f=Iu.bind(null,zx),d=Iu.bind(null,Xi);function h(z,Z){let ee,le;return em(z)?(ee=n.getRecordMatcher(z),le=Z):le=z,n.addRoute(le,ee)}function p(z){const Z=n.getRecordMatcher(z);Z&&n.removeRoute(Z)}function v(){return n.getRoutes().map(z=>z.record)}function m(z){return!!n.getRecordMatcher(z)}function g(z,Z){if(Z=ze({},Z||u.value),typeof z=="string"){const U=Au(t,z,Z.path),X=n.resolve({path:U.path},Z),Y=o.createHref(U.fullPath);return ze(U,X,{params:d(X.params),hash:Xi(U.hash),redirectedFrom:void 0,href:Y})}let ee;if(z.path!=null)ee=ze({},z,{path:Au(t,z.path,Z.path).path});else{const U=ze({},z.params);for(const X in U)U[X]==null&&delete U[X];ee=ze({},z,{params:f(U)}),Z.params=f(Z.params)}const le=n.resolve(ee,Z),pe=z.hash||"";le.params=l(d(le.params));const D=Gx(r,ze({},z,{hash:Wx(pe),path:le.path})),N=o.createHref(D);return ze({fullPath:D,hash:pe,query:r===Nd?aw(z.query):z.query||{}},le,{redirectedFrom:void 0,href:N})}function b(z){return typeof z=="string"?Au(t,z,u.value.path):ze({},z)}function x(z,Z){if(c!==z)return ci(nt.NAVIGATION_CANCELLED,{from:Z,to:z})}function y(z){return S(z)}function w(z){return y(ze(b(z),{replace:!0}))}function _(z,Z){const ee=z.matched[z.matched.length-1];if(ee&&ee.redirect){const{redirect:le}=ee;let pe=typeof le=="function"?le(z,Z):le;return typeof pe=="string"&&(pe=pe.includes("?")||pe.includes("#")?pe=b(pe):{path:pe},pe.params={}),ze({query:z.query,hash:z.hash,params:pe.path!=null?{}:z.params},pe)}}function S(z,Z){const ee=c=g(z),le=u.value,pe=z.state,D=z.force,N=z.replace===!0,U=_(ee,le);if(U)return S(ze(b(U),{state:typeof U=="object"?ze({},pe,U.state):pe,force:D,replace:N}),Z||ee);const X=ee;X.redirectedFrom=Z;let Y;return!D&&jx(r,le,ee)&&(Y=ci(nt.NAVIGATION_DUPLICATED,{to:X,from:le}),G(le,le,!0,!1)),(Y?Promise.resolve(Y):C(X,le)).catch(J=>ir(J)?ir(J,nt.NAVIGATION_GUARD_REDIRECT)?J:$(J):F(J,X,le)).then(J=>{if(J){if(ir(J,nt.NAVIGATION_GUARD_REDIRECT))return S(ze({replace:N},b(J.to),{state:typeof J.to=="object"?ze({},pe,J.to.state):pe,force:D}),Z||X)}else J=k(X,le,!0,N,pe);return I(X,le,J),J})}function R(z,Z){const ee=x(z,Z);return ee?Promise.reject(ee):Promise.resolve()}function E(z){const Z=he.values().next().value;return Z&&typeof Z.runWithContext=="function"?Z.runWithContext(z):z()}function C(z,Z){let ee;const[le,pe,D]=uw(z,Z);ee=Du(le.reverse(),"beforeRouteLeave",z,Z);for(const U of le)U.leaveGuards.forEach(X=>{ee.push(Mr(X,z,Z))});const N=R.bind(null,z,Z);return ee.push(N),ae(ee).then(()=>{ee=[];for(const U of i.list())ee.push(Mr(U,z,Z));return ee.push(N),ae(ee)}).then(()=>{ee=Du(pe,"beforeRouteUpdate",z,Z);for(const U of pe)U.updateGuards.forEach(X=>{ee.push(Mr(X,z,Z))});return ee.push(N),ae(ee)}).then(()=>{ee=[];for(const U of D)if(U.beforeEnter)if(Dn(U.beforeEnter))for(const X of U.beforeEnter)ee.push(Mr(X,z,Z));else ee.push(Mr(U.beforeEnter,z,Z));return ee.push(N),ae(ee)}).then(()=>(z.matched.forEach(U=>U.enterCallbacks={}),ee=Du(D,"beforeRouteEnter",z,Z,E),ee.push(N),ae(ee))).then(()=>{ee=[];for(const U of a.list())ee.push(Mr(U,z,Z));return ee.push(N),ae(ee)}).catch(U=>ir(U,nt.NAVIGATION_CANCELLED)?U:Promise.reject(U))}function I(z,Z,ee){s.list().forEach(le=>E(()=>le(z,Z,ee)))}function k(z,Z,ee,le,pe){const D=x(z,Z);if(D)return D;const N=Z===kr,U=Wo?history.state:{};ee&&(le||N?o.replace(z.fullPath,ze({scroll:N&&U&&U.scroll},pe)):o.push(z.fullPath,pe)),u.value=z,G(z,Z,ee,N),$()}let M;function P(){M||(M=o.listen((z,Z,ee)=>{if(!be.listening)return;const le=g(z),pe=_(le,be.currentRoute.value);if(pe){S(ze(pe,{replace:!0,force:!0}),le).catch(Wi);return}c=le;const D=u.value;Wo&&ew(Dd(D.fullPath,ee.delta),Xs()),C(le,D).catch(N=>ir(N,nt.NAVIGATION_ABORTED|nt.NAVIGATION_CANCELLED)?N:ir(N,nt.NAVIGATION_GUARD_REDIRECT)?(S(ze(b(N.to),{force:!0}),le).then(U=>{ir(U,nt.NAVIGATION_ABORTED|nt.NAVIGATION_DUPLICATED)&&!ee.delta&&ee.type===Ac.pop&&o.go(-1,!1)}).catch(Wi),Promise.reject()):(ee.delta&&o.go(-ee.delta,!1),F(N,le,D))).then(N=>{N=N||k(le,D,!1),N&&(ee.delta&&!ir(N,nt.NAVIGATION_CANCELLED)?o.go(-ee.delta,!1):ee.type===Ac.pop&&ir(N,nt.NAVIGATION_ABORTED|nt.NAVIGATION_DUPLICATED)&&o.go(-1,!1)),I(le,D,N)}).catch(Wi)}))}let L=wi(),q=wi(),V;function F(z,Z,ee){$(z);const le=q.list();return le.length?le.forEach(pe=>pe(z,Z,ee)):console.error(z),Promise.reject(z)}function H(){return V&&u.value!==kr?Promise.resolve():new Promise((z,Z)=>{L.add([z,Z])})}function $(z){return V||(V=!z,P(),L.list().forEach(([Z,ee])=>z?ee(z):Z()),L.reset()),z}function G(z,Z,ee,le){const{scrollBehavior:pe}=e;if(!Wo||!pe)return Promise.resolve();const D=!ee&&tw(Dd(z.fullPath,0))||(le||!ee)&&history.state&&history.state.scroll||null;return $t().then(()=>pe(z,Z,D)).then(N=>N&&Zx(N)).catch(N=>F(N,z,Z))}const O=z=>o.go(z);let re;const he=new Set,be={currentRoute:u,listening:!0,addRoute:h,removeRoute:p,clearRoutes:n.clearRoutes,hasRoute:m,getRoutes:v,resolve:g,options:e,push:y,replace:w,go:O,back:()=>O(-1),forward:()=>O(1),beforeEach:i.add,beforeResolve:a.add,afterEach:s.add,onError:q.add,isReady:H,install(z){z.component("RouterLink",Tw),z.component("RouterView",Pw),z.config.globalProperties.$router=be,Object.defineProperty(z.config.globalProperties,"$route",{enumerable:!0,get:()=>po(u)}),Wo&&!re&&u.value===kr&&(re=!0,y(o.location).catch(le=>{}));const Z={};for(const le in kr)Object.defineProperty(Z,le,{get:()=>u.value[le],enumerable:!0});z.provide(Ys,be),z.provide(nm,Qp(Z)),z.provide(Dc,u);const ee=z.unmount;he.add(z),z.unmount=function(){he.delete(z),he.size<1&&(c=kr,M&&M(),M=null,u.value=kr,re=!1,V=!1),ee()}}};function ae(z){return z.reduce((Z,ee)=>Z.then(()=>E(ee)),Promise.resolve())}return be}function am(){return Xt(Ys)}const Nc={xs:18,sm:24,md:32,lg:38,xl:46},Tl={size:String};function Dl(e,n=Nc){return oe(()=>e.size!==void 0?{fontSize:e.size in n?`${n[e.size]}px`:e.size}:null)}function mi(e,n,t,r){return Object.defineProperty(e,n,{get:t,set:r,enumerable:!0}),e}function en(e){return Ws(El(e))}function Ow(e){return Ws(e)}const Qs=(e,n)=>{const t=Hn(e);for(const r in e)mi(n,r,()=>t[r],o=>{t[r]=o});return n};function vr(e,n){return e!==void 0&&e()||n}function Go(e,n){return e!==void 0?n.concat(e()):n}function Bw(e,n){return e===void 0?n:n!==void 0?n.concat(e()):e()}const Hd="0 0 24 24",Nu=e=>e,Fu=e=>`ionicons ${e}`,sm={"mdi-":e=>`mdi ${e}`,"icon-":Nu,"bt-":e=>`bt ${e}`,"eva-":e=>`eva ${e}`,"ion-md":Fu,"ion-ios":Fu,"ion-logo":Fu,"iconfont ":Nu,"ti-":e=>`themify-icon ${e}`,"bi-":e=>`bootstrap-icons ${e}`,"i-":Nu},um={o_:"-outlined",r_:"-round",s_:"-sharp"},cm={sym_o_:"-outlined",sym_r_:"-rounded",sym_s_:"-sharp"},Lw=new RegExp("^("+Object.keys(sm).join("|")+")"),Ww=new RegExp("^("+Object.keys(um).join("|")+")"),Gd=new RegExp("^("+Object.keys(cm).join("|")+")"),Vw=/^[Mm]\s?[-+]?\.?\d/,Uw=/^img:/,zw=/^svguse:/,qw=/^ion-/,Hw=/^(fa-(classic|sharp|solid|regular|light|brands|duotone|thin)|[lf]a[srlbdk]?) /,li=en({name:"QIcon",props:{...Tl,tag:{type:String,default:"i"},name:String,color:String,left:Boolean,right:Boolean},setup(e,{slots:n}){const{proxy:{$q:t}}=ot(),r=Dl(e),o=oe(()=>"q-icon"+(e.left===!0?" on-left":"")+(e.right===!0?" on-right":"")+(e.color!==void 0?` text-${e.color}`:"")),i=oe(()=>{let a,s=e.name;if(s==="none"||!s)return{none:!0};if(t.iconMapFn!==null){const l=t.iconMapFn(s);if(l!==void 0)if(l.icon!==void 0){if(s=l.icon,s==="none"||!s)return{none:!0}}else return{cls:l.cls,content:l.content!==void 0?l.content:" "}}if(Vw.test(s)===!0){const[l,f=Hd]=s.split("|");return{svg:!0,viewBox:f,nodes:l.split("&&").map(d=>{const[h,p,v]=d.split("@@");return se("path",{style:p,d:h,transform:v})})}}if(Uw.test(s)===!0)return{img:!0,src:s.substring(4)};if(zw.test(s)===!0){const[l,f=Hd]=s.split("|");return{svguse:!0,src:l.substring(7),viewBox:f}}let u=" ";const c=s.match(Lw);if(c!==null)a=sm[c[1]](s);else if(Hw.test(s)===!0)a=s;else if(qw.test(s)===!0)a=`ionicons ion-${t.platform.is.ios===!0?"ios":"md"}${s.substring(3)}`;else if(Gd.test(s)===!0){a="notranslate material-symbols";const l=s.match(Gd);l!==null&&(s=s.substring(6),a+=cm[l[1]]),u=s}else{a="notranslate material-icons";const l=s.match(Ww);l!==null&&(s=s.substring(2),a+=um[l[1]]),u=s}return{cls:a,content:u}});return()=>{const a={class:o.value,style:r.value,"aria-hidden":"true"};return i.value.none===!0?se(e.tag,a,vr(n.default)):i.value.img===!0?se(e.tag,a,Go(n.default,[se("img",{src:i.value.src})])):i.value.svg===!0?se(e.tag,a,Go(n.default,[se("svg",{viewBox:i.value.viewBox||"0 0 24 24"},i.value.nodes)])):i.value.svguse===!0?se(e.tag,a,Go(n.default,[se("svg",{viewBox:i.value.viewBox},[se("use",{"xlink:href":i.value.src})])])):(i.value.cls!==void 0&&(a.class+=" "+i.value.cls),se(e.tag,a,Go(n.default,[i.value.content])))}}}),Gw={size:{type:[String,Number],default:"1em"},color:String};function jw(e){return{cSize:oe(()=>e.size in Nc?`${Nc[e.size]}px`:e.size),classes:oe(()=>"q-spinner"+(e.color?` text-${e.color}`:""))}}const Nl=en({name:"QSpinner",props:{...Gw,thickness:{type:Number,default:5}},setup(e){const{cSize:n,classes:t}=jw(e);return()=>se("svg",{class:t.value+" q-spinner-mat",width:n.value,height:n.value,viewBox:"25 25 50 50"},[se("circle",{class:"path",cx:"50",cy:"50",r:"20",fill:"none",stroke:"currentColor","stroke-width":e.thickness,"stroke-miterlimit":"10"})])}});function Fc(e,n){const t=e.style;for(const r in n)t[r]=n[r]}function $w(e){if(e==null)return;if(typeof e=="string")try{return document.querySelector(e)||void 0}catch{return}const n=po(e);if(n)return n.$el||n}function Kw(e,n){if(e==null||e.contains(n)===!0)return!0;for(let t=e.nextElementSibling;t!==null;t=t.nextElementSibling)if(t.contains(n))return!0;return!1}const zt={hasPassive:!1,passiveCapture:!0,notPassiveCapture:!0};try{const e=Object.defineProperty({},"passive",{get(){Object.assign(zt,{hasPassive:!0,passive:{passive:!0},notPassive:{passive:!1},passiveCapture:{passive:!0,capture:!0},notPassiveCapture:{passive:!1,capture:!0}})}});window.addEventListener("qtest",null,e),window.removeEventListener("qtest",null,e)}catch{}function bo(){}function Xw(e){return e.touches&&e.touches[0]?e=e.touches[0]:e.changedTouches&&e.changedTouches[0]?e=e.changedTouches[0]:e.targetTouches&&e.targetTouches[0]&&(e=e.targetTouches[0]),{top:e.clientY,left:e.clientX}}function Yw(e){if(e.path)return e.path;if(e.composedPath)return e.composedPath();const n=[];let t=e.target;for(;t;){if(n.push(t),t.tagName==="HTML")return n.push(document),n.push(window),n;t=t.parentElement}}function is(e){e.stopPropagation()}function Vo(e){e.cancelable!==!1&&e.preventDefault()}function Or(e){e.cancelable!==!1&&e.preventDefault(),e.stopPropagation()}function Qw(e,n,t){const r=`__q_${n}_evt`;e[r]=e[r]!==void 0?e[r].concat(t):t,t.forEach(o=>{o[0].addEventListener(o[1],e[o[2]],zt[o[3]])})}function Jw(e,n){const t=`__q_${n}_evt`;e[t]!==void 0&&(e[t].forEach(r=>{r[0].removeEventListener(r[1],e[r[2]],zt[r[3]])}),e[t]=void 0)}let lm=!1;function Zw(e){lm=e.isComposing===!0}function fm(e){return lm===!0||e!==Object(e)||e.isComposing===!0||e.qKeyEvent===!0}function as(e,n){return fm(e)===!0?!1:[].concat(n).includes(e.keyCode)}function e1(e,n=250){let t=!1,r;return function(){return t===!1&&(t=!0,setTimeout(()=>{t=!1},n),r=e.apply(this,arguments)),r}}function jd(e,n,t,r){t.modifiers.stop===!0&&is(e);const o=t.modifiers.color;let i=t.modifiers.center;i=i===!0||r===!0;const a=document.createElement("span"),s=document.createElement("span"),u=Xw(e),{left:c,top:l,width:f,height:d}=n.getBoundingClientRect(),h=Math.sqrt(f*f+d*d),p=h/2,v=`${(f-h)/2}px`,m=i?v:`${u.left-c-p}px`,g=`${(d-h)/2}px`,b=i?g:`${u.top-l-p}px`;s.className="q-ripple__inner",Fc(s,{height:`${h}px`,width:`${h}px`,transform:`translate3d(${m},${b},0) scale3d(.2,.2,1)`,opacity:0}),a.className=`q-ripple${o?" text-"+o:""}`,a.setAttribute("dir","ltr"),a.appendChild(s),n.appendChild(a);const x=()=>{a.remove(),clearTimeout(y)};t.abort.push(x);let y=setTimeout(()=>{s.classList.add("q-ripple__inner--enter"),s.style.transform=`translate3d(${v},${g},0) scale3d(1,1,1)`,s.style.opacity=.2,y=setTimeout(()=>{s.classList.remove("q-ripple__inner--enter"),s.classList.add("q-ripple__inner--leave"),s.style.opacity=0,y=setTimeout(()=>{a.remove(),t.abort.splice(t.abort.indexOf(x),1)},275)},250)},50)}function $d(e,{modifiers:n,value:t,arg:r}){const o=Object.assign({},e.cfg.ripple,n,t);e.modifiers={early:o.early===!0,stop:o.stop===!0,center:o.center===!0,color:o.color||r,keyCodes:[].concat(o.keyCodes||13)}}const t1=Ow({name:"ripple",beforeMount(e,n){const t=n.instance.$.appContext.config.globalProperties.$q.config||{};if(t.ripple===!1)return;const r={cfg:t,enabled:n.value!==!1,modifiers:{},abort:[],start(o){r.enabled===!0&&o.qSkipRipple!==!0&&o.type===(r.modifiers.early===!0?"pointerdown":"click")&&jd(o,e,r,o.qKeyEvent===!0)},keystart:e1(o=>{r.enabled===!0&&o.qSkipRipple!==!0&&as(o,r.modifiers.keyCodes)===!0&&o.type===`key${r.modifiers.early===!0?"down":"up"}`&&jd(o,e,r,!0)},300)};$d(r,n),e.__qripple=r,Qw(r,"main",[[e,"pointerdown","start","passive"],[e,"click","start","passive"],[e,"keydown","keystart","passive"],[e,"keyup","keystart","passive"]])},updated(e,n){if(n.oldValue!==n.value){const t=e.__qripple;t!==void 0&&(t.enabled=n.value!==!1,t.enabled===!0&&Object(n.value)===n.value&&$d(t,n))}},beforeUnmount(e){const n=e.__qripple;n!==void 0&&(n.abort.forEach(t=>{t()}),Jw(n,"main"),delete e._qripple)}}),dm={left:"start",center:"center",right:"end",between:"between",around:"around",evenly:"evenly",stretch:"stretch"},n1=Object.keys(dm),r1={align:{type:String,validator:e=>n1.includes(e)}};function o1(e){return oe(()=>{const n=e.align===void 0?e.vertical===!0?"stretch":"left":e.align;return`${e.vertical===!0?"items":"justify"}-${dm[n]}`})}function hm(e){return e.appContext.config.globalProperties.$router!==void 0}function pm(e){return e.isUnmounted===!0||e.isDeactivated===!0}function Kd(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}function Xd(e,n){return(e.aliasOf||e)===(n.aliasOf||n)}function i1(e,n){for(const t in n){const r=n[t],o=e[t];if(typeof r=="string"){if(r!==o)return!1}else if(Array.isArray(o)===!1||o.length!==r.length||r.some((i,a)=>i!==o[a]))return!1}return!0}function Yd(e,n){return Array.isArray(n)===!0?e.length===n.length&&e.every((t,r)=>t===n[r]):e.length===1&&e[0]===n}function a1(e,n){return Array.isArray(e)===!0?Yd(e,n):Array.isArray(n)===!0?Yd(n,e):e===n}function s1(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const t in e)if(a1(e[t],n[t])===!1)return!1;return!0}const u1={to:[String,Object],replace:Boolean,href:String,target:String,disable:Boolean};function c1({fallbackTag:e,useDisableForRouterLinkProps:n=!0}={}){const t=ot(),{props:r,proxy:o,emit:i}=t,a=hm(t),s=oe(()=>r.disable!==!0&&r.href!==void 0),u=oe(n===!0?()=>a===!0&&r.disable!==!0&&s.value!==!0&&r.to!==void 0&&r.to!==null&&r.to!=="":()=>a===!0&&s.value!==!0&&r.to!==void 0&&r.to!==null&&r.to!==""),c=oe(()=>u.value===!0?b(r.to):null),l=oe(()=>c.value!==null),f=oe(()=>s.value===!0||l.value===!0),d=oe(()=>r.type==="a"||f.value===!0?"a":r.tag||e||"div"),h=oe(()=>s.value===!0?{href:r.href,target:r.target}:l.value===!0?{href:c.value.href,target:r.target}:{}),p=oe(()=>{if(l.value===!1)return-1;const{matched:w}=c.value,{length:_}=w,S=w[_-1];if(S===void 0)return-1;const R=o.$route.matched;if(R.length===0)return-1;const E=R.findIndex(Xd.bind(null,S));if(E!==-1)return E;const C=Kd(w[_-2]);return _>1&&Kd(S)===C&&R[R.length-1].path!==C?R.findIndex(Xd.bind(null,w[_-2])):E}),v=oe(()=>l.value===!0&&p.value!==-1&&i1(o.$route.params,c.value.params)),m=oe(()=>v.value===!0&&p.value===o.$route.matched.length-1&&s1(o.$route.params,c.value.params)),g=oe(()=>l.value===!0?m.value===!0?` ${r.exactActiveClass} ${r.activeClass}`:r.exact===!0?"":v.value===!0?` ${r.activeClass}`:"":"");function b(w){try{return o.$router.resolve(w)}catch{}return null}function x(w,{returnRouterError:_,to:S=r.to,replace:R=r.replace}={}){if(r.disable===!0)return w.preventDefault(),Promise.resolve(!1);if(w.metaKey||w.altKey||w.ctrlKey||w.shiftKey||w.button!==void 0&&w.button!==0||r.target==="_blank")return Promise.resolve(!1);w.preventDefault();const E=o.$router[R===!0?"replace":"push"](S);return _===!0?E:E.then(()=>{}).catch(()=>{})}function y(w){if(l.value===!0){const _=S=>x(w,S);i("click",w,_),w.defaultPrevented!==!0&&_()}else i("click",w)}return{hasRouterLink:l,hasHrefLink:s,hasLink:f,linkTag:d,resolvedLink:c,linkIsActive:v,linkIsExactActive:m,linkClass:g,linkAttrs:h,getLink:b,navigateToRouterLink:x,navigateOnClick:y}}const Qd={none:0,xs:4,sm:8,md:16,lg:24,xl:32},l1={xs:8,sm:10,md:14,lg:20,xl:24},f1=["button","submit","reset"],d1=/[^\s]\/[^\s]/,h1=["flat","outline","push","unelevated"];function p1(e,n){return e.flat===!0?"flat":e.outline===!0?"outline":e.push===!0?"push":e.unelevated===!0?"unelevated":n}const v1={...Tl,...u1,type:{type:String,default:"button"},label:[Number,String],icon:String,iconRight:String,...h1.reduce((e,n)=>(e[n]=Boolean)&&e,{}),square:Boolean,rounded:Boolean,glossy:Boolean,size:String,fab:Boolean,fabMini:Boolean,padding:String,color:String,textColor:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,tabindex:[Number,String],ripple:{type:[Boolean,Object],default:!0},align:{...r1.align,default:"center"},stack:Boolean,stretch:Boolean,loading:{type:Boolean,default:null},disable:Boolean},m1={...v1,round:Boolean};function g1(e){const n=Dl(e,l1),t=o1(e),{hasRouterLink:r,hasLink:o,linkTag:i,linkAttrs:a,navigateOnClick:s}=c1({fallbackTag:"button"}),u=oe(()=>{const m=e.fab===!1&&e.fabMini===!1?n.value:{};return e.padding!==void 0?Object.assign({},m,{padding:e.padding.split(/\s+/).map(g=>g in Qd?Qd[g]+"px":g).join(" "),minWidth:"0",minHeight:"0"}):m}),c=oe(()=>e.rounded===!0||e.fab===!0||e.fabMini===!0),l=oe(()=>e.disable!==!0&&e.loading!==!0),f=oe(()=>l.value===!0?e.tabindex||0:-1),d=oe(()=>p1(e,"standard")),h=oe(()=>{const m={tabindex:f.value};return o.value===!0?Object.assign(m,a.value):f1.includes(e.type)===!0&&(m.type=e.type),i.value==="a"?(e.disable===!0?m["aria-disabled"]="true":m.href===void 0&&(m.role="button"),r.value!==!0&&d1.test(e.type)===!0&&(m.type=e.type)):e.disable===!0&&(m.disabled="",m["aria-disabled"]="true"),e.loading===!0&&e.percentage!==void 0&&Object.assign(m,{role:"progressbar","aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":e.percentage}),m}),p=oe(()=>{let m;e.color!==void 0?e.flat===!0||e.outline===!0?m=`text-${e.textColor||e.color}`:m=`bg-${e.color} text-${e.textColor||"white"}`:e.textColor&&(m=`text-${e.textColor}`);const g=e.round===!0?"round":`rectangle${c.value===!0?" q-btn--rounded":e.square===!0?" q-btn--square":""}`;return`q-btn--${d.value} q-btn--${g}`+(m!==void 0?" "+m:"")+(l.value===!0?" q-btn--actionable q-focusable q-hoverable":e.disable===!0?" disabled":"")+(e.fab===!0?" q-btn--fab":e.fabMini===!0?" q-btn--fab-mini":"")+(e.noCaps===!0?" q-btn--no-uppercase":"")+(e.dense===!0?" q-btn--dense":"")+(e.stretch===!0?" no-border-radius self-stretch":"")+(e.glossy===!0?" glossy":"")+(e.square?" q-btn--square":"")}),v=oe(()=>t.value+(e.stack===!0?" column":" row")+(e.noWrap===!0?" no-wrap text-no-wrap":"")+(e.loading===!0?" q-btn__content--hidden":""));return{classes:p,style:u,innerClasses:v,attributes:h,hasLink:o,linkTag:i,navigateOnClick:s,isActionable:l}}const{passiveCapture:pn}=zt;let To=null,Do=null,No=null;const Fl=en({name:"QBtn",props:{...m1,percentage:Number,darkPercentage:Boolean,onTouchstart:[Function,Array]},emits:["click","keydown","mousedown","keyup"],setup(e,{slots:n,emit:t}){const{proxy:r}=ot(),{classes:o,style:i,innerClasses:a,attributes:s,hasLink:u,linkTag:c,navigateOnClick:l,isActionable:f}=g1(e),d=Re(null),h=Re(null);let p=null,v,m=null;const g=oe(()=>e.label!==void 0&&e.label!==null&&e.label!==""),b=oe(()=>e.disable===!0||e.ripple===!1?!1:{keyCodes:u.value===!0?[13,32]:[13],...e.ripple===!0?{}:e.ripple}),x=oe(()=>({center:e.round})),y=oe(()=>{const P=Math.max(0,Math.min(100,e.percentage));return P>0?{transition:"transform 0.6s",transform:`translateX(${P-100}%)`}:{}}),w=oe(()=>{if(e.loading===!0)return{onMousedown:M,onTouchstart:M,onClick:M,onKeydown:M,onKeyup:M};if(f.value===!0){const P={onClick:S,onKeydown:R,onMousedown:C};if(r.$q.platform.has.touch===!0){const L=e.onTouchstart!==void 0?"":"Passive";P[`onTouchstart${L}`]=E}return P}return{onClick:Or}}),_=oe(()=>({ref:d,class:"q-btn q-btn-item non-selectable no-outline "+o.value,style:i.value,...s.value,...w.value}));function S(P){if(d.value!==null){if(P!==void 0){if(P.defaultPrevented===!0)return;const L=document.activeElement;if(e.type==="submit"&&L!==document.body&&d.value.contains(L)===!1&&L.contains(d.value)===!1){P.qAvoidFocus!==!0&&d.value.focus();const q=()=>{document.removeEventListener("keydown",Or,!0),document.removeEventListener("keyup",q,pn),d.value?.removeEventListener("blur",q,pn)};document.addEventListener("keydown",Or,!0),document.addEventListener("keyup",q,pn),d.value.addEventListener("blur",q,pn)}}l(P)}}function R(P){d.value!==null&&(t("keydown",P),as(P,[13,32])===!0&&Do!==d.value&&(Do!==null&&k(),P.defaultPrevented!==!0&&(P.qAvoidFocus!==!0&&d.value.focus(),Do=d.value,d.value.classList.add("q-btn--active"),document.addEventListener("keyup",I,!0),d.value.addEventListener("blur",I,pn)),Or(P)))}function E(P){d.value!==null&&(t("touchstart",P),P.defaultPrevented!==!0&&(To!==d.value&&(To!==null&&k(),To=d.value,p=P.target,p.addEventListener("touchcancel",I,pn),p.addEventListener("touchend",I,pn)),v=!0,m!==null&&clearTimeout(m),m=setTimeout(()=>{m=null,v=!1},200)))}function C(P){d.value!==null&&(P.qSkipRipple=v===!0,t("mousedown",P),P.defaultPrevented!==!0&&No!==d.value&&(No!==null&&k(),No=d.value,d.value.classList.add("q-btn--active"),document.addEventListener("mouseup",I,pn)))}function I(P){if(d.value!==null&&!(P?.type==="blur"&&document.activeElement===d.value)){if(P?.type==="keyup"){if(Do===d.value&&as(P,[13,32])===!0){const L=new MouseEvent("click",P);L.qKeyEvent=!0,P.defaultPrevented===!0&&Vo(L),P.cancelBubble===!0&&is(L),d.value.dispatchEvent(L),Or(P),P.qKeyEvent=!0}t("keyup",P)}k()}}function k(P){const L=h.value;P!==!0&&(To===d.value||No===d.value)&&L!==null&&L!==document.activeElement&&(L.setAttribute("tabindex",-1),L.focus()),To===d.value&&(p!==null&&(p.removeEventListener("touchcancel",I,pn),p.removeEventListener("touchend",I,pn)),To=p=null),No===d.value&&(document.removeEventListener("mouseup",I,pn),No=null),Do===d.value&&(document.removeEventListener("keyup",I,!0),d.value?.removeEventListener("blur",I,pn),Do=null),d.value?.classList.remove("q-btn--active")}function M(P){Or(P),P.qSkipRipple=!0}return Qt(()=>{k(!0)}),Object.assign(r,{click:P=>{f.value===!0&&S(P)}}),()=>{let P=[];e.icon!==void 0&&P.push(se(li,{name:e.icon,left:e.stack!==!0&&g.value===!0,role:"img"})),g.value===!0&&P.push(se("span",{class:"block"},[e.label])),P=Go(n.default,P),e.iconRight!==void 0&&e.round===!1&&P.push(se(li,{name:e.iconRight,right:e.stack!==!0&&g.value===!0,role:"img"}));const L=[se("span",{class:"q-focus-helper",ref:h})];return e.loading===!0&&e.percentage!==void 0&&L.push(se("span",{class:"q-btn__progress absolute-full overflow-hidden"+(e.darkPercentage===!0?" q-btn__progress--dark":"")},[se("span",{class:"q-btn__progress-indicator fit block",style:y.value})])),L.push(se("span",{class:"q-btn__content text-center col items-center q-anchor--skip "+a.value},P)),e.loading!==null&&L.push(se(rs,{name:"q-transition--fade"},()=>e.loading===!0?[se("span",{key:"loading",class:"absolute-full flex flex-center"},n.loading!==void 0?n.loading():[se(Nl)])]:null)),z0(se(c.value,_.value,L),[[t1,b.value,void 0,x.value]])}}}),vm={dark:{type:Boolean,default:null}};function mm(e,n){return oe(()=>e.dark===null?n.dark.isActive:e.dark)}const Pc=en({name:"QCard",props:{...vm,tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean},setup(e,{slots:n}){const{proxy:{$q:t}}=ot(),r=mm(e,t),o=oe(()=>"q-card"+(r.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>se(e.tag,{class:o.value},vr(n.default))}}),y1="_q_",Pl="_q_l_",gm="_q_pc_",b1="_q_fo_";function lr(){}const x1=en({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:n}){const{proxy:{$q:t}}=ot(),r=Xt(Pl,lr);if(r===lr)return console.error("QPage needs to be a deep child of QLayout"),lr;if(Xt(gm,lr)===lr)return console.error("QPage needs to be child of QPageContainer"),lr;const i=oe(()=>{const s=(r.header.space===!0?r.header.size:0)+(r.footer.space===!0?r.footer.size:0);if(typeof e.styleFn=="function"){const u=r.isContainer.value===!0?r.containerHeight.value:t.screen.height;return e.styleFn(s,u)}return{minHeight:r.isContainer.value===!0?r.containerHeight.value-s+"px":t.screen.height===0?s!==0?`calc(100vh - ${s}px)`:"100vh":t.screen.height-s+"px"}}),a=oe(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>se("main",{class:a.value,style:i.value},vr(n.default))}}),ym=en({name:"QPageContainer",setup(e,{slots:n}){const{proxy:{$q:t}}=ot(),r=Xt(Pl,lr);if(r===lr)return console.error("QPageContainer needs to be child of QLayout"),lr;Yo(gm,!0);const o=oe(()=>{const i={};return r.header.space===!0&&(i.paddingTop=`${r.header.size}px`),r.right.space===!0&&(i[`padding${t.lang.rtl===!0?"Left":"Right"}`]=`${r.right.size}px`),r.footer.space===!0&&(i.paddingBottom=`${r.footer.size}px`),r.left.space===!0&&(i[`padding${t.lang.rtl===!0?"Right":"Left"}`]=`${r.left.size}px`),i});return()=>se("div",{class:"q-page-container",style:o.value},vr(n.default))}});var bm=function(e,n){return(bm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])})(e,n)};function Nn(e,n){function t(){this.constructor=e}bm(e,n),e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function me(e,n,t,r){return new(t||(t=Promise))((function(o,i){function a(c){try{u(r.next(c))}catch(l){i(l)}}function s(c){try{u(r.throw(c))}catch(l){i(l)}}function u(c){c.done?o(c.value):new t((function(l){l(c.value)})).then(a,s)}u((r=r.apply(e,[])).next())}))}function ge(e,n){var t,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(u){return function(c){return(function(l){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){a=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(l[0]===6&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(f){l=[6,f],r=0}finally{t=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}})([u,c])}}}var w1=(function(){function e(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(n,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=n,this.platform=t},e.prototype.registerFlag=function(n,t,r){if(this.flagRegistry[n]={evaluationFn:t,setHook:r},this.urlFlags[n]!=null){var o=this.urlFlags[n];console.warn("Setting feature override from URL "+n+": "+o+"."),this.set(n,o)}},e.prototype.get=function(n){return n in this.flags?this.flags[n]:(this.flags[n]=this.evaluateFlag(n),this.flags[n])},e.prototype.getNumber=function(n){return this.get(n)},e.prototype.getBool=function(n){return this.get(n)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(n,t){if(this.flagRegistry[n]==null)throw new Error("Cannot set flag "+n+" as it has not been registered.");this.flags[n]=t,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(t)},e.prototype.evaluateFlag=function(n){if(this.flagRegistry[n]==null)throw new Error("Cannot evaluate flag '"+n+"': no evaluation function found.");return this.flagRegistry[n].evaluationFn()},e.prototype.setFlags=function(n){this.flags=Object.assign({},n)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var n=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,o=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(i){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return _1(r,a[0],a[1]),a.join("=")})),r);"tfjsflags"in o&&o.tfjsflags.split(",").forEach((function(i){var a=i.split(":"),s=a[0],u=a[1];n.urlFlags[s]=(function(c,l){if((l=l.toLowerCase())==="true"||l==="false")return l==="true";if(""+ +l===l)return+l;throw new Error("Could not parse value flag value "+l+" for flag "+c+".")})(s,u)}))}},e})();function _1(e,n,t){e[decodeURIComponent(n)]=decodeURIComponent(t||"")}function Q(){return xm}var xm=null,ss=new Map,Mc=new Map;function wm(e,n){var t=Cm(e,n);return ss.get(t)}function C1(e){return Mc.get(e)}function Jd(e){for(var n=ss.entries(),t=[];;){var r=n.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===e&&t.push(s)}return t}function _m(e){var n=e.kernelName,t=e.backendName,r=Cm(n,t);if(ss.has(r))throw new Error("The kernel '"+n+"' for backend '"+t+"' is already registered");ss.set(r,e)}function E1(e){var n=e.kernelName;Mc.has(n)&&console.warn("Overriding the gradient for '"+n+"'"),Mc.set(n,e)}function Cm(e,n){return n+"_"+e}function Oc(e,n,t){return Math.max(e,Math.min(n,t))}function Em(e){return e%2==0?e:e+1}function S1(e){for(var n=0,t=0;t<e.length;t++)n+=e[t];return n}function T(e,n){if(!e)throw new Error(typeof n=="string"?n:n())}function He(e,n,t){t===void 0&&(t=""),T(wt(e,n),(function(){return t+" Shapes "+e+" and "+n+" must match"}))}function gi(e){T(e!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function fi(e,n,t){if(n===void 0&&(n=[]),t===void 0&&(t=!1),n==null&&(n=[]),Array.isArray(e)||Kn(e)&&!t)for(var r=0;r<e.length;++r)fi(e[r],n,t);else n.push(e);return n}function ye(e){if(e.length===0)return 1;for(var n=e[0],t=1;t<e.length;t++)n*=e[t];return n}function wt(e,n){if(e===n)return!0;if(e==null||n==null||e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function it(e){return e%1==0}function R1(e){if(Math.tanh!=null)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var n=Math.exp(2*e);return(n-1)/(n+1)}function Bc(e){var n=Math.ceil(Math.sqrt(e));return[n,Math.ceil(e/n)]}function Jo(e,n){return n<=e.length?e:e+" ".repeat(n-e.length)}function Zd(e,n,t){return n===void 0&&(n=function(r){return 0}),new Promise((function(r,o){var i=0,a=function(){if(e())r();else{i++;var s=n(i);t!=null&&i>=t?o():setTimeout(a,s)}};a()}))}function k1(e,n){for(var t=1,r=-1,o=0;o<e.length;++o)if(e[o]>=0)t*=e[o];else if(e[o]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(e[o]<0)throw Error("Shapes can not be < 0. Found "+e[o]+" at dim "+o);if(r===-1){if(n>0&&n!==t)throw Error("Size("+n+") must match the product of shape "+e);return e}if(t===0)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(n%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+n+" / "+t);var i=e.slice();return i[r]=n/t,i}function gt(e,n){var t=n.length;return T((e=e==null?n.map((function(r,o){return o})):[].concat(e)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+e})),T(e.every((function(r){return it(r)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(r){return r<0?t+r:r}))}function ao(e,n){for(var t=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:gt(n,e).sort(),a=0,s=0;s<e.length;++s){if(i!=null){if(i[a]===s&&e[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(i[a]==null||i[a]>s)&&e[s]===1&&(t.push(e[s]),r.push(s)),i[a]<=s&&a++}e[s]!==1&&(t.push(e[s]),r.push(s))}return{newShape:t,keptDims:r}}function Yi(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else{if(e!=="bool")throw new Error("Unknown data type "+e);t=new Uint8Array(n)}return t}function us(e,n){var t=null;if(e==null||e==="float32")t=new Float32Array(n);else if(e==="int32")t=new Int32Array(n);else if(e==="bool")t=new Uint8Array(n);else{if(e!=="string")throw new Error("Unknown data type "+e);t=new Array(n)}return t}function I1(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+n+" being uploaded contains "+r+".")}}function A1(e){return e==="bool"||e==="complex64"||e==="float32"||e==="int32"||e==="string"}function T1(e,n){return n!=="complex64"&&(n!=="float32"||e==="complex64")&&(n!=="int32"||e==="float32"||e==="complex64")&&(n!=="bool"||e!=="bool")}function Kn(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Sm(e){if(e==="float32"||e==="int32")return 4;if(e==="complex64")return 8;if(e==="bool")return 1;throw new Error("Unknown dtype "+e)}function D1(e){if(e==null)return 0;var n=0;return e.forEach((function(t){return n+=t.length})),n}function Ml(e){return typeof e=="string"||e instanceof String}function N1(e){return typeof e=="boolean"}function F1(e){return typeof e=="number"}function sa(e){return Array.isArray(e)?sa(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":F1(e)?"float32":Ml(e)?"string":N1(e)?"bool":"float32"}function Lc(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Wc(e,n){for(var t=n;t<e;++t)if(e%t==0)return t;return e}function Xn(e){var n=e.length;if(n<2)return[];var t=new Array(n-1);t[n-2]=e[n-1];for(var r=n-3;r>=0;--r)t[r]=t[r+1]*e[r+1];return t}function Rm(e,n,t){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=fi(e)),t&&I1(e,n),(function(i,a){return i instanceof Float32Array&&a==="float32"||i instanceof Int32Array&&a==="int32"||i instanceof Uint8Array&&a==="bool"})(e,n))return e;if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool"){for(var r=new Uint8Array(e.length),o=0;o<r.length;++o)Math.round(e[o])!==0&&(r[o]=1);return r}throw new Error("Unknown data type "+n)}function eh(e,n){if(e.length===0)return n[0];var t=e.reduce((function(r,o){return r*o}));if(t===0)return[];if(t!==n.length)throw new Error("["+e+"] does not match the input size.");return(function r(o,i,a){var s=new Array;if(i.length===1)for(var u=i[0],c=0;c<u;c++)s[c]=a[o+c];else{u=i[0];var l=i.slice(1),f=l.reduce((function(d,h){return d*h}));for(c=0;c<u;c++)s[c]=r(o+c*f,l,a)}return s})(0,e,n)}function km(e,n){for(var t=ua(e,n),r=0;r<t.length;r++)t[r]=1;return t}function ua(e,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(e);if(n==="int32")return new Int32Array(e);if(n==="bool")return new Uint8Array(e);throw new Error("Unknown data type "+n)}function Un(){return Q().platform.now()}function Im(e){e.forEach((function(n){T(Number.isInteger(n)&&n>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function P1(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",Q().platform.encode(e,n)}function cs(e,n){return n===void 0&&(n="utf-8"),n=n||"utf-8",Q().platform.decode(e,n)}function th(e,n,t){if(n===0)return 0;if(n===1)return e[0];for(var r=e[e.length-1],o=0;o<e.length-1;++o)r+=t[o]*e[o];return r}function M1(e,n,t){if(n===0)return[];if(n===1)return[e];for(var r=new Array(n),o=0;o<r.length-1;++o)r[o]=Math.floor(e/t[o]),e-=r[o]*t[o];return r[r.length-1]=e,r}var O1=(function(){function e(n,t){this.backendTimer=n,this.logger=t,t==null&&(this.logger=new B1)}return e.prototype.profileKernel=function(n,t,r){var o,i=this,a=this.backendTimer.time((function(){o=r()}));return o.forEach((function(s){s.data().then((function(u){(function(c,l,f){if(l!=="float32")return!1;for(var d=0;d<c.length;d++){var h=c[d];if(isNaN(h)||!isFinite(h))return console.warn("Found "+h+" in the result of '"+f+"'"),!0}})(u,s.dtype,n),a.then((function(c){var l="";c.getExtraProfileInfo!=null&&(l=c.getExtraProfileInfo()),i.logger.logKernelProfile(n,s,u,c.kernelMs,t,l)}))}))})),o},e})(),B1=(function(){function e(){}return e.prototype.logKernelProfile=function(n,t,r,o,i,a){var s=typeof o=="number"?Jo(o+"ms",9):o.error,u=Jo(n,25),c=t.rank,l=t.size,f=Jo(t.shape.toString(),14),d="";for(var h in i){var p=i[h].shape||t.shape,v=p.length;d+=h+": "+v+"D "+(v>0?p:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+c+"D "+f+"	%c"+l+"	%c"+d+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e})(),nh=20,_i=3,Pu=7;function L1(e,n,t,r){var o=Xn(n),i=(function(c,l,f,d){var h=ye(l),p=d[d.length-1],v=new Array(p).fill(0),m=l.length,g=f==="complex64"?Ei(c):c;if(m>1)for(var b=0;b<h/p;b++)for(var x=b*p,y=0;y<p;y++)v[y]=Math.max(v[y],Ci(g[x+y],0,f).length);return v})(e,n,t,o),a=n.length,s=(function c(l,f,d,h,p,v){v===void 0&&(v=!0);var m=d==="complex64"?2:1,g=f[0],b=f.length;if(b===0)return d==="complex64"?[Ci(Ei(l)[0],0,d)]:d==="bool"?[Am(l[0])]:[l[0].toString()];if(b===1){if(g>nh){var x=_i*m,y=Array.from(l.slice(0,x)),w=Array.from(l.slice((g-_i)*m,g*m));return d==="complex64"&&(y=Ei(y),w=Ei(w)),["["+y.map((function(L,q){return Ci(L,p[q],d)})).join(", ")+", ..., "+w.map((function(L,q){return Ci(L,p[g-_i+q],d)})).join(", ")+"]"]}return["["+(d==="complex64"?Ei(l):Array.from(l)).map((function(L,q){return Ci(L,p[q],d)})).join(", ")+"]"]}var _=f.slice(1),S=h.slice(1),R=h[0]*m,E=[];if(g>nh){for(var C=0;C<_i;C++){var I=(k=C*R)+R;E.push.apply(E,c(l.slice(k,I),_,d,S,p,!1))}for(E.push("..."),C=g-_i;C<g;C++)I=(k=C*R)+R,E.push.apply(E,c(l.slice(k,I),_,d,S,p,C===g-1))}else for(C=0;C<g;C++){var k;I=(k=C*R)+R,E.push.apply(E,c(l.slice(k,I),_,d,S,p,C===g-1))}var M=b===2?",":"";for(E[0]="["+E[0]+M,C=1;C<E.length-1;C++)E[C]=" "+E[C]+M;var P=`,
`;for(C=2;C<b;C++)P+=`
`;return E[E.length-1]=" "+E[E.length-1]+"]"+(v?"":P),E})(e,n,t,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+n+"]"),u.push("  values:")),u.push(s.map((function(c){return"    "+c})).join(`
`)),u.join(`
`)}function Ci(e,n,t){return Jo(Array.isArray(e)?parseFloat(e[0].toFixed(Pu))+" + "+parseFloat(e[1].toFixed(Pu))+"j":Ml(e)?"'"+e+"'":t==="bool"?Am(e):parseFloat(e.toFixed(Pu)).toString(),n)}function Am(e){return e===0?"false":"true"}function Ei(e){for(var n=[],t=0;t<e.length;t+=2)n.push([e[t],e[t+1]]);return n}var Qi=(function(){function e(n,t,r){var o=this;if(this.dtype=t,this.shape=n.slice(),this.size=ye(n),r!=null){var i=r.length;T(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+o.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||us(t,this.size),this.strides=Xn(n)}return e.prototype.set=function(n){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];r.length===0&&(r=[0]),T(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(r);this.values[i]=n},e.prototype.get=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];n.length===0&&(n=[0]);for(var r=0,o=0,i=n;o<i.length;o++){var a=i[o];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+n+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=n[n.length-1],c=0;c<n.length-1;++c)u+=this.strides[c]*n[c];return this.values[u]},e.prototype.locToIndex=function(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];for(var t=n[n.length-1],r=0;r<n.length-1;++r)t+=this.strides[r]*n[r];return t},e.prototype.indexToLoc=function(n){if(this.rank===0)return[];if(this.rank===1)return[n];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(n/this.strides[r]),n-=t[r]*this.strides[r];return t[t.length-1]=n,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return zn().makeTensor(this.values,this.shape,this.dtype)},e})(),zn=null,K=null,Tm=null,Je=(function(){function e(n,t,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=t||"float32",this.size=ye(n),this.strides=Xn(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),T(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(n,t){return this.throwIfDisposed(),this.reshape([n,t])},e.prototype.as3D=function(n,t,r){return this.throwIfDisposed(),this.reshape([n,t,r])},e.prototype.as4D=function(n,t,r,o){return this.throwIfDisposed(),this.reshape([n,t,r,o])},e.prototype.as5D=function(n,t,r,o,i){return this.throwIfDisposed(),this.reshape([n,t,r,o,i])},e.prototype.asType=function(n){return this.throwIfDisposed(),K.cast(this,n)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return me(this,void 0,void 0,(function(){var n;return ge(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,K.buffer(this.shape,this.dtype,n)]}}))}))},e.prototype.bufferSync=function(){return K.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return me(this,void 0,void 0,(function(){var n;return ge(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return n=t.sent(),[2,eh(this.shape,n)]}}))}))},e.prototype.arraySync=function(){return eh(this.shape,this.dataSync())},e.prototype.data=function(){return me(this,void 0,void 0,(function(){var n,t;return ge(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),n=zn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,n];case 1:t=r.sent();try{return[2,t.map((function(o){return cs(o)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,n]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var n=zn().readSync(this.dataId);if(this.dtype==="string")try{return n.map((function(t){return cs(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n},e.prototype.bytes=function(){return me(this,void 0,void 0,(function(){var n;return ge(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,zn().read(this.dataId)];case 1:return n=t.sent(),this.dtype==="string"?[2,n]:[2,new Uint8Array(n.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(zn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(n){return n===void 0&&(n=!1),K.print(this,n)},e.prototype.reshape=function(n){return this.throwIfDisposed(),K.reshape(this,n)},e.prototype.reshapeAs=function(n){return this.throwIfDisposed(),this.reshape(n.shape)},e.prototype.expandDims=function(n){return n===void 0&&(n=0),K.expandDims(this,n)},e.prototype.cumsum=function(n,t,r){return n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1),K.cumsum(this,n,t,r)},e.prototype.squeeze=function(n){return this.throwIfDisposed(),K.squeeze(this,n)},e.prototype.clone=function(){return this.throwIfDisposed(),K.clone(this)},e.prototype.oneHot=function(n,t,r){return this.throwIfDisposed(),K.oneHot(this,n,t,r)},e.prototype.toString=function(n){return n===void 0&&(n=!1),L1(this.dataSync(),this.shape,this.dtype,n)},e.prototype.tile=function(n){return this.throwIfDisposed(),K.tile(this,n)},e.prototype.gather=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),K.gather(this,n,t)},e.prototype.matMul=function(n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),K.matMul(this,n,t,r)},e.prototype.dot=function(n){return this.throwIfDisposed(),K.dot(this,n)},e.prototype.norm=function(n,t,r){return n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),K.norm(this,n,t,r)},e.prototype.slice=function(n,t){return this.throwIfDisposed(),K.slice(this,n,t)},e.prototype.reverse=function(n){return this.throwIfDisposed(),K.reverse(this,n)},e.prototype.concat=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),n instanceof e&&(n=[n]),K.concat([this].concat(n),t)},e.prototype.split=function(n,t){return t===void 0&&(t=0),this.throwIfDisposed(),K.split(this,n,t)},e.prototype.stack=function(n,t){return t===void 0&&(t=0),K.stack([this,n],t)},e.prototype.unstack=function(n){return n===void 0&&(n=0),K.unstack(this,n)},e.prototype.pad=function(n,t){return t===void 0&&(t=0),K.pad(this,n,t)},e.prototype.batchNormalization=function(n,t,r,o,i){return r===void 0&&(r=.001),Tm("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(n,t,i,o,r)},e.prototype.batchNorm=function(n,t,r,o,i){return i===void 0&&(i=.001),this.throwIfDisposed(),K.batchNorm(this,n,t,r,o,i)},e.prototype.all=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.all(this,n,t)},e.prototype.any=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.any(this,n,t)},e.prototype.logSumExp=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.logSumExp(this,n,t)},e.prototype.sum=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.sum(this,n,t)},e.prototype.prod=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.prod(this,n,t)},e.prototype.mean=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.mean(this,n,t)},e.prototype.min=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.min(this,n,t)},e.prototype.max=function(n,t){return n===void 0&&(n=null),t===void 0&&(t=!1),this.throwIfDisposed(),K.max(this,n,t)},e.prototype.argMin=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),K.argMin(this,n)},e.prototype.argMax=function(n){return n===void 0&&(n=null),this.throwIfDisposed(),K.argMax(this,n)},e.prototype.cast=function(n){return this.throwIfDisposed(),K.cast(this,n)},e.prototype.add=function(n){return this.throwIfDisposed(),K.add(this,n)},e.prototype.addStrict=function(n){return this.throwIfDisposed(),K.addStrict(this,n)},e.prototype.atan2=function(n){return this.throwIfDisposed(),K.atan2(this,n)},e.prototype.sub=function(n){return this.throwIfDisposed(),K.sub(this,n)},e.prototype.subStrict=function(n){return this.throwIfDisposed(),K.subStrict(this,n)},e.prototype.pow=function(n){return this.throwIfDisposed(),K.pow(this,n)},e.prototype.powStrict=function(n){return this.throwIfDisposed(),K.powStrict(this,n)},e.prototype.mul=function(n){return this.throwIfDisposed(),K.mul(this,n)},e.prototype.mulStrict=function(n){return this.throwIfDisposed(),K.mulStrict(this,n)},e.prototype.div=function(n){return this.throwIfDisposed(),K.div(this,n)},e.prototype.divNoNan=function(n){return this.throwIfDisposed(),K.divNoNan(this,n)},e.prototype.floorDiv=function(n){return this.throwIfDisposed(),K.floorDiv(this,n)},e.prototype.divStrict=function(n){return this.throwIfDisposed(),K.divStrict(this,n)},e.prototype.minimum=function(n){return this.throwIfDisposed(),K.minimum(this,n)},e.prototype.minimumStrict=function(n){return this.throwIfDisposed(),K.minimumStrict(this,n)},e.prototype.maximum=function(n){return this.throwIfDisposed(),K.maximum(this,n)},e.prototype.maximumStrict=function(n){return this.throwIfDisposed(),K.maximumStrict(this,n)},e.prototype.mod=function(n){return this.throwIfDisposed(),K.mod(this,n)},e.prototype.modStrict=function(n){return this.throwIfDisposed(),K.modStrict(this,n)},e.prototype.squaredDifferenceStrict=function(n){return this.throwIfDisposed(),K.squaredDifferenceStrict(this,n)},e.prototype.transpose=function(n){return this.throwIfDisposed(),K.transpose(this,n)},e.prototype.notEqual=function(n){return this.throwIfDisposed(),K.notEqual(this,n)},e.prototype.notEqualStrict=function(n){return this.throwIfDisposed(),K.notEqualStrict(this,n)},e.prototype.less=function(n){return this.throwIfDisposed(),K.less(this,n)},e.prototype.lessStrict=function(n){return this.throwIfDisposed(),K.lessStrict(this,n)},e.prototype.equal=function(n){return this.throwIfDisposed(),K.equal(this,n)},e.prototype.equalStrict=function(n){return this.throwIfDisposed(),K.equalStrict(this,n)},e.prototype.lessEqual=function(n){return this.throwIfDisposed(),K.lessEqual(this,n)},e.prototype.lessEqualStrict=function(n){return this.throwIfDisposed(),K.lessEqualStrict(this,n)},e.prototype.greater=function(n){return this.throwIfDisposed(),K.greater(this,n)},e.prototype.greaterStrict=function(n){return this.throwIfDisposed(),K.greaterStrict(this,n)},e.prototype.greaterEqual=function(n){return this.throwIfDisposed(),K.greaterEqual(this,n)},e.prototype.greaterEqualStrict=function(n){return this.throwIfDisposed(),K.greaterEqualStrict(this,n)},e.prototype.logicalAnd=function(n){return this.throwIfDisposed(),K.logicalAnd(this,n)},e.prototype.logicalOr=function(n){return this.throwIfDisposed(),K.logicalOr(this,n)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),K.logicalNot(this)},e.prototype.logicalXor=function(n){return this.throwIfDisposed(),K.logicalXor(this,n)},e.prototype.where=function(n,t){return this.throwIfDisposed(),K.where(n,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),K.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),K.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),K.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),K.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),K.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),K.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),K.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),K.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),K.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),K.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),K.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),K.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),K.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),K.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),K.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),K.abs(this)},e.prototype.clipByValue=function(n,t){return this.throwIfDisposed(),K.clipByValue(this,n,t)},e.prototype.relu=function(){return this.throwIfDisposed(),K.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),K.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),K.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),K.selu(this)},e.prototype.leakyRelu=function(n){return n===void 0&&(n=.2),this.throwIfDisposed(),K.leakyRelu(this,n)},e.prototype.prelu=function(n){return this.throwIfDisposed(),K.prelu(this,n)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),K.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),K.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),K.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),K.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),K.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),K.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),K.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),K.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),K.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),K.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),K.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),K.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),K.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),K.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),K.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),K.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),K.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),K.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),K.round(this)},e.prototype.step=function(n){return n===void 0&&(n=0),this.throwIfDisposed(),K.step(this,n)},e.prototype.softmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),K.softmax(this,n)},e.prototype.logSoftmax=function(n){return n===void 0&&(n=-1),this.throwIfDisposed(),K.logSoftmax(this,n)},e.prototype.resizeBilinear=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),K.image.resizeBilinear(this,n,t)},e.prototype.resizeNearestNeighbor=function(n,t){return t===void 0&&(t=!1),this.throwIfDisposed(),K.image.resizeNearestNeighbor(this,n,t)},e.prototype.conv1d=function(n,t,r,o,i,a){return o===void 0&&(o="NWC"),i===void 0&&(i=1),this.throwIfDisposed(),K.conv1d(this,n,t,r,o,i,a)},e.prototype.conv2d=function(n,t,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),K.conv2d(this,n,t,r,o,i,a)},e.prototype.conv2dTranspose=function(n,t,r,o,i){return this.throwIfDisposed(),K.conv2dTranspose(this,n,t,r,o,i)},e.prototype.depthwiseConv2D=function(n,t,r,o,i,a){return o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]),this.throwIfDisposed(),K.depthwiseConv2d(this,n,t,r,o,i,a)},e.prototype.separableConv2d=function(n,t,r,o,i,a){return i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),K.separableConv2d(this,n,t,r,o,i,a)},e.prototype.avgPool=function(n,t,r,o){return this.throwIfDisposed(),K.avgPool(this,n,t,r,o)},e.prototype.maxPool=function(n,t,r,o){return this.throwIfDisposed(),K.maxPool(this,n,t,r,o)},e.prototype.localResponseNormalization=function(n,t,r,o){return n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5),K.localResponseNormalization(this,n,t,r,o)},e.prototype.pool=function(n,t,r,o,i){return this.throwIfDisposed(),K.pool(this,n,t,r,o,i)},e.prototype.variable=function(n,t,r){return n===void 0&&(n=!0),this.throwIfDisposed(),zn().makeVariable(this,n,t,r)},e.prototype.unsortedSegmentSum=function(n,t){return this.throwIfDisposed(),K.unsortedSegmentSum(this,n,t)},e.prototype.batchToSpaceND=function(n,t){return this.throwIfDisposed(),K.batchToSpaceND(this,n,t)},e.prototype.spaceToBatchND=function(n,t){return this.throwIfDisposed(),K.spaceToBatchND(this,n,t)},e.prototype.topk=function(n,t){return n===void 0&&(n=1),t===void 0&&(t=!0),this.throwIfDisposed(),K.topk(this,n,t)},e.prototype.stridedSlice=function(n,t,r,o,i,a,s,u){return o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),K.stridedSlice(this,n,t,r,o,i,a,s,u)},e.prototype.depthToSpace=function(n,t){return this.throwIfDisposed(),K.depthToSpace(this,n,t)},e.prototype.fft=function(){return this.throwIfDisposed(),K.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),K.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),K.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),K.spectral.irfft(this)},e})();Object.defineProperty(Je,Symbol.hasInstance,{value:function(e){return!!e&&e.dataId!=null&&e.shape!=null&&e.dtype!=null}});var rh,Vc,Uc,zc,qc,di=(function(e){function n(t,r,o,i){var a=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return a.trainable=r,a.name=o,a}return Nn(n,e),n.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!wt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");zn().disposeTensor(this),this.dataId=t.dataId,zn().incRef(this,null)},n.prototype.dispose=function(){zn().disposeVariable(this),this.isDisposedInternal=!0},n})(Je);Object.defineProperty(di,Symbol.hasInstance,{value:function(e){return e instanceof Je&&e.assign!=null&&e.assign instanceof Function}}),(function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"})(rh||(rh={})),(function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"})(Vc||(Vc={})),(function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"})(Uc||(Uc={})),(function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"})(zc||(zc={})),(function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"})(qc||(qc={}));var W1={float32:zc,int32:Vc,bool:Uc,complex64:qc};function Rt(e,n){if(e==="string"||n==="string"){if(e==="string"&&n==="string")return"string";throw new Error("Can not upcast "+e+" with "+n)}return W1[e][n]}function Mu(e){return Rt(e,"int32")}function et(e,n){if(e.dtype===n.dtype)return[e,n];var t=Rt(e.dtype,n.dtype);return[e.cast(t),n.cast(t)]}function V1(e,n){T(e.dtype===n.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+n.dtype+") input must match"}))}function Dm(e){var n=[];return(function t(r,o,i){if(r!=null){if(r instanceof Je)return void o.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var c=s[u];i.has(c)||(i.add(c),t(c,o,i))}}}})(e,n,new Set),n}var Ou,oh=(function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var n in this.registeredVariables)this.registeredVariables[n].dispose()},e})(),U1=(function(){function e(n){this.ENV=n,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new oh}return e.prototype.ready=function(){return me(this,void 0,void 0,(function(){var n,t,r;return ge(this,(function(o){switch(o.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];n=this.getSortedBackends(),t=0,o.label=1;case 1:return t<n.length?(r=n[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return o.sent()?[4,this.setBackend(r)]:[3,4];case 3:return o.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var n=this.initializeBackendsAndReturnBest(),t=n.name;if(n.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(n){return!(n in this.registry)&&(!(n in this.registryFactory)||this.initializeBackend(n).asyncInit)?null:this.registry[n]},e.prototype.findBackendFactory=function(n){return n in this.registryFactory?this.registryFactory[n].factory:null},e.prototype.registerBackend=function(n,t,r){return r===void 0&&(r=1),n in this.registryFactory?(console.warn(n+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[n]={factory:t,priority:r},!0)},e.prototype.setBackend=function(n){return me(this,void 0,void 0,(function(){var t,r,o;return ge(this,(function(i){switch(i.label){case 0:if(this.registryFactory[n]==null)throw new Error("Backend name '"+n+"' not found in registry");return this.backendName=n,this.registry[n]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(n),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return o=i.sent(),[3,3];case 2:o=r,i.label=3;case 3:if(!o)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[n],this.setupRegisteredKernels(),this.profiler=new O1(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var n=this;Jd(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(n.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(n){var t=this;Jd(n).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[n])}))},e.prototype.initializeBackend=function(n){var t=this,r=this.registryFactory[n];if(r==null)throw new Error("Cannot initialize backend "+n+", no registration found.");try{var o=r.factory();if(Promise.resolve(o)===o){var i=++this.pendingBackendInitId,a=o.then((function(s){return!(i<t.pendingBackendInitId)&&(t.registry[n]=s,t.pendingBackendInit=null,!0)})).catch((function(s){return!(i<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[n]=o,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+n+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(n){if(!(n in this.registryFactory))throw new Error(n+" backend not found in registry");this.backendName===n&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,n in this.registry&&(this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n]),delete this.registryFactory[n],this.backendName===n&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var n=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return n.registryFactory[r].priority-n.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var n=this.getSortedBackends(),t=0;t<n.length;t++){var r=n[t],o=this.initializeBackend(r),i=o.success,a=o.asyncInit;if(a||i)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(n,t){var r=this.state.tensorInfo.get(t),o=r.backend,i=this.readSync(t);o.disposeData(t),r.backend=n,n.move(t,i,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(n,t){var r,o=this,i=null;if(t==null){if(typeof n!="function")throw new Error("Please provide a function to tidy()");t=n}else{if(typeof n!="string"&&!(n instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=n}return this.scopedRun((function(){return o.startScope(i)}),(function(){return o.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},e.prototype.scopedRun=function(n,t,r){n();try{var o=r();return t(),o}catch(i){throw t(),i}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(n){var t=this.makeTensorFromDataId(n.dataId,n.shape,n.dtype),r={x:n};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(o){return{x:function(){return o.toFloat()}}}),[]),t},e.prototype.runKernel=function(n,t,r,o,i){return this.runKernelFunc(null,t,null,n,r,o,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(n,t,r){var o=this.backend.numDataIds(),i=0;r.forEach((function(u){i+=u.dtype==="complex64"?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=o-t-i-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+n+"'")},e.prototype.runKernelFunc=function(n,t,r,o,i,a,s){var u,c=this;a===void 0&&(a=[]),s===void 0&&(s=[]);var l=[],f=this.isTapeOn();o==null&&(o=this.state.activeScope!=null?this.state.activeScope.name:"");var d,h=function(b){f&&(l=b.map((function(x){return c.keep(c.clone(x))})))},p=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var m,g=wm(o,this.backendName);return d=g!=null?function(){var b=c.backend.numDataIds();m=g.kernelFunc({inputs:t,attrs:i,backend:c.backend});var x=Array.isArray(m)?m:[m];c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,x);var y=x.map((function(_){var S=_.dataId,R=_.shape,E=_.dtype;return c.makeTensorFromDataId(S,R,E)})),w=y.filter((function(_,S){return s[S]}));return h((a||[]).slice().concat(w)),y}:function(){var b=c.backend.numDataIds();m=c.tidy((function(){return n(c.backend,h)}));var x=Array.isArray(m)?m:[m];return c.shouldCheckForMemLeaks()&&c.checkKernelForMemLeak(o,b,x),x},this.scopedRun((function(){return c.state.kernelDepth++}),(function(){return c.state.kernelDepth--}),(function(){u=c.ENV.getBool("DEBUG")?c.profiler.profileKernel(o,t,(function(){return d()})):d()})),f&&this.addTapeNode(o,t,u,r,l),this.state.profiling&&this.state.activeProfile.kernels.push({name:o,bytesAdded:this.state.numBytes-p,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(b){return t[b].shape})),outputShapes:u.map((function(b){return b.shape}))}),Array.isArray(m)?u:u[0]},e.prototype.makeTensor=function(n,t,r,o){if(n==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",o=o||this.backend;var i=n;r==="string"&&Ml(n[0])&&(i=n.map((function(l){return P1(l)})));var a=o.write(i,t,r),s=new Je(t,r,a,this.nextTensorId());if(this.incRef(s,o),r==="string"){var u=this.state.tensorInfo.get(a),c=D1(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},e.prototype.makeTensorFromDataId=function(n,t,r,o){var i=new Je(t,r=r||"float32",n,this.nextTensorId());return this.incRef(i,o),i},e.prototype.makeVariable=function(n,t,r,o){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),o!=null&&o!==n.dtype&&(n=n.asType(o));var i=new di(n,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(n,t){var r=this.state.tensorInfo.has(n.dataId)?this.state.tensorInfo.get(n.dataId).refCount:0;if(this.state.numTensors++,n.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var o=0;n.dtype!=="complex64"&&n.dtype!=="string"&&(o=n.size*Sm(n.dtype)),this.state.tensorInfo.set(n.dataId,{backend:t||this.backend,dtype:n.dtype,shape:n.shape,bytes:o,refCount:0}),this.state.numBytes+=o}this.state.tensorInfo.get(n.dataId).refCount++,n instanceof di||this.track(n)},e.prototype.disposeTensor=function(n){if(this.state.tensorInfo.has(n.dataId)){this.state.numTensors--,n.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(n.dataId);t.refCount<=1?(n.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(n.dataId),this.state.tensorInfo.delete(n.dataId)):this.state.tensorInfo.get(n.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var n in this.state.registeredVariables){var t=this.state.registeredVariables[n];this.disposeVariable(t)}},e.prototype.disposeVariable=function(n){this.disposeTensor(n),this.state.registeredVariables[n.name]!=null&&delete this.state.registeredVariables[n.name]},e.prototype.memory=function(){var n=this.backend.memory();return n.numTensors=this.state.numTensors,n.numDataBuffers=this.state.numDataBuffers,n.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(n.unreliable=!0,n.reasons==null&&(n.reasons=[]),n.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),n},e.prototype.profile=function(n){return me(this,void 0,void 0,(function(){var t,r;return ge(this,(function(o){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=n(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(i){return i.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},e.prototype.addTapeNode=function(n,t,r,o,i){var a=this,s={id:this.state.nextTapeNodeId++,kernelName:n,inputs:t,outputs:r,saved:i},u=C1(n);u!=null&&(o=u.gradFunc),o!=null&&(s.gradient=function(c){return c=c.map((function(l,f){if(l==null){var d=r[f],h=ua(d.size,d.dtype);return a.makeTensor(h,d.shape,d.dtype)}return l})),o(c.length>1?c:c[0],i)}),this.state.activeTape.push(s)},e.prototype.keep=function(n){return n.kept=!0,n},e.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(n){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};n&&(t.name=n),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(n){for(var t=this,r=Dm(n),o=new Set(r.map((function(u){return u.id}))),i=0;i<this.state.activeScope.track.length;i++){var a=this.state.activeScope.track[i];a.kept||o.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(u){u.kept||u.scopeId!==s.id||t.track(u)}))},e.prototype.gradients=function(n,t,r,o){var i=this;if(o===void 0&&(o=!1),T(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",n)}));T(a instanceof Je,(function(){return"The result y returned by f() must be a tensor."}));var s=(function(u,c,l){for(var f={},d={},h=0;h<c.length;h++)f[c[h].id]=!0;for(h=0;h<u.length;h++){var p=(_=u[h]).inputs;for(var v in p){for(var m=p[v],g=!1,b=0;b<c.length;b++)if(f[m.id]){_.outputs.forEach((function(C){return f[C.id]=!0})),g=!0,d[_.id]=!0;break}if(g)break}}var x={};x[l.id]=!0;var y={};for(h=u.length-1;h>=0;h--)for(p=(_=u[h]).inputs,b=0;b<_.outputs.length;b++)if(x[_.outputs[b].id]){for(var v in p)x[p[v].id]=!0,y[_.id]=!0;break}var w=[];for(h=0;h<u.length;h++){var _;if(d[(_=u[h]).id]&&y[_.id]){var S={};for(var v in _.inputs){var R=_.inputs[v];f[R.id]&&(S[v]=R)}var E=Object.assign({},_);E.inputs=S,E.outputs=_.outputs,w.push(E)}}return w})(this.state.activeTape,t,a);if(!o&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var u,c,l={};l[a.id]=r??(u=a.shape,c=km(ye(u),"float32"),W.makeTensor(c,u,"float32")),(function(d,h,p){for(var v=function(g){var b=h[g],x=[];if(b.outputs.forEach((function(S){var R=d[S.id];R!=null?x.push(R):x.push(null)})),b.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+b.kernelName+".");var y=b.gradient(x),w=function(S){if(!(S in y))throw new Error("Cannot backprop through input "+S+". Available gradients found: "+Object.keys(y)+".");var R=p((function(){return y[S]()}));if(R.dtype!=="float32")throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input "+S+" must have 'float32' dtype, but has '"+R.dtype+"'");var E=b.inputs[S];if(!wt(R.shape,E.shape))throw new Error("Error in gradient for op "+b.kernelName+". The gradient of input '"+S+"' has shape '"+R.shape+"', which does not match the shape of the input '"+E.shape+"'");if(d[E.id]==null)d[E.id]=R;else{var C=d[E.id];d[E.id]=C.add(R),C.dispose()}};for(var _ in b.inputs)w(_)},m=h.length-1;m>=0;m--)v(m)})(l,s,(function(d){return i.tidy(d)}));var f=t.map((function(d){return l[d.id]}));return i.state.gradientDepth===0&&(i.state.activeTape.forEach((function(d){for(var h=0,p=d.saved;h<p.length;h++)p[h].dispose()})),i.state.activeTape=null),{value:a,grads:f}}))},e.prototype.customGrad=function(n){var t=this;return T(Lc(n),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];T(o.every((function(s){return s instanceof Je})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return o.forEach((function(s,u){a[u]=s})),t.runKernelFunc((function(s,u){return T((r=n.apply(void 0,o.concat([u]))).value instanceof Je,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),T(Lc(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),a,(function(s,u){var c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];T(l.length===o.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),T(l.every((function(d){return d instanceof Je})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var f={};return l.forEach((function(d,h){f[h]=function(){return d}})),f}))}},e.prototype.readSync=function(n){return this.state.tensorInfo.get(n).backend.readSync(n)},e.prototype.read=function(n){return this.state.tensorInfo.get(n).backend.read(n)},e.prototype.time=function(n){return me(this,void 0,void 0,(function(){var t,r;return ge(this,(function(o){switch(o.label){case 0:return t=Un(),[4,this.backend.time(n)];case 1:return(r=o.sent()).wallMs=Un()-t,[2,r]}}))}))},e.prototype.track=function(n){return this.state.activeScope!=null&&(n.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(n)),n},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var n in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new oh,this.registry)this.disposeRegisteredKernels(n),this.registry[n].dispose(),delete this.registry[n];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e})(),W=(function(){var e=(function(){if(Ou==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Ou=t}return Ou})();if(e._tfengine==null){var n=new w1(e);e._tfengine=new U1(n)}return(function(t){xm=t})(e._tfengine.ENV),zn=function(){return e._tfengine},e._tfengine})();function Nm(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ar=Q();ar.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ar.registerFlag("IS_BROWSER",(function(){return Nm()})),ar.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),ar.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),ar.registerFlag("PROD",(function(){return!1})),ar.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return ar.getBool("DEBUG")})),ar.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),ar.registerFlag("IS_TEST",(function(){return!1}));var Ji,sn,rn,ro={},Bu={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function z1(e,n){ro[e]=n}function Zn(e){e in ro||(ro[e]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(o){if(typeof OffscreenCanvas<"u"&&o===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(o){o.preventDefault(),delete ro[t]}),!1),t===1?r.getContext("webgl",Bu)||r.getContext("experimental-webgl",Bu):r.getContext("webgl2",Bu)})(e));var n=ro[e];return n.isContextLost()?(delete ro[e],Zn(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ro[e])}function Js(e,n){return[n,e]}function Vi(e){var n=ye(e);return Bc(Math.ceil(n/4))}function ca(e,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(e/2))]}function Ol(e,n){var t,r,o,i,a,s,u,c,l,f=e;return Q().getNumber("WEBGL_VERSION")===2?(t=f.R32F,r=f.R16F,o=f.RGBA16F,i=f.RGBA32F,a=f.RED,s=4,u=1,c=f.HALF_FLOAT,l=f.FLOAT):(t=e.RGBA,r=e.RGBA,o=e.RGBA,i=f.RGBA,a=e.RGBA,s=4,u=4,c=n!=null?n.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function xe(e,n,t){var r=t();return n&&(function(o){var i=o.getError();if(i!==o.NO_ERROR)throw new Error("WebGL Error: "+j1(o,i))})(e),r}(function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"})(Ji||(Ji={})),(function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"})(sn||(sn={})),(function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(rn||(rn={}));var q1=596e-10,H1=65504;function G1(e){return!!(Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||e===0||q1<Math.abs(e)&&Math.abs(e)<H1)}function j1(e,n){switch(n){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+n}}function _a(e,n,t){return xr(e,n,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function $1(e,n,t){var r=xr(e,n,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(xe(e,n,(function(){return e.shaderSource(r,t)})),xe(e,n,(function(){return e.compileShader(r)})),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function K1(e,n,t){var r=xr(e,n,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(xe(e,n,(function(){return e.shaderSource(r,t)})),xe(e,n,(function(){return e.compileShader(r)})),e.getShaderParameter(r,e.COMPILE_STATUS)===!1)throw(function(o,i){var a=X1.exec(i);if(a==null)return console.log("Couldn't parse line number in error: "+i),void console.log(o);for(var s=+a[1],u=o.split(`
`),c=u.length.toString().length+2,l=u.map((function(m,g){return Jo((g+1).toString(),c)+m})),f=0,d=0;d<l.length;d++)f=Math.max(l[d].length,f);var h=l.slice(0,s-1),p=l.slice(s-1,s),v=l.slice(s);console.log(h.join(`
`)),console.log(i.split(`
`)[0]),console.log("%c "+Jo(p[0],f),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))})(t,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Lu,Wu,X1=/ERROR: [0-9]+:([0-9]+):/g;function Y1(e,n){return xr(e,n,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function Q1(e,n,t){if(xe(e,n,(function(){return e.linkProgram(t)})),e.getProgramParameter(t,e.LINK_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Vu(e,n,t){if(xe(e,n,(function(){return e.validateProgram(t)})),e.getProgramParameter(t,e.VALIDATE_STATUS)===!1)throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function J1(e,n,t){var r=xr(e,n,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return xe(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),xe(e,n,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),r}function Z1(e,n,t){var r=xr(e,n,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return xe(e,n,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),xe(e,n,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),r}function e_(e,n){return xr(e,n,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function t_(e,n){var t=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||n<=0){var r="["+e+"x"+n+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>t||n>t)throw r="["+e+"x"+n+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function n_(e,n){return xr(e,n,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ih(e,n,t,r,o,i,a,s){var u=e.getAttribLocation(t,r);return u!==-1&&(xe(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,o)})),xe(e,n,(function(){return e.vertexAttribPointer(u,i,e.FLOAT,!1,a,s)})),xe(e,n,(function(){return e.enableVertexAttribArray(u)})),!0)}function r_(e,n,t,r){u_(e,r),xe(e,n,(function(){return e.activeTexture(e.TEXTURE0+r)})),xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function o_(e,n,t,r){return xr(e,n,(function(){return e.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function i_(e,n,t){return e.getUniformLocation(n,t)}function a_(e,n,t,r,o,i){xe(e,n,(function(){return r_(e,n,r,i)})),xe(e,n,(function(){return e.uniform1i(o,i)}))}function Uu(e,n,t,r){xe(e,n,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),xe(e,n,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function ah(e,n,t){xe(e,n,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),xe(e,n,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Ca(e){var n=e.checkFramebufferStatus(e.FRAMEBUFFER);if(n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+s_(e,n))}function s_(e,n){switch(n){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+n}}function xr(e,n,t,r){var o=xe(e,n,(function(){return t()}));if(o==null)throw new Error(r);return o}function u_(e,n){var t=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+e.TEXTURE0;if(r<e.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function ls(e,n){return n===void 0&&(n=2),ye(e.slice(0,e.length-n))}function fs(e){if(e.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function zu(e){var n=[1,1,1];return e.length===0||e.length===1&&e[0]===1||(n=[ls(e)].concat(fs(e))),n}function c_(e,n){var t;n===void 0&&(n=!1);var r=Q().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n&&(r*=2,(e=e.map((function(c,l){return l>=e.length-2?Em(e[l]):e[l]}))).length===1&&(e=[2,e[0]])),e.length!==2){var o=ao(e);e=o.newShape}var i=ye(e);if(e.length<=1&&i<=r)return[1,i];if(e.length===2&&e[0]<=r&&e[1]<=r)return e;if(e.length===3&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(e.length===3&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(e.length===4&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(e.length===4&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(n){var a=ls(e),s=2,u=2;return e.length&&(s=(t=fs(e))[0],u=t[1]),Bc(i=a*(s/2)*(u/2)).map((function(c){return 2*c}))}return Bc(i)}function Ea(e){return e%2==0}function Sa(e,n){if(wt(e=e.slice(-2),n=n.slice(-2))||!e.length||!n.length||e[0]===0||e[1]===0||n[0]===0||n[1]===0)return!0;if(e.length!==n.length){var t=e.slice(-1)[0],r=n.slice(-1)[0];if(t===r||Ea(t)&&Ea(r)&&(e[0]===1||n[0]===1))return!0}return e[1]===n[1]&&Ea(e[0])&&Ea(n[0])}function l_(e){if(Lu==null){var n=Zn(e);Lu=n.getParameter(n.MAX_TEXTURE_SIZE)}return Lu}function f_(e){if(Wu==null){var n=Zn(e);Wu=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Wu)}function d_(e){if(e===0)return 0;var n=Zn(e);return bn(n,"EXT_disjoint_timer_query_webgl2")&&e===2?2:bn(n,"EXT_disjoint_timer_query")?1:0}function bn(e,n){return e.getExtension(n)!=null}function sh(e){try{if(Zn(e)!=null)return!0}catch{return!1}return!1}function h_(e){if(e===0)return!1;var n=Zn(e);if(e===1){if(!bn(n,"OES_texture_float"))return!1}else if(!bn(n,"EXT_color_buffer_float"))return!1;return Hc(n)}function p_(e){if(e===0)return!1;var n=Zn(e);if(e!==1){if(bn(n,"EXT_color_buffer_float"))return Hc(n);if(bn(n,"EXT_color_buffer_half_float")){var t=n.getExtension("EXT_color_buffer_half_float");return(function(r,o){var i=Ol(r,o),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,i.internalFormatHalfFloat,1,1,0,i.textureFormatFloat,i.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u})(n,t)}return!1}return!!bn(n,"OES_texture_float")&&!!bn(n,"WEBGL_color_buffer_float")&&Hc(n)}function Hc(e){var n=Ol(e),t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(t),e.deleteFramebuffer(r),o}function v_(e){return e===2&&Zn(e).fenceSync!=null}var ke=Q();function Fm(e){Q().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function ve(e,n){return W.tidy(e,n)}function Yt(e){Dm(e).forEach((function(n){return n.dispose()}))}function m_(e){return W.keep(e)}function ds(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Q().getBool("IS_TEST")||console.warn.apply(console,e)}function Kr(e,n){var t=e;if(Kn(e))return n==="string"?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(t)||Kn(t)&&n!=="string";)r.push(t.length),t=t[0];return Array.isArray(e)&&Q().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function o(i,a,s){if(s=s||[],!Array.isArray(i)&&!Kn(i))return void T(a.length===0,(function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"}));T(a.length>0,(function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"})),T(i.length===a[0],(function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+i.length+" elements"}));for(var u=a.slice(1),c=0;c<i.length;++c)o(i[c],u,s.concat(c))})(e,r,[]),r}function uh(e,n,t,r){if(e!=null&&(e!=="numeric"&&e!==n||e==="numeric"&&n==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+e+" tensor, but got "+n+" tensor")}function A(e,n,t,r){if(r===void 0&&(r="numeric"),e instanceof Je)return uh(r,e.dtype,n,t),e;var o=sa(e);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),uh(r,o,n,t),e==null||!Kn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string"){var i=e==null?"null":e.constructor.name;throw new Error("Argument '"+n+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=Kr(e,o);Kn(e)||Array.isArray(e)||(e=[e]);var s=o!=="string"?Rm(e,o,Q().getBool("DEBUG")):fi(e,[],!0);return W.makeTensor(s,a,o)}function hs(e,n,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+n+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(o,i){return A(o,n+"["+i+"]",t)}),r)}function Pm(e,n){for(var t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0}function g_(e,n,t){for(var r=e.length+n.length,o=[],i=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?o.push(e[i++]):o.push(n[a++]);return o}function Tt(e,n){for(var t=[],r=e.length,o=0;o<r;o++)n.indexOf(o)===-1&&t.push(e[o]);return[t,n.map((function(i){return e[i]}))]}function Jt(e,n){return g_(e,n.map((function(t){return 1})),n)}function tn(e,n,t){T(Pm(n,t),(function(){return e+" supports only inner-most axes for now. Got axes "+n+" and rank-"+t+" input."}))}function er(e,n){if(Pm(e,n))return null;for(var t=[],r=0;r<n;++r)e.indexOf(r)===-1&&t.push(r);return e.forEach((function(o){return t.push(o)})),t}function Bl(e){return e.map((function(n,t){return[t,n]})).sort((function(n,t){return n[1]-t[1]})).map((function(n){return n[0]}))}function tr(e,n){for(var t=[],r=n-e;r<n;++r)t.push(r);return t}function y_(e,n){var t=e[0].length;e.forEach((function(o,i){T(o.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same as the rank of the rest ("+t+")"}))})),T(n>=0&&n<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=e[0];e.forEach((function(o,i){for(var a=0;a<t;a++)T(a===n||o[a]===r[a],(function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+o+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function hi(e,n){for(var t=e[0].slice(),r=1;r<e.length;r++)t[n]+=e[r][n];return t}function B(e){var n=Object.keys(e);if(n.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+n.length+" keys.");var t=n[0],r=e[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var o=function(){for(var i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];W.startScope(t);try{var s=r.apply(void 0,i);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),W.endScope(s),s}catch(u){throw W.endScope(null),u}};return Object.defineProperty(o,"name",{value:t,configurable:!0}),o}ke.registerFlag("HAS_WEBGL",(function(){return ke.getNumber("WEBGL_VERSION")>0})),ke.registerFlag("WEBGL_VERSION",(function(){return sh(2)?2:sh(1)?1:0})),ke.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return ke.get("WEBGL_VERSION")===2})),ke.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),ke.registerFlag("WEBGL_PACK",(function(){return ke.getBool("HAS_WEBGL")})),ke.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_CLIP",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_PACK_REDUCE",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_CONV_IM2COL",(function(){return ke.getBool("WEBGL_PACK")})),ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return l_(ke.getNumber("WEBGL_VERSION"))})),ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return f_(ke.getNumber("WEBGL_VERSION"))})),ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=ke.getNumber("WEBGL_VERSION");return e===0?0:d_(e)})),ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return h_(ke.getNumber("WEBGL_VERSION"))})),ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!ke.getBool("WEBGL_FORCE_F16_TEXTURES")&&ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return p_(ke.getNumber("WEBGL_VERSION"))})),ke.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return v_(ke.getNumber("WEBGL_VERSION"))})),ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),Tm=Fm;var St=B({complex_:function(e,n){var t=A(e,"real","complex"),r=A(n,"imag","complex");return He(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),W.runKernelFunc((function(o){return o.complex(t,r)}),{$real:t,$imag:r})}}),yn=B({real_:function(e){var n=A(e,"input","real");return W.runKernelFunc((function(t){return t.real(n)}),{$input:n})}}),qn=B({imag_:function(e){var n=A(e,"input","imag");return W.runKernelFunc((function(t){return t.imag(n)}),{$input:n})}});function kt(e,n,t){return Xr(e,n,Kr(e,t),t)}function Xr(e,n,t,r){if(r==null&&(r=sa(e)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Kn(e)&&!Array.isArray(e)&&typeof e!="number"&&typeof e!="boolean"&&typeof e!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Im(n);var o=ye(n),i=ye(t);T(o===i,(function(){return"Based on the provided shape, ["+n+"], the tensor should have "+o+" values but has "+i}));for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==ye(n.slice(a));T(t[a]===n[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+n+"). "}))}}return Kn(e)||Array.isArray(e)||(e=[e]),n=n||t,e=r!=="string"?Rm(e,r,Q().getBool("DEBUG")):fi(e,[],!0),W.makeTensor(e,n,r)}function de(e,n){if((Kn(e)&&n!=="string"||Array.isArray(e))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Kn(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xr(e,[],[],n)}function st(e,n){gi(e);var t=Kr(e,n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xr(e,null,t,n)}function Ur(e,n,t){if(gi(e),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Kr(e,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xr(e,n,r,t)}function Ll(e,n,t){if(gi(e),n!=null&&n.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Kr(e,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Xr(e,n,r,t)}function jt(e,n,t){if(gi(e),n!=null&&n.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Kr(e,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Xr(e,n,r,t)}function b_(e,n,t){if(gi(e),n!=null&&n.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Kr(e,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Xr(e,n,r,t)}function x_(e,n,t){if(gi(e),n!=null&&n.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Kr(e,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Xr(e,n=n||r,r,t)}function w_(e,n,t,r){return n===void 0&&(n=!0),W.makeVariable(e,n,t,r)}function yi(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=yi(e,"float32"),r=Ye(e,"float32");return St(t,r)}var o=km(ye(e),n);return W.makeTensor(o,e,n)}function Ye(e,n){if(n===void 0&&(n="float32"),n==="complex64"){var t=Ye(e,"float32"),r=Ye(e,"float32");return St(t,r)}var o=ua(ye(e),n);return W.makeTensor(o,e,n)}function Yn(e,n,t){return W.runKernelFunc((function(r){return r.fill(e,n,t)}),{})}function __(e,n,t){if(t<=0)throw new Error("The number of values should be positive.");return W.runKernelFunc((function(r){return r.linspace(e,n,t)}),{})}function ps(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(e===n||e<n&&t<0||n<e&&t>1)return Ye([0],r);var o=ua(Math.abs(Math.ceil((n-e)/t)),r);n<e&&t===1&&(t=-1),o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+t;return st(o,r)}var Mm=B({onesLike_:function(e){var n=A(e,"x","onesLike");if(n.dtype==="complex64"){var t=Mm(yn(n)),r=Le(qn(n));return St(t,r)}return W.runKernelFunc((function(o){return o.onesLike(n)}),{$x:n},(function(o,i){return{$x:function(){return Le(o)}}}))}}),Le=B({zerosLike_:function(e){var n=A(e,"x","zerosLike");return W.runKernelFunc((function(t){return t.zerosLike(n)}),{$x:n},(function(t,r){return{$x:function(){return Le(t)}}}))}}),dt=B({concat_:function(e,n){n===void 0&&(n=0),T(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=hs(e,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")})),n=gt(n,t[0].shape)[0];var r=hi(t.map((function(s){return s.shape})),n);if(ye(r)===0)return kt([],r);if((t=t.filter((function(s){return s.size>0}))).length===1)return t[0];var o=t.map((function(s){return s.shape}));y_(o,n);var i=t,a={axis:n};return W.runKernelFunc((function(s){return s.concat(t,n)}),i,(function(s){var u=o.map((function(c){return c[n]}));return Wl(s,u,n).map((function(c){return function(){return c}}))}),"Concat",a)}}),C_=B({concat1d_:function(e){return dt(e,0)}}),E_=B({concat2d_:function(e,n){return dt(e,n)}}),S_=B({concat3d_:function(e,n){return dt(e,n)}}),R_=B({concat4d_:function(e,n){return dt(e,n)}}),Wl=B({split_:function(e,n,t){t===void 0&&(t=0);var r,o=A(e,"x","split");return t=gt(t,o.shape)[0],typeof n=="number"?(T(o.shape[t]%n==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(n).fill(o.shape[t]/n)):(T(o.shape[t]===n.reduce((function(i,a){return i+a})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=n),W.runKernelFunc((function(i){return i.split(o,r,t)}),{$x:o},(function(i){return{$x:function(){return dt(i,t)}}}))}});function Co(e,n){return e(n={exports:{}},n.exports),n.exports}var k_=Co((function(e){(function(n,t,r){function o(s){var u,c=this,l=(u=4022871197,function(f){f=f.toString();for(var d=0;d<f.length;d++){var h=.02519603282416938*(u+=f.charCodeAt(d));h-=u=h>>>0,u=(h*=u)>>>0,u+=4294967296*(h-=u)}return 23283064365386963e-26*(u>>>0)});c.next=function(){var f=2091639*c.s0+23283064365386963e-26*c.c;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=0|f)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(s),c.s0<0&&(c.s0+=1),c.s1-=l(s),c.s1<0&&(c.s1+=1),c.s2-=l(s),c.s2<0&&(c.s2+=1),l=null}function i(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var c=new o(s),l=u&&u.state,f=c.next;return f.int32=function(){return 4294967296*c.next()|0},f.double=function(){return f()+11102230246251565e-32*(2097152*f()|0)},f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.alea=a})(0,e)})),I_=Co((function(e){(function(n,t,r){function o(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor128=a})(0,e)})),A_=Co((function(e){(function(n,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^f^f<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=0|c.charCodeAt(l),l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorwow=a})(0,e)})),T_=Co((function(e){(function(n,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.x,d=u.i;return c=f[d],l=(c^=c>>>7)^c<<24,l^=(c=f[d+1&7])^c>>>10,l^=(c=f[d+3&7])^c>>>3,l^=(c=f[d+4&7])^c<<7,c=f[d+7&7],l^=(c^=c<<13)^c<<9,f[d]=l,u.i=d+1&7,l},(function(c,l){var f,d=[];if(l===(0|l))d[0]=l;else for(l=""+l,f=0;f<l.length;++f)d[7&f]=d[7&f]<<15^l.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?d[7]=-1:d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()})(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xorshift7=a})(0,e)})),D_=Co((function(e){(function(n,t,r){function o(s){var u=this;u.next=function(){var c,l,f=u.w,d=u.X,h=u.i;return u.w=f=f+1640531527|0,l=d[h+34&127],c=d[h=h+1&127],l^=l<<13,c^=c<<17,l^=l>>>15,c^=c>>>12,l=d[h]=l^c,u.i=h,l+(f^f>>>16)|0},(function(c,l){var f,d,h,p,v,m=[],g=128;for(l===(0|l)?(d=l,l=null):(l+="\0",d=0,g=Math.max(g,l.length)),h=0,p=-32;p<g;++p)l&&(d^=l.charCodeAt((p+32)%l.length)),p===0&&(v=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,p>=0&&(v=v+1640531527|0,h=(f=m[127&p]^=d+v)==0?h+1:0);for(h>=128&&(m[127&(l&&l.length||0)]=-1),h=127,p=512;p>0;--p)d=m[h+34&127],f=m[h=h+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,m[h]=d^f;c.w=v,c.X=m,c.i=h})(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.xor4096=a})(0,e)})),N_=Co((function(e){(function(n,t,r){function o(s){var u=this,c="";u.next=function(){var f=u.b,d=u.c,h=u.d,p=u.a;return f=f<<25^f>>>7^d,d=d-h|0,h=h<<24^h>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^d,u.c=d=d-h|0,u.d=h<<16^d>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):c+=s;for(var l=0;l<c.length+20;l++)u.b^=0|c.charCodeAt(l),u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var c=new o(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var d=((c.next()>>>11)+(c.next()>>>0)/4294967296)/2097152;while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=a:this.tychei=a})(0,e)})),oo=Co((function(e){(function(n,t){var r,o=this,i=256,a=6,s="random",u=t.pow(i,a),c=t.pow(2,52),l=2*c,f=i-1;function d(g,b,x){var y=[],w=v((function R(E,C){var I,k=[],M=typeof E;if(C&&M=="object")for(I in E)try{k.push(R(E[I],C-1))}catch{}return k.length?k:M=="string"?E:E+"\0"})((b=b==1?{entropy:!0}:b||{}).entropy?[g,m(n)]:g??(function(){try{var R;return r&&(R=r.randomBytes)?R=R(i):(R=new Uint8Array(i),(o.crypto||o.msCrypto).getRandomValues(R)),m(R)}catch{var E=o.navigator,C=E&&E.plugins;return[+new Date,o,C,o.screen,m(n)]}})(),3),y),_=new h(y),S=function(){for(var R=_.g(a),E=u,C=0;R<c;)R=(R+C)*i,E*=i,C=_.g(1);for(;R>=l;)R/=2,E/=2,C>>>=1;return(R+C)/E};return S.int32=function(){return 0|_.g(4)},S.quick=function(){return _.g(4)/4294967296},S.double=S,v(m(_.S),n),(b.pass||x||function(R,E,C,I){return I&&(I.S&&p(I,_),R.state=function(){return p(_,{})}),C?(t[s]=R,E):R})(S,w,"global"in b?b.global:this==t,b.state)}function h(g){var b,x=g.length,y=this,w=0,_=y.i=y.j=0,S=y.S=[];for(x||(g=[x++]);w<i;)S[w]=w++;for(w=0;w<i;w++)S[w]=S[_=f&_+g[w%x]+(b=S[w])],S[_]=b;(y.g=function(R){for(var E,C=0,I=y.i,k=y.j,M=y.S;R--;)E=M[I=f&I+1],C=C*i+M[f&(M[I]=M[k=f&k+E])+(M[k]=E)];return y.i=I,y.j=k,C})(i)}function p(g,b){return b.i=g.i,b.j=g.j,b.S=g.S.slice(),b}function v(g,b){for(var x,y=g+"",w=0;w<y.length;)b[f&w]=f&(x^=19*b[f&w])+y.charCodeAt(w++);return m(b)}function m(g){return String.fromCharCode.apply(0,g)}if(t["seed"+s]=d,v(t.random(),n),e.exports){e.exports=d;try{r=require("crypto")}catch{}}})([],Math)}));oo.alea=k_,oo.xor128=I_,oo.xorwow=A_,oo.xorshift7=T_,oo.xor4096=D_,oo.tychei=N_;var Zs=oo.alea,Vl=(function(){function e(n,t,r,o,i){this.mean=n,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=i||Math.random();this.random=Zs(a.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var n=this.nextVal;return this.nextVal=NaN,n}for(var t,r,o=!1;!o;){var i=void 0,a=void 0,s=void 0;do s=(i=2*this.random()-1)*i+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(o=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},e.prototype.convertValue=function(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)},e.prototype.isValidTruncated=function(n){return n<=this.upper&&n>=this.lower},e})(),F_=(function(){function e(n,t,r,o){this.alpha=n,this.beta=1/t,this.dtype=r;var i=o||Math.random();this.randu=Zs(i.toString()),this.randn=new Vl(0,1,r,!1,this.randu()),this.d=n<1?n+2/3:n-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var n,t,r,o,i,a;;){do o=this.randn.nextValue(),a=1+this.c*o;while(a<=0);if(a*=a*a,t=1-.331*(n=o*o)*n,r=.5*n+this.d*(1-a+Math.log(a)),(i=this.randu())<t||Math.log(i)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},e.prototype.convertValue=function(n){return this.dtype==="float32"?n:Math.round(n)},e})(),P_=(function(){function e(n,t,r,o){var i=this;if(n===void 0&&(n=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=n,this.range=t-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+n+" - "+t+" <= 1 and dtype is not float");this.random=Zs(o)}return e.prototype.convertValue=function(n){return this.canReturnFloat()?n:Math.round(n)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e})();function Te(e,n,t){return n===void 0&&(n="float32"),n=n||"float32",Im(e),new Qi(e,n,t)}function M_(e,n){n===void 0&&(n=!1),console.log(e.toString(n))}var Om=B({batchToSpaceND_:function(e,n,t){var r=A(e,"x","batchToSpaceND"),o=n.reduce((function(i,a){return i*a}));return T(r.rank>=1+n.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+n.length})),T(t.length===n.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+n.length})),T(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+n.join(" * ")+" === "+o})),W.runKernelFunc((function(i){return i.batchToSpaceND(r,n,t)}),{$x:r},(function(i){return{$x:function(){return i.spaceToBatchND(n,t)}}}))}}),O_=B({broadcastTo_:function(e,n){var t=A(e,"broadcastTo","x"),r=t.shape;if(n.some((function(u){return!(u>0)||u%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+n+"].");if(n.length<t.rank)throw new Error("broadcastTo(): shape.length="+n.length+" < input.rank="+t.rank+".");if(n.length>t.rank){for(var o=t.shape.slice();o.length<n.length;)o.unshift(1);t=t.reshape(o)}for(var i=Array.from(n),a=n.length-1;a>=0;a--)if(t.shape[a]===n[a])i[a]=1;else if(t.shape[a]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+n+"].");var s=i.map((function(u,c){return u>1?c:-1})).filter((function(u){return u>=0}));return s.length===0?t.clone():W.runKernelFunc((function(u){return u.tile(t,i)}),{input:t},(function(u){return{input:function(){return u.sum(s,!0)}}}))}}),B_=B({cast_:function(e,n){var t=A(e,"x","cast");if(!A1(n))throw new Error("Failed to cast to unknown dtype "+n);if(n==="string"&&t.dtype!=="string"||n!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:n};return W.runKernelFunc((function(o){return o.cast(t,n)}),{x:t},(function(o){return{x:function(){return o.clone()}}}),"Cast",r)}}),L_=B({clone_:function(e){var n=A(e,"x","clone",null);return W.runKernelFunc((function(){return W.makeTensorFromDataId(n.dataId,n.shape,n.dtype)}),{$x:n},(function(t){return{$x:function(){return t.toFloat()}}}))}}),W_=B({cumsum_:function(e,n,t,r){n===void 0&&(n=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var o=A(e,"x","cumsum"),i=er([n|=0],o.rank),a=o;i!=null&&(a=o.transpose(i));var s=tr(1,o.rank)[0],u=W.runKernelFunc((function(c){return c.cumsum(a,s,t,r)}),{permutedX:a},(function(c){return{permutedX:function(){return c.cumsum(n,t,!r)}}}));return i!=null&&(u=u.transpose(i)),u}}),V_=B({depthToSpace_:function(e,n,t){t===void 0&&(t="NHWC");var r=A(e,"x","depthToSpace"),o=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return T(o*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+n+`  for depthToSpace with input shape
      `+r.shape})),T(i*n>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+n+` for depthToSpace with input shape
          `+r.shape})),T(a%(n*n)==0,(function(){return"Dimension size must be evenly divisible by "+n*n+" but is "+a+" for depthToSpace with input shape "+r.shape})),W.runKernelFunc((function(s){return s.depthToSpace(r,n,t)}),{$x:r})}}),gn=B({expandDims_:function(e,n){n===void 0&&(n=0);var t=A(e,"x","expandDims",null);T(n<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return n<0&&(T(-(t.rank+1)<=n,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),n=t.rank+n+1),r.splice(n,0,1),Rn(t,r)}}),Bm=B({eye_:function(e,n,t,r){r===void 0&&(r="float32"),n==null&&(n=e);for(var o=Te([e,n],r),i=e<=n?e:n,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(e,n);if(t==null)return s;if(t.length===1)return Zo(gn(s,0),[t[0],1,1]);if(t.length===2)return Zo(gn(gn(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Zo(gn(gn(gn(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),U_=B({multinomial_:function(e,n,t,r){r===void 0&&(r=!1);var o=A(e,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?o.as2D(1,-1):o,u=W.runKernelFunc((function(c){return c.multinomial(s,r,n,t)}),{logits2D:s});return a===1?u.as1D():u}}),Gc=B({oneHot_:function(e,n,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),n<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+n);var o=A(e,"indices","oneHot","int32"),i=o.shape.concat([n]);return o=o.flatten(),W.runKernelFunc((function(a){return a.oneHot(o,n,t,r)}),{$indices:o},(function(a){return{$indices:function(){return Ye(o.shape,"float32")}}})).reshape(i)}}),Eo=B({pad_:function(e,n,t){t===void 0&&(t=0);var r=A(e,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:n,constantValue:t};return W.runKernelFunc((function(i){return i.pad(r,n,t)}),{x:r},(function(i){var a=n.map((function(s){return s[0]}));return{x:function(){return i.slice(a,r.shape)}}}),"PadV2",o)}}),z_=B({pad1d_:function(e,n,t){return t===void 0&&(t=0),T(n.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),Eo(e,[n],t)}}),q_=B({pad2d_:function(e,n,t){return t===void 0&&(t=0),T(n.length===2&&n[0].length===2&&n[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Eo(e,n,t)}}),H_=B({pad3d_:function(e,n,t){return t===void 0&&(t=0),T(n.length===3&&n[0].length===2&&n[1].length===2&&n[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Eo(e,n,t)}}),G_=B({pad4d_:function(e,n,t){return t===void 0&&(t=0),T(n.length===4&&n[0].length===2&&n[1].length===2&&n[2].length===2&&n[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Eo(e,n,t)}}),j_=B({rand_:function(e,n,t){var r=ye(e),o=null;if(t==null||t==="float32")o=new Float32Array(r);else if(t==="int32")o=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=n();return W.makeTensor(o,e,t)}}),$_=B({randomNormal_:function(e,n,t,r,o){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Vl(n,t,r,!1,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),K_=B({randomGamma_:function(e,n,t,r,o){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var i=new F_(n,t,r,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Lm=B({randomUniform_:function(e,n,t,r,o){n===void 0&&(n=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var i=Te(e,r),a=new P_(n,t,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Rn=B({reshape_:function(e,n){var t=A(e,"x","reshape",null);n=k1(n,t.size),T(t.size===ye(n),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:n};return W.runKernelFunc((function(o){return o.reshape(t,n)}),{x:t},(function(o){return{x:function(){return o.reshape(t.shape)}}}),"Reshape",r)}}),Wm=B({spaceToBatchND_:function(e,n,t){var r=A(e,"x","spaceToBatchND");return T(r.rank>=1+n.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+n.length})),T(t.length===n.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+n.length})),T(r.shape.reduce((function(o,i,a){return a>0&&a<=n.length?o&&(i+t[a-1][0]+t[a-1][1])%n[a-1]==0:o}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+n.toString()})),W.runKernelFunc((function(o){return o.spaceToBatchND(r,n,t)}),{$x:r},(function(o){return{$x:function(){return o.batchToSpaceND(n,t)}}}))}}),Vm=B({squeeze_:function(e,n){var t=A(e,"x","squeeze");return Rn(t,ao(t.shape,n).newShape)}}),ln=B({stack_:function(e,n){n===void 0&&(n=0);var t=hs(e,"tensors","stack");if(T(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(n);var r=t[0].rank,o=t[0].shape,i=t[0].dtype;T(n<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(s){He(o,s.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(s){T(i===s.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var a=t.map((function(s){return s.expandDims(n)}));return dt(a,n)}}),Zo=B({tile_:function(e,n){var t=A(e,"x","tile",null);T(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+n+"."}));var r=[t],o={reps:n};return W.runKernelFunc((function(i,a){var s=i.tile(t,n);return a([t]),s}),{x:t},(function(i,a){var s=a[0];return{x:function(){var u=Le(s);if(s.rank===1)for(var c=0;c<n[0];++c)u=u.add(i.slice([c*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(c=0;c<n[0];++c)for(var l=0;l<n[1];++l)u=u.add(i.slice([c*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(var f=0;f<n[2];++f)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],f*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(c=0;c<n[0];++c)for(l=0;l<n[1];++l)for(f=0;f<n[2];++f)for(var d=0;d<n[3];++d)u=u.add(i.slice([c*s.shape[0],l*s.shape[1],f*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}}),"Tile",o,r)}}),X_=B({truncatedNormal_:function(e,n,t,r,o){if(n===void 0&&(n=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var i=new Vl(n,t,r,!0,o),a=Te(e,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),ht=B({unstack_:function(e,n){n===void 0&&(n=0),n=n||0;var t=A(e,"x","unstack");T(n>=-t.shape.length&&n<t.shape.length,(function(){return"Axis = "+n+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),n<0&&(n+=t.shape.length);var r={axis:n};return W.runKernelFunc((function(o){return o.unstack(t,n)}),{x:t},(function(o){return{x:function(){return ln(o,n)}}}),"Unpack",r)}}),Y_=function(e,n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f;return ge(this,(function(d){switch(d.label){case 0:return t=A(e,"x","setdiff1d"),r=A(n,"y","setdiff1d"),T(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),T(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),T(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Qi([s],t.dtype),c=new Qi([s],"int32"),l=0,f=0;l<o.length;l++)a.has(o[l])||(u.values[f]=o[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}}))}))};function vs(e,n,t,r){r===void 0&&(r=!0);var o=[];if(r)(o=o.concat(n.slice(0))).push(e[0]/t),o=o.concat(e.slice(1));else{o=o.concat(e[0]);for(var i=n.length,a=0;a<i;++a)o=o.concat([e[a+1]/n[a],n[a]]);o=o.concat(e.slice(i+1))}return o}function ms(e,n,t){t===void 0&&(t=!0);var r=[];if(t){r.push(n);for(var o=n+1;o<e;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<e;++o)o>=2*n+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function gs(e,n,t,r){r===void 0&&(r=!0);var o=[];r?o.push(e[0]/t):o.push(e[0]*t);for(var i=1;i<e.length;++i)i<=n.length?r?o.push(n[i-1]*e[i]):o.push(e[i]/n[i-1]):o.push(e[i]);return o}function Um(e,n){for(var t=[0],r=0;r<n;++r)t.push(e[r][0]);return t}function zm(e,n,t){for(var r=e.slice(0,1),o=0;o<t;++o)r.push(e[o+1]-n[o][0]-n[o][1]);return r}function qm(e,n){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(n.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+n.dtype+".");if(n.shape[n.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+n.shape[n.rank-1]+" vs. "+e.rank);if(e.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var t=n.shape,r=t[t.length-1],o=1,i=0;i<t.length-1;++i)o*=t[i];var a=e.shape,s=t.slice();s.pop();var u=1;for(i=r;i<e.rank;++i)u*=a[i],s.push(a[i]);var c=Xn(e.shape).map((function(l){return l/u})).concat([1]).slice(0,r);return[s,o,u,c]}var Hm=30;function qu(e){return e<=Hm?e:Wc(e,Math.floor(Math.sqrt(e)))}function Q_(e,n,t){var r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+n.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+o+".";if(t.rank<o)throw new Error(i+" update.rank < "+o+". ");if(e.length<r+(t.rank-o))throw new Error(i+" Output shape length < "+(r+(t.rank-o)));if(t.rank!==o+e.length-r)throw new Error(i+" update.rank != "+(o+e.length-r));for(var a=0;a<o;++a)if(t.shape[a]!==n.shape[a])throw new Error(i+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+n.shape[a]+").");for(a=0;a<t.rank-o;++a)if(t.shape[a+o]!==e[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+t.shape[a+o]+") != shape["+(a+o)+"] ("+e[a+o]+")")}function J_(e,n,t){if(n.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if(n.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+n.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(n.size===0)throw new Error("Indices specified for empty output. indices shape: "+n.shape);if(e.size===0)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}Q_(t,n,e)}function ys(e,n,t){for(var r=n.shape.length,o=r>1?n.shape[r-1]:1,i=t.length,a=1,s=o;s<i;++s)a*=t[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:ye(n.shape)/u,sliceSize:a,strides:Xn(t.slice(0,o)).concat([1]),outputSize:ye(t)}}function Z_(e,n,t){T(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+n+" must match the rank of the array ("+e.rank+")."})),T(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+t+" must match the rank of the array ("+e.rank+")."}));for(var r=function(i){T(n[i]+t[i]<=e.shape[i],(function(){return"Error in slice"+e.rank+"D: begin["+i+"] + size["+i+"] ("+(n[i]+t[i])+") would overflow input.shape["+i+"] ("+e.shape[i]+")"}))},o=0;o<e.rank;++o)r(o)}function ch(e){for(var n=[],t=0;e>0;)1&e&&n.push(t),e/=2,t++;return n}function Ul(e,n,t){for(var r=[],o=0;o<e.length;o++)r[o]=Math.ceil((n[o]-e[o])/t[o]);return r}function e2(e,n,t,r,o){var i=n[o],a=t[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=Oc(0,i,s-1)}function t2(e,n,t,r,o){var i=n[o],a=t[o]||1;(e&1<<o||i==null)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),i=a>0?Oc(0,i,s):Oc(-1,i,s-1)}function Gm(e,n,t){for(var r=t.length,o=0;o<t.length;o++)if(t[o]>1){r=o;break}for(o=r+1;o<t.length;o++)if(n[o]>0||t[o]!==e[o])return!1;return!0}function jm(e,n){for(var t=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)t+=e[r]*n[r];return t}function n2(e,n){T(Lc(e),(function(){return"The f passed in variableGrads(f) must be a function"})),T(n==null||Array.isArray(n)&&n.every((function(l){return l instanceof di})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=n!=null;if(!t)for(var r in n=[],W.registeredVariables)n.push(W.registeredVariables[r]);var o=t?n.filter((function(l){return!l.trainable})):null,i=n.length;T((n=n.filter((function(l){return l.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."}));var a=W.gradients(e,n,null,!0),s=a.value,u=a.grads;T(u.some((function(l){return l!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),T(s.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return n.forEach((function(l,f){u[f]!=null&&(c[l.name]=u[f])})),o?.forEach((function(l){return c[l.name]=null})),{value:s,grads:c}}function eu(e){return W.customGrad(e)}var wr=B({softmax_:function(e,n){n===void 0&&(n=-1);var t=A(e,"logits","softmax","float32");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+n);return W.runKernelFunc((function(r,o){var i=r.softmax(t,n);return o([i]),i}),{logits:t},(function(r,o){var i=o[0],a=r.mul(i);return{logits:function(){return a.sub(a.sum([n],!0).mul(i))}}}),"Softmax",{dim:n},[],[!0])}}),r2=B({logSoftmax_:function(e,n){n===void 0&&(n=-1);var t=A(e,"logits","logSoftmax");if(n===-1&&(n=t.rank-1),n!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+n);return eu((function(r,o){var i=r.max(n,!0),a=r.sub(i),s=a.toFloat().sub(a.exp().sum(n,!0).log());return o([s]),{value:s,gradFunc:function(u,c){var l=c[0].exp();return u.sub(u.sum(n,!0).mul(l))}}}))(t)}}),$m=(function(){function e(n,t){this.backend=n,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)},e.prototype.set=function(n,t){this.dataIdsCount++,this.data.set(n,t)},e.prototype.has=function(n){return this.data.has(n)},e.prototype.delete=function(n){return this.dataIdsCount--,this.data.delete(n)},e.prototype.numDataIds=function(){return this.dataIdsCount},e})(),Km=(function(){function e(){}return e.prototype.time=function(n){return j("time")},e.prototype.read=function(n){return j("read")},e.prototype.readSync=function(n){return j("readSync")},e.prototype.numDataIds=function(){return j("numDataIds")},e.prototype.disposeData=function(n){return j("disposeData")},e.prototype.write=function(n,t,r){return j("write")},e.prototype.move=function(n,t,r,o){return j("move")},e.prototype.memory=function(){return j("memory")},e.prototype.floatPrecision=function(){return j("floatPrecision")},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.batchMatMul=function(n,t,r,o){return j("batchMatMul")},e.prototype.fusedBatchMatMul=function(n){return n.a,n.b,n.transposeA,n.transposeB,n.bias,n.activation,n.preluActivationWeights,j("fusedBatchMatMul")},e.prototype.slice=function(n,t,r){return j("slice")},e.prototype.stridedSlice=function(n,t,r,o){return j("stridedSlice")},e.prototype.unstack=function(n,t){return j("unstack")},e.prototype.reverse=function(n,t){return j("reverse")},e.prototype.concat=function(n,t){return j("concat")},e.prototype.neg=function(n){return j("neg")},e.prototype.add=function(n,t){return j("add")},e.prototype.addN=function(n){return j("addN")},e.prototype.subtract=function(n,t){return j("subtract")},e.prototype.multiply=function(n,t){return j("multiply")},e.prototype.realDivide=function(n,t){return j("realDivide")},e.prototype.floorDiv=function(n,t){return j("floorDiv")},e.prototype.sum=function(n,t){return j("sum")},e.prototype.prod=function(n,t){return j("prod")},e.prototype.unsortedSegmentSum=function(n,t,r){return j("unsortedSegmentSum")},e.prototype.argMin=function(n,t){return j("argMin")},e.prototype.argMax=function(n,t){return j("argMax")},e.prototype.equal=function(n,t){return j("equal")},e.prototype.notEqual=function(n,t){return j("notEqual")},e.prototype.less=function(n,t){return j("less")},e.prototype.lessEqual=function(n,t){return j("lessEqual")},e.prototype.greater=function(n,t){return j("greater")},e.prototype.greaterEqual=function(n,t){return j("greaterEqual")},e.prototype.logicalNot=function(n){return j("logicalNot")},e.prototype.logicalAnd=function(n,t){return j("logicalAnd")},e.prototype.logicalOr=function(n,t){return j("logicalOr")},e.prototype.where=function(n){return j("where")},e.prototype.select=function(n,t,r){return j("select")},e.prototype.topk=function(n,t,r){return j("topk")},e.prototype.min=function(n,t){return j("min")},e.prototype.minimum=function(n,t){return j("minimum")},e.prototype.mod=function(n,t){return j("mod")},e.prototype.max=function(n,t){return j("max")},e.prototype.maximum=function(n,t){return j("maximum")},e.prototype.all=function(n,t){return j("all")},e.prototype.any=function(n,t){return j("any")},e.prototype.squaredDifference=function(n,t){return j("squaredDifference")},e.prototype.ceil=function(n){return j("ceil")},e.prototype.floor=function(n){return j("floor")},e.prototype.round=function(n){return j("round")},e.prototype.sign=function(n){return j("sign")},e.prototype.isNaN=function(n){return j("isNaN")},e.prototype.isInf=function(n){return j("isInf")},e.prototype.isFinite=function(n){return j("isFinite")},e.prototype.pow=function(n,t){return j("pow")},e.prototype.exp=function(n){return j("exp")},e.prototype.expm1=function(n){return j("expm1")},e.prototype.softmax=function(n,t){return j("softmax")},e.prototype.log=function(n){return j("log")},e.prototype.log1p=function(n){return j("log1p")},e.prototype.sqrt=function(n){return j("sqrt")},e.prototype.rsqrt=function(n){return j("rsqrt")},e.prototype.square=function(n){return j("square")},e.prototype.reciprocal=function(n){return j("reciprocal")},e.prototype.relu=function(n){return j("relu")},e.prototype.relu6=function(n){return j("relu6")},e.prototype.prelu=function(n,t){return j("prelu")},e.prototype.elu=function(n){return j("elu")},e.prototype.eluDer=function(n,t){return j("eluDer")},e.prototype.selu=function(n){return j("selu")},e.prototype.int=function(n){return j("int")},e.prototype.clip=function(n,t,r){return j("clip")},e.prototype.abs=function(n){return j("abs")},e.prototype.complexAbs=function(n){return j("complexAbs")},e.prototype.sigmoid=function(n){return j("sigmoid")},e.prototype.softplus=function(n){return j("softplus")},e.prototype.sin=function(n){return j("sin")},e.prototype.cos=function(n){return j("cos")},e.prototype.tan=function(n){return j("tan")},e.prototype.asin=function(n){return j("asin")},e.prototype.acos=function(n){return j("acos")},e.prototype.atan=function(n){return j("atan")},e.prototype.atan2=function(n,t){return j("atan2")},e.prototype.sinh=function(n){return j("sinh")},e.prototype.cosh=function(n){return j("cosh")},e.prototype.tanh=function(n){return j("tanh")},e.prototype.asinh=function(n){return j("asinh")},e.prototype.acosh=function(n){return j("acosh")},e.prototype.atanh=function(n){return j("atanh")},e.prototype.erf=function(n){return j("erf")},e.prototype.step=function(n,t){return j("step")},e.prototype.fusedConv2d=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,j("fusedConv2d")},e.prototype.conv2d=function(n,t,r){return j("conv2d")},e.prototype.conv2dDerInput=function(n,t,r){return j("conv2dDerInput")},e.prototype.conv2dDerFilter=function(n,t,r){return j("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(n){return n.input,n.filter,n.convInfo,n.bias,n.activation,n.preluActivationWeights,j("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(n,t,r){return j("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(n,t,r){return j("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(n,t,r){return j("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(n,t,r){return j("conv3d")},e.prototype.conv3dDerInput=function(n,t,r){return j("conv3dDerInput")},e.prototype.conv3dDerFilter=function(n,t,r){return j("conv3dDerFilter")},e.prototype.maxPool=function(n,t){return j("maxPool")},e.prototype.maxPoolBackprop=function(n,t,r,o){return j("maxPoolBackprop")},e.prototype.avgPool=function(n,t){return j("avgPool")},e.prototype.avgPoolBackprop=function(n,t,r){return j("avgPoolBackprop")},e.prototype.avgPool3d=function(n,t){return j("avgPool3d")},e.prototype.avgPool3dBackprop=function(n,t,r){return j("avgPool3dBackprop")},e.prototype.maxPool3d=function(n,t){return j("maxPool3d")},e.prototype.maxPool3dBackprop=function(n,t,r,o){return j("maxPool3dBackprop")},e.prototype.reshape=function(n,t){return j("reshape")},e.prototype.cast=function(n,t){return j("cast")},e.prototype.tile=function(n,t){return j("tile")},e.prototype.pad=function(n,t,r){return j("pad")},e.prototype.transpose=function(n,t){return j("transpose")},e.prototype.gather=function(n,t,r){return j("gather")},e.prototype.gatherND=function(n,t){return j("gatherND")},e.prototype.scatterND=function(n,t,r){return j("scatterND")},e.prototype.batchToSpaceND=function(n,t,r){return j("batchToSpaceND")},e.prototype.spaceToBatchND=function(n,t,r){return j("spaceToBatchND")},e.prototype.resizeBilinear=function(n,t,r,o){return j("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(n,t,r){return j("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(n,t,r,o){return j("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(n,t,r){return j("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(n,t,r,o,i,a){return j("batchNormalization")},e.prototype.localResponseNormalization4D=function(n,t,r,o,i){return j("localResponseNormalization4D")},e.prototype.LRNGrad=function(n,t,r,o,i,a,s){return j("LRNGrad")},e.prototype.multinomial=function(n,t,r,o){return j("multinomial")},e.prototype.oneHot=function(n,t,r,o){return j("oneHot")},e.prototype.cumsum=function(n,t,r,o){return j("cumsum")},e.prototype.nonMaxSuppression=function(n,t,r,o,i){return j("nonMaxSuppression")},e.prototype.fft=function(n){return j("fft")},e.prototype.ifft=function(n){return j("ifft")},e.prototype.complex=function(n,t){return j("complex")},e.prototype.real=function(n){return j("real")},e.prototype.imag=function(n){return j("imag")},e.prototype.cropAndResize=function(n,t,r,o,i,a){return j("cropAndResize")},e.prototype.depthToSpace=function(n,t,r){return j("depthToSpace")},e.prototype.split=function(n,t,r){return j("split")},e.prototype.sparseToDense=function(n,t,r,o){return j("sparseToDense")},e.prototype.diag=function(n){return j("diag")},e.prototype.fill=function(n,t,r){return j("fill")},e.prototype.onesLike=function(n){return j("onesLike")},e.prototype.zerosLike=function(n){return j("zerosLike")},e.prototype.linspace=function(n,t,r){return j("linspace")},e.prototype.dispose=function(){return j("dispose")},e})();function j(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Lr(e,n){for(var t=e.length,r=[],o=0;o<t;o++){var i=t-1-o,a=e[i]||1;(n[n.length-1-o]||1)>1&&a===1&&r.unshift(i)}return r}function vt(e,n){for(var t=[],r=0;r<n.length;r++){var o=e[e.length-r-1],i=n.length-r-1,a=n[i];(o==null||o===1&&a>1)&&t.unshift(i)}return t}function Be(e,n){for(var t=[],r=Math.max(e.length,n.length),o=0;o<r;o++){var i=e[e.length-o-1];i==null&&(i=1);var a=n[n.length-o-1];if(a==null&&(a=1),i===1)t.unshift(a);else if(a===1)t.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+n+".");t.unshift(i)}}return t}function Zi(e,n,t,r,o,i,a){a===void 0&&(a="channelsLast");var s,u=ws(n),c=u[0],l=u[1];if(a==="channelsLast")s=[c,l,e[3],e[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[c,l,e[1],e[1]]}return So(e,s,t,r,o,i,!1,a)}function bs(e,n,t,r,o,i,a){a===void 0&&(a="NDHWC");var s,u,c=jc(n),l=c[0],f=c[1],d=c[2];if(a==="NDHWC")u="channelsLast",s=[l,f,d,e[4],e[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,f,d,e[1],e[1]]}return xs(e,s,t,r,o,!1,u,i)}function So(e,n,t,r,o,i,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3];if(s==="channelsLast")c=e[0],l=e[1],f=e[2],d=e[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);c=e[0],d=e[1],l=e[2],f=e[3]}var h,p=n[0],v=n[1],m=n[3],g=ws(t),b=g[0],x=g[1],y=ws(r),w=y[0],_=y[1],S=ei(p,w),R=ei(v,_),E=(function(P,L,q,V,F,H,$,G){var O,re,he;if(typeof P=="number"){O={top:P,bottom:P,left:P,right:P,type:P===0?"VALID":"NUMBER"};var be=(function(pe,D,N,U,X){U==null&&(U=Xm(pe,D,N));var Y=pe[0],J=pe[1],ce=Ui((Y-D+2*U)/N+1,X);T(it(ce),(function(){return"The output # of rows ("+ce+") must be an integer. Change the stride and/or zero pad parameters"}));var ie=Ui((J-D+2*U)/N+1,X);return T(it(ie),(function(){return"The output # of columns ("+ie+") must be an integer. Change the stride and/or zero pad parameters"})),[ce,ie]})([L,q],H,V,P,G);re=be[0],he=be[1]}else if(P==="same"){re=Math.ceil(L/V),he=Math.ceil(q/F);var ae=Math.max(0,(re-1)*V+H-L),z=Math.max(0,(he-1)*F+$-q),Z=Math.floor(ae/2),ee=ae-Z,le=Math.floor(z/2);O={top:Z,bottom:ee,left:le,right:z-le,type:"SAME"}}else{if(P!=="valid")throw Error("Unknown padding parameter: "+P);O={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((L-H+1)/V),he=Math.ceil((q-$+1)/F)}return{padInfo:O,outHeight:re,outWidth:he}})(o,l,f,b,x,S,R,i),C=E.padInfo,I=E.outHeight,k=E.outWidth,M=a?m*d:m;return s==="channelsFirst"?h=[c,M,I,k]:s==="channelsLast"&&(h=[c,I,k,M]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:f,inChannels:d,outHeight:I,outWidth:k,outChannels:M,padInfo:C,strideHeight:b,strideWidth:x,filterHeight:p,filterWidth:v,effectiveFilterHeight:S,effectiveFilterWidth:R,dilationHeight:w,dilationWidth:_,inShape:e,outShape:h,filterShape:n}}function xs(e,n,t,r,o,i,a,s){i===void 0&&(i=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],f=u[2],d=u[3],h=u[4];if(a==="channelsLast")c=e[0],l=e[1],f=e[2],d=e[3],h=e[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);c=e[0],h=e[1],l=e[2],f=e[3],d=e[4]}var p,v=n[0],m=n[1],g=n[2],b=n[4],x=jc(t),y=x[0],w=x[1],_=x[2],S=jc(r),R=S[0],E=S[1],C=S[2],I=ei(v,R),k=ei(m,E),M=ei(g,C),P=(function($,G,O,re,he,be,ae,z,Z,ee,le){var pe,D,N,U;if(typeof $=="number"){pe={top:$,bottom:$,left:$,right:$,front:$,back:$,type:$===0?"VALID":"NUMBER"};var X=(function(Ee,Se,Me,We,Pe,yt){Pe==null&&(Pe=Xm(Ee,Se,We));var It=Ee[0],fn=Ee[1],dn=Ee[2],rr=Ui((It-Se+2*Pe)/We+1,yt);T(it(rr),(function(){return"The output # of depths ("+rr+") must be an integer. Change the stride and/or zero pad parameters"}));var Io=Ui((fn-Se+2*Pe)/We+1,yt);T(it(Io),(function(){return"The output # of rows ("+Io+") must be an integer. Change the stride and/or zero pad parameters"}));var Ct=Ui((dn-Se+2*Pe)/We+1,yt);return T(it(Ct),(function(){return"The output # of columns ("+Ct+") must be an integer. Change the stride and/or zero pad parameters"})),[rr,Io,Ct,Me]})([G,O,re,1],z,1,he,$,le);D=X[0],N=X[1],U=X[2]}else if($==="same"){D=Math.ceil(G/he),N=Math.ceil(O/be),U=Math.ceil(re/ae);var Y=(D-1)*he+z-G,J=(N-1)*be+Z-O,ce=(U-1)*ae+ee-re,ie=Math.floor(Y/2),ue=Y-ie,ne=Math.floor(J/2),Ce=J-ne,fe=Math.floor(ce/2);pe={top:ne,bottom:Ce,left:fe,right:ce-fe,front:ie,back:ue,type:"SAME"}}else{if($!=="valid")throw Error("Unknown padding parameter: "+$);pe={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},D=Math.ceil((G-z+1)/he),N=Math.ceil((O-Z+1)/be),U=Math.ceil((re-ee+1)/ae)}return{padInfo:pe,outDepth:D,outHeight:N,outWidth:U}})(o,l,f,d,y,w,_,I,k,M,s),L=P.padInfo,q=P.outDepth,V=P.outHeight,F=P.outWidth,H=i?b*h:b;return a==="channelsFirst"?p=[c,H,q,V,F]:a==="channelsLast"&&(p=[c,q,V,F,H]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:f,inWidth:d,inChannels:h,outDepth:q,outHeight:V,outWidth:F,outChannels:H,padInfo:L,strideDepth:y,strideHeight:w,strideWidth:_,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:k,effectiveFilterWidth:M,dilationDepth:R,dilationHeight:E,dilationWidth:C,inShape:e,outShape:p,filterShape:n}}function Xm(e,n,t,r){r===void 0&&(r=1);var o=ei(n,r);return Math.floor((e[0]*(t-1)-t+o)/2)}function ws(e){return typeof e=="number"?[e,e,e]:e.length===2?[e[0],e[1],1]:e}function jc(e){return typeof e=="number"?[e,e,e]:e}function ei(e,n){return n<=1?e:e+(e-1)*(n-1)}function Ui(e,n){if(!n)return e;switch(n){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+n)}}function pi(e){var n=ws(e),t=n[0],r=n[1],o=n[2];return t===1&&r===1&&o===1}function Zt(e,n){return pi(e)||pi(n)}function zl(e){if(e==="NHWC")return"channelsLast";if(e==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function Ym(e,n,t){if(n==="complex64"){if(e.dtype==="complex64")return e.clone();var r=Ye(e.shape),o=e.toFloat(),i=t.complex(o,r);return r.dispose(),o.dispose(),i}if(!T1(e.dtype,n))return W.makeTensorFromDataId(e.dataId,e.shape,n);if(e.dtype==="complex64"){var a=t.real(e);return i=a.cast(n),a.dispose(),i}if(n==="int32")return t.int(e);if(n==="bool"){var s=de(0,e.dtype);return i=t.notEqual(e,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+n)}function $c(e,n){return W.makeTensorFromDataId(e.dataId,n,e.dtype)}function Qm(e,n,t){var r=(n-e)/(t-1),o=ua(t,"float32");o[0]=e;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return st(o,"float32")}function Kc(e,n){if(e.length!==n.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+n.length+".");for(var t=new Float32Array(2*e.length),r=0;r<t.length;r+=2)t[r]=e[r/2],t[r+1]=n[r/2];return t}function lh(e,n){return{real:e[2*n],imag:e[2*n+1]}}function o2(e,n,t,r){e[2*r]=n,e[2*r+1]=t}function i2(e,n,t){var r=(t?2:-2)*Math.PI*(e/n);return{real:Math.cos(r),imag:Math.sin(r)}}function a2(e,n,t){var r=(function(i,a,s){return(function(u,c,l){for(var f=0,d=u.length,h=0,p=!1;f<d;){var v=l(c,u[h=f+(d-f>>>1)]);v>0?f=h+1:(d=h,p=!v)}return p?f:-f-1})(i,a,s||s2)})(e,n,t),o=r<0?-(r+1):r;e.splice(o,0,n)}function s2(e,n){return e>n?1:e<n?-1:0}function ql(e,n,t,r,o){return Jm(e,n,t,r,o,0).selectedIndices}function Hl(e,n,t,r,o,i){var a=Jm(e,n,t,r,o,i);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function Jm(e,n,t,r,o,i,a,s){s===void 0&&(s=!1);for(var u=Array.from(n).map((function(y,w){return{score:y,boxIndex:w,suppressBeginIndex:0}})).filter((function(y){return y.score>o})).sort(fh),c=i>0?-.5/i:0,l=[],f=[];l.length<t&&u.length>0;){var d=u.pop(),h=d.score,p=d.boxIndex,v=d.suppressBeginIndex;if(h<o)break;for(var m=!1,g=l.length-1;g>=v;--g){var b=u2(e,p,l[g]);if(b>=r){m=!0;break}if(d.score=d.score*c2(r,c,b),d.score<=o)break}d.suppressBeginIndex=l.length,m||(d.score===h?(l.push(p),f.push(d.score)):d.score>o&&a2(u,d,fh))}var x=l.length;return s&&(l.fill(0,x),f.fill(0,x)),{selectedIndices:st(l,"int32"),selectedScores:st(f,"float32"),numValidOutputs:de(x,"int32")}}function u2(e,n,t){var r=e.subarray(4*n,4*n+4),o=e.subarray(4*t,4*t+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),f=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),h=(s-i)*(u-a),p=(f-c)*(d-l);if(h<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(a,l),g=Math.min(s,f),b=Math.min(u,d),x=Math.max(g-v,0)*Math.max(b-m,0);return x/(h+p-x)}function c2(e,n,t){var r=Math.exp(n*t*t);return t<=e?r:0}function fh(e,n){return e.score-n.score||e.score===n.score&&n.boxIndex-e.boxIndex}function Zm(e,n,t){var r=new Array(e.rank).fill(0),o=e.shape.slice();return n.map((function(i){o[t]=i;var a=e.slice(r,o);return r[t]+=i,a}))}function eg(e,n){for(var t=new Array(e.rank),r=0;r<t.length;r++)t[r]=e.shape[r]*n[r];var o=Te(t,e.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=i[s]%e.shape[s];var u=e.locToIndex(a);o.values[r]=e.values[u]}return o.toTensor()}function tg(e,n,t,r,o){for(var i=n[n.length-1],a=[e.length/i,i],s=a[0],u=a[1],c=Yi(t,s*r),l=Yi("int32",s*r),f=0;f<s;f++){for(var d=f*u,h=e.subarray(d,d+u),p=[],v=0;v<h.length;v++)p.push({value:h[v],index:v});p.sort((function(y,w){return w.value-y.value}));var m=f*r,g=c.subarray(m,m+r),b=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,b[v]=p[v].index}var x=n.slice();return x[x.length-1]=r,[kt(c,x,t),kt(l,x,"int32")]}function Gl(e,n){for(var t=[],r=0;r<n.length;r++)n[r]&&t.push(r);var o=Te(e,"int32"),i=Te([t.length,e.length],"int32");for(r=0;r<t.length;r++){var a=o.indexToLoc(t[r]),s=r*e.length;i.values.set(a,s)}return i.toTensor()}var l2=function(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((function(o,i){return"T"+i}));var t=[];this.variableNames.forEach((function(o){t.push("float v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},f2=function(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((function(o,i){return"T"+i}));var t=[];this.variableNames.forEach((function(o){t.push("vec4 v"+o+" = get"+o+"AtOutCoords();")}));var r=this.variableNames.map((function(o){return"v"+o})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},d2=function(e,n,t){this.variableNames=["A"];var r=e.windowSize,o=e.batchSize,i=e.inSize,a=Math.ceil(i/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s=n==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function ng(e,n){return["x","y","z","w","u","v"].slice(0,n).map((function(t){return e+"."+t}))}function Kt(e,n){return n===1?[e]:ng(e,n)}function Pt(){var e,n,t,r,o,i,a,s,u,c;return Q().getNumber("WEBGL_VERSION")===2?(e="#version 300 es",n="in",t="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(e="",n="attribute",t="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:e,attribute:n,varyingVs:t,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function uo(e,n,t){t===void 0&&(t="index");var r=Xn(n);return r.map((function(o,i){return"int "+e[i]+" = "+t+" / "+o+"; "+(i===r.length-1?"int "+e[i+1]+" = "+t+" - "+e[i]+" * "+o:"index -= "+e[i]+" * "+o)+";"})).join("")}function jl(e){var n=Xn(e).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+n[0]+" + coords.y * "+n[1]+` + coords.z;
  }
`}var rg=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function h2(e,n,t,r){var o=[];e.forEach((function(h){var p=ye(h.shapeInfo.logicalShape);h.shapeInfo.isUniform?o.push("uniform float "+h.name+(p>1?"["+p+"]":"")+";"):(o.push("uniform sampler2D "+h.name+";"),o.push("uniform int offset"+h.name+";"))}));var i,a,s=o.join(`
`),u=e.map((function(h){return(function(p,v,m){m===void 0&&(m=!1);var g="";g+=m?og(p):Uo(p);var b=p.shapeInfo.logicalShape,x=v.logicalShape;return b.length<=x.length&&(g+=m?(function(y,w){var _,S=y.name,R=S.charAt(0).toUpperCase()+S.slice(1),E="get"+R+"AtOutCoords",C=y.shapeInfo.logicalShape.length,I=w.logicalShape.length,k=Lr(y.shapeInfo.logicalShape,w.logicalShape),M=Xe(I),P=I-C,L=["x","y","z","w","u","v"];_=C===0?"":I<2&&k.length>=1?"coords = 0;":k.map((function(O){return"coords."+L[O+P]+" = 0;"})).join(`
`);var q="";q=I<2&&C>0?"coords":y.shapeInfo.logicalShape.map((function(O,re){return"coords."+L[re+P]})).join(", ");var V="return outputValue;",F=ye(y.shapeInfo.logicalShape)===1,H=ye(w.logicalShape)===1;if(C!==1||F||H){if(F&&!H)V=I===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(k.length){var $=C-2,G=C-1;k.indexOf($)>-1&&k.indexOf(G)>-1?V="return vec4(outputValue.x);":k.indexOf($)>-1?V="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":k.indexOf(G)>-1&&(V="return vec4(outputValue.xx, outputValue.zz);")}}else V=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+E+`() {
      `+M+` coords = getOutputCoords();
      `+_+`
      vec4 outputValue = get`+R+"("+q+`);
      `+V+`
    }
  `})(p,v):(function(y,w){var _=y.name,S=_.charAt(0).toUpperCase()+_.slice(1),R="get"+S+"AtOutCoords",E=w.texShape,C=y.shapeInfo.texShape,I=y.shapeInfo.logicalShape.length,k=w.logicalShape.length;if(!y.shapeInfo.isUniform&&I===k&&y.shapeInfo.flatOffset==null&&wt(C,E))return`
      float `+R+`() {
        return sampleTexture(`+_+`, resultUV);
      }
    `;var M,P=Xe(k),L=Lr(y.shapeInfo.logicalShape,w.logicalShape),q=k-I,V=["x","y","z","w","u","v"];M=I===0?"":k<2&&L.length>=1?"coords = 0;":L.map((function(H){return"coords."+V[H+q]+" = 0;"})).join(`
`);var F="";return F=k<2&&I>0?"coords":y.shapeInfo.logicalShape.map((function(H,$){return"coords."+V[$+q]})).join(", "),`
    float `+R+`() {
      `+P+` coords = getOutputCoords();
      `+M+`
      return get`+S+"("+F+`);
    }
  `})(p,v)),g})(h,n,r)})).join(`
`),c=n.texShape,l=Pt(),f=(function(h){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+h.texture2D+`(textureSampler, uv).r;
    }
  `})(l),d=(function(h){return h.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+h.varyingFs+` vec2 resultUV;
    `+h.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+h.defineSpecialNaN+`
    `+h.defineSpecialInf+`
    `+h.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+p2+`
    `+v2+`
    `+m2+`
  `})(l);return n.isPacked?(i=(function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,w){var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];return _[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+_[1]+`.0);
      }
    `:_[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+_[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      return 2 * (resTexRC.x * `+_[1]+` + resTexRC.y);
    }
  `})(0,p);case 2:return(function(y,w){var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)];if(wt(y,w))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+_[0]+", "+_[1]+`));
      }
    `;var S=Math.ceil(y[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));

      int index = resTexRC.x * `+_[1]+` + resTexRC.y;
      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec2(r, c);
    }
  `})(h,p);case 3:return v=h,m=p,g=[Math.ceil(m[0]/2),Math.ceil(m[1]/2)],b=Math.ceil(v[2]/2),x=b*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+g[0]+", "+g[1]+`));
      int index = resTexRC.x * `+g[1]+` + resTexRC.y;

      int b = index / `+x+`;
      index -= b * `+x+`;

      int r = 2 * (index / `+b+`);
      int c = imod(index, `+b+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(y,w){for(var _=[Math.ceil(w[0]/2),Math.ceil(w[1]/2)],S=Math.ceil(y[y.length-1]/2),R=S*Math.ceil(y[y.length-2]/2),E=R,C="",I="b, r, c",k=2;k<y.length-1;k++)E*=y[y.length-k-1],C=`
      int b`+k+" = index / "+E+`;
      index -= b`+k+" * "+E+`;
    `+C,I="b"+k+", "+I;return`
    ivec`+y.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+_[0]+", "+_[1]+`));
      int index = resTexRC.x * `+_[1]+` + resTexRC.y;

      `+C+`

      int b = index / `+R+`;
      index -= b * `+R+`;

      int r = 2 * (index / `+S+`);
      int c = imod(index, `+S+`) * 2;

      return ivec`+y.length+"("+I+`);
    }
  `})(h,p)}var v,m,g,b,x})(n.logicalShape,c),a=(function(h){return`
    void setOutput(vec4 val) {
      `+h.output+` = val;
    }
  `})(l)):(i=(function(h,p){switch(h.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(g,b){return b[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+b[1]+`.0);
      }
    `:b[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+b[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      return resTexRC.x * `+b[1]+` + resTexRC.y;
    }
  `})(0,p);case 2:return(function(g,b){return wt(g,b)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+b[0]+", "+b[1]+`));
      }
    `:g[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:g[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+b[0]+", "+b[1]+`));
        int index = resTexRC.x * `+b[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      int r = index / `+g[1]+`;
      int c = index - r * `+g[1]+`;
      return ivec2(r, c);
    }
  `})(h,p);case 3:return v=p,m=uo(["r","c","d"],h),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+m+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(g,b){var x=uo(["r","c","d","d2"],g);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;
      `+x+`
      return ivec4(r, c, d, d2);
    }
  `})(h,p);case 5:return(function(g,b){var x=uo(["r","c","d","d2","d3"],g);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+b[0]+`,
                             `+b[1]+`));

      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(h,p);case 6:return(function(g,b){var x=uo(["r","c","d","d2","d3","d4"],g);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+b[0]+", "+b[1]+`));
      int index = resTexRC.x * `+b[1]+` + resTexRC.y;

      `+x+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(h,p);default:throw new Error(h.length+"-D output sampling is not yet supported")}var v,m})(n.logicalShape,c),a=(function(h){return`
    void setOutput(float val) {
      `+h.output+` = vec4(val, 0, 0, 0);
    }
  `})(l)),r&&(d+=g2),[d,f,a,s,i,u,t].join(`
`)}function Uo(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+o+"() {return "+r+";}";var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(a===1&&s===1)return`
      float `+o+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,c=u[0],l=u[1],f=eo(r);return`
    float `+o+`() {
      vec2 uv = uvFromFlat(`+c+", "+l+", "+f+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(e);case 1:return(function(t){var r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+o+`(int index) {
        `+Fo(t)+`
      }
    `;var i=t.shapeInfo.texShape,a=i[0],s=i[1];if(s===1&&a===1)return`
      float `+o+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=eo(r);return s===1?`
      float `+o+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+o+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+o+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(e);case 2:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=t.shapeInfo.texShape;if(a!=null&&wt(r,a)){var s=a[0],u=a[1];return`
    float `+i+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `}var c=ao(r),l=c.newShape,f=c.keptDims,d=l;if(d.length<r.length){var h=zo(t,d);return`
      `+Uo(h)+`
      float `+i+`(int row, int col) {
        return `+i+"("+qo(["row","col"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Fo(t)+`
      }
    `;var p=a[0],v=a[1],m=eo(o);return v===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `:p===1?`
    float `+i+`(int row, int col) {
      float index = dot(vec3(row, col, `+m+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+o+`, uv);
    }
  `:`
  float `+i+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+m+`;
    vec2 uv = uvFromFlat(`+p+", "+v+`, index);
    return sampleTexture(`+o+`, uv);
  }
`})(e);case 3:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[1]*r[2],s=r[2],u=ao(r),c=u.newShape,l=u.keptDims,f=c;if(f.length<r.length){var d=zo(t,f);return`
        `+Uo(d)+`
        float `+i+`(int row, int col, int depth) {
          return `+i+"("+qo(["row","col","depth"],l)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Fo(t)+`
      }
    `;var h=t.shapeInfo.texShape,p=h[0],v=h[1],m=t.shapeInfo.flatOffset;if(v===a&&m==null)return`
        float `+i+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+p+`.0);
          return sampleTexture(`+o+`, uv);
        }
      `;if(v===s&&m==null)return`
    float `+i+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+p+`.0);
      return sampleTexture(`+o+`, uv);
    }
  `;var g=eo(o);return`
      float `+i+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+p+", "+v+`, index);
        return sampleTexture(`+o+`, uv);
      }
  `})(e);case 4:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,c=ao(r),l=c.newShape,f=c.keptDims;if(l.length<r.length){var d=zo(t,l);return`
      `+Uo(d)+`
      float `+i+`(int row, int col, int depth, int depth2) {
        return `+i+"("+qo(["row","col","depth","depth2"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Fo(t)+`
      }
    `;var h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],m=p[1];if(m===u&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(m===a&&h==null)return`
      float `+i+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+v+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var g=eo(o);return`
    float `+i+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+m+", index + "+g+`);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);case 5:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,c=r[1]*u,l=ao(r),f=l.newShape,d=l.keptDims;if(f.length<r.length){var h=zo(t,f);return`
      `+Uo(h)+`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        return `+i+"("+qo(["row","col","depth","depth2","depth3"],d)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+c+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Fo(t)+`
      }
    `;var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],g=v[1];if(g===c&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(g===a&&p==null)return`
      float `+i+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+m+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var b=eo(o);return`
    float `+i+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+c+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+b+`;
      vec2 uv = uvFromFlat(`+m+", "+g+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);case 6:return(function(t){var r=t.shapeInfo.logicalShape,o=t.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),a=ao(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var c=zo(t,s);return`
      `+Uo(c)+`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+i+"("+qo(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var l=r[5],f=r[4]*l,d=r[3]*f,h=r[2]*d,p=r[1]*h;if(t.shapeInfo.isUniform)return`
      float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+d+", "+f+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Fo(t)+`
      }
    `;var v=t.shapeInfo.flatOffset,m=t.shapeInfo.texShape,g=m[0],b=m[1];if(b===p&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+d+", "+f+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;if(b===l&&v==null)return`
      float `+i+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+b+".0, "+g+`.0);
        return sampleTexture(`+o+`, uv);
      }
    `;var x=eo(o);return`
    float `+i+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+d+` +
          depth2 * `+f+" + depth3 * "+l+" + depth4 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+b+`, index);
      return sampleTexture(`+o+`, uv);
    }
  `})(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}function og(e){var n,t,r;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,t="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Pt(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+n+`, halfCR);
    }
  `;case 1:return(function(o){var i=o.name,a="get"+i.charAt(0).toUpperCase()+i.slice(1),s=o.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Pt();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+c.texture2D+"("+i+`, uv);
    }
  `})(e);case 2:return(function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=u[0],l=u[1],f=Pt();if(u!=null&&wt(i,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+l+".0, "+c+`.0);

        return `+f.texture2D+"("+a+`, uv);
      }
    `;var d=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],h=Math.ceil(i[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+h+", "+d[0]+", "+d[1]+`, row, col);
      return `+f.texture2D+"("+a+`, uv);
    }
  `})(e);case 3:return(function(o){var i=o.shapeInfo.logicalShape,a=o.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=o.shapeInfo.texShape,c=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(i[0]===1){var l=i.slice(1),f=zo(o,l);return`
        `+og(f)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+qo(["b","row","col"],[1,2])+`);
        }
      `}var d=c[0],h=c[1],p=Math.ceil(i[2]/2),v=p*Math.ceil(i[1]/2),m=Pt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+d+", "+h+", "+v+", "+p+`, b, row, col);
      return `+m.texture2D+"("+a+`, uv);
    }
  `})(e);default:return(function(o){for(var i=o.shapeInfo.logicalShape,a=i.length,s=o.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),c=o.shapeInfo.texShape,l=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)],f=l[0],d=l[1],h=Math.ceil(i[a-1]/2),p=h*Math.ceil(i[a-2]/2),v="int b, int row, int col",m="b * "+p+" + (row / 2) * "+h+" + (col / 2)",g=2;g<a-1;g++)v="int b"+g+", "+v,p*=i[a-g-1],m="b"+g+" * "+p+" + "+m;var b=Pt();return`
    vec4 `+u+"("+v+`) {
      int index = `+m+`;
      int texR = index / `+d+`;
      int texC = index - texR * `+d+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+d+", "+f+`);
      return `+b.texture2D+"("+s+`, uv);
    }
  `})(e)}}var p2=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,v2=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,m2=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,g2=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function eo(e){return"offset"+e}function Fo(e){var n=e.name,t=ye(e.shapeInfo.logicalShape);return t<2?"return "+n+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+n+`[i];
      }
    }
  `}function Xe(e){if(e<=1)return"int";if(e===2)return"ivec2";if(e===3)return"ivec3";if(e===4)return"ivec4";if(e===5)return"ivec5";if(e===6)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function zo(e,n){var t=JSON.parse(JSON.stringify(e));return t.shapeInfo.logicalShape=n,t}function qo(e,n){return n.map((function(t){return e[t]})).join(", ")}var y2=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,T(e.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var o=e[e.length-1],i=Math.ceil(o/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=Xe(c),f=Kt("coords",c);if(i===1){var d=Xe(s=c+1);a=`
        `+d+" sourceLocR = "+d+"("+f.join()+`, 0);
        ++`+f[c-1]+`;
        `+d+" sourceLocG = "+d+"("+f.join()+`, 0);
        ++`+f[c-2]+`;
        `+d+" sourceLocA = "+d+"("+f.join()+`, 0);
        --`+f[c-1]+`;
        `+d+" sourceLocB = "+d+"("+f.join()+`, 0);
        --`+f[c-2]+";"}else s=c,a=`
        `+l+` sourceLocR = coords;
        ++`+f[c-1]+`;
        `+l+` sourceLocG = coords;
        ++`+f[c-2]+`;
        `+l+` sourceLocA = coords;
        --`+f[c-1]+`;
        `+l+` sourceLocB = coords;
        --`+f[c-2]+";";var h=["x","y","z","w","u","v"].slice(0,s),p="."+h[s-1],v=h.map((function(R){return"int "+R})),m=Kt("sourceLocR",s-1).concat("inIdx.r"),g=Kt("sourceLocG",s-1).concat("inIdx.g"),b=Kt("sourceLocB",s-1).concat("inIdx.b"),x=Kt("sourceLocA",s-1).concat("inIdx.a"),y=t==="max"?"greaterThan":"lessThan",w=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+x.join()+")));",_=`vec4(
            getAChannel(`+m.join()+`),
            hasNextCol ? getAChannel(`+g.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+x.join()+") : 0.)",S=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+h.join()+`),
                                          vec2(`+h.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+h.join()+`),
                               vec2(`+h.slice(-2).join()+`));
      }
      `+S+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+f[c-1]+" < "+(u[c-1]-1)+`;
        bool hasNextRow = `+f[c-2]+" < "+(u[c-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+p+", sourceLocG"+p+`,
          sourceLocB`+p+", sourceLocA"+p+") * "+n+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+_+`;

        for (int i = 0; i < `+n+`; i++) {
          inIdx = srcIdx;
          `+w+`
          vec4 candidate = `+_+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+y+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},b2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=s-1-e.padInfo.top,l=u-1-e.padInfo.left,f=1/(n*t);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+l+`);
      const float avgMultiplier = float(`+f+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+i+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},x2=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=l-1-e.padInfo.front,p=f-1-e.padInfo.top,v=d-1-e.padInfo.left,m=1/(n*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);
      const float avgMultiplier = float(`+m+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+o+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+f+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+d+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},w2=function(e,n,t,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Be(e,n),Be(e,t);var a="0.0";r!=null&&(Be(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";o!=null&&(Be(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+i+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},_2=function(e,n,t,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Be(e,n),Be(e,t);var a="vec4(0.0)";r!=null&&(Be(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";o!=null&&(Be(e,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+i+`));

        setOutput((x - mean) * inv + offset);
      }
    `},C2="return areal * breal - aimag * bimag;",E2="return areal * bimag + aimag * breal;",dh=function(e,n,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Be(n,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Hu="return a + b;",Gu="return a - b;",hh="return a * b;",ig="return (a < 0.) ? b * a : a;",tt=function(e,n,t){this.variableNames=["A","B"],this.outputShape=Be(n,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},ag=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,sr=function(e,n,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Be(n,t);var o=this.outputShape.length,i="";if(r)if(o===0||ye(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          `+Xe(o)+` coords = getOutputCoords();
        `,o===1)i+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=Kt("coords",o);i+=`
            bool nextRowOutOfBounds =
              (`+a[o-2]+" + 1) >= "+this.outputShape[o-2]+`;
            bool nextColOutOfBounds =
              (`+a[o-1]+" + 1) >= "+this.outputShape[o-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+i+`

        setOutput(result);
      }
    `},S2=(function(){function e(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,t)}},e})(),R2=(function(){function e(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return e.prototype.getCustomSetupFunc=function(n,t){var r=this;return function(o,i){r.minLoc==null&&(r.minLoc=o.getUniformLocationNoThrow(i,"minVal"),r.maxLoc=o.getUniformLocationNoThrow(i,"maxVal")),o.gl.uniform1f(r.minLoc,n),o.gl.uniform1f(r.maxLoc,t)}},e})(),k2=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},I2=function(e){this.outputShape=[],this.outputShape=hi(e,1),this.variableNames=e.map((function(s,u){return"T"+u}));var n=new Array(e.length-1);n[0]=e[0][1];for(var t=1;t<n.length;t++)n[t]=n[t-1]+e[t][1];var r=["if (yC < "+n[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<n.length;t++){var o=n[t-1];r.push("else if (yC < "+n[t]+") setOutput(getT"+t+"(yR, yC-"+o+"));")}var i=n.length,a=n[n.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},A2=function(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hi(e,n);var t=this.outputShape,r=t.length,o=Xe(r),i=Kt("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(m,g){return"T"+g}));var s=new Array(e.length-1);s[0]=e[0][n];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][n];var c=a[n],l=a.slice(-2),f=a.join(),d="if ("+c+" < "+s[0]+`) {
        return getChannel(
            getT0(`+f+"), vec2("+l.join()+`));
        }`;for(u=1;u<s.length;u++){var h=s[u-1];d+=`
        if (`+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Ra(a,c,h)+`),
            vec2(`+Ra(l,c,h)+`));
        }`}var p=s.length,v=s[s.length-1];d+=`
        return getChannel(
          getT`+p+"("+Ra(a,c,v)+`),
          vec2(`+Ra(l,c,v)+"));",this.userCode=`
      float getValue(`+a.map((function(m){return"int "+m}))+`) {
        `+d+`
      }

      void main() {
        `+o+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+i+`), 0., 0., 0.);

        `+i[r-1]+" = "+i[r-1]+` + 1;
        if (`+i[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+i+`);
        }

        `+i[r-2]+" = "+i[r-2]+` + 1;
        if (`+i[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+i+`);
        }

        `+i[r-1]+" = "+i[r-1]+` - 1;
        if (`+i[r-2]+" < "+t[r-2]+` &&
            `+i[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+i+`);
        }
        setOutput(result);
      }
    `};function Ra(e,n,t){var r=e.indexOf(n);return e.map((function(o,i){return i===r?o+" - "+t:o})).join()}var T2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+i+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},D2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,s=t-1-e.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+l+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+i+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},N2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+n+" - "+o+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+i+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},F2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterDepth,t=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=n-1-e.padInfo.front,u=t-1-e.padInfo.top,c=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+n+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+o+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+n+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+i+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},P2=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var n=e.strideHeight,t=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+i+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+n+" - "+r+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+o+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},M2=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var n=e.filterHeight,t=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=n-1-e.padInfo.top,a=t-1-e.padInfo.left,s=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+n+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+n+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+o+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},ph=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,i=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),h=e.inChannels%4,p=e.dataFormat==="channelsLast",v=p?1:2,m=p?2:3,g=p?3:1,b="",x="";t&&(b=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,x="result = activation(result);");var y=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+b+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+g+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+m+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+f+`; wC++) {
            int xC = xCCorner + wC * `+c+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+p+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(h===1)+`) {

              if (`+p+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(h===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+p+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(h===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+p+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+y+`
        `+x+`
        setOutput(result);
      }
    `},O2=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var n=e.padInfo.front,t=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,f=e.filterHeight,d=e.filterWidth,h=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+n+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+l+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+d+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+h+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(p===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+h+`) *
                  getW(wF, wR, wC, `+h+`, d2);
              } else if (`+(p===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(p===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+h+`),
                  getX(batch, xF, xR, xC, `+h+` + 1),
                  getX(batch, xF, xR, xC, `+h+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+h+`, d2),
                  getW(wF, wR, wC, `+h+` + 1, d2),
                  getW(wF, wR, wC, `+h+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},vh=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=e.outChannels/e.inChannels,v="",m="";t&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,m="result = activation(result);");var g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+p+`;
        int q = d2 - d1 * `+p+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+d+`; wR++) {
          int xR = xRCorner + wR * `+l+`;

          if (xR < 0 || xR >= `+o+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+i+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+g+`
        `+m+`
        setOutput(result);
      }
    `},mh=function(e,n,t,r){n===void 0&&(n=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var o=e.inHeight,i=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,d=e.filterHeight,h=e.filterWidth,p=h,v="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var g=0;g<h;g++)v+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<d;m++)for(var b=0;b<p;b++){if(v+=`
          xR = xRCorner + `+m*l+`;
          xC = xCCorner + `+(g=2*b)*f+`;
        `,c===1){if(g<h&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    xTexelR`+m+"C"+g+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+o+" && xCOffset >= 0 && xCOffset < "+i+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+i+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+o+" && xC >= 0 && xC < "+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<h)){var x=s%2==0?Em(f):f;f%2==0&&s%2==1||f%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,f>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+o+` &&
                      xCOffset >= 0 && xCOffset < `+i+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+x+`;

                  if(xR >= 0 && xR < `+o+` &&
                    xCOffset >= 0 && xCOffset < `+i+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<h&&(v+=`
              if(xR >= 0 && xR < `+o+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<h&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+c+`;
                  if(xCOffset >= 0 && xCOffset < `+i+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+i+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+c+`;
                if(xCOffset >= 0 && xCOffset < `+i+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<h&&(v+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),v+="}");g<h&&(v+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<h&&(v+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<d;m++)for(g=0;g<h;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var y="",w="";t&&(y=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,w="result = activation(result);");var _=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+y+`

      const ivec2 strides = ivec2(`+u+", "+c+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+_+`
        `+w+`
        setOutput(result);
      }
    `},B2=function(e,n,t,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=e[0],a=e[1],s=e[2],u=e[3],c=n[0],l=t[0],f=t[1];this.outputShape=[c,l,f,u];var d=r==="bilinear"?1:0,h=[a-1+".0",s-1+".0"],p=h[0],v=h[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],g=m[0],b=m[1],x=m[2],y=f>1?[""+(s-1)/(f-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],w=y[0],_=y[1],S=y[2];this.userCode=`
      const float height_ratio = float(`+g+`);
      const float width_ratio = float(`+w+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+i+`) {
          return;
        }

        float height_scale = `+b+`;
        float width_scale = `+_+`;

        float in_y = `+x+`;
        if( in_y < 0.0 || in_y > `+p+` ) {
          setOutput(float(`+o+`));
          return;
        }
        float in_x = `+S+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+o+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+d+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},L2=function(e,n,t){this.variableNames=["x"],this.outputShape=e;var r=e.length,o=e[e.length-1],i=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+o+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Xe(r)+` coords = getOutputCoords();
        int end = `+gh(r,"coords")+`;
        float val = 0.0;
        for (int i = `+o+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+i+` end) {
            continue;
          }
          if (idx == end && `+n+`) {
            continue;
          }
          `+gh(r,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function gh(e,n){if(e===1)return""+n;if(e===2)return n+".y";if(e===3)return n+".z";if(e===4)return n+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var W2=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ji.DENSE;var n=Vi(e),t=Pt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+uo(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},V2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ji.DENSE;var n=Vi(e),t=Pt();this.outputShape=e,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+uo(["r","c","d"],e)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+n[0]+", "+n[1]+`));
        int index = 4 * (resTexRC.x * `+n[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},U2=(function(){function e(n,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return e.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e})(),z2=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},q2=function(e){this.variableNames=["A"],this.outTexUsage=sn.DOWNLOAD;var n=Pt();this.outputShape=e,this.userCode=`
      `+rg+`

      void main() {
        float x = getAAtOutCoords();
        `+n.output+` = encode_float(x);
      }
    `},H2=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=sn.DOWNLOAD;var n=Pt();this.outputShape=e,this.userCode=`
      `+rg+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+n.output+` = encode_float(x);
      }
    `},G2=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Pt(),o=n[0],i=n[1];this.outputShape=e;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+jl(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+i+`;
        int c = imod(flatIndex, `+i+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},j2=function(e,n,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Pt(),o=n[0],i=n[1];this.outputShape=e;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+=`
          localCoords = coords;
          if(localCoords[2] + `+c+" < "+e[2]+`) {
            localCoords[2] += `+c+`;
            if(localCoords[1] + `+u+" < "+e[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+i+`;
              c = imod(flatIndex, `+i+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+i+".0, "+o+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+l+`] = values[0];
              } else if(offset == 1) {
                result[`+l+`] = values[1];
              } else if(offset == 2) {
                result[`+l+`] = values[2];
              } else {
                result[`+l+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+jl(e)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},$2="return real * expR - imag * expI;",K2="return real * expI + imag * expR;",yh=function(e,n,t){this.variableNames=["real","imag"];var r=n[1];this.outputShape=n;var o=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+o+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+e+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+i+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},X2=(function(){function e(n,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,o){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(o,"value")),r.gl.uniform1f(t.valueLoc,n)}},e})(),Y2=function(e,n,t){this.variableNames=["A","indices"];var r=e.slice();r[t]=n,this.outputShape=r,this.rank=r.length;var o=Xe(this.rank),i=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var c=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],f=0;f<a.length;f++)f===s?l.push("int(getIndices("+c[f]+"))"):l.push(""+c[f]);return l.join()})(e,t);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},Q2=function(e,n,t){this.sliceDim=e,this.strides=n,this.variableNames=["x","indices"],this.outputShape=t;var r=Xe(n.length),o=Xe(t.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+o+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+i+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function J2(e,n){var t=Pt();return $1(e,n,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function Z2(e,n){return J1(e,n,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function eC(e,n){return Z1(e,n,new Uint16Array([0,1,2,2,1,3]))}function la(e,n,t,r,o,i,a){t_(t,r);var s=e_(e,n),u=e.TEXTURE_2D;return xe(e,n,(function(){return e.bindTexture(u,s)})),xe(e,n,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),xe(e,n,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),xe(e,n,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),xe(e,n,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),xe(e,n,(function(){return e.texImage2D(u,0,o,t,r,0,i,a,null)})),xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function tC(e,n,t,r,o){var i=Js(t,r);return la(e,n,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,e.FLOAT)}function nC(e,n,t,r,o){var i=Js(t,r);return la(e,n,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function rC(e,n,t,r,o){var i=Js(t,r);return la(e,n,i[0],i[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function oC(e,n,t,r,o){var i=ca(t,r);return la(e,n,i[0],i[1],o.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function iC(e,n,t,r,o){var i=ca(t,r);return la(e,n,i[0],i[1],o.internalFormatPackedHalfFloat,e.RGBA,o.textureTypeHalfFloat)}function aC(e,n,t,r){return xe(e,n,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),ih(e,n,t,"clipSpacePos",r,3,20,0)&&ih(e,n,t,"uv",r,2,20,12)}function sC(e,n,t,r,o,i,a){var s,u,c;xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*o*4),u=e.FLOAT,c=a.internalFormatPackedFloat),s.set(i),xe(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,o,0,e.RGBA,u,s)})),xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function uC(e,n,t,r){xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),r.data instanceof Uint8Array?xe(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):xe(e,n,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),xe(e,n,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function cC(e,n,t,r,o){var i=e.createBuffer();xe(e,n,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,i)}));var a=16*t*r;return xe(e,n,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)})),xe(e,n,(function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,0)})),xe(e,n,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),i}function lC(e,n,t){var r=e,o=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function fC(e,n,t,r,o){var i=Js(t,r),a=i[0],s=i[1],u=new Uint8Array(t*r*4);return xe(e,n,(function(){return e.readPixels(0,0,a,s,o.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function dC(e,n,t,r,o,i,a,s){var u=e,c=new Float32Array((function(l,f){var d=ca(l,f);return d[0]*d[1]*4})(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,n),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function hC(e,n,t,r){var o=new Float32Array(t*r*4);return xe(e,n,(function(){return e.readPixels(0,0,r,t,e.RGBA,e.FLOAT,o)})),o}var pC=(function(){function e(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Q().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,z1(t,n)):this.gl=Zn(t);var r="WEBGL_color_buffer_float";if(Q().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=_a(this.gl,this.debug,"OES_texture_float"),bn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=_a(this.gl,this.debug,"OES_texture_half_float");else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),bn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=_a(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Q().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",bn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!bn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Z2(this.gl,this.debug),this.indexBuffer=eC(this.gl,this.debug),this.framebuffer=n_(this.gl,this.debug),this.textureConfig=Ol(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return Q().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var n=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;xe(t,this.debug,(function(){return t.finish()})),xe(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),xe(t,this.debug,(function(){return t.deleteFramebuffer(n.framebuffer)})),xe(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),xe(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),xe(t,this.debug,(function(){return t.deleteBuffer(n.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(n,t){return this.throwIfDisposed(),tC(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(n,t){return this.throwIfDisposed(),nC(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(n,t){return this.throwIfDisposed(),rC(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.uploadPixelDataToTexture=function(n,t){this.throwIfDisposed(),uC(this.gl,this.debug,n,t)},e.prototype.uploadDenseMatrixToTexture=function(n,t,r,o){this.throwIfDisposed(),sC(this.gl,this.debug,n,t,r,o,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(n,t){return this.throwIfDisposed(),iC(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(n,t){return this.throwIfDisposed(),oC(this.gl,this.debug,n,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(n){var t=this;this.throwIfDisposed(),this.outputTexture===n&&(ah(this.gl,this.debug,this.framebuffer),this.outputTexture=null),xe(this.gl,this.debug,(function(){return t.gl.deleteTexture(n)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(n,t,r){var o=this;return this.downloadMatrixDriver(n,(function(){return fC(o.gl,o.debug,t,r,o.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(n,t,r,o,i,a){return dC(this.gl,n,0,0,0,i,a,this.textureConfig)},e.prototype.downloadFloat32MatrixFromBuffer=function(n,t){return lC(this.gl,n,t)},e.prototype.createBufferFromTexture=function(n,t,r){this.bindTextureToFrameBuffer(n);var o=cC(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o},e.prototype.createAndWaitForFence=function(){var n=this.createFence(this.gl);return this.pollFence(n)},e.prototype.createFence=function(n){var t,r,o=this;if(Q().getBool("WEBGL_FENCE_API_ENABLED")){var i=n,a=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=function(){var s=i.clientWaitSync(a,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},t=a}else Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return o.isQueryAvailable(t,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},e.prototype.downloadMatrixFromPackedTexture=function(n,t,r){var o=this;return this.downloadMatrixDriver(n,(function(){return hC(o.gl,o.debug,t,r)}))},e.prototype.createProgram=function(n){this.throwIfDisposed();var t=this.gl,r=K1(t,this.debug,n),o=J2(t,this.debug),i=Y1(t,this.debug);return xe(t,this.debug,(function(){return t.attachShader(i,o)})),xe(t,this.debug,(function(){return t.attachShader(i,r)})),Q1(t,this.debug,i),this.debug&&Vu(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=aC(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(n){var t=this;this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&xe(this.gl,this.debug,(function(){return t.gl.deleteProgram(n)}))},e.prototype.setProgram=function(n){var t=this;this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&Vu(this.gl,this.debug,this.program),xe(this.gl,this.debug,(function(){return t.gl.useProgram(n)}))},e.prototype.getUniformLocation=function(n,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?o_(this.gl,this.debug,n,t):i_(this.gl,n,t)},e.prototype.getAttributeLocation=function(n,t){var r=this;return this.throwIfDisposed(),xe(this.gl,this.debug,(function(){return r.gl.getAttribLocation(n,t)}))},e.prototype.getUniformLocationNoThrow=function(n,t){return this.throwIfDisposed(),this.gl.getUniformLocation(n,t)},e.prototype.setInputMatrixTexture=function(n,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),a_(this.gl,this.debug,this.program,n,t,r)},e.prototype.setOutputMatrixTexture=function(n,t,r){this.setOutputMatrixTextureDriver(n,r,t)},e.prototype.setOutputPackedMatrixTexture=function(n,t,r){this.throwIfDisposed();var o=ca(t,r),i=o[0],a=o[1];this.setOutputMatrixTextureDriver(n,i,a)},e.prototype.setOutputMatrixWriteRegion=function(n,t,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(n,t,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){this.program!=null&&Vu(this.gl,this.debug,this.program),Ca(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var n=this.gl;this.debug&&this.debugValidate(),xe(n,this.debug,(function(){return n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var n=this;this.throwIfDisposed(),xe(this.gl,this.debug,(function(){return n.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=_a(this.gl,this.debug,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var n=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=n.createQuery();return n.beginQuery(t.TIME_ELAPSED_EXT,r),r}var o=this.getQueryTimerExtensionWebGL1(),i=o.createQueryEXT();return o.beginQueryEXT(o.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(n){return me(this,void 0,void 0,(function(){var t=this;return ge(this,(function(r){switch(r.label){case 0:return[4,Zd((function(){return t.disposed||t.isQueryAvailable(n,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(n,Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(n,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}var o=this.getQueryTimerExtensionWebGL1();return o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(n,t){if(t===0)return!0;if(t===2){var r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(o=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(n,o.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(n){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return n.isFencePassed()}),(function(){return r()}))}))},e.prototype.pollItems=function(){for(var n=(function(r){for(var o=0;o<r.length&&r[o]();++o);return o-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=n;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(n+1)},e.prototype.addItemToPoll=function(n,t){var r=this;this.itemsToPoll.push({isDoneFn:n,resolveFn:t}),this.itemsToPoll.length>1||Zd((function(){return r.pollItems(),r.itemsToPoll.length===0}))},e.prototype.bindTextureToFrameBuffer=function(n){this.throwIfDisposed(),Uu(this.gl,this.debug,n,this.framebuffer),this.debug&&Ca(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Uu(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Ca(this.gl)):ah(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(n,t){this.bindTextureToFrameBuffer(n);var r=t();return this.unbindTextureToFrameBuffer(),r},e.prototype.setOutputMatrixTextureDriver=function(n,t,r){this.throwIfDisposed();var o=this.gl;Uu(o,this.debug,n,this.framebuffer),this.debug&&Ca(o),this.outputTexture=n,xe(o,this.debug,(function(){return o.viewport(0,0,t,r)})),xe(o,this.debug,(function(){return o.scissor(0,0,t,r)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(n,t,r,o){var i=this;this.throwIfDisposed(),xe(this.gl,this.debug,(function(){return i.gl.scissor(n,t,r,o)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},e})();function bh(e,n){if(e.length!==n.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+n.length+" inputs");e.forEach((function(t,r){var o=t.logicalShape,i=n[r],a=i.shape;if(!wt(o,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+o+" and "+a+" must match");if(!t.isUniform||!i.isUniform){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!wt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}}))}var vC=function(e,n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=t.filterWidth,o=t.inChannels,i=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,c=t.dilationWidth,l=t.dilationHeight,f=t.dataFormat,d=s.left,h=s.top,p=o*r,v=Pt(),m=f==="channelsLast",g=m?0:1,b=m?1:2,x="",y=0;y<=1;y++)for(var w=0;w<=1;w++)x+=`
          blockIndex = rc.y + `+w+`;
          pos = rc.x + `+y+`;

          if(blockIndex < `+e[1]+" && pos < "+e[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+h+`;
            d0 = offsetY + `+l+" * (pos / "+p+`);

            if(d0 < `+n[g]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+i+". - "+d+`.);
              d1 = offsetX + `+c+" * (int(mod(float(pos), "+p+".) / "+o+`.));

              if(d1 < `+n[b]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+o+`.));

                if (`+m+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*y+w)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*y+w)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+x+`

        `+v.output+` = result;
      }
    `},mC=function(e,n,t,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=n,s=e[3]-1;this.outputShape=e;var u="float("+t+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+i+`;
        setOutput(val);
      }
    `},gC=function(e,n,t,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=t,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+n+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+n+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+o+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+o+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},yC=function(e,n,t,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=n,s=e[3]-1;this.outputShape=e;var u="float("+t+") + float("+r+") * sum";i=o===.5?"inversesqrt("+u+")":o===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+i+`;
        setOutput(result);
      }
    `},bC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideHeight,t=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,s=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+o+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+i+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+i+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},xC=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var n=e.strideDepth,t=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=s-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,h=s*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+l+", "+f+", "+d+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+o+`) {
          float dyD = float(dyDCorner + wD) / `+n+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+h+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},ju=function(e,n,t,r,o,i,a){t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o=!1),i===void 0&&(i=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;var s=t?e[1]:e[2],u=Math.ceil(s/2),c=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",f=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],h="",p="";i&&(h=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+i+`
        }`:`vec4 activation(vec4 x) {
          `+i+`
        }`,p="result = activation(result);");var v=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+h+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+c+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+f[0]+" * "+d[0]+`);
          result += (`+f[1]+" * "+d[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+p+`

        setOutput(result);
      }
    `},wC=(function(){function e(n,t,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;return function(r,o){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(o,"seed")),r.gl.uniform1f(t.seedLoc,n)}},e})(),_C=function(e,n,t,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},CC=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var n=e.length;if(n===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Kt("rc",n),r=Xe(n),o=(function(s,u,c){if(s===1)return"rc > "+u[0];for(var l="",f=s-2;f<s;f++)l+=c[f]+" >= "+u[f],f<s-1&&(l+="||");return l})(n,e,t),i=(function(s,u,c,l){if(s===1)return"";var f=l.slice(-2);return`
    int r = `+f[0]+`;
    int c = `+f[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+c+`;
  `})(n,e[e.length-1],e[e.length-2],t),a=(function(s,u){var c=s.length,l=(function(f,d){for(var h=[],p=0;p<=1;p++)for(var v=0;v<=1;v++){for(var m=(p===0?"r":"rp1")+", "+(v===0?"c":"cp1"),g=2;g<f;g++)m=d[d.length-1-g]+","+m;h.push(m)}return h})(c,u);return c===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+l[0]+`),
          cEdge ? 0. : getA(`+l[1]+`),
          rEdge ? 0. : getA(`+l[2]+`),
          rEdge || cEdge ? 0. : getA(`+l[3]+")"})(e,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+o+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},EC=function(e,n,t){this.variableNames=["x"],this.outputShape=n.map((function(u,c){return u[0]+e[c]+u[1]}));var r=e.length,o=Xe(r),i=n.map((function(u){return u[0]})).join(","),a=n.map((function(u,c){return u[0]+e[c]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+o+" start = "+o+"("+i+`);
      `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+o+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+i+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},SC=function(e,n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(m,g){return m[0]+e[g]+m[1]}));for(var r=e.length,o=Xe(r),i=n.map((function(m){return m[0]})).join(","),a=n.map((function(m,g){return m[0]+e[g]})).join(","),s=Kt("rc",r),u=Kt("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=r===1?"source":"vec2("+u.slice(-2).join()+")",f=[o+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+c+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+c+") {"],d=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",h="",p=0,v=r===1?2:4;p<v;p++)h+=`
        `+f[p]+`
        if (`+d+`) {
          result[`+p+"] = float("+t+`);
        } else {
          `+o+` source = rc - start;
          result[`+p+"] = getChannel(getX("+u.join()+"), "+l+`);
        }
      `;h+=r===1?"} ":"}}",this.userCode=`
      const `+o+" start = "+o+"("+i+`);
      const `+o+" end = "+o+"("+a+`);

      void main() {
        `+o+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+h+`
        setOutput(result);
      }
    `},$u=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideHeight,i=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,f=e.padInfo.left;this.outputShape=e.outShape;var d=n==="avg",h="0.0";if(d||(h="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+o+", "+i+`);
        const ivec2 pads = ivec2(`+l+", "+f+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+c+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var p=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g=`
      if (`+d+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+i+`);
      const ivec2 pads = ivec2(`+l+", "+f+`);
      const float initializationValue = `+h+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+h+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+g+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(m===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+g+`
          } else if (`+(m===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+g+`
          }
        }
        setOutput(`+p+`);
      }
    `}},Ku=function(e,n,t){if(this.variableNames=["x"],n==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var m=n==="avg",g="0.0";if(m||(g="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+o+", "+i+", "+a+`);
        const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+l+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+f+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+d+`;
                  wC += `+c+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+f+" * "+d+` +
                      wR * `+d+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var b=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="avg"&&(b="avgValue / count");var x=4*Math.floor(r/4),y=r%4,w=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+o+", "+i+", "+a+`);
      const ivec3 pads = ivec3(`+h+", "+p+", "+v+`);
      const float initializationValue = `+g+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+g+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+l+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+f+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+x+`; wC += 4) {
              int xC = xCCorner + wC * `+c+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+c+`, ch)
              );

              `+w+`
            }

            int xC = xCCorner + `+x+`;
            if (`+(y===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(y===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                initializationValue,
                initializationValue
              );

              `+w+`
            } else if (`+(y===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+c+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+c+`, ch),
                initializationValue
              );

              `+w+`
            }
          }
          setOutput(`+b+`);
        }
      }
    `}},RC=function(e,n){this.variableNames=["x"];var t=e.windowSize,r=e.batchSize,o=e.inSize,i=Math.ceil(o/t);this.outputShape=[r,i];var a="0.0",s="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",s="min"):n==="max"&&(a="-1.0 / 1e-20",s="max");var u=n+"("+n+"("+n+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";n==="sum"?u="sumValue":n==="prod"?u="prodValue":n==="all"?u="allValue":n==="any"&&(u="anyValue");var c=4*Math.floor(t/4),l=t%4,f=`
      if (`+(n==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(n==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,d="vec4";n==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):n==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var h="";o%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+h+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+f+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(l===1)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(l===2)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+f+`
        } else if (`+(l===3)+`) {
          `+d+" values = "+d+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+f+`
        }
        setOutput(`+u+`);
      }
    `},kC=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var t="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),t+=`
        `+o+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+uo(["r","c","d"],n)+`
      return ivec3(r, c, d);
    }
  
      `+jl(e)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+e[1]+`;
        int cols = `+e[2]+`;

        `+t+`

        setOutput(result);
      }
    `},IC=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(o-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(i-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},AC=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},TC=function(e,n,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`,
          `+u[1]/c[1]+`);
      const vec3 inputShapeRC = vec3(`+i+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},DC=function(e,n,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n.shape;var r=n.shape,o=r[1],i=r[2],a=e.shape,s=a[1],u=a[2],c=[t&&s>1?o-1:o,t&&u>1?i-1:i],l=[t&&s>1?s-1:s,t&&u>1?u-1:u],f=c[0]/l[0],d=c[1]/l[1],h=1/f,p=1/d,v=2*Math.ceil(h)+2,m=2*Math.ceil(p)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+f+`);
        const float widthScale = float(`+d+`);

        const float invHeightScale = float(`+h+`);
        const float invWidthScale = float(`+p+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+m+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+l[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+l[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},NC=function(e,n,t,r){this.variableNames=["A"],this.outputShape=[];var o=e[0],i=e[1],a=e[2],s=e[3];this.outputShape=[o,n,t,s];var u=[r&&n>1?i-1:i,r&&t>1?a-1:a],c=[r&&n>1?n-1:n,r&&t>1?t-1:t],l=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/c[0]+`,
          `+u[1]/c[1]+`);
      const vec2 inputShapeRC = vec2(`+i+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+l+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},FC=function(e,n){this.variableNames=["x"];var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=e,t!==1){var r=e.map((function(i,a){return(function(s){return n.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)})).join(","),o=Xe(t);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `},PC=function(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=e.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=e;var r=Kt("rc",t),o=r[t-1]+" + 1 < "+this.outputShape[t-1],i=r[t-2]+" + 1 < "+this.outputShape[t-2],a=Xe(t);function s(u){var c=e.map((function(l,f){return(function(d,h){return n.indexOf(d)!==-1&&e[d]!==1?e[d]+" - "+h[d]+" - 1":""+h[d]})(f,u)}));return"getChannel(getX("+c.join(",")+"), vec2("+c.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+o+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(r.slice())+`;
          if(`+o+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(r.slice())+`;
          }
          if(`+i+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            if(`+o+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},xh=function(e,n,t,r,o,i,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Xe(o.length),u=Xe(i.length),c="";t===1?c="i":t===2&&(c="i, j");var l="getIndices("+c+")",f="";r===1?f="i":r===2&&(f="i, coords[1]");var d="getUpdates("+f+")",h=n>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+o+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+n+`; j++) {
              int index = round(`+l+`);
              flattenedIndex += index * `+h+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+d+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},MC=function(e,n){this.variableNames=["x","segmentIds"];var t=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,c=`
        sumValue += dot(values, segFilter);
    `,l="";o%t>0&&(l=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return initializationValue;
        }
      `);var f="";o%t>0&&(f=`
        if (inIdx < 0 || inIdx >= `+o+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+l+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+f+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+i+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+i+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+c+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+c+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+c+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+c+`
        }
        setOutput(sumValue);
      }
    `},OC=function(e,n,t){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=n,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<n.length;u++)s.push(""+i[u]),u<e&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=Xe(t);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+o+`));
        } else {
          setOutput(getB(`+o+`));
        }
      }
    `},BC=(function(){function e(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;var t,r=Xe(this.rank),o="uniform int start["+this.rank+"];",i=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Xu.slice(0,a).map((function(s){return"sourceLoc."+s})).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+n.map((function(a,s){return"sourceLoc."+Xu[s]+" = start["+s+"] + coords."+Xu[s]+";"})).join(`
`)+`
      `,this.userCode=`
      `+o+`
      void main() {
        `+t+`
        setOutput(getSource(`+i+`));
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e})(),Xu=["x","y","z","w","u","v"],LC=(function(){function e(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;var t=Xe(this.rank),r=Kt("coords",this.rank),o=Kt("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+o.slice(-2).join()+")",a="getChannel(getSource("+o.join()+"), "+i+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
        ++`+o[this.rank-1]+`;
        result.y = `+a+`;
        --`+o[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+n[this.rank-2]+`) {
        ++`+o[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+n[this.rank-1]+`) {
          ++`+o[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            `+t+"("+n.map((function(l,f){return"start["+f+"]"})).join()+");":n.map((function(l,f){return o[f]+" = "+r[f]+" + start["+f+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+c+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return e.prototype.getCustomSetupFunc=function(n){var t=this;if(n.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+n.length+")");return function(r,o){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(o,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,n)}},e})(),WC=function(e,n,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=Xe(t.length),i=Xe(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map((function(u,c){return s++,t.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(s-1)+"] * strides["+c+"] + begin["+c+"]"})).join(",")}this.userCode=`
      `+o+" begin = "+o+"("+e+`);
      `+o+" strides = "+o+"("+n+`);

      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},VC=(function(){function e(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(n,t,r){var o,i=wh(t,r),a=_h(n,i,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),i===rn.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):i===rn.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):i===rn.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):i===rn.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):i===rn.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[a].push(o),o},e.prototype.releaseTexture=function(n,t,r,o){if(this.freeTextures!=null){var i=_h(t,wh(r,o),o);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(n),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[i],s=a.indexOf(n);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},e.prototype.log=function(){if(this.logEnabled){var n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+n+")")}},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var n=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){n.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(o){n.gpgpu.deleteMatrixTexture(o)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e})();function wh(e,n){if(e===sn.UPLOAD)return rn.PACKED_2X2_FLOAT32;if(e===sn.RENDER||e==null)return(function(t){return Q().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?rn.PACKED_2X2_FLOAT32:rn.UNPACKED_FLOAT32:t?rn.PACKED_2X2_FLOAT16:rn.UNPACKED_FLOAT16})(n);if(e===sn.DOWNLOAD||e===sn.PIXELS)return rn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function _h(e,n,t){return e[0]+"_"+e[1]+"_"+n+"_"+t}var UC=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[r]*n[r];this.outputShape=t,this.rank=t.length;var o=Xe(this.rank),i=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],c=[],l=0;l<a.length;l++)c.push("imod("+u[l]+", "+a[l]+")");return c.join()})(e);this.userCode=`
      void main() {
        `+o+` resRC = getOutputCoords();
        setOutput(getA(`+i+`));
      }
    `},zC=function(e,n){this.variableNames=["A"];for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];this.outputShape=t,this.rank=t.length;var o=Xe(this.rank),i=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],c=new Array(s),l=0;l<a.length;l++)c[a[l]]=u[l];return c.join()})(n);this.userCode=`
    void main() {
      `+o+` resRC = getOutputCoords();
      setOutput(getA(`+i+`));
    }
    `},qC=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=e[n[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Xe(this.rank),i=ng("rc",this.rank),a=new Array(this.rank);for(r=0;r<n.length;r++)a[n[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+t[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+o+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+u+`) {
        result[1] = `+c+`;
      }
      --`+i[this.rank-1]+`;
      if(++`+i[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+u+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `},$l=1.7580993408473768,Kl=1.0507009873554805,Fe=function(e,n){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      float unaryOperation(float x) {
        `+n+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Fn="if (isnan(x)) return x;",HC="return x;",Ch="return abs(x);",sg=Fn+`
  return (x < 0.0) ? 0.0 : x;
`,ug=Fn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,cg="return (x >= 0.0) ? x : (exp(x) - 1.0);",GC=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+$l+`;
  float scale = `+Kl+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Eh="return -x;",Sh="return ceil(x);",Rh="return floor(x);",kh="return exp(x);",Ih="return exp(x) - 1.0;",jC=Fn+`
  return sin(x);
`,$C=Fn+`
  return cos(x);
`,KC=Fn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,XC=Fn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,YC=Fn+`
  return atan(x);
`,QC=Fn+"return log(x + sqrt(x * x + 1.0));",JC=Fn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,ZC=Fn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ka="return x;",eE="return x;",lg=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fg=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,dg=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Si=function(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+n+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},tE=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var n=e.length,t=Kt("rc",n),r=Xe(n),o=(function(s,u){if(s===1)return"rc";for(var c="",l=0;l<s;l++)c+=u[l],l<s-1&&(c+=",");return c})(n,t),i=t.slice(-2),a=n<=1?"rc":"vec2("+i.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+o+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},Ia={};function Aa(e,n){if(n===void 0&&(n=!1),e==="linear")return n?eE:HC;if(e==="relu")return n?lg:sg;if(e==="elu")return n?dg:cg;if(e==="relu6")return n?fg:ug;if(e==="prelu")return n?ag:ig;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var nE=600,rE=(function(e){function n(t){var r,o=e.call(this)||this;if(o.pendingRead=new WeakMap,o.pendingDisposal=new WeakSet,o.dataRefCount=new WeakMap,o.numBytesInGPU=0,o.uploadWaitMs=0,o.downloadWaitMs=0,o.warnedAboutMemory=!1,o.pendingDeletes=0,o.disposed=!1,!Q().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var i=Zn(Q().getNumber("WEBGL_VERSION"));o.binaryCache=((r=Q().getNumber("WEBGL_VERSION"))in Ia||(Ia[r]={}),Ia[r]),o.gpgpu=new pC(i),o.canvas=i.canvas,o.gpgpuCreatedLocally=!0}else o.gpgpu=t,o.binaryCache={},o.gpgpuCreatedLocally=!1,o.canvas=t.gl.canvas;return o.textureManager=new VC(o.gpgpu),o.numMBBeforeWarning=Q().global.screen==null?1024:Q().global.screen.height*Q().global.screen.width*window.devicePixelRatio*nE/1024/1024,o.texData=new $m(o,W),o}return Nn(n,e),n.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},n.prototype.write=function(t,r,o){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(t),o==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={};return this.texData.set(i,{shape:r,dtype:o,values:t,usage:sn.UPLOAD}),i},n.prototype.move=function(t,r,o,i){if(Q().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:o,dtype:i,values:r,usage:sn.UPLOAD})},n.prototype.readSync=function(t){var r=this.texData.get(t),o=r.values,i=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;l=c?new Si(u,ka):new Fe(u,ka);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),d=this.readSync(f.dataId);return this.disposeData(f.dataId),d}if(o!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return o;var h,p,v=this.activeTimers!=null;return v&&(h=Un()),i==="complex64"?p=Kc(a.real.dataSync(),a.imag.dataSync()):p=this.getValuesFromTexture(t),v&&(this.downloadWaitMs+=Un()-h),this.convertAndCacheOnCPU(t,p)},n.prototype.read=function(t){return me(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,d,h,p,v,m,g,b,x,y,w,_,S,R;return ge(this,(function(E){switch(E.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(C){return r.push(C)}))];if(o=this.texData.get(t),i=o.values,a=o.shape,s=o.slice,u=o.dtype,c=o.complexTensors,l=o.isPacked,s!=null)return f=void 0,f=l?new Si(a,ka):new Fe(a,ka),d=this.runWebGLProgram(f,[{dataId:t,shape:a,dtype:u}],u),h=this.read(d.dataId),this.disposeData(d.dataId),[2,h];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Q().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&Q().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(R=this.gpgpu).createBufferFromTexture.apply(R,[m.texture].concat(Vi(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:E.sent(),E.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([c.real.data(),c.imag.data()])];case 3:return b=E.sent(),x=b[0],y=b[1],g=Kc(x,y),[3,5];case 4:p==null?g=this.getValuesFromTexture(t):(w=ye(a),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),E.label=5;case 5:return v!=null&&this.disposeData(v.dataId),_=this.convertAndCacheOnCPU(t,g),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach((function(C){return C(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}}))}))},n.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var o=t[r];if(!G1(o))throw Q().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+o+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+o+" cannot be represented on this device.")}},n.prototype.getValuesFromTexture=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.isPacked,u=ye(i);if(Q().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[l.texture].concat(Vi(i))).subarray(0,u);return this.disposeData(c.dataId),f}var d=Q().getBool("WEBGL_PACK")&&s===!0,h=d?zu(i):i,p=d?new H2(h):new q2(h),v=this.runWebGLProgram(p,[{shape:h,dtype:a,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),g},n.prototype.time=function(t){return me(this,void 0,void 0,(function(){var r,o,i,a,s,u,c;return ge(this,(function(l){switch(l.label){case 0:return r=this.activeTimers,o=[],i=!1,this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,t(),a=fi(this.activeTimers.map((function(f){return f.query}))).filter((function(f){return f!=null})),s=fi(this.activeTimers.map((function(f){return f.name}))).filter((function(f){return f!=null})),this.activeTimers=r,i&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return c=l.sent(),u.kernelMs=S1(c),u.getExtraProfileInfo=function(){return c.map((function(f,d){return{name:s[d],ms:f}})).map((function(f){return f.name+": "+f.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},l.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Un(),endMs:null}},n.prototype.endTimer=function(t){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Un(),t)},n.prototype.getQueryTime=function(t){return me(this,void 0,void 0,(function(){var r;return ge(this,(function(o){return Q().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},n.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},n.prototype.releaseGPUData=function(t){var r=this.texData.get(t),o=r.texture,i=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),o!=null&&(this.numBytesInGPU-=this.computeBytes(a,i),this.textureManager.releaseTexture(o,a,s,u)));var d=this.texData.get(t);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null},n.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},n.prototype.getDataInfo=function(t){return this.texData.get(t)},n.prototype.getCPUBackend=function(){return Q().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=W.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(t,r){var o=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(i){return o.texData.get(i.dataId).texture==null&&i.size<r}))},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(t,r){var o=this.makeOutput(t.shape,"complex64");return this.texData.get(o.dataId).complexTensors={real:W.keep(t.clone()),imag:W.keep(r.clone())},o},n.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,o);if(ye(o)===0)return kt([],o,t.dtype);var i=this.texData.get(t.dataId).isPacked,a=Gm(t.shape,r,o);if(i||!a){var s=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LC(o):new BC(o),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,o)},n.prototype.shallowSlice=function(t,r,o){var i=this.texData.get(t.dataId),a=this.makeOutput(o,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,i),s.shape=o,s.dtype=t.dtype;var u=jm(r,t.strides);i.slice&&(u+=i.slice.flatOffset),s.slice={flatOffset:u,origDataId:i.slice&&i.slice.origDataId||t.dataId};var c=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,c+1),a},n.prototype.stridedSlice=function(t,r,o,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,o,i);var a=Ul(r,o,i);if(a.some((function(u){return u===0})))return kt([],a);var s=new WC(r,i,a);return this.compileAndRun(s,[t])},n.prototype.reverse=function(t,r){var o=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new PC(t.shape,r):new FC(t.shape,r);return this.compileAndRun(o,[t])},n.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var o=t.map((function(h){return yn(h)})),i=t.map((function(h){return qn(h)}));return St(this.concat(o,r),this.concat(i,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Q().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var c=new A2(t.map((function(h){return h.shape})),r);return this.compileAndRun(c,t)}var l=hi(t.map((function(h){return h.shape})),r),f=t.map((function(h){return h.as2D(-1,ye(h.shape.slice(r)))})),d=new I2(f.map((function(h){return h.shape})));return this.compileAndRun(d,f).reshape(l)},n.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Eh,t.dtype);var r=new Fe(t.shape,Eh);return this.compileAndRun(r,[t])},n.prototype.batchMatMul=function(t,r,o,i){var a=o?t.shape[2]:t.shape[1],s=i?r.shape[1]:r.shape[2],u=o?t.shape[1]:t.shape[2],c=t.shape[0];if((a===1||s===1)&&u>1e3){o&&(t=t.transpose([0,2,1])),i&&(r=r.transpose([0,2,1]));var l=s===1?t:t.as3D(c,u,1),f=s===1?2:1,d=s===1?r.as3D(c,1,u):r;return this.multiply(l,d).sum(f,!0)}var h=Rt(t.dtype,r.dtype),p=new ju(t.shape,[c,a,s],o,i);return this.compileAndRun(p,[t,r],h)},n.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=i?r.shape[2]:r.shape[1],f=a?o.shape[1]:o.shape[2],d=r.shape[0],h=Rt(r.dtype,o.dtype),p=s!=null,v=c!=null,m=u?Aa(u,!0):null,g=new ju(r.shape,[d,l,f],i,a,p,m,v),b=[r,o];return s&&b.push(s),c&&b.push(c),this.compileAndRun(g,b,h)},n.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var o=this.texData.get(t.dataId),i=this.texData.get(r.dataId),a=new dh(C2,t.shape,r.shape),s=new dh(E2,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag),this.makeComplexComponentTensorInfo(r,i.complexTensors.real),this.makeComplexComponentTensorInfo(r,i.complexTensors.imag)],c=this.compileAndRun(a,u),l=this.compileAndRun(s,u),f=this.complex(c,l);return c.dispose(),l.dispose(),f}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,hh,t.dtype);var d=new tt(hh,t.shape,r.shape);return this.compileAndRun(d,[t,r],t.dtype)},n.prototype.batchNormalization=function(t,r,o,i,a,s){var u=[t,r,o],c=null;s!=null&&(c=s.shape,u.push(s));var l=null;if(a!=null&&(l=a.shape,u.push(a)),Q().getBool("WEBGL_PACK_NORMALIZATION")){var f=new _2(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(f,u)}var d=new w2(t.shape,r.shape,o.shape,c,l,i);return this.compileAndRun(d,u)},n.prototype.localResponseNormalization4D=function(t,r,o,i,a){var s=Q().getBool("WEBGL_PACK_NORMALIZATION")?new yC(t.shape,r,o,i,a):new mC(t.shape,r,o,i,a);return this.compileAndRun(s,[t])},n.prototype.LRNGrad=function(t,r,o,i,a,s,u){var c=new gC(r.shape,i,a,s,u);return this.compileAndRun(c,[r,o,t])},n.prototype.tile=function(t,r){if(t.dtype==="string"){var o=this.readSync(t.dataId).map((function(a){return cs(a)}));return eg(Te(t.shape,t.dtype,o),r)}var i=new UC(t.shape,r);return this.compileAndRun(i,[t])},n.prototype.pad=function(t,r,o){var i=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SC(t.shape,r,o):new EC(t.shape,r,o);return this.compileAndRun(i,[t])},n.prototype.transpose=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,r);var o=Q().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qC(t.shape,r):new zC(t.shape,r);return this.compileAndRun(o,[t])},n.prototype.gather=function(t,r,o){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,o);var i=new Y2(t.shape,r.size,o);return this.compileAndRun(i,[t,r])},n.prototype.batchToSpaceND=function(t,r,o){T(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var i=r.reduce((function(f,d){return f*d})),a=vs(t.shape,r,i),s=ms(a.length,r.length),u=gs(t.shape,r,i),c=Um(o,r.length),l=zm(u,o,r.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(t,r,o){T(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var i=r.reduce((function(d,h){return d*h})),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=vs(u.shape,r,i,!1),l=ms(c.length,r.length,!1),f=gs(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(f)},n.prototype.reduce=function(t,r,o){var i=t.shape[0],a=t.shape[1],s=qu(a),u=new RC({windowSize:s,inSize:a,batchSize:i},r),c=this.compileAndRun(u,[t],o);return c.shape[1]===1?c:this.reduce(c,r,o)},n.prototype.argReduce=function(t,r,o){o===void 0&&(o=null);var i=t.shape[0],a=t.shape[1];o!=null&&(i=o.shape[0],a=o.shape[1]);var s=qu(a),u=new d2({windowSize:s,inSize:a,batchSize:i},r,o==null),c=[t];o!=null&&c.push(o);var l=this.compileAndRun(u,c,"int32");return l.shape[1]===1?l:this.argReduce(t,r,l)},n.prototype.argReducePacked=function(t,r,o){o===void 0&&(o=null);var i=o!=null?o.shape:t.shape,a=qu(i[i.length-1]),s=new y2(i,a,r,o==null),u=o==null?[t]:[t,o],c=this.compileAndRun(s,u,"int32");return c.rank===t.rank?this.argReducePacked(t,r,c):c},n.prototype.sum=function(t,r){tn("sum",r,t.rank);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a),u=Mu(t.dtype);return this.reduce(s,"sum",u).reshape(i)},n.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a),u=Mu(t.dtype);return this.reduce(s,"prod",u).reshape(i)},n.prototype.unsortedSegmentSum=function(t,r,o){var i=0,a=er([i],t.rank),s=t;a!=null&&(s=t.transpose(a),i=tr(1,t.rank)[0]);var u=(function(h,p,v){for(var m=[],g=h.length,b=0;b<g;b++)b!==p?m.push(h[b]):m.push(v);return m})(s.shape,i,o),c=ye([s.shape[i]]),l=s.as2D(-1,c),f=Mu(t.dtype),d=this.segOpCompute(l,"unsortedSegmentSum",r,f,o).reshape(u);return a!=null&&(d=d.transpose(Bl(a))),d},n.prototype.segOpCompute=function(t,r,o,i,a){var s=t.shape[0],u=t.shape[1],c=(function(d,h){var p,v=!1;for(d<=Hm?(p=d,v=!0):p=Wc(d,Math.floor(Math.sqrt(d)));!v;)p>h||p===d?v=!0:p=Wc(d,p+1);return p})(u,a),l=new MC({windowSize:c,inSize:u,batchSize:s,numSegments:a}),f=this.compileAndRun(l,[t,o],i);return f.shape[1]===a?f:(o=ps(0,a).tile([u/c]),this.segOpCompute(f,r,o,i,a))},n.prototype.argMinMaxReduce=function(t,r,o){var i=[r];if(tn("arg"+o.charAt(0).toUpperCase()+o.slice(1),i,t.rank),!Q().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Tt(t.shape,i),s=a[0],u=ye(a[1]),c=t.as2D(-1,u);return this.argReduce(c,o).reshape(s)}return this.argReducePacked(t,o)},n.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},n.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},n.prototype.cumsum=function(t,r,o,i){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new L2(t.shape,o,i);return this.compileAndRun(a,[t])},n.prototype.equal=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var o=new tt("return float(a == b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.notEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var o=new tt("return float(a != b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var o=new tt("return float(a < b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.lessEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var o=new tt("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var o=new tt("return float(a > b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.greaterEqual=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var o=new tt("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.logicalNot=function(t){var r=new Fe(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},n.prototype.logicalAnd=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var o=new tt("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.logicalOr=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var o=new tt("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r],"bool")},n.prototype.select=function(t,r,o){var i=new OC(t.rank,r.shape,r.rank);return this.compileAndRun(i,[t,r,o],Rt(r.dtype,o.dtype))},n.prototype.where=function(t){ds("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Gl(t.shape,r)},n.prototype.topk=function(t,r,o){return tg(t.dataSync(),t.shape,t.dtype,r)},n.prototype.min=function(t,r){tn("min",r,t.rank);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(i)},n.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.mod=function(t,r){var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);tn("max",r,t.rank);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(i)},n.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.all=function(t,r){tn("all",r,t.rank);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(i)},n.prototype.any=function(t,r){tn("any",r,t.rank);var o=Tt(t.shape,r),i=o[0],a=ye(o[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(i)},n.prototype.realDivide=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var o=new tt(`
if (a == b) {
  return 1.0;
};
return a / b;`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"float32")},n.prototype.floorDiv=function(t,r){if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var o=new tt(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(o,[t,r],"int32")},n.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Hu);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var o=Rt(t.dtype,r.dtype);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Hu,o);var i=new tt(Hu,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},n.prototype.packedUnaryOp=function(t,r,o){var i=new Si(t.shape,r);return this.compileAndRun(i,[t],o)},n.prototype.packedBinaryOp=function(t,r,o,i,a){a===void 0&&(a=!1);var s=new sr(o,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],i)},n.prototype.complexSeparableBinaryOp=function(t,r,o){var i=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map((function(d){var h=d[0],p=d[1],v=i.makeComplexComponentTensorInfo(t,h),m=i.makeComplexComponentTensorInfo(r,p),g=new tt(o,t.shape,r.shape);return i.compileAndRun(g,[v,m],Rt(h.dtype,p.dtype))})),c=u[0],l=u[1],f=this.complex(c,l);return c.dispose(),l.dispose(),f},n.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},n.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Q().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),o=this.addN(t.slice(0,r)),i=this.addN(t.slice(r));return this.addN([o,i])}var a=t.map((function(c){return c.dtype})).reduce((function(c,l){return Rt(c,l)})),s=t.map((function(c){return c.shape})),u=Q().getBool("WEBGL_PACK")?new f2(t[0].shape,s):new l2(t[0].shape,s);return this.compileAndRun(u,t,a)},n.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Gu);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var o=Rt(t.dtype,r.dtype);if(Q().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Gu,t.dtype);var i=new tt(Gu,t.shape,r.shape);return this.compileAndRun(i,[t,r],o)},n.prototype.pow=function(t,r){var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),i=Rt(t.dtype,r.dtype);return this.compileAndRun(o,[t,r],i)},n.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Sh,t.dtype);var r=new Fe(t.shape,Sh);return this.compileAndRun(r,[t])},n.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Rh,t.dtype);var r=new Fe(t.shape,Rh);return this.compileAndRun(r,[t])},n.prototype.sign=function(t){var r=new Fe(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},n.prototype.isNaN=function(t){var r=new Fe(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isInf=function(t){var r=new Fe(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.isFinite=function(t){var r=new Fe(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},n.prototype.round=function(t){var r=new Fe(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},n.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,kh,t.dtype);var r=new Fe(t.shape,kh);return this.compileAndRun(r,[t])},n.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ih,t.dtype);var r=new Fe(t.shape,Ih);return this.compileAndRun(r,[t])},n.prototype.softmax=function(t,r){var o=gt([r],t.shape),i=this.max(t,o),a=Jt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Fe(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},n.prototype.log1p=function(t){var r=new Fe(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},n.prototype.sqrt=function(t){var r=new Fe(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},n.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Fe(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},n.prototype.reciprocal=function(t){var r=new Fe(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},n.prototype.relu=function(t){var r;return r=Q().getBool("WEBGL_PACK")?new Si(t.shape,lg):new Fe(t.shape,sg),this.compileAndRun(r,[t])},n.prototype.relu6=function(t){var r;return r=Q().getBool("WEBGL_PACK")?new Si(t.shape,fg):new Fe(t.shape,ug),this.compileAndRun(r,[t])},n.prototype.prelu=function(t,r){var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(ag,t.shape,r.shape):new tt(ig,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.elu=function(t){if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,dg,t.dtype);var r=new Fe(t.shape,cg);return this.compileAndRun(r,[t])},n.prototype.eluDer=function(t,r){var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new tt("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.selu=function(t){var r=new Fe(t.shape,GC);return this.compileAndRun(r,[t])},n.prototype.int=function(t){var r=new Fe(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},n.prototype.clip=function(t,r,o){var i,a=(i=Q().getBool("WEBGL_PACK_CLIP")?new R2(t.shape):new S2(t.shape)).getCustomSetupFunc(r,o);return this.compileAndRun(i,[t],null,a)},n.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Q().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ch,t.dtype);var r=new Fe(t.shape,Ch);return this.compileAndRun(r,[t])},n.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),o=new k2(t.shape),i=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(o,i)},n.prototype.sigmoid=function(t){var r=new Fe(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},n.prototype.softplus=function(t){var r=new Fe(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},n.prototype.sin=function(t){var r=new Fe(t.shape,jC);return this.compileAndRun(r,[t])},n.prototype.cos=function(t){var r=new Fe(t.shape,$C);return this.compileAndRun(r,[t])},n.prototype.tan=function(t){var r=new Fe(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},n.prototype.asin=function(t){var r=new Fe(t.shape,KC);return this.compileAndRun(r,[t])},n.prototype.acos=function(t){var r=new Fe(t.shape,XC);return this.compileAndRun(r,[t])},n.prototype.atan=function(t){var r=new Fe(t.shape,YC);return this.compileAndRun(r,[t])},n.prototype.atan2=function(t,r){var o=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new tt(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(o,[t,r])},n.prototype.sinh=function(t){var r=new Fe(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.cosh=function(t){var r=new Fe(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},n.prototype.tanh=function(t){var r=new Fe(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},n.prototype.asinh=function(t){var r=new Fe(t.shape,QC);return this.compileAndRun(r,[t])},n.prototype.acosh=function(t){var r=new Fe(t.shape,JC);return this.compileAndRun(r,[t])},n.prototype.atanh=function(t){var r=new Fe(t.shape,ZC);return this.compileAndRun(r,[t])},n.prototype.erf=function(t){var r=new Fe(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},n.prototype.step=function(t,r){var o=new Fe(t.shape,(function(i){return i===void 0&&(i=0),Fn+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `})(r));return this.compileAndRun(o,[t])},n.prototype.conv2dByMatMul=function(t,r,o,i,a,s){var u=t.shape,c=this.texData.get(t.dataId),l=o.inChannels,f=u[0]*u[1]*u[2],d=o.outChannels,h=o.dataFormat==="channelsLast",p=(f===1||d===1)&&l>1e3,v=u[2]%2!=0&&!!c.isPacked;if(p||!Q().getBool("WEBGL_LAZILY_UNPACK")||!Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var m=h?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],g=this.reshape(t,[1,m,o.inChannels]),b=this.reshape(r,[1,o.inChannels,o.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),o.outShape)}var x=h?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),y={dataId:t.dataId,shape:[1,x,o.inChannels],dtype:t.dtype},w=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,T(Sa(c.shape,y.shape),(function(){return"packed reshape "+c.shape+" to "+y.shape+" isn't free"}));var _=this.reshape(r,[1,o.inChannels,o.outChannels]),S=this.fusedBatchMatMul({a:y,b:_,transposeA:!1,transposeB:!1,bias:i,activation:a,preluActivationWeights:s}),R=this.texData.get(S.dataId);return T(R.isPacked,(function(){return"batchMatMul result is expected to be packed"})),c.shape=w,R.shape=o.outShape,W.makeTensorFromDataId(S.dataId,o.outShape,S.dtype)},n.prototype.conv2dWithIm2Row=function(t,r,o,i,a,s){var u=o.filterWidth,c=o.filterHeight,l=o.inChannels,f=o.outWidth,d=o.outHeight,h=o.dataFormat==="channelsLast",p=u*c*l,v=d*f,m=[p,v],g=t.squeeze([0]),b=r.reshape([1,p,-1]),x=new vC(m,g.shape,o),y=this.compileAndRun(x,[g]).reshape([1,m[0],m[1]]),w=i!=null,_=s!=null,S=a?Aa(a,!0):null,R=new ju(y.shape,[1,v,o.outChannels],!0,!1,w,S,_),E=[y,b];i&&E.push(i),_&&E.push(s);var C=this.compileAndRun(R,E);return h?C.reshape([1,d,f,o.outChannels]):C.reshape([1,o.outChannels,d,f])},n.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(r,o,i,a,s,u);if(Q().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,o,i,a,s,u);var c=a!=null,l=u!=null,f=s?Aa(s,!1):null,d=new ph(i,c,f,l),h=[r,o];return a&&h.push(a),u&&h.push(u),this.compileAndRun(d,h)},n.prototype.conv2d=function(t,r,o){if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,o);if(Q().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,o);var i=new ph(o);return this.compileAndRun(i,[t,r])},n.prototype.conv2dDerInput=function(t,r,o){var i=new D2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv2dDerFilter=function(t,r,o){var i=new T2(o);return this.compileAndRun(i,[t,r])},n.prototype.fusedDepthwiseConv2D=function(t){var r,o=t.input,i=t.filter,a=t.convInfo,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,f=u?Aa(u,l):null,d=[o,i],h=s!=null,p=c!=null;return h&&d.push(s),p&&d.push(c),l?(r=new mh(a,h,f,p),this.compileAndRun(r,d)):(r=new vh(a,h,f,p),this.compileAndRun(r,d))},n.prototype.depthwiseConv2D=function(t,r,o){var i;return Q().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1?(i=new mh(o),this.compileAndRun(i,[t,r])):(i=new vh(o),this.compileAndRun(i,[t,r]))},n.prototype.depthwiseConv2DDerInput=function(t,r,o){var i=new M2(o);return this.compileAndRun(i,[t,r])},n.prototype.depthwiseConv2DDerFilter=function(t,r,o){var i=new P2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3d=function(t,r,o){var i=new O2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3dDerInput=function(t,r,o){var i=new F2(o);return this.compileAndRun(i,[t,r])},n.prototype.conv3dDerFilter=function(t,r,o){var i=new N2(o);return this.compileAndRun(i,[t,r])},n.prototype.maxPool=function(t,r){var o=new $u(r,"max",!1);return this.compileAndRun(o,[t])},n.prototype.avgPool=function(t,r){var o=new $u(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.maxPoolBackprop=function(t,r,o,i){var a=new $u(i,"max",!0),s=this.compileAndRun(a,[r]),u=new bC(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},n.prototype.avgPoolBackprop=function(t,r,o){var i=new b2(o);return this.compileAndRun(i,[t],r.dtype)},n.prototype.cast=function(t,r){return Ym(t,r,this)},n.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},n.prototype.avgPool3d=function(t,r){var o=new Ku(r,"avg",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.avgPool3dBackprop=function(t,r,o){var i=new x2(o);return this.compileAndRun(i,[t],r.dtype)},n.prototype.maxPool3d=function(t,r){var o=new Ku(r,"max",!1);return this.compileAndRun(o,[t],"float32")},n.prototype.maxPool3dBackprop=function(t,r,o,i){var a=new Ku(i,"max",!0),s=this.compileAndRun(a,[r]),u=new xC(i),c=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),c},n.prototype.reshape=function(t,r){var o=this.texData.get(t.dataId);if(o.isPacked&&!Sa(t.shape,r)&&(o.texture===null||!Sa(o.shape,r))){var i=this.packedReshape(t,r);return W.makeTensorFromDataId(i.dataId,i.shape,i.dtype)}return $c(t,r)},n.prototype.resizeBilinear=function(t,r,o,i){var a=Q().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new TC(t.shape,r,o,i):new AC(t.shape,r,o,i);return this.compileAndRun(a,[t],"float32")},n.prototype.resizeBilinearBackprop=function(t,r,o){var i=new IC(t,r,o);return this.compileAndRun(i,[t])},n.prototype.resizeNearestNeighbor=function(t,r,o,i){var a=new NC(t.shape,r,o,i);return this.compileAndRun(a,[t])},n.prototype.resizeNearestNeighborBackprop=function(t,r,o){var i=new DC(t,r,o);return this.compileAndRun(i,[t])},n.prototype.multinomial=function(t,r,o,i){var a=r?t:wr(t),s=a.shape[0],u=a.shape[1],c=new wC(s,u,o),l=c.getCustomSetupFunc(i);return this.compileAndRun(c,[a],"int32",l)},n.prototype.oneHot=function(t,r,o,i){var a=new _C(t.size,r,o,i);return this.compileAndRun(a,[t])},n.prototype.diag=function(t){var r=new z2(t.size);return this.compileAndRun(r,[t])},n.prototype.nonMaxSuppression=function(t,r,o,i,a){return ds("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),ql(t.dataSync(),r.dataSync(),o,i,a)},n.prototype.cropAndResize=function(t,r,o,i,a,s){var u=new B2(t.shape,r.shape,i,a,s);return this.compileAndRun(u,[t,r,o],"float32")},n.prototype.depthToSpace=function(t,r,o){T(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var i=t.shape[0],a=o==="NHWC"?t.shape[1]:t.shape[2],s=o==="NHWC"?t.shape[2]:t.shape[3],u=o==="NHWC"?t.shape[3]:t.shape[1],c=a*r,l=s*r,f=u/(r*r),d=new U2(o==="NHWC"?[i,c,l,f]:[i,f,c,l],r,o);return this.compileAndRun(d,[t])},n.prototype.split=function(t,r,o){return Zm(t,r,o)},n.prototype.scatterND=function(t,r,o){var i=ys(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=[l/u,u],d=t.reshape([s,a]),h=r.reshape([s,u]);if(l===0)return $c(kt([]),o);var p=de(0),v=new xh(s,a,d.rank,h.rank,c,f);return this.compileAndRun(v,[h,d,p]).reshape(o)},n.prototype.sparseToDense=function(t,r,o,i){var a=ys(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.strides,l=a.outputSize,f=new xh(u,s,t.rank,r.rank,c,[l,1]);return this.compileAndRun(f,[r,t,i]).reshape(o)},n.prototype.fft=function(t){return this.fftImpl(t,!1)},n.prototype.ifft=function(t){return this.fftImpl(t,!0)},n.prototype.fftImpl=function(t,r){var o=this.texData.get(t.dataId),i=new yh($2,t.shape,r),a=new yh(K2,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,o.complexTensors.real),this.makeComplexComponentTensorInfo(t,o.complexTensors.imag)],u=this.compileAndRun(i,s),c=this.compileAndRun(a,s),l=this.complex(u,c).as2D(t.shape[0],t.shape[1]);return u.dispose(),c.dispose(),l},n.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=qm(t,r),s=a[0],u=a[1],c=a[2],l=a[3],f=r.reshape([u,i]),d=t.reshape([t.size/c,c]),h=new Q2(i,l,[u,c]);return this.compileAndRun(h,[d,f]).reshape(s)},n.prototype.fill=function(t,r,o){if((o=o||sa(r))==="string"){var i=us(o,ye(t));return i.fill(r),W.makeTensor(i,t,o,this)}var a=new X2(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],o,s)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},n.prototype.linspace=function(t,r,o){return Qm(t,r,o)},n.prototype.makeTensorInfo=function(t,r){var o=this.write(null,t,r);return this.texData.get(o).usage=null,{dataId:o,shape:t,dtype:r}},n.prototype.makeOutput=function(t,r){var o=this.makeTensorInfo(t,r).dataId;return W.makeTensorFromDataId(o,t,r,this)},n.prototype.unpackTensor=function(t){var r=new tE(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},n.prototype.packTensor=function(t){var r=new CC(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},n.prototype.packedReshape=function(t,r){var o=[ls(t.shape)].concat(fs(t.shape)),i={dtype:t.dtype,shape:o,dataId:t.dataId},a=[ls(r)].concat(fs(r)),s=new kC(a,o),u=this.runWebGLProgram(s,[i],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},n.prototype.decode=function(t){var r,o=this.texData.get(t),i=o.isPacked,a=o.shape,s=o.dtype,u=zu(a);return r=i?new V2(u):new W2(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},n.prototype.runWebGLProgram=function(t,r,o,i,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,o),c=this.texData.get(u.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===Ji.DENSE){var l=Vi(t.outputShape);c.texShape=l.map((function(x){return 2*x}))}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),ye(u.shape)===0)return c.values=Yi(u.dtype,0),u;var f=[],d=r.map((function(x){if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var y=s.texData.get(x.dataId);if(y.texture==null){if(!t.packedInputs&&ye(x.shape)<=Q().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:y.values};t.packedInputs&&(y.isPacked=!0,y.shape=x.shape)}else if(!!y.isPacked!=!!t.packedInputs)x=y.isPacked?s.unpackTensor(x):s.packTensor(x),f.push(x),y=s.texData.get(x.dataId);else if(y.isPacked&&!Sa(y.shape,x.shape)){var w=x,_=x.shape;x.shape=y.shape,x=s.packedReshape(x,_),f.push(x),y=s.texData.get(x.dataId),w.shape=_}return s.uploadToGPU(x.dataId),{shape:x.shape,texData:y,isUniform:!1}}));this.uploadToGPU(u.dataId);var h,p={shape:u.shape,texData:c,isUniform:!1},v=(function(x,y,w){var _="";y.concat(w).forEach((function(E){var C=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,I=E.isUniform?"uniform":E.texData.texShape;_+=E.shape+"_"+I+"_"+C}));var S=x.userCode,R=x.constructor.name;return R+="_"+_+"_"+S})(t,d,p),m=this.getAndSaveBinary(v,(function(){return(function(x,y,w,_){var S=y.userCode,R=w.map((function(F,H){var $={logicalShape:F.shape,texShape:F.isUniform?null:F.texData.texShape,isUniform:F.isUniform,isPacked:!F.isUniform&&F.texData.isPacked,flatOffset:null};return F.texData!=null&&F.texData.slice!=null&&F.texData.slice.flatOffset>0&&($.flatOffset=F.texData.slice.flatOffset),{name:y.variableNames[H],shapeInfo:$}})),E=R.map((function(F){return F.shapeInfo})),C={logicalShape:_.shape,texShape:_.texData.texShape,isUniform:!1,isPacked:_.texData.isPacked,flatOffset:null},I=h2(R,C,S,y.packedInputs),k=x.createProgram(I),M=null,P=x.getUniformLocation(k,"NAN",!1);Q().getNumber("WEBGL_VERSION")===1&&(M=x.getUniformLocation(k,"INFINITY",!1));for(var L={},q=0;q<y.variableNames.length;q++){var V=y.variableNames[q];L[V]=x.getUniformLocation(k,V,!1),L["offset"+V]=x.getUniformLocation(k,"offset"+V,!1)}return{program:y,source:I,webGLProgram:k,uniformLocations:L,inShapeInfos:E,outShapeInfo:C,infLoc:M,nanLoc:P}})(s.gpgpu,t,d,p)})),g=this.activeTimers!=null;if(g&&(h=this.startTimer()),(function(x,y,w,_,S){bh(y.inShapeInfos,w),bh([y.outShapeInfo],[_]);var R=_.texData.texture,E=_.texData.texShape;_.texData.isPacked?x.setOutputPackedMatrixTexture(R,E[0],E[1]):x.setOutputMatrixTexture(R,E[0],E[1]),x.setProgram(y.webGLProgram),Q().getNumber("WEBGL_VERSION")===1&&y.infLoc!==null&&x.gl.uniform1f(y.infLoc,1/0),y.nanLoc!==null&&x.gl.uniform1f(y.nanLoc,NaN),w.forEach((function(C,I){var k=y.program.variableNames[I],M=y.uniformLocations[k],P=y.uniformLocations["offset"+k];if(M!=null)if(C.isUniform)if(ye(C.shape)<2)x.gl.uniform1f(M,C.uniformValues[0]);else{var L=C.uniformValues;L instanceof Float32Array||(L=new Float32Array(L)),x.gl.uniform1fv(M,L)}else C.texData.slice!=null&&P!=null&&x.gl.uniform1i(P,C.texData.slice.flatOffset),x.setInputMatrixTexture(C.texData.texture,M,I)})),S?.(x,y.webGLProgram),x.executeProgram()})(this.gpgpu,m,d,p,i),f.forEach((function(x){return s.disposeData(x.dataId)})),g&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!Q().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&a===!1){var b=this.unpackTensor(u);return this.disposeData(u.dataId),b}return u},n.prototype.compileAndRun=function(t,r,o,i,a){a===void 0&&(a=!1),o=o||r[0].dtype;var s=this.runWebGLProgram(t,r,o,i,a);return W.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},n.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){var t=this;this.disposed||(Q().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ve((function(){if(!Q().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Q().getBool("DEBUG");Q().set("DEBUG",!1);var o=t.abs(de(1e-8)).dataSync()[0];if(Q().set("DEBUG",r),o>0)return 32}return 16}))),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(t){var r,o=this.texData.get(t),i=o.shape,a=o.dtype,s=o.values,u=o.texture,c=o.usage,l=o.isPacked;if(u==null){var f,d=this.activeTimers!=null;d&&(f=Un());var h=o.texShape;if(h==null&&(h=c_(i,l),o.texShape=h),s!=null){var p=zu(i),v=void 0,m=h[1],g=h[0],b=s instanceof Uint8Array;l?(m=(r=ca(h[0],h[1]))[0],g=r[1],v=new j2(p,[g,m],b)):v=new G2(p,[g,m],b);var x=this.makeTensorInfo([g,m],a);this.texData.get(x.dataId).usage=b?sn.PIXELS:sn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),m,g,s);var y=this.runWebGLProgram(v,[x],a,null,!0),w=this.texData.get(y.dataId);o.texture=w.texture,o.texShape=w.texShape,o.isPacked=w.isPacked,o.usage=w.usage,this.disposeData(x.dataId),this.texData.delete(y.dataId),o.values=null,d&&(this.uploadWaitMs+=Un()-f)}else{var _=this.acquireTexture(h,c,a,l);o.texture=_}}},n.prototype.convertAndCacheOnCPU=function(t,r){var o=this.texData.get(t),i=o.dtype;return this.releaseGPUData(t),r!=null&&(o.values=(function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),c=0;c<u.length;++c)u[c]=Math.round(a[c]);return u}throw new Error("Unknown dtype "+s)})(r,i)),o.values},n.prototype.acquireTexture=function(t,r,o,i){if(this.numBytesInGPU+=this.computeBytes(t,o),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},n.prototype.computeBytes=function(t,r){return t[0]*t[1]*Sm(r)},n})(Km);Nm()&&W.registerBackend("webgl",(function(){return new rE}),2);var oE=B({square_:function(e){var n=A(e,"x","square"),t=[n];return W.runKernelFunc((function(r,o){return o([n]),r.square(n)}),{x:n},null,"Square",{},t,[])}}),ea="SquaredDifference",hg=B({squaredDifference_:function(e,n){var t,r=A(e,"a","squaredDifference"),o=A(n,"b","squaredDifference");t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return W.runKernelFunc((function(s,u){var c=s.squaredDifference(r,o);return u([r,o]),c}),i,(function(s,u){var c=u[0],l=u[1],f=de(2);return{a:function(){return s.mul(c.sub(l).mul(f))},b:function(){return s.mul(l.sub(c).mul(f))}}}),ea,{},a,[])}}),iE=B({abs_:function(e){var n=A(e,"x","abs");return n.dtype==="complex64"?W.runKernelFunc((function(t){return t.complexAbs(n)}),{$x:n}):W.runKernelFunc((function(t,r){var o=t.abs(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.toFloat().step(-1))}}}),"Abs")}}),aE=B({acos_:function(e){var n=A(e,"x","acos");return W.runKernelFunc((function(t,r){var o=t.acos(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(de(1).sub(o.toFloat().square()).sqrt()).neg()}}}))}}),sE=B({acosh_:function(e){var n=A(e,"x","acosh");return W.runKernelFunc((function(t,r){var o=t.acosh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(o.toFloat().square().sub(1).sqrt())}}}))}}),uE=B({asin_:function(e){var n=A(e,"x","asin");return W.runKernelFunc((function(t,r){var o=t.asin(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(de(1).sub(o.toFloat().square()).sqrt())}}}))}}),cE=B({asinh_:function(e){var n=A(e,"x","asinh");return W.runKernelFunc((function(t,r){var o=t.asinh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.divStrict(de(1).add(o.toFloat().square()).sqrt())}}}))}}),lE=B({atan_:function(e){var n=A(e,"x","atan");return W.runKernelFunc((function(t,r){var o=t.atan(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().square().add(1))}}}))}}),fE=B({atanh_:function(e){var n=A(e,"x","atanh");return W.runKernelFunc((function(t,r){var o=t.atanh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(de(1).sub(o.toFloat().square()))}}}))}}),dE=B({ceil_:function(e){var n=A(e,"x","ceil");return W.runKernelFunc((function(t){return t.ceil(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),Xl=B({clipByValue_:function(e,n,t){var r=A(e,"x","clipByValue");T(n<=t,(function(){return"Error in clip: min ("+n+") must be less than or equal to max ("+t+")."}));var o=[r],i={min:n,max:t};return W.runKernelFunc((function(a,s){var u=a.clip(r,n,t);return s([r]),u}),{x:r},(function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(n).logicalAnd(u.lessEqual(t)),Le(a))}}}),"ClipByValue",i,o)}}),hE=B({cos_:function(e){var n=A(e,"x","cos"),t=[n];return W.runKernelFunc((function(r,o){var i=r.cos(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return i.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),pE=B({cosh_:function(e){var n=A(e,"x","cosh");return W.runKernelFunc((function(t,r){var o=t.cosh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().sinh().mulStrict(t)}}}))}}),vE=B({erf_:function(e){var n=A(e,"x","erf");return T(n.dtype==="int32"||n.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),n.dtype==="int32"&&(n=n.toFloat()),W.runKernelFunc((function(t,r){var o=t.erf(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Xc=B({exp_:function(e){var n=A(e,"x","exp");return W.runKernelFunc((function(t,r){var o=t.exp(n);return r([o]),o}),{x:n},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),mE=B({expm1_:function(e){var n=A(e,"x","expm1");return W.runKernelFunc((function(t,r){var o=t.expm1(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.exp())}}}))}}),gE=B({floor_:function(e){var n=A(e,"x","floor");return W.runKernelFunc((function(t){return t.floor(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),yE=B({log_:function(e){var n=A(e,"x","log"),t=[n];return W.runKernelFunc((function(r,o){var i=r.log(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return r.div(i.toFloat())}}}),"Log",{},t)}}),bE=B({log1p_:function(e){var n=A(e,"x","log1p");return W.runKernelFunc((function(t,r){var o=t.log1p(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.add(1))}}}))}}),xE=B({logSigmoid_:function(e){var n=A(e,"x","logSigmoid");return W.runKernelFunc((function(t,r){var o=t.softplus(n.neg()).neg();return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.neg().sigmoid())}}}))}}),_s=B({neg_:function(e){var n=A(e,"x","neg"),t=[n];return W.runKernelFunc((function(r){return r.neg(n)}),{x:n},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),wE=B({reciprocal_:function(e){var n=A(e,"x","reciprocal");return W.runKernelFunc((function(t,r){var o=t.reciprocal(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.square().neg())}}}))}}),_E=B({round_:function(e){var n=A(e,"x","round");return W.runKernelFunc((function(t){return t.round(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),pg=B({rsqrt_:function(e){var n=A(e,"x","rsqrt"),t=[n];return W.runKernelFunc((function(r,o){var i=r.rsqrt(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return r.div(i.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),vg=B({sigmoid_:function(e){var n=A(e,"x","sigmoid");return W.runKernelFunc((function(t,r){var o=t.sigmoid(n);return r([o]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mul(o.mul(de(1).sub(o)))}}}),"Sigmoid")}}),CE=B({sign_:function(e){var n=A(e,"x","sign");return W.runKernelFunc((function(t){return t.sign(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),EE=B({isNaN_:function(e){var n=A(e,"x","isNaN");return W.runKernelFunc((function(t){return t.isNaN(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),SE=B({isInf_:function(e){var n=A(e,"x","isInf");return W.runKernelFunc((function(t){return t.isInf(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),RE=B({isFinite_:function(e){var n=A(e,"x","isFinite");return W.runKernelFunc((function(t){return t.isFinite(n)}),{$x:n},(function(t){return{$x:function(){return Le(t)}}}))}}),kE=B({sin_:function(e){var n=A(e,"x","sin"),t=[n];return W.runKernelFunc((function(r,o){var i=r.sin(n);return o([n]),i}),{x:n},(function(r,o){var i=o[0];return{x:function(){return i.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),IE=B({sinh_:function(e){var n=A(e,"x","sinh");return W.runKernelFunc((function(t,r){var o=t.sinh(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return o.toFloat().cosh().mulStrict(t)}}}))}}),AE=B({softplus_:function(e){var n=A(e,"x","softplus");return W.runKernelFunc((function(t,r){var o=t.softplus(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.mul(o.sigmoid())}}}))}}),TE=B({sqrt_:function(e){var n=A(e,"x","sqrt");return W.runKernelFunc((function(t,r){var o=t.sqrt(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.toFloat().sqrt().mul(2))}}}))}}),DE=B({step_:function(e,n){n===void 0&&(n=0);var t=A(e,"x","step");return W.runKernelFunc((function(r){return r.step(t,n)}),{$x:t},(function(r){return{$x:function(){return Le(r)}}}))}}),NE=B({tan_:function(e){var n=A(e,"x","tan");return W.runKernelFunc((function(t,r){var o=t.tan(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return t.div(o.cos().square())}}}))}}),FE=B({tanh_:function(e){var n=A(e,"x","tanh");return W.runKernelFunc((function(t,r){var o=t.tanh(n);return r([o]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return de(1).sub(o.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}});function mg(e,n,t,r,o,i){var a,s,u=A(e,"x","batchNorm"),c=A(n,"mean","batchNorm"),l=A(t,"variance","batchNorm");return o!=null&&(a=A(o,"scale","batchNorm")),r!=null&&(s=A(r,"offset","batchNorm")),T(u.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),T(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),T(l.rank===2||l.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),a!=null&&T(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),s!=null&&T(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),fa(u,c,l,s,a,i)}function gg(e,n,t,r,o,i){var a,s,u=A(e,"x","batchNorm"),c=A(n,"mean","batchNorm"),l=A(t,"variance","batchNorm");return o!=null&&(a=A(o,"scale","batchNorm")),r!=null&&(s=A(r,"offset","batchNorm")),T(u.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),T(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),T(l.rank===3||l.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),a!=null&&T(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),s!=null&&T(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),fa(u,c,l,s,a,i)}function yg(e,n,t,r,o,i){var a,s,u=A(e,"x","batchNorm"),c=A(n,"mean","batchNorm"),l=A(t,"variance","batchNorm");return o!=null&&(a=A(o,"scale","batchNorm")),r!=null&&(s=A(r,"offset","batchNorm")),T(u.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),T(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),T(l.rank===4||l.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),a!=null&&T(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),s!=null&&T(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),fa(u,c,l,s,a,i)}function fa(e,n,t,r,o,i){i==null&&(i=.001);var a,s,u,c=A(e,"x","batchNorm"),l=A(n,"mean","batchNorm"),f=A(t,"variance","batchNorm");o!=null&&(a=A(o,"scale","batchNorm")),r!=null&&(s=A(r,"offset","batchNorm")),T(l.rank===f.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),T(s==null||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),T(a==null||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=c.rank===0||c.rank===1?c.as4D(1,1,1,c.size):c.rank===2?c.as4D(1,1,c.shape[0],c.shape[1]):c.rank===3?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,f,a];return W.runKernelFunc((function(h,p){var v=h.batchNormalization(u,Ta(l),Ta(f),i,Ta(a),Ta(s));return p([c,l,f,a]),v}),{x:c,mean:l,variance:f,scale:a,offset:s},(function(h,p){var v=p,m=v[0],g=v[1],b=v[2],x=v[3],y=x??de(1),w=vt(g.shape,u.shape),_=[];if(g.rank===1){for(var S=0;S<u.shape.length-1;++S)_.push(u.shape[S]);_.push(1)}var R=m.sub(g),E=h.mul(y),C=pg(b.add(de(i))),I=C.mul(C).mul(C).mul(de(-.5));return{x:function(){return g.rank===1?h.mul(Zo(C.as4D(1,1,1,g.shape[0]),_)).mul(y).reshape(m.shape):h.mul(C).mul(y).reshape(m.shape)},mean:function(){var k=C.mul(de(-1)).mul(E);return g.rank===1&&(k=k.sum(w)),k.reshape(g.shape)},variance:function(){var k=I.mul(R).mul(E);return g.rank===1&&(k=k.sum(w)),k.reshape(g.shape)},scale:function(){var k=R.mul(C),M=h.mul(k);return g.rank===1&&(M=M.sum(w)),M.reshape(g.shape)},offset:function(){var k=h;return g.rank===1&&(k=k.sum(w)),k.reshape(g.shape)}}}),"BatchNormalization",{varianceEpsilon:i},d).reshape(c.shape)}function Ta(e){return e==null?null:e.rank===0?e.as1D():e.rank===1?e:e.rank===2?e.as4D(1,1,e.shape[0],e.shape[1]):e.rank===3?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function tu(){Fm("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var PE=B({batchNormalization2d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),tu(),mg(e,n,t,i,o,r)}}),ME=B({batchNormalization3d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),tu(),gg(e,n,t,i,o,r)}}),OE=B({batchNormalization4d_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),tu(),yg(e,n,t,i,o,r)}}),BE=B({batchNormalization_:function(e,n,t,r,o,i){return r===void 0&&(r=.001),tu(),fa(e,n,t,i,o,r)}}),bg=B({batchNorm_:fa}),LE=B({batchNorm2d_:mg}),WE=B({batchNorm3d_:gg}),VE=B({batchNorm4d_:yg}),nu=B({logicalAnd_:function(e,n){var t=A(e,"a","logicalAnd","bool"),r=A(n,"b","logicalAnd","bool");return Be(t.shape,r.shape),W.runKernelFunc((function(o){return o.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),UE=B({logicalNot_:function(e){var n=A(e,"x","logicalNot","bool");return W.runKernelFunc((function(t){return t.logicalNot(n)}),{$x:n})}}),xg=B({logicalOr_:function(e,n){var t=A(e,"a","logicalOr","bool"),r=A(n,"b","logicalOr","bool");return Be(t.shape,r.shape),W.runKernelFunc((function(o){return o.logicalOr(t,r)}),{$a:t,$b:r})}}),zE=B({logicalXor_:function(e,n){var t=A(e,"a","logicalXor","bool"),r=A(n,"b","logicalXor","bool");return Be(t.shape,r.shape),xg(e,n).logicalAnd(nu(e,n).logicalNot())}}),xo=B({where_:function(e,n,t){var r=A(n,"a","where"),o=A(t,"b","where"),i=A(e,"condition","where","bool");return He(r.shape,o.shape,"Error in where: "),i.rank===1?T(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):He(i.shape,o.shape,"Error in where: "),W.runKernelFunc((function(a,s){var u=a.select(i,r,o);return s([i]),u}),{$condition:i,$a:r,$b:o},(function(a,s){var u=s[0];return{$condition:function(){return Le(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}}))}}),wg=function(e){return me(this,void 0,void 0,(function(){var n,t,r;return ge(this,(function(o){switch(o.label){case 0:return[4,(n=A(e,"condition","whereAsync","bool")).data()];case 1:return t=o.sent(),r=Gl(n.shape,t),e!==n&&n.dispose(),[2,r]}}))}))},Oe=B({add_:function(e,n){var t,r=A(e,"a","add"),o=A(n,"b","add");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a){return a.add(r,o)}),{a:r,b:o},(function(a){return{a:function(){var s=a,u=vt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=vt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(o.shape)}}}),"Add")}}),qE=B({addN_:function(e){T(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),T(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var n=e.map((function(o,i){return A(o,"tensors"+i,"addN")})),t=n[0];n.forEach((function(o){if(o.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),n.forEach((function(o){if(!wt(o.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=n;return W.runKernelFunc((function(o){return o.addN(n)}),r,(function(o){var i={};return n.forEach((function(a,s){i[s]=function(){return o.clone()}})),i}),"AddN")}}),HE=B({addStrict_:function(e,n){var t=A(e,"a","addStrict"),r=A(n,"b","addStrict");return He(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),GE=B({atan2_:function(e,n){var t,r=A(e,"a","atan2"),o=A(n,"b","atan2");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a,s){var u=a.atan2(r,o);return s([r,o]),u}),{$a:r,$b:o},(function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=Oe(u.square(),c.square()),f=a.mul(c.div(l)),d=vt(u.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(u.shape)},$b:function(){var l=Oe(u.square(),c.square()),f=_s(a.mul(u.div(l))),d=vt(c.shape,i);return d.length>0&&(f=f.sum(d)),f.reshape(c.shape)}}}))}}),Sn=B({div_:function(e,n){var t,r=A(e,"a","div"),o=A(n,"b","div");if(t=et(r,o),r=t[0],o=t[1],r.dtype==="int32"&&o.dtype==="int32")return _g(r,o);var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a,s){var u=a.realDivide(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),f=vt(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=vt(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}}),"Div")}}),jE=B({divNoNan_:function(e,n){var t,r=A(e,"a","div"),o=A(n,"b","div");r=(t=et(r,o))[0],o=t[1];var i=Sn(r,o),a=Le(i),s=o.equal(a);return xo(s,a,i)}}),$E=B({divStrict_:function(e,n){var t=A(e,"a","div"),r=A(n,"b","div");return He(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),_g=B({floorDiv_:function(e,n){var t,r=A(e,"a","floorDiv"),o=A(n,"b","floorDiv");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a,s){var u=a.floorDiv(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.div(c.toFloat()),f=vt(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=vt(c.shape,i);f.length>0&&(l=l.sum(f).reshape(c.shape));var d=c.square();return l.div(d.toFloat()).neg()}}}),"FloorDiv")}}),Yl=B({maximum_:function(e,n){var t,r=A(e,"a","maximum"),o=A(n,"b","maximum");return t=et(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Be(r.shape,o.shape),W.runKernelFunc((function(i,a){var s=i.maximum(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.greaterEqual(u).toFloat())},b:function(){return i.mul(s.less(u).toFloat())}}}),"Maximum")}}),KE=B({maximumStrict_:function(e,n){var t=A(e,"a","maximumStrict"),r=A(n,"b","maximumStrict");return He(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),Cg=B({minimum_:function(e,n){var t,r=A(e,"a","minimum"),o=A(n,"b","minimum");return t=et(r,o),r=t[0],o=t[1],r.dtype==="bool"&&(r=r.toInt(),o=o.toInt()),Be(r.shape,o.shape),W.runKernelFunc((function(i,a){var s=i.minimum(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return i.mul(s.lessEqual(u).toFloat())},b:function(){return i.mul(s.greater(u).toFloat())}}}),"Minimum")}}),XE=B({minimumStrict_:function(e,n){var t=A(e,"a","minimumStrict"),r=A(n,"b","minimumStrict");return He(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),YE=B({mod_:function(e,n){var t,r=A(e,"a","mod"),o=A(n,"b","mod");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a,s){var u=a.mod(r,o);return s([r,o]),u}),{$a:r,$b:o},(function(a,s){var u=s[0],c=s[1];return{$a:function(){var l=vt(u.shape,i);return l.length>0?a.sum(l).reshape(u.shape):a},$b:function(){var l=a.mul(u.div(c).floor().neg()),f=vt(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}}))}}),QE=B({modStrict_:function(e,n){var t=A(e,"a","modStrict"),r=A(n,"b","modStrict");return He(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Ot=B({mul_:function(e,n){var t,r=A(e,"a","mul"),o=A(n,"b","mul");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a,s){var u=a.multiply(r,o);return s([r,o]),u}),{a:r,b:o},(function(a,s){var u=s[0],c=s[1];return{a:function(){var l=a.mul(c.toFloat()),f=vt(u.shape,i);return f.length>0?l.sum(f).reshape(u.shape):l},b:function(){var l=a.mul(u.toFloat()),f=vt(c.shape,i);return f.length>0?l.sum(f).reshape(c.shape):l}}}),"Mul")}}),JE=B({mulStrict_:function(e,n){var t=A(e,"a","mul"),r=A(n,"b","mul");return He(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Cs=B({pow_:function(e,n){var t,r=A(e,"base","pow"),o=A(n,"exp","pow");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape),a=[r,o];return W.runKernelFunc((function(s,u){var c=s.pow(r,o);return u([r,o,c]),c}),{a:r,b:o},(function(s,u){var c=u[0],l=u[1],f=u[2];return{a:function(){var d=l.toFloat(),h=s.mul(d.mul(c.pow(d.sub(de(1))))),p=vt(c.shape,i);return p.length>0&&(h=h.sum(p)),h.reshape(c.shape)},b:function(){var d=c.greater(0),h=c.log().where(d,Le(c)),p=s.mul(f.mul(h)),v=vt(l.shape,i);return v.length>0&&(p=p.sum(v)),p.reshape(l.shape)}}}),"Pow",{},a,[!0])}}),ZE=B({powStrict_:function(e,n){return He(e.shape,n.shape,"Error in powStrict: "),e.pow(n)}}),eS=B({squaredDifferenceStrict_:function(e,n){var t=A(e,"a","squaredDifferenceStrict"),r=A(n,"b","squaredDifferenceStrict");return He(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),mt=B({sub_:function(e,n){var t,r=A(e,"a","sub"),o=A(n,"b","sub");t=et(r,o),r=t[0],o=t[1];var i=Be(r.shape,o.shape);return W.runKernelFunc((function(a){return a.subtract(r,o)}),{a:r,b:o},(function(a){return{a:function(){var s=a,u=vt(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=vt(o.shape,i);return u.length>0&&(s=s.sum(u)),s.neg().reshape(o.shape)}}}),"Sub")}}),tS=B({subStrict_:function(e,n){var t=A(e,"a","subStrict"),r=A(n,"b","subStrict");return He(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Eg=B({equal_:function(e,n){var t,r=A(e,"a","equal"),o=A(n,"b","equal");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i){return i.equal(r,o)}),{$a:r,$b:o})}}),nS=B({equalStrict_:function(e,n){var t=A(e,"a","equalStrict"),r=A(n,"b","equalStrict");return He(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),rS=B({greater_:function(e,n){var t,r=A(e,"a","greater"),o=A(n,"b","greater");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i){return i.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Sg=B({greaterEqual_:function(e,n){var t,r=A(e,"a","greaterEqual"),o=A(n,"b","greaterEqual");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i,a){var s=i.greaterEqual(r,o);return a([r,o]),s}),{a:r,b:o},(function(i,a){var s=a[0],u=a[1];return{a:function(){return Le(s)},b:function(){return Le(u)}}}),"GreaterEqual")}}),oS=B({greaterEqualStrict_:function(e,n){var t=A(e,"a","greaterEqualStrict"),r=A(n,"b","greaterEqualStrict");return He(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),iS=B({greaterStrict_:function(e,n){var t=A(e,"a","greaterStrict"),r=A(n,"b","greaterStrict");return He(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),aS=B({less_:function(e,n){var t,r=A(e,"a","less"),o=A(n,"b","less");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i){return i.less(r,o)}),{a:r,b:o},null,"Less")}}),sS=B({lessEqual_:function(e,n){var t,r=A(e,"a","lessEqual"),o=A(n,"b","lessEqual");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i,a){var s=i.lessEqual(r,o);return a([r,o]),s}),{a:r,b:o},null,"LessEqual")}}),uS=B({lessEqualStrict_:function(e,n){var t=A(e,"a","lessEqualStrict"),r=A(n,"b","lessEqualStrict");return He(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),cS=B({lessStrict_:function(e,n){var t=A(e,"a","lessStrict"),r=A(n,"b","lessStrict");return He(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),lS=B({notEqual_:function(e,n){var t,r=A(e,"a","notEqual"),o=A(n,"b","notEqual");return t=et(r,o),r=t[0],o=t[1],Be(r.shape,o.shape),W.runKernelFunc((function(i){return i.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),fS=B({notEqualStrict_:function(e,n){var t=A(e,"a","notEqualStrict"),r=A(n,"b","notEqualStrict");return He(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function Ah(e,n){for(var t=[],r=e;r<n;++r)t.push(r);return t}function Th(e){for(var n=[],t=0;t<e.length;++t)for(var r=0;r<e[t].length;++r)n.push(e[t][r]);return n}var Ql=B({gather_:function(e,n,t){t===void 0&&(t=0);var r=A(e,"x","gather"),o=A(n,"indices","gather","int32");t=gt(t,r.shape)[0];var i=(function(a,s,u){for(var c=a.shape[u],l=[],f=1,d=1,h=0;h<u;h++)l.push(a.shape[h]),f*=a.shape[h];for(h=0;h<s.rank;h++)l.push(s.shape[h]);for(h=u+1;h<a.rank;h++)l.push(a.shape[h]),d*=a.shape[h];return{batchSize:f,sliceSize:d,dimSize:c,outputShape:l}})(r,o,t);return W.runKernelFunc((function(a,s){var u=a.gather(r,o.flatten(),t);return s([o]),u}),{x:r,indices:o},(function(a,s){var u=s[0];return{x:function(){var c=r.shape,l=u.size,f=c.slice(0,t),d=f.length,h=c.slice(t,c.length).slice(1),p=h.length,v=Ah(0,d),m=Ah(d+1,d+1+p),g=Th([f,[l],h]),b=a.reshape(g),x=u.reshape([l]),y=Th([[d],v,m]),w=b.transpose(y),_=Rg(w,x,r.shape[t]),S=Bl(y);return _=_.transpose(S)},indices:function(){return u}}}),"Gather",{axis:t}).reshape(i.outputShape)}}),Rg=B({unsortedSegmentSum_:function(e,n,t){var r=A(e,"x","unsortedSegmentSum"),o=A(n,"segmentIds","unsortedSegmentSum","int32");return T(it(t),(function(){return"numSegments must be of dtype int"})),W.runKernelFunc((function(i,a){var s=i.unsortedSegmentSum(r,o,t);return a([o]),s}),{$x:r},(function(i,a){var s=a[0];return{$x:function(){return(function(u,c){for(var l=Yl(c,Le(c)),f=Ql(u,l),d=Sg(c,de(0,"int32")),h=f.rank-d.rank,p=0;p<h;++p)d=gn(d,p+1);d=nu(d,yi(f.shape,"bool"));var v=Le(f);return xo(d,f,v)})(i,s)}}}))}}),dS=function(e,n,t){return me(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,d,h,p,v;return ge(this,(function(m){switch(m.label){case 0:for(r=A(e,"tensor","boolMask"),o=A(n,"mask","boolMask","bool"),i=t??0,a=o.rank,s=r.shape,T(a>0,(function(){return"mask cannot be scalar"})),He(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),f=r.reshape(l),d=o.reshape([-1]),[4,wg(d)];case 1:return h=m.sent(),p=h.squeeze([1]),v=Ql(f,p,i),e!==r&&r.dispose(),n!==o&&o.dispose(),p.dispose(),f.dispose(),d.dispose(),h.dispose(),[2,v]}}))}))};function kg(e,n,t,r,o,i,a){i===void 0&&(i="NHWC"),T(e.length===n.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"}));var s=e,u=n,c=!1;n.rank===3&&(c=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,e[0],e[1],e[2]]),T(s.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),T(u.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),T(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];T(l===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."})),T(f===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+f+") must match output depth for filter "+t.shape[3]+"."})),a!=null&&T(it(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var d=zl(i),h=So(s,t.shape,r,1,o,a,!1,d),p=W.runKernelFunc((function(v,m){var g=v.conv2dDerInput(u,t,h);return m([t,u]),g}),{dy4D:u,filter:t},(function(v,m){var g=m[0],b=m[1];return{dy4D:function(){return Cn(v,g,r,o,i,1,a)},filter:function(){return Jl(v,b,g.shape,r,o,i,a)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Yu(e){var n=(function(i){return typeof i=="number"?[i,i,i]:i.length===2?[i[0],i[1],1]:i})(e),t=n[0],r=n[1],o=n[2];return t===1&&r===1&&o===1}function Ig(e,n,t,r,o){T(e.length===n.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+n.rank+") must match"}));var i=e,a=n,s=!1;n.rank===4&&(s=!0,a=n.as5D(1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=a.shape[4];T(i.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."})),T(a.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),T(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),T(u===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."})),T(c===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[4]+"."}));var l=xs(i,t.shape,r,1,o),f=W.runKernelFunc((function(d){return d.conv3dDerInput(a,t,l)}),{dy5D:a});return s?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}var hS=B({conv1d_:function(e,n,t,r,o,i,a){o===void 0&&(o="NWC"),i===void 0&&(i=1);var s=A(e,"x","conv1d"),u=A(n,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),T(c.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),T(u.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),a!=null&&T(it(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."})),T(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),T(Zt(t,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+i+"'"})),T(o==="NWC",(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var f=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),h=Cn(d,f,[1,t],r,"NHWC",[1,i],a);return l?h.as2D(h.shape[2],h.shape[3]):h.as3D(h.shape[0],h.shape[2],h.shape[3])}}),Cn=B({conv2d_:function(e,n,t,r,o,i,a){o===void 0&&(o="NHWC"),i===void 0&&(i=[1,1]);var s=A(e,"x","conv2d"),u=A(n,"filter","conv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(c.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),T(u.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),a!=null&&T(it(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f=o==="NHWC"?c.shape[3]:c.shape[1];T(f===u.shape[2],(function(){return"Error in conv2d: depth of input ("+f+") must match input depth for filter "+u.shape[2]+"."})),T(Zt(t,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"}));var d=zl(o),h=So(c.shape,u.shape,t,i,r,a,!1,d),p=[u,c],v=W.runKernelFunc((function(m,g){var b=m.conv2d(c,u,h);return g([u,c]),b}),{x:c,filter:u},(function(m,g){var b=g,x=b[0],y=b[1];return T(pi(i),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"})),{x:function(){return Ag(y.shape,m,x,t,r,o)},filter:function(){return Jl(y,m,x.shape,t,r,o)}}}),"Conv2D",h,p);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),pS=B({conv3d_:function(e,n,t,r,o,i){o===void 0&&(o="NDHWC"),i===void 0&&(i=[1,1,1]);var a=A(e,"x","conv3d"),s=A(n,"filter","conv3d"),u=a,c=!1;a.rank===4&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),T(u.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),T(s.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),T(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),T((function(d,h){return Yu(d)||Yu(h)})(t,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),T(o==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=xs(u.shape,s.shape,t,i,r),f=W.runKernelFunc((function(d,h){var p=d.conv3d(u,s,l);return h([u,s]),p}),{x:u,$filter:s},(function(d,h){T(Yu(i),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}));var p=h[0],v=h[1];return{x:function(){return Ig(p.shape,d,v,t,r)},$filter:function(){return(function(m,g,b,x,y){var w=m;m.rank===4&&(w=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3]));var _=g;_.rank===4&&(_=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3])),T(w.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+w.shape+"."})),T(_.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+_.shape+"."})),T(b.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+b+"."})),T(w.shape[4]===b[3],(function(){return"Error in conv3dDerFilter: depth of input "+w.shape[4]+") must match input depth in filter ("+b[3]+"."})),T(_.shape[4]===b[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+_.shape[4]+") must match output depth for filter ("+b[4]+")."}));var S=xs(w.shape,b,x,1,y);return W.runKernelFunc((function(R){return R.conv3dDerFilter(w,_,S)}),{x5D:w,dy5D:_})})(p,d,v.shape,t,r)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Jl=B({conv2dDerFilter_:function(e,n,t,r,o,i,a){i===void 0&&(i="NHWC");var s=e;e.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=n;u.rank===3&&(u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),T(s.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),T(u.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),T(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];T(c===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+t[2]+"."})),T(l===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+t[3]+")."})),a!=null&&T(it(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var f=zl(i),d=So(s.shape,t,r,1,o,a,!1,f);return W.runKernelFunc((function(h){return h.conv2dDerFilter(s,u,d)}),{x4D:s,dy4D:u})}}),Ag=B({conv2dDerInput_:kg}),ru=B({depthwiseConv2d_:function(e,n,t,r,o,i,a){i===void 0&&(i=[1,1]);var s=A(e,"x","depthwiseConv2d"),u=A(n,"filter","depthwiseConv2d"),c=s,l=!1;s.rank===3&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),T(c.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),T(u.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),T(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),i==null&&(i=[1,1]),T(Zt(t,i),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+i+"'"})),a!=null&&T(it(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var f=So(c.shape,u.shape,t,i,r,a,!0),d=[c,u],h=W.runKernelFunc((function(p,v){var m=p.depthwiseConv2D(c,u,f);return v([c,u]),m}),{x:c,filter:u},(function(p,v){T(pi(i),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"}));var m=v[0],g=v[1];return{x:function(){return Tg(m.shape,p,g,f)},filter:function(){return Dg(m,p,g.shape,f)}}}),"DepthwiseConv2dNative",f,d);return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}}),Tg=B({depthwiseConv2dDerInput_:function(e,n,t,r){var o=n,i=!1;n.rank===3&&(i=!0,o=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=W.runKernelFunc((function(s){return s.depthwiseConv2DDerInput(o,t,r)}),{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),Dg=B({depthwiseConv2dDerFilter_:function(e,n,t,r){var o=e;e.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=n;return i.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2])),W.runKernelFunc((function(a){return a.depthwiseConv2DDerFilter(o,i,r)}),{x4D:o,dy4D:i})}}),Zl=B({separableConv2d_:function(e,n,t,r,o,i,a){i===void 0&&(i=[1,1]),a===void 0&&(a="NHWC");var s=A(e,"x","separableConv2d"),u=A(n,"depthwiseFilter","separableConv2d"),c=A(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");T(l.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),T(u.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),T(c.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),T(c.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),T(c.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var d=u.shape[2],h=u.shape[3];T(c.shape[2]===d*h,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*h+", but got "+c.shape[2]+"."}));var p=ru(l,u,r,o,a,i),v=Cn(p,c,1,"valid",a);return f?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),vS=B({conv2dTranspose_:function(e,n,t,r,o,i){return kg(t,A(e,"x","conv2dTranspose"),A(n,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),mS=B({conv3dTranspose_:function(e,n,t,r,o){return Ig(t,A(e,"x","conv3dTranspose"),A(n,"filter","conv3dTranspose"),r,o)}}),ou=B({matMul_:function(e,n,t,r){var o;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=A(e,"a","matMul"),a=A(n,"b","matMul");o=et(i,a),i=o[0],a=o[1];var s=t?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=t?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],f=i.shape.slice(0,-2),d=a.shape.slice(0,-2),h=ye(f),p=ye(d);T(i.rank>=2&&a.rank>=2&&i.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."})),T(wt(f,d),(function(){return"Error in matMul: outer dimensions ("+f+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."})),T(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var v=i.shape.slice(0,-2).concat([c,l]),m=t?i.as3D(h,s,c):i.as3D(h,c,s),g=r?a.as3D(p,l,u):a.as3D(p,u,l),b={transposeA:t,transposeB:r};return W.runKernelFunc((function(x,y){var w=x.batchMatMul(m,g,t,r);return y([m,g]),w}),{a:m,b:g},(function(x,y){var w=y,_=w[0],S=w[1];return t||r?!t&&r?{a:function(){return x.matMul(S,!1,!1)},b:function(){return x.matMul(_,!0,!1)}}:t&&!r?{a:function(){return S.matMul(x,!1,!0)},b:function(){return _.matMul(x,!1,!1)}}:{a:function(){return S.matMul(x,!0,!0)},b:function(){return x.matMul(_,!0,!0)}}:{a:function(){return x.matMul(S,!1,!0)},b:function(){return _.matMul(x,!0,!1)}}}),"BatchMatMul",b).reshape(v)}}),gS=B({dot_:function(e,n){var t=A(e,"t1","dot"),r=A(n,"t2","dot");T(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var o=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];return T(o===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),yS=B({outerProduct_:function(e,n){var t=A(e,"v1","outerProduct"),r=A(n,"v2","outerProduct");return T(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),da=B({reverse_:function(e,n){var t=A(e,"x","reverse");if(t.rank===0)return t.clone();var r=gt(n,t.shape);return W.runKernelFunc((function(o){return o.reverse(t,r)}),{$x:t},(function(o){return{$x:function(){return o.reverse(r)}}})).reshapeAs(t)}}),bS=B({reverse1d_:function(e){var n=A(e,"x","reverse");return T(n.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+n.rank+"."})),da(n,0)}}),xS=B({reverse2d_:function(e,n){var t=A(e,"x","reverse");return T(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),da(t,n)}}),wS=B({reverse3d_:function(e,n){var t=A(e,"x","reverse");return T(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),da(t,n)}}),_S=B({reverse4d_:function(e,n){var t=A(e,"x","reverse");return T(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),da(t,n)}});function Ng(e,n,t,r,o,i){var a=A(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),T(Zt(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),i!=null&&T(it(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Zi(s.shape,n,t,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&wt(c.inShape,c.outShape))return a.clone();var l=[s],f=W.runKernelFunc((function(d,h){var p=d.maxPool(s,c);return h([s,p]),p}),{x:s},(function(d,h){var p=h[0],v=h[1];return{x:function(){return(function(m,g,b,x,y,w,_,S){var R=A(m,"dy","maxPoolBackprop"),E=A(g,"input","maxPoolBackprop"),C=A(b,"output","maxPoolBackprop");T(E.rank===R.rank,(function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+R.rank+")"})),T(Zt(y,w),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+w+"'"})),T(R.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."})),T(E.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+E.rank+"."}));var I=Zi(E.shape,x,y,w,_,S);return W.runKernelFunc((function(k){return k.maxPoolBackprop(R,E,C,I)}),{$dy:R,$input:E})})(d,p,v,n,t,r,o)}}}),"MaxPool",c,l);return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function Fg(e,n,t,r,o,i){var a=A(e,"x","avgPool","float32");T(Zt(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(s.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),i!=null&&T(it(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var c=Zi(s.shape,n,t,r,o,i);if(c.filterWidth===1&&c.filterHeight===1&&wt(c.inShape,c.outShape))return a.clone();var l=W.runKernelFunc((function(f){return f.avgPool(s,c)}),{x:s},(function(f){return{x:function(){return(function(d,h,p,v,m,g){var b=A(d,"dy","avgPoolBackprop"),x=A(h,"input","avgPoolBackprop");T(x.rank===b.rank,(function(){return"Rank of input ("+x.rank+") does not match rank of dy ("+b.rank+")"})),T(Zt(v,m),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+m+"'"}));var y=x,w=b,_=!1;x.rank===3&&(_=!0,y=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]),w=b.as4D(1,b.shape[0],b.shape[1],b.shape[2])),T(w.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+w.rank+"."})),T(y.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+y.rank+"."}));var S=Zi(y.shape,p,v,m,g),R=W.runKernelFunc((function(E){return E.avgPoolBackprop(w,y,S)}),{dy4D:w,input4D:y});return _?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R})(f,s,n,t,r,o)}}}),"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var bt=B({maxPool_:function(e,n,t,r,o){return Ng(e,n,t,1,r,o)}}),ha=B({avgPool_:function(e,n,t,r,o){return Fg(e,n,t,1,r,o)}}),CS=B({pool_:function(e,n,t,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");var a=A(e,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),T(Zt(i,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"}));var c,l=Zi(s.shape,n,i,o,r),f=[l.dilationHeight,l.dilationWidth];c=r==="same"?(function(y,w){var _=y.map((function(E,C){return E+(E-1)*(w[C]-1)})).map((function(E){return E-1})),S=_.map((function(E){return Math.floor(E/2)})),R=_.map((function(E,C){return E-S[C]}));return _.map((function(E,C){return[S[C],R[C]]}))})([l.filterHeight,l.filterWidth],f):[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,h=(function(y,w,_){var S=_.map((function(P){return P[0]})),R=_.map((function(P){return P[1]})),E=y.concat(S,R),C=w.map((function(P,L){return(P-E[L]%P)%P})),I=R.map((function(P,L){return P+C[L]})),k=w.map((function(P,L){return[S[L],I[L]]})),M=w.map((function(P,L){return[0,C[L]]}));return[k,M]})([l.inHeight,l.inWidth],f,c),p=h[0],v=h[1],m=d?r:"valid",g=d?s:Wm(s,f,p),b=(t==="avg"?function(){return Fg(g,n,i,1,m)}:function(){return Ng(g,n,i,1,m)})(),x=d?b:Om(b,f,v);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),ES=B({maxPool3d_:function(e,n,t,r,o,i,a){i===void 0&&(i="NDHWC");var s=A(e,"x","maxPool3d"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),T(i==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),T(Zt(t,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),o!=null&&T(it(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=bs(u.shape,n,t,a,r,o,i),f=W.runKernelFunc((function(d,h){var p=d.maxPool3d(u,l);return h([u,p]),p}),{x:u},(function(d,h){var p=h[0],v=h[1];return{x:function(){return(function(m,g,b,x,y,w,_,S){var R=A(m,"dy","maxPool3dBackprop"),E=A(g,"input","maxPool3dBackprop"),C=A(b,"output","maxPool3dBackprop"),I=R,k=E,M=C,P=!1;E.rank===4&&(P=!0,I=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3]),k=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3]),M=C.as5D(1,C.shape[0],C.shape[1],C.shape[2],C.shape[3])),T(I.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+I.rank+"."})),T(k.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."})),T(M.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+M.rank+"."})),w==null&&(w=[1,1,1]),T(Zt(y,w),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+y+" and dilations '"+w+"'"})),S!=null&&T(it(_),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+S+" but got pad "+_+"."}));var L=bs(k.shape,x,y,w,_,S),q=W.runKernelFunc((function(V){return V.maxPool3dBackprop(I,k,M,L)}),{dy5D:I,input5D:k});return P?q.as4D(q.shape[1],q.shape[2],q.shape[3],q.shape[4]):q})(d,p,v,n,t,a,r,o)}}}));return c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),SS=B({avgPool3d_:function(e,n,t,r,o,i,a){i===void 0&&(i="NDHWC");var s=A(e,"x","avgPool3d","float32"),u=s,c=!1;s.rank===4&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),T(u.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),T(i==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i})),T(Zt(t,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),o!=null&&T(it(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=bs(u.shape,n,t,a,r,o,i),f=W.runKernelFunc((function(d){return d.avgPool3d(u,l)}),{x:u},(function(d){return{x:function(){return(function(h,p,v,m,g,b,x){var y=A(h,"dy","avgPool3dBackprop"),w=A(p,"input","avgPool3dBackprop"),_=y,S=w,R=!1;w.rank===4&&(R=!0,_=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),S=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3])),T(_.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+_.rank+"."})),T(S.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+S.rank+"."})),g==null&&(g=[1,1,1]),T(Zt(m,g),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+m+" and dilations '"+g+"'"})),x!=null&&T(it(b),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+x+" but got pad "+b+"."}));var E=bs(S.shape,v,m,g,b,x),C=W.runKernelFunc((function(I){return I.avgPool3dBackprop(_,S,E)}),{dy5D:_,input5D:S});return R?C.as4D(C.shape[1],C.shape[2],C.shape[3],C.shape[4]):C})(d,u,n,t,a,r,o)}}}));return f=f.cast(u.dtype),c?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}}),Qn=B({slice_:function(e,n,t){var r,o,i=A(e,"x","slice");if(i.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof n=="number"?[n].concat(new Array(i.rank-1).fill(0)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(0)):n.slice()).forEach((function(u){T(u!==-1,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=t==null?new Array(i.rank).fill(-1):typeof t=="number"?[t].concat(new Array(i.rank-1).fill(-1)):t.length<i.rank?t.concat(new Array(i.rank-t.length).fill(-1)):t).map((function(u,c){return u>=0?u:(T(u===-1,(function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+c+"."})),i.shape[c]-r[c])})),Z_(i,r,o);var a=i.shape,s={begin:r,size:o};return W.runKernelFunc((function(u){return u.slice(i,r,o)}),{x:i},(function(u){for(var c=[],l=0;l<u.rank;l++)c.push([r[l],a[l]-r[l]-o[l]]);return{x:function(){return u.pad(c)}}}),"Slice",s)}}),RS=B({slice1d_:function(e,n,t){var r=A(e,"x","slice1d");return T(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Qn(r,[n],[t])}}),kS=B({slice2d_:function(e,n,t){var r=A(e,"x","slice2d");return T(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Qn(r,n,t)}}),Pg=B({slice3d_:function(e,n,t){var r=A(e,"x","slice3d");return T(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Qn(r,n,t)}}),IS=B({slice4d_:function(e,n,t){var r=A(e,"x","slice4d");return T(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Qn(r,n,t)}});function Mg(e,n,t,r,o){return n.rank<t.rank&&(n=n.reshape(Jt(n.shape,r))),e.rank<t.rank&&(e=e.reshape(Jt(e.shape,r))),{x:function(){var i=e.mul(t.equal(n).cast(e.dtype));return o==null?i:i.transpose(o)}}}var AS=B({all_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","all","bool"),o=gt(n,r.shape),i=o,a=er(i,r.rank);a!=null&&(r=r.transpose(a),i=tr(i.length,r.rank));var s=W.runKernelFunc((function(c){return c.all(r,i)}),{$x:r});if(t){var u=Jt(s.shape,o);return s.reshape(u)}return s}}),TS=B({any_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","any","bool"),o=gt(n,r.shape),i=o,a=er(i,r.rank);a!=null&&(r=r.transpose(a),i=tr(i.length,r.rank));var s=W.runKernelFunc((function(c){return c.any(r,i)}),{$x:r});if(t){var u=Jt(s.shape,o);return s.reshape(u)}return s}}),DS=B({argMax_:function(e,n){n===void 0&&(n=0);var t=A(e,"x","argMax");n==null&&(n=0);var r=gt(n,t.shape),o=er(r,t.rank);o!=null&&(t=t.transpose(o),r=tr(r.length,t.rank));var i={axis:r[0]},a=[t];return W.runKernelFunc((function(s,u){var c=s.argMax(t,r[0]);return u([t]),c}),{x:t},(function(s,u){var c=u[0];return{x:function(){return Le(c)}}}),"ArgMax",i,a)}}),NS=B({argMin_:function(e,n){n===void 0&&(n=0);var t=A(e,"x","argMin");n==null&&(n=0);var r=gt(n,t.shape),o=er(r,t.rank);return o!=null&&(t=t.transpose(o),r=tr(r.length,t.rank)),W.runKernelFunc((function(i,a){var s=i.argMin(t,r[0]);return a([t]),s}),{$x:t},(function(i,a){var s=a[0];return{$x:function(){return Le(s)}}}))}}),FS=B({logSumExp_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","logSumExp"),o=gt(n,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(t){var u=Jt(s.shape,o);return s.reshape(u)}return s}}),iu=B({max_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","max"),o=r,i=gt(n,r.shape),a=i,s=er(a,r.rank);s!=null&&(r=r.transpose(s),a=tr(a.length,r.rank));var u=[r],c=W.runKernelFunc((function(f,d){var h=f.max(r,a);return d([o,h]),h}),{x:r},(function(f,d){return Mg(f,d[1],d[0],i,s)}),"Max",{axes:a},u,[!0]);if(t){var l=Jt(c.shape,i);c=c.reshape(l)}return c}}),PS=B({mean_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","mean"),o=gt(n,r.shape),i=ye(Tt(r.shape,o)[1]);return eu((function(a){var s=de(i);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(n,t),gradFunc:function(u){var c=a.shape.slice();return o.forEach((function(l){c[l]=1})),u.reshape(c).mul(yi(a.shape,"float32")).div(i)}}}))(r)}}),MS=B({min_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","min"),o=r,i=gt(n,r.shape),a=i,s=er(a,r.rank);s!=null&&(r=r.transpose(s),a=tr(a.length,r.rank));var u=[r],c=W.runKernelFunc((function(f,d){var h=f.min(r,a);return d([o,h]),h}),{x:r},(function(f,d){return Mg(f,d[1],d[0],i,s)}),"Min",{axes:a},u,[!0]);if(t){var l=Jt(c.shape,i);c=c.reshape(l)}return c}}),OS=B({moments_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=gt(n,(e=A(e,"x","moments")).shape),o=e.mean(r,t),i=o.shape;t||(i=Jt(o.shape,r));var a=e.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,t)}}}),Og=B({sum_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","sum");r.dtype==="bool"&&(r=r.toInt());var o=gt(n,r.shape);return eu((function(i){var a=er(o,i.rank),s=o,u=i;a!=null&&(u=i.transpose(a),s=tr(s.length,i.rank));var c=function(h){var p=i.shape.slice();return o.forEach((function(v){p[v]=1})),h.reshape(p).mul(yi(i.shape,"float32"))},l={axes:s},f=W.runKernelFunc((function(h){return h.sum(u,s)}),{x:u},(function(h){return{x:function(){return c(h)}}}),"Sum",l);if(t){var d=Jt(f.shape,o);f=f.reshape(d)}return{value:f,gradFunc:c}}))(r)}}),BS=B({prod_:function(e,n,t){n===void 0&&(n=null),t===void 0&&(t=!1);var r=A(e,"x","prod");r.dtype==="bool"&&(r=r.toInt());var o=gt(n,r.shape),i=er(o,r.rank),a=o,s=r;i!=null&&(s=r.transpose(i),a=tr(a.length,r.rank));var u=W.runKernelFunc((function(l){return l.prod(s,a)}),{permutedX:s});if(t){var c=Jt(u.shape,o);u=u.reshape(c)}return u}}),Bg=B({elu_:function(e){var n=A(e,"x","elu");return W.runKernelFunc((function(t,r){var o=t.elu(n);return r([o]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){return W.runKernelFunc((function(i){return i.eluDer(t,o)}),{dy:t,y:o})}}}))}}),LS=B({leakyRelu_:function(e,n){n===void 0&&(n=.2);var t=A(e,"x","leakyRelu");return Yl(de(n).mul(t),t)}}),Lg=B({prelu_:function(e,n){var t=A(e,"x","prelu"),r=A(n,"alpha","prelu");return W.runKernelFunc((function(o,i){var a=o.prelu(t,r);return i([t,r]),a}),{x:t,alpha:r},(function(o,i){var a=i[0],s=i[1],u=a.greater(0);return{x:function(){return xo(u,o,o.mul(s))},alpha:function(){var c=xo(u,Le(o),o.mul(a)),l=vt(s.shape,o.shape);return l.length>0&&(c=c.sum(l)),c.reshape(s.shape)}}}),"Prelu")}}),Ze=B({relu_:function(e){var n=A(e,"x","relu");return n.dtype==="bool"?n.toInt():W.runKernelFunc((function(t,r){var o=t.relu(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0];return{x:function(){return t.mulStrict(o.step().toFloat())}}}),"Relu")}}),Wg=B({relu6_:function(e){var n=A(e,"x","relu6");return n.dtype==="bool"?n.toInt():W.runKernelFunc((function(t,r){var o=t.relu6(n);return r([n]),o}),{x:n},(function(t,r){var o=r[0],i=o.lessEqual(6).mul(o.step());return{x:function(){return t.mulStrict(i.toFloat())}}}),"Relu6")}}),WS=B({selu_:function(e){var n=A(e,"x","selu");return W.runKernelFunc((function(t,r){var o=t.selu(n);return r([n]),o}),{$x:n},(function(t,r){var o=r[0];return{$x:function(){var i=o.greater(de(0)),a=de($l),s=de(Kl),u=t.mul(s),c=t.mul(a).mul(o.toFloat().exp());return xo(i,u,c)}}}))}}),Gr=B({transpose_:function(e,n){var t=A(e,"x","transpose");if(n==null&&(n=t.shape.map((function(o,i){return i})).reverse()),T(t.rank===n.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+n+"."})),n.forEach((function(o){T(o>=0&&o<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+n}))})),t.rank<=1)return t.clone();var r={perm:n};return W.runKernelFunc((function(o){return o.transpose(t,n)}),{x:t},(function(o){var i=Bl(n);return{x:function(){return o.transpose(i)}}}),"Transpose",r)}}),VS=B({localResponseNormalization_:function(e,n,t,r,o){n===void 0&&(n=5),t===void 0&&(t=1),r===void 0&&(r=1),o===void 0&&(o=.5);var i=A(e,"x","localResponseNormalization");T(i.rank===4||i.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."})),T(it(n),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+n+"."}));var a=i,s=!1;i.rank===3&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=W.runKernelFunc((function(c,l){var f=c.localResponseNormalization4D(a,n,t,r,o);return l([a,f]),f}),{x4D:a},(function(c,l){var f=l[0],d=l[1];return{x4D:function(){return W.runKernelFunc((function(h){return h.LRNGrad(c,f,d,n,t,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Vg=B({norm_:function(e,n,t,r){n===void 0&&(n="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var o=(function s(u,c,l){if(l===void 0&&(l=null),u.rank===0)return u.abs();if(u.rank!==1&&l===null)return s(u.reshape([-1]),c,l);if(u.rank===1||typeof l=="number"||Array.isArray(l)&&l.length===1){if(c===1)return u.abs().sum(l);if(c===1/0)return u.abs().max(l);if(c===-1/0)return u.abs().min(l);if(c==="euclidean"||c===2)return u.abs().pow(de(2,"int32")).sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}if(Array.isArray(l)&&l.length===2){if(c===1)return u.abs().sum(l[0]).max(l[1]-1);if(c===1/0)return u.abs().sum(l[1]).max(l[0]);if(c===-1/0)return u.abs().sum(l[1]).min(l[0]);if(c==="fro"||c==="euclidean")return u.square().sum(l).sqrt();throw new Error("Error in norm: invalid ord value: "+c)}throw new Error("Error in norm: invalid axis: "+l)})(e=A(e,"x","norm"),n,t),i=o.shape;if(r){var a=gt(t,e.shape);i=Jt(o.shape,a)}return o.reshape(i)}}),US=B({basicLSTMCell_:function(e,n,t,r,o,i){var a=A(e,"forgetBias","basicLSTMCell"),s=A(n,"lstmKernel","basicLSTMCell"),u=A(t,"lstmBias","basicLSTMCell"),c=A(r,"data","basicLSTMCell"),l=A(o,"c","basicLSTMCell"),f=A(i,"h","basicLSTMCell"),d=c.concat(f,1).matMul(s).add(u),h=d.shape[0],p=d.shape[1]/4,v=[h,p],m=d.slice([0,0],v),g=d.slice([0,p],v),b=d.slice([0,2*p],v),x=d.slice([0,3*p],v),y=m.sigmoid().mulStrict(g.tanh()).addStrict(l.mulStrict(a.add(b).sigmoid())),w=y.tanh().mulStrict(x.sigmoid());return[y,w]}}),zS=B({multiRNNCell_:function(e,n,t,r){for(var o=A(n,"data","multiRNNCell"),i=hs(t,"c","multiRNNCell"),a=hs(r,"h","multiRNNCell"),s=o,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var f=[],d=[];for(c=0;c<u.length;c+=2)f.push(u[c]),d.push(u[c+1]);return[f,d]}}),qS=B({movingAverage_:function(e,n,t,r,o){o===void 0&&(o=!0);var i=A(e,"v","movingAverage"),a=A(n,"x","movingAverage"),s=A(t,"decay","movingAverage");V1(i,a),T(wt(i.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=de(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){T(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var f=A(r,"step","movingAverage");l=l.div(u.sub(Cs(s,f)))}return i.add(l)}}),HS=B({stridedSlice_:function(e,n,t,r,o,i,a,s,u){if(o===void 0&&(o=0),i===void 0&&(i=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(n.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var c=A(e,"x","stridedSlice"),l=ch(s),f=c.shape.slice();l.forEach((function(m){n[m]=0,t[m]=1,f.splice(m,0,1)})),c=c.reshape(f);for(var d=0;d<c.rank;d++)n[d]=e2(o,n,r,c.shape,d),t[d]=t2(i,t,r,c.shape,d),r[d]=r[d]||1;var h=ch(u);h.forEach((function(m){t[m]=n[m]+1,r[m]=1}));var p=Ul(n,t,r),v=p.filter((function(m,g){return h.indexOf(g)===-1}));return r.every((function(m){return m===1}))?Qn(c,n,p).reshape(v):W.runKernelFunc((function(m){return m.stridedSlice(c,n,t,r)}),{$x:c}).reshape(v)}}),GS=B({topk_:function(e,n,t){n===void 0&&(n=1),t===void 0&&(t=!0);var r=A(e,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(n>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+n);var i=W.runKernelFunc((function(a){return a.topk(r,n,t)}),{$x:r});return{values:i[0],indices:i[1]}}}),jS=B({scatterND_:function(e,n,t){var r=A(e,"indices","scatterND","int32"),o=A(n,"updates","scatterND");return J_(o,r,t),W.runKernelFunc((function(i){return i.scatterND(r,o,t)}),{indices:r,updates:o},null,"ScatterNd",{shape:t})}}),ef=B({fft_:function(e){T(e.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return W.runKernelFunc((function(o){return o.fft(r)}),{input:e}).reshape(e.shape)}}),Es=B({ifft_:function(e){T(e.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var n=e.shape[e.shape.length-1],t=e.size/n,r=e.as2D(t,n);return W.runKernelFunc((function(o){return o.ifft(r)}),{input:e}).reshape(e.shape)}}),tf=B({rfft_:function(e,n){T(e.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var t,r=e.shape[e.shape.length-1],o=e.size/r;if(n!=null&&n<r){var i=e.shape.map((function(g){return 0})),a=e.shape.map((function(g){return g}));a[e.shape.length-1]=n,t=e.slice(i,a),r=n}else if(n!=null&&n>r){var s=e.shape.map((function(g){return g}));s[e.shape.length-1]=n-r,t=e.concat(Ye(s),e.shape.length-1),r=n}else t=e;var u=t.zerosLike(),c=St(t,u).as2D(o,r),l=ef(c),f=Math.floor(r/2)+1,d=yn(l),h=qn(l),p=d.split([f,r-f],d.shape.length-1),v=h.split([f,r-f],h.shape.length-1),m=t.shape.slice();return m[t.shape.length-1]=f,St(p[0],v[0]).reshape(m)}}),Ug=B({irfft_:function(e){var n=e.shape[e.shape.length-1],t=e.size/n;if(n<=2){var r=e.as2D(t,n),o=Es(r);return yn(o)}var i=[t,2*(n-1)],a=yn(e).as2D(t,n),s=qn(e).as2D(t,n),u=a.slice([0,1],[t,n-2]).reverse(1),c=s.slice([0,1],[t,n-2]).reverse(1).mul(de(-1)),l=a.concat(u,1),f=s.concat(c,1);return r=St(l,f).as2D(i[0],i[1]),o=Es(r),yn(o)}}),$S=Object.freeze({fft:ef,ifft:Es,rfft:tf,irfft:Ug}),KS=B({sparseToDense_:function(e,n,t,r){r===void 0&&(r=0);var o=A(e,"sparseIndices","sparseToDense","int32"),i=A(n,"sparseValues","sparseToDense"),a=A(r,"defaultValue","sparseToDense",i.dtype);return(function(s,u,c,l){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var f=s.rank>0?s.shape[0]:1,d=s.rank>1?s.shape[1]:1;if(c.length!==d)throw new Error("outputShape has incorrect number of elements:, "+c.length+", should be: "+d+".");var h=u.size;if(u.rank!==0&&(u.rank!==1||h!==f))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+f+"]");if(u.dtype!==l.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(o,i,t,a),W.runKernelFunc((function(s){return s.sparseToDense(o,i,t,a)}),{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),XS=B({gatherND_:function(e,n){var t=A(n,"indices","gatherND","int32"),r=A(e,"x","gatherND");return W.runKernelFunc((function(o){return o.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),YS=B({diag_:function(e){var n=A(e,"x","diag").flatten(),t=e.shape.concat(e.shape);return W.runKernelFunc((function(r){return r.diag(n)}),{$x:n}).reshape(t)}}),QS=B({dropout_:function(e,n,t,r){var o=A(e,"x","dropout");if(T(o.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),T(n>=0&&n<1,(function(){return"rate must be a float in the range [0, 1), but got "+n+"."})),n===0)return e instanceof Je?o.clone():o;var i=(function(u,c){if(c==null)return u.shape.slice();if(wt(u.shape,c))return c;if(u.shape.length===c.length){for(var l=[],f=0;f<u.shape.length;f++)c[f]==null&&u.shape[f]!=null?l.push(u.shape[f]):l.push(c[f]);return l}return c})(o,t),a=1-n,s=Lm(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function zg(e,n,t){for(var r=1-e%2,o=new Float32Array(e),i=0;i<e;++i){var a=2*Math.PI*i/(e+r-1);o[i]=n-t*Math.cos(a)}return st(o,"float32")}var nf=B({hannWindow_:function(e){return zg(e,.5,.5)}}),qg=B({hammingWindow_:function(e){return zg(e,.54,.46)}}),rf=B({frame_:function(e,n,t,r,o){r===void 0&&(r=!1),o===void 0&&(o=0);for(var i=0,a=[];i+n<=e.size;)a.push(Qn(e,i,n)),i+=t;if(r)for(;i<e.size;){var s=i+n-e.size,u=dt([Qn(e,i,n-s),Yn([s],o)]);a.push(u),i+=t}return a.length===0?Ur([],[0,n]):dt(a).as2D(a.length,n)}}),Hg=B({stft_:function(e,n,t,r,o){var i;o===void 0&&(o=nf),r==null&&(i=n,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=rf(e,n,t),s=Ot(a,o(n)),u=[],c=0;c<a.shape[0];c++)u.push(tf(s.slice([c,0],[1,n]),r));return dt(u)}}),JS=Object.freeze({hannWindow:nf,hammingWindow:qg,frame:rf,stft:Hg}),Mt,ZS=function(e,n,t){return t===void 0&&(t=1),me(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f,d,h,p,v,m;return ge(this,(function(g){switch(g.label){case 0:return r=A(e,"predictions","inTopK"),o=A(n,"targets","inTopK"),T(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),T(r.rank-1===o.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank})),He(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],T(t>0&&t<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+t})),[4,r.data()];case 1:return a=g.sent(),[4,o.data()];case 2:for(s=g.sent(),u=[a.length/i,i],l=u[1],f=Yi("bool",c=u[0]),d=0;d<c;d++){for(h=d*l,p=a.subarray(h,h+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort((function(b,x){return x.value-b.value})),f[d]=0,m=0;m<t;m++)if(v[m].index===s[d]){f[d]=1;break}}return e!==r&&r.dispose(),n!==o&&o.dispose(),[2,kt(f,o.shape,"bool")]}}))}))};(function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mt||(Mt={}));var eR=B({absoluteDifference_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=A(e,"labels","absoluteDifference"),i=A(n,"predictions","absoluteDifference"),a=null;t!=null&&(a=A(t,"weights","absoluteDifference")),He(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return _r(s,a,r)}}),_r=B({computeWeightedLoss_:function(e,n,t){t===void 0&&(t=Mt.SUM_BY_NONZERO_WEIGHTS);var r=A(e,"losses","computeWeightedLoss"),o=null;n!=null&&(o=A(n,"weights","computeWeightedLoss"));var i=o==null?r:r.mul(o);if(t===Mt.NONE)return i;if(t===Mt.SUM)return i.sum();if(t===Mt.MEAN){if(o==null)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(de(a)):s}if(t===Mt.SUM_BY_NONZERO_WEIGHTS){if(o==null)return i.sum().div(de(r.size));var u=o.mul(yi(r.shape)).notEqual(de(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+t)}}),tR=B({cosineDistance_:function(e,n,t,r,o){o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=A(e,"labels","cosineDistance"),a=A(n,"predictions","cosineDistance"),s=null;r!=null&&(s=A(r,"weights","cosineDistance")),He(i.shape,a.shape,"Error in cosineDistance: ");var u=de(1).sub(i.mul(a).sum(t,!0));return _r(u,s,o)}}),nR=B({hingeLoss_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=A(e,"labels","hingeLoss"),i=A(n,"predictions","hingeLoss"),a=null;t!=null&&(a=A(t,"weights","hingeLoss")),He(o.shape,i.shape,"Error in hingeLoss: ");var s=de(1);o=de(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return _r(u,a,r)}}),rR=B({huberLoss_:function(e,n,t,r,o){r===void 0&&(r=1),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=A(e,"labels","huberLoss"),a=A(n,"predictions","huberLoss"),s=null;t!=null&&(s=A(t,"weights","huberLoss")),He(i.shape,a.shape,"Error in huberLoss: ");var u=de(r),c=a.sub(i).abs(),l=Cg(c,u),f=c.sub(l),d=de(.5).mul(l.square()).add(u.mul(f));return _r(d,s,o)}}),oR=B({logLoss_:function(e,n,t,r,o){r===void 0&&(r=1e-7),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=A(e,"labels","logLoss"),a=A(n,"predictions","logLoss"),s=null;t!=null&&(s=A(t,"weights","logLoss")),He(i.shape,a.shape,"Error in logLoss: ");var u=de(1),c=de(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return _r(l,s,o)}}),iR=B({meanSquaredError_:function(e,n,t,r){r===void 0&&(r=Mt.SUM_BY_NONZERO_WEIGHTS);var o=A(e,"labels","meanSquaredError"),i=A(n,"predictions","meanSquaredError"),a=null;t!=null&&(a=A(t,"weights","meanSquaredError")),He(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return _r(s,a,r)}}),aR=B({sigmoidCrossEntropy_:function(e,n,t,r,o){r===void 0&&(r=0),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=A(e,"multiClassLabels","sigmoidCrossEntropy"),a=A(n,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=A(t,"weights","sigmoidCrossEntropy")),He(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=de(r),c=de(1),l=de(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var f=(function(d,h){var p=A(d,"labels","sigmoidCrossEntropyWithLogits"),v=A(h,"logits","sigmoidCrossEntropyWithLogits");He(p.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var m=v.relu(),g=v.mul(p),b=v.abs().neg().exp().log1p();return m.sub(g).add(b)})(i,a);return _r(f,s,o)}}),sR=B({softmaxCrossEntropy_:function(e,n,t,r,o){r===void 0&&(r=0),o===void 0&&(o=Mt.SUM_BY_NONZERO_WEIGHTS);var i=A(e,"onehotLabels","softmaxCrossEntropy"),a=A(n,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=A(t,"weights","softmaxCrossEntropy")),He(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=de(r),c=de(1),l=de(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var f=(function(d,h,p){if(p===void 0&&(p=-1),p===-1&&(p=h.rank-1),p!==h.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+h.rank+" and dim was "+p);return eu((function(v,m,g){var b=m.logSumExp([p],!0),x=m.toFloat().sub(b);return g([v,x]),{value:x.mul(v).neg().sum([p]),gradFunc:function(y,w){var _=w[0],S=w[1],R=Jt(y.shape,[p]);return[y.reshape(R).mul(_.toFloat().sub(S.exp())),y.reshape(R).mul(S.exp().sub(_.toFloat()))]}}}))(d,h)})(i,a);return _r(f,s,o)}}),uR=Object.freeze({get Reduction(){return Mt},absoluteDifference:eR,computeWeightedLoss:_r,cosineDistance:tR,hingeLoss:nR,huberLoss:rR,logLoss:oR,meanSquaredError:iR,sigmoidCrossEntropy:aR,softmaxCrossEntropy:sR});function Dh(e,n){return n===void 0&&(n=!1),W.tidy((function(){if(e.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var t=e.shape[0],r=e.shape[1],o=Bm(t),i=e.clone(),a=Ur([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,c=function(f){var d,h=i,p=s,v=o;d=W.tidy((function(){var m=i.slice([f,f],[t-f,1]),g=m.norm(),b=i.slice([f,f],[1,1]),x=Ur([[-1]]).where(b.greater(0),Ur([[1]])),y=b.sub(x.mul(g)),w=m.div(y);s=w.shape[0]===1?a.clone():a.concat(w.slice([1,0],[w.shape[0]-1,w.shape[1]]),0);var _=x.matMul(y).div(g).neg(),S=i.slice([f,0],[t-f,r]),R=_.mul(s);if(f===0)i=S.sub(R.matMul(s.transpose().matMul(S)));else{var E=S.sub(R.matMul(s.transpose().matMul(S)));i=i.slice([0,0],[f,r]).concat(E,0)}var C=o.slice([0,f],[t,o.shape[1]-f]);if(f===0)o=C.sub(C.matMul(s).matMul(R.transpose()));else{var I=C.sub(C.matMul(s).matMul(R.transpose()));o=o.slice([0,0],[t,f]).concat(I,1)}return[s,i,o]})),s=d[0],i=d[1],o=d[2],Yt([h,p,v])},l=0;l<u;++l)c(l);return!n&&t>r&&(o=o.slice([0,0],[t,r]),i=i.slice([0,0],[r,r])),[o,i]}))}var cR=B({bandPart_:function(e,n,t){if(n%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+n+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=A(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(n<=a))throw new Error("bandPart(): numLower ("+n+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");n<0&&(n=a),t<0&&(t=s);var u=ps(0,a,1,"int32").reshape([-1,1]),c=ps(0,s,1,"int32"),l=mt(u,c),f=nu(l.lessEqual(de(+n,"int32")),l.greaterEqual(de(-t,"int32"))),d=Ye([a,s],r.dtype);return ln(ht(r.reshape([-1,a,s])).map((function(h){return xo(f,h,d)}))).reshape(o)}}),lR=B({gramSchmidt_:function(e){var n;if(Array.isArray(e)){n=!1,T(e!=null&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=e[0].shape[0],r=function(u){T(e[u].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[u].shape[0]+" vs. "+t+")"}))},o=1;o<e.length;++o)r(o)}else n=!0,e=Wl(e,e.shape[0],0).map((function(u){return Vm(u,[0])}));T(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var i=[],a=e,s=function(u){i.push(W.tidy((function(){var c=a[u];if(u>0)for(var l=0;l<u;++l){var f=Og(i[l].mulStrict(c)).mul(i[l]);c=c.sub(f)}return c.div(Vg(c,"euclidean"))})))};for(o=0;o<e.length;++o)s(o);return n?ln(i,0):i}}),fR=B({qr_:function(e,n){if(n===void 0&&(n=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(e.rank===2)return Dh(e,n);var t=e.shape.slice(0,e.shape.length-2).reduce((function(a,s){return a*s})),r=ht(e.reshape([t,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),o=[],i=[];return r.forEach((function(a){var s=Dh(a,n),u=s[0],c=s[1];o.push(u),i.push(c)})),[ln(o,0).reshape(e.shape),ln(i,0).reshape(e.shape)]}}),dR=Object.freeze({bandPart:cR,gramSchmidt:lR,qr:fR});function au(e,n,t,r,o,i){r==null&&(r=.5),o==null&&(o=Number.NEGATIVE_INFINITY),i==null&&(i=0);var a=e.shape[0];return t=Math.min(t,a),T(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),T(e.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),T(e.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),T(n.rank===1,(function(){return"scores must be a 1D tensor"})),T(n.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+n.shape[0]})),T(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var hR=B({resizeBilinear_:function(e,n,t){t===void 0&&(t=!1);var r=A(e,"images","resizeBilinear");T(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(n.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+n+"."}));var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=W.runKernelFunc((function(c,l){return l([o]),c.resizeBilinear(o,a,s,t)}),{x:o},(function(c,l){return{x:function(){return W.runKernelFunc((function(f){return f.resizeBilinearBackprop(c,l[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),pR=B({resizeNearestNeighbor_:function(e,n,t){t===void 0&&(t=!1);var r=A(e,"images","resizeNearestNeighbor");T(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),T(n.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+n+"."})),T(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,i=!1;r.rank===3&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=n[0],s=n[1],u=W.runKernelFunc((function(c,l){return l([o]),c.resizeNearestNeighbor(o,a,s,t)}),{batchImages:o},(function(c,l){return{batchImages:function(){return W.runKernelFunc((function(f){return f.resizeNearestNeighborBackprop(c,l[0],t)}),{})}}}));return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),vR=B({nonMaxSuppression_:function(e,n,t,r,o){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY);var i=A(e,"boxes","nonMaxSuppression"),a=A(n,"scores","nonMaxSuppression"),s=au(i,a,t,r,o);t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:o};return W.runKernelFunc((function(c){return c.nonMaxSuppression(i,a,t,r,o)}),{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),mR=function(e,n,t,r,o){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),me(this,void 0,void 0,(function(){var i,a,s,u,c,l,f;return ge(this,(function(d){switch(d.label){case 0:return i=A(e,"boxes","nonMaxSuppressionAsync"),a=A(n,"scores","nonMaxSuppressionAsync"),s=au(i,a,t,r,o),t=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],f=ql(c,l,t,r,o),i!==e&&i.dispose(),a!==n&&a.dispose(),[2,f]}}))}))},gR=B({nonMaxSuppressionWithScore_:function(e,n,t,r,o,i){r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var a=A(e,"boxes","nonMaxSuppression"),s=A(n,"scores","nonMaxSuppression"),u=au(a,s,t,r,o,i),c={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=W.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),yR=function(e,n,t,r,o,i){return r===void 0&&(r=.5),o===void 0&&(o=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),me(this,void 0,void 0,(function(){var a,s,u,c,l,f,d;return ge(this,(function(h){switch(h.label){case 0:return a=A(e,"boxes","nonMaxSuppressionAsync"),s=A(n,"scores","nonMaxSuppressionAsync"),u=au(a,s,t,r,o,i),t=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),l=c[0],f=c[1],d=Hl(l,f,t,r,o,i),a!==e&&a.dispose(),s!==n&&s.dispose(),[2,d]}}))}))},bR=B({cropAndResize_:function(e,n,t,r,o,i){var a=A(e,"image","cropAndResize"),s=A(n,"boxes","cropAndResize","float32"),u=A(t,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return T(a.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),T(s.rank===2&&s.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),T(u.rank===1&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),T(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),T(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),T(o==="bilinear"||o==="nearest",(function(){return"method must be bilinear or nearest, but was "+o})),W.runKernelFunc((function(l,f){return l.cropAndResize(a,s,u,r,o,i)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),of=Object.freeze({resizeBilinear:hR,resizeNearestNeighbor:pR,nonMaxSuppression:vR,nonMaxSuppressionAsync:mR,nonMaxSuppressionWithScore:gR,nonMaxSuppressionWithScoreAsync:yR,cropAndResize:bR}),af=function(e,n){return!(e>0)||n==="linear"},sf=function(e,n,t){if(t==null||t==="linear")return e;if(t==="relu")return e.mul(n.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},uf=function(e,n){var t=n,r=vt(e.shape,n.shape);return r.length>0&&(t=t.sum(r)),t.reshape(e.shape)},cf=function(e,n,t){if(n==="linear")return e;if(n==="relu")return Ze(e);if(n==="elu")return Bg(e);if(n==="relu6")return Wg(e);if(n==="prelu")return Lg(e,t);throw new Error("Unknown fused activation "+n+".")},xR=B({fusedMatMul_:function(e){var n,t=e.a,r=e.b,o=e.transposeA,i=o!==void 0&&o,a=e.transposeB,s=a!==void 0&&a,u=e.bias,c=e.activation,l=c===void 0?"linear":c,f=e.preluActivationWeights;if(af(W.state.gradientDepth,l)===!1){var d=ou(t,r,i,s);return u!=null&&(d=Oe(d,u)),cf(d,l,f)}var h=A(t,"a","fused matMul"),p=A(r,"b","fused matMul");n=et(h,p),h=n[0],p=n[1];var v=i?h.shape[h.rank-2]:h.shape[h.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=i?h.shape[h.rank-1]:h.shape[h.rank-2],b=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=h.shape.slice(0,-2),y=p.shape.slice(0,-2),w=ye(x),_=ye(y);T(h.rank>=2&&p.rank>=2&&h.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+h.rank+" and "+p.rank+"."})),T(wt(x,y),(function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+y+") of Tensors with shapes "+h.shape+" and "+p.shape+" must match."})),T(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+h.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."}));var S,R,E=h.shape.slice(0,-2).concat([g,b]),C=i?h.as3D(w,v,g):h.as3D(w,g,v),I=s?p.as3D(_,b,m):p.as3D(_,m,b);u!=null&&Be(E,(S=et(S=A(u,"bias","fused matMul"),h)[0]).shape),f!=null&&(R=A(f,"prelu weights","fused matMul"));var k={a:C,b:I};u!=null&&(k.bias=S),f!=null&&(k.preluActivationWeights=R);var M=[C,I];return W.runKernelFunc((function(P,L){var q=P.fusedBatchMatMul({a:C,b:I,transposeA:i,transposeB:s,bias:S,activation:l,preluActivationWeights:R});return L([C,I,q]),q}),k,(function(P,L){var q=L[0],V=L[1],F=L[2],H=sf(P,F,l),$={};return u!=null&&($={bias:function(){return uf(S,H)}}),Object.assign(i||s?!i&&s?{a:function(){return H.matMul(V,!1,!1)},b:function(){return H.matMul(q,!0,!1)}}:i&&!s?{a:function(){return V.matMul(H,!1,!0)},b:function(){return q.matMul(H,!1,!1)}}:{a:function(){return V.matMul(H,!0,!0)},b:function(){return H.matMul(q,!0,!0)}}:{a:function(){return H.matMul(V,!1,!0)},b:function(){return q.matMul(H,!0,!1)}},$)}),"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},M,[!0]).reshape(E)}}),wR=B({fusedConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=f===void 0?"linear":f,h=e.preluActivationWeights;if(d=d||"linear",af(W.state.gradientDepth,d)===!1){var p=Cn(n,t,r,o,a,u,c);return l!=null&&(p=Oe(p,l)),cf(p,d,h)}var v=A(n,"x","conv2d"),m=A(t,"filter","conv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(g.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),T(m.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),c!=null&&T(it(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),T(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),T(Zt(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),T(a==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var x,y,w=So(g.shape,m.shape,r,u,o,c);l!=null&&(x=et(x=A(l,"bias","fused conv2d"),v)[0],Be(w.outShape,x.shape)),h!=null&&(y=A(h,"prelu weights","fused conv2d"));var _={x:g,filter:m};l!=null&&(_.bias=x),h!=null&&(_.preluActivationWeights=y);var S=[m,g],R=W.runKernelFunc((function(E,C){var I=E.fusedConv2d({input:g,filter:m,convInfo:w,bias:x,activation:d,preluActivationWeights:y});return C([m,g,I]),I}),_,(function(E,C){var I=C,k=I[0],M=I[1],P=I[2],L=sf(E,P,d);T(pi(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var q={};return l!=null&&(q={bias:function(){return uf(x,L)}}),Object.assign({x:function(){return Ag(M.shape,L,k,r,o)},filter:function(){return Jl(M,L,k.shape,r,o)}},q)}),"FusedConv2D",{convInfo:w,activation:d},S,[!0]);return b?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),_R=B({fusedDepthwiseConv2d_:function(e){var n=e.x,t=e.filter,r=e.strides,o=e.pad,i=e.dataFormat,a=i===void 0?"NHWC":i,s=e.dilations,u=s===void 0?[1,1]:s,c=e.dimRoundingMode,l=e.bias,f=e.activation,d=f===void 0?"linear":f,h=e.preluActivationWeights;if(af(W.state.gradientDepth,d)===!1){var p=ru(n,t,r,o,a,u,c);return l!=null&&(p=Oe(p,l)),cf(p,d,h)}var v=A(n,"x","depthwiseConv2d"),m=A(t,"filter","depthwiseConv2d"),g=v,b=!1;v.rank===3&&(b=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),T(g.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),T(m.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),T(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),u==null&&(u=[1,1]),T(Zt(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),c!=null&&T(it(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var x,y,w=So(g.shape,m.shape,r,u,o,c,!0);l!=null&&(x=et(x=A(l,"bias","fused conv2d"),v)[0],Be(w.outShape,x.shape)),h!=null&&(y=A(h,"prelu weights","fused depthwiseConv2d"));var _={x:g,filter:m};l!=null&&(_.bias=x),h!=null&&(_.preluActivationWeights=y);var S=[m,g],R=W.runKernelFunc((function(E,C){var I=E.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:x,activation:d,preluActivationWeights:y});return C([m,g,I]),I}),_,(function(E,C){T(pi(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var I=C[0],k=C[1],M=C[2],P=sf(E,M,d),L={};return l!=null&&(L={bias:function(){return uf(x,P)}}),Object.assign({x:function(){return Tg(k.shape,P,I,w)},filter:function(){return Dg(k,P,I.shape,w)}},L)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},S,[!0]);return b?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R}}),CR=Object.freeze({matMul:xR,conv2d:wR,depthwiseConv2d:_R}),ER=Object.freeze({image:of,linalg:dR,losses:uR,spectral:$S,fused:CR,signal:JS,square:oE,squaredDifference:hg,conv1d:hS,conv2d:Cn,conv3d:pS,depthwiseConv2d:ru,separableConv2d:Zl,conv2dTranspose:vS,conv3dTranspose:mS,op:B,batchNormalization2d:PE,batchNormalization3d:ME,batchNormalization4d:OE,batchNormalization:BE,batchNorm:bg,batchNorm2d:LE,batchNorm3d:WE,batchNorm4d:VE,booleanMaskAsync:dS,complex:St,real:yn,imag:qn,concat:dt,concat1d:C_,concat2d:E_,concat3d:S_,concat4d:R_,split:Wl,matMul:ou,dot:gS,outerProduct:yS,reverse:da,reverse1d:bS,reverse2d:xS,reverse3d:wS,reverse4d:_S,maxPool:bt,avgPool:ha,pool:CS,maxPool3d:ES,avgPool3d:SS,slice:Qn,slice1d:RS,slice2d:kS,slice3d:Pg,slice4d:IS,abs:iE,acos:aE,acosh:sE,asin:uE,asinh:cE,atan:lE,atanh:fE,ceil:dE,clipByValue:Xl,cos:hE,cosh:pE,erf:vE,exp:Xc,expm1:mE,floor:gE,log:yE,log1p:bE,logSigmoid:xE,neg:_s,reciprocal:wE,round:_E,rsqrt:pg,sigmoid:vg,sign:CE,isNaN:EE,isInf:SE,isFinite:RE,sin:kE,sinh:IE,softplus:AE,sqrt:TE,step:DE,tan:NE,tanh:FE,all:AS,any:TS,argMax:DS,argMin:NS,logSumExp:FS,max:iu,mean:PS,min:MS,moments:OS,sum:Og,prod:BS,equal:Eg,equalStrict:nS,greater:rS,greaterEqual:Sg,greaterEqualStrict:oS,greaterStrict:iS,less:aS,lessEqual:sS,lessEqualStrict:uS,lessStrict:cS,notEqual:lS,notEqualStrict:fS,add:Oe,addN:qE,addStrict:HE,atan2:GE,div:Sn,divNoNan:jE,divStrict:$E,floorDiv:_g,maximum:Yl,maximumStrict:KE,minimum:Cg,minimumStrict:XE,mod:YE,modStrict:QE,mul:Ot,mulStrict:JE,pow:Cs,powStrict:ZE,squaredDifferenceStrict:eS,sub:mt,subStrict:tS,elu:Bg,leakyRelu:LS,prelu:Lg,relu:Ze,relu6:Wg,selu:WS,logicalAnd:nu,logicalNot:UE,logicalOr:xg,logicalXor:zE,where:xo,whereAsync:wg,buffer:Te,print:M_,batchToSpaceND:Om,broadcastTo:O_,cast:B_,clone:L_,cumsum:W_,depthToSpace:V_,expandDims:gn,eye:Bm,multinomial:U_,oneHot:Gc,pad:Eo,pad1d:z_,pad2d:q_,pad3d:H_,pad4d:G_,rand:j_,randomNormal:$_,randomGamma:K_,randomUniform:Lm,reshape:Rn,spaceToBatchND:Wm,squeeze:Vm,stack:ln,tile:Zo,truncatedNormal:X_,unstack:ht,setdiff1dAsync:Y_,fill:Yn,linspace:__,ones:yi,range:ps,scalar:de,tensor:kt,tensor1d:st,tensor2d:Ur,tensor3d:Ll,tensor4d:jt,tensor5d:b_,tensor6d:x_,variable:w_,zeros:Ye,onesLike:Mm,zerosLike:Le,transpose:Gr,softmax:wr,logSoftmax:r2,localResponseNormalization:VS,norm:Vg,gather:Ql,unsortedSegmentSum:Rg,basicLSTMCell:US,multiRNNCell:zS,movingAverage:qS,stridedSlice:HS,topk:GS,scatterND:jS,fft:ef,ifft:Es,rfft:tf,irfft:Ug,sparseToDense:KS,gatherND:XS,diag:YS,dropout:QS,hannWindow:nf,hammingWindow:qg,frame:rf,stft:Hg,inTopKAsync:ZS});function te(e,n){Array.isArray(e)||(e=[e]),e.forEach((function(t){t!=null&&T(t.dtype!=="complex64",(function(){return n+" does not support complex64 tensors."}))}))}function Qu(e,n,t,r){if(t==="linear")return e.linear(n);if(t==="relu")return e.relu(n);if(t==="elu")return e.elu(n);if(t==="relu6")return e.relu6(n);if(t==="prelu")return e.prelu(n,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var SR=(function(e){function n(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new $m(t,W),t}return Nn(n,e),n.prototype.write=function(t,r,o){this.firstUse&&(this.firstUse=!1,Q().get("IS_NODE")&&ds(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var i={};return this.data.set(i,{values:t,dtype:o}),i},n.prototype.move=function(t,r,o,i){this.data.set(t,{values:r,dtype:i})},n.prototype.numDataIds=function(){return this.data.numDataIds()},n.prototype.read=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){return[2,this.readSync(t)]}))}))},n.prototype.readSync=function(t){var r=this.data.get(t),o=r.dtype,i=r.complexTensors;return o==="complex64"?Kc(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(t).values},n.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),o=r;if(t.dtype==="string")try{o=r.map((function(i){return cs(i)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(t.shape,t.dtype,o)},n.prototype.makeOutput=function(t,r,o){var i=this.write(t,r,o);return W.makeTensorFromDataId(i,r,o,this)},n.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},n.prototype.time=function(t){return me(this,void 0,void 0,(function(){var r;return ge(this,(function(o){return r=Un(),t(),[2,{kernelMs:Un()-r}]}))}))},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(t,r){var o=this.makeOutput(null,t.shape,"complex64");return this.data.get(o.dataId).complexTensors={real:W.keep(t.clone()),imag:W.keep(r.clone())},o},n.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},n.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},n.prototype.slice=function(t,r,o){if(te(t,"slice"),Gm(t.shape,r,o)){var i=jm(r,t.strides),a=ye(o);return kt(this.readSync(t.dataId).subarray(i,i+a),o,t.dtype)}for(var s=Te(o,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c).map((function(f,d){return f+r[d]}));s.values[c]=u.get.apply(u,l)}return s.toTensor()},n.prototype.stridedSlice=function(t,r,o,i){te(t,"stridedSlice");var a=Ul(r,o,i);if(a.some((function(h){return h===0})))return kt([],a);for(var s=Te(a,t.dtype),u=this.bufferSync(t),c=0;c<s.size;c++){for(var l=s.indexToLoc(c),f=new Array(l.length),d=0;d<f.length;d++)f[d]=l[d]*i[d]+r[d];s.set.apply(s,[u.get.apply(u,f)].concat(l))}return s.toTensor()},n.prototype.diag=function(t){for(var r=this.readSync(t.dataId),o=Te([t.size,t.size],t.dtype),i=o.values,a=0;a<r.length;a++)i[a*t.size+a]=r[a];return o.toTensor()},n.prototype.unstack=function(t,r){for(var o=t.shape[r],i=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(i[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),c=t.shape.slice();c[r]=1;var l=new Array(o);for(s=0;s<l.length;s++)u[r]=s,l[s]=this.slice(t,u,c).reshape(i);return l},n.prototype.reverse=function(t,r){te(t,"reverse");for(var o=Te(t.shape,t.dtype),i=this.bufferSync(t),a=function(u){var c=o.indexToLoc(u),l=c.slice();r.forEach((function(f){return l[f]=t.shape[f]-1-l[f]})),o.set.apply(o,[i.get.apply(i,l)].concat(c))},s=0;s<o.size;s++)a(s);return o.toTensor()},n.prototype.concat=function(t,r){var o=this;if(t[0].dtype==="complex64"){var i=t.map((function(h){return yn(h)})),a=t.map((function(h){return qn(h)}));return St(this.concat(i,r),this.concat(a,r))}var s=t.map((function(h){var p=ye(h.shape.slice(r));return h.as2D(-1,p)})),u=hi(s.map((function(h){return h.shape})),1),c=Te(u,t[0].dtype).values;if(s[0].shape[0]===1){var l=0;s.forEach((function(h){c.set(o.readSync(h.dataId),l),l+=h.size}))}else{var f=0;s.forEach((function(h){for(var p=o.readSync(h.dataId),v=0,m=0;m<h.shape[0];++m)for(var g=m*u[1]+f,b=0;b<h.shape[1];++b)c[g+b]=p[v++];f+=h.shape[1]}))}var d=hi(t.map((function(h){return h.shape})),r);return kt(c,d,t[0].dtype)},n.prototype.neg=function(t){return te(t,"neg"),this.multiply(de(-1),t)},n.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o+a,imag:i+s}})):this.broadcastedBinaryOp(t,r,Rt(t.dtype,r.dtype),(function(o,i){return o+i}))},n.prototype.addN=function(t){var r=this;te(t,"addN");for(var o=t.map((function(l){return r.readSync(l.dataId)})),i=Te(t[0].shape,t[0].dtype),a=i.values,s=0;s<t.length;s++)for(var u=o[s],c=0;c<a.length;c++)a[c]+=u[c];return i.toTensor()},n.prototype.softmax=function(t,r){var o=gt([r],t.shape),i=this.max(t,o),a=Jt(i.shape,o),s=this.subtract(t,i.reshape(a)),u=this.exp(s),c=this.sum(u,o).reshape(a);return this.realDivide(u,c)},n.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o-a,imag:i-s}})):this.broadcastedBinaryOp(t,r,Rt(t.dtype,r.dtype),(function(o,i){return o-i}))},n.prototype.pow=function(t,r){return te([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.pow(o,i)}))},n.prototype.batchMatMul=function(t,r,o,i){te([t,r],"matMul");for(var a=o?t.shape[1]:t.shape[2],s=o?t.shape[2]:t.shape[1],u=i?r.shape[1]:r.shape[2],c=t.shape[0],l=this.readSync(t.dataId),f=this.readSync(r.dataId),d=o?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=d[0],p=d[1],v=d[2],m=i?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],g=m[0],b=m[1],x=m[2],y=s*u,w=Te([c,s,u],t.dtype),_=w.values,S=this.blockSize,R=0;R<c;R++)for(var E=0;E<s;E+=S)for(var C=0;C<u;C+=S)for(var I=0;I<a;I+=S)for(var k=Math.min(E+S,s),M=Math.min(C+S,u),P=Math.min(I+S,a),L=E;L<k;L++)for(var q=C;q<M;q++){for(var V=0,F=I;F<P;F++)V+=l[R*h+L*p+F*v]*f[F*g+q*b+R*x];_[R*y+(L*u+q)]+=V}return w.toTensor()},n.prototype.fusedBatchMatMul=function(t){var r=t.a,o=t.b,i=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,c=t.preluActivationWeights,l=this.batchMatMul(r,o,i,a);return s&&(l=this.add(l,s)),u&&(l=Qu(this,l,u,c)),l},n.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(o,i,a,s){return{real:o*a-i*s,imag:o*s+i*a}})):this.broadcastedBinaryOp(t,r,Rt(t.dtype,r.dtype),(function(o,i){return o*i}))},n.prototype.realDivide=function(t,r){return te([t,r],"realDivide"),this.broadcastedBinaryOp(t,r,"float32",(function(o,i){return o/i}))},n.prototype.floorDiv=function(t,r){return te([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(o,i){return Math.floor(o/i)}))},n.prototype.sum=function(t,r){te(t,"sum"),tn("sum",r,t.rank);for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,Rt(t.dtype,"int32")),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=0,p=0;p<u;++p)h+=l[d+p];c[f]=h}return s},n.prototype.prod=function(t,r){te(t,"sum");for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,Rt(t.dtype,"int32")),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=1,p=0;p<u;++p)h*=l[d+p];c[f]=h}return s},n.prototype.unsortedSegmentSum=function(t,r,o){te(t,"unsortedSegmentSum");for(var i=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<o;++s){var u=de(s,"int32"),c=Eg(u,r).asType("float32").mul(t).sum(0);i.push(c)}return ln(i)},n.prototype.argMin=function(t,r){te(t,"argMin");var o=[r];tn("argMin",o,t.rank);for(var i=Tt(t.shape,o),a=i[0],s=i[1],u=Ye(a,"int32"),c=ye(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),d=0;d<l.length;++d){for(var h=d*c,p=f[h],v=0,m=0;m<c;++m){var g=f[h+m];g<p&&(p=g,v=m)}l[d]=v}return u},n.prototype.argMax=function(t,r){te(t,"argMax");var o=[r];tn("argMax",o,t.rank);for(var i=Tt(t.shape,o),a=i[0],s=i[1],u=Ye(a,"int32"),c=ye(s),l=this.readSync(u.dataId),f=this.readSync(t.dataId),d=0;d<l.length;++d){for(var h=d*c,p=f[h],v=0,m=0;m<c;++m){var g=f[h+m];g>p&&(p=g,v=m)}l[d]=v}return u},n.prototype.cumsum=function(t,r,o,i){if(te(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=Rt(t.dtype,"int32"),s=Ye(t.shape,a),u=this.readSync(s.dataId),c=this.readSync(t.dataId),l=t.shape[t.rank-1],f=i?function(m,g){return m+l-g-1}:function(m,g){return m+g},d=0;d<c.length;d+=l)for(var h=0;h<l;h++){var p=f(d,h);if(h===0)u[p]=o?0:c[p];else{var v=f(d,h-1);u[p]=o?c[v]+u[v]:c[p]+u[v]}}return s},n.prototype.equal=function(t,r){return te([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o===i?1:0}))},n.prototype.notEqual=function(t,r){return te([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o!==i?1:0}))},n.prototype.less=function(t,r){return te([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o<i?1:0}))},n.prototype.lessEqual=function(t,r){return te([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o<=i?1:0}))},n.prototype.greater=function(t,r){return te([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o>i?1:0}))},n.prototype.greaterEqual=function(t,r){return te([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o>=i?1:0}))},n.prototype.logicalNot=function(t){te(t,"logicalNot");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)o[i]=r[i]?0:1;return this.makeOutput(o,t.shape,"bool")},n.prototype.logicalAnd=function(t,r){return te([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o&&i}))},n.prototype.logicalOr=function(t,r){return te([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(o,i){return o||i}))},n.prototype.select=function(t,r,o){te([t,r,o],"select");for(var i=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(o.dataId),u=Ye(r.shape,Rt(r.dtype,o.dtype)),c=this.readSync(u.dataId),l=0,f=t.rank===0||t.rank>1||r.rank===1?1:ye(r.shape.slice(1)),d=0;d<i.length;d++)for(var h=0;h<f;h++)i[d]===1?c[l++]=a[d]:c[l++]=s[d];return u},n.prototype.where=function(t){te([t],"where");var r=this.readSync(t.dataId);return Gl(t.shape,r)},n.prototype.topk=function(t,r,o){return te(t,"topk"),tg(this.readSync(t.dataId),t.shape,t.dtype,r)},n.prototype.min=function(t,r){te(t,"min"),tn("min",r,t.rank);for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,t.dtype),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var v=l[d+p];v<h&&(h=v)}c[f]=h}return s},n.prototype.minimum=function(t,r){return te([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.min(o,i)}))},n.prototype.mod=function(t,r){return te([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){var a=o%i;return o<0&&i<0||o>=0&&i>=0?a:(a+i)%i}))},n.prototype.max=function(t,r){te(t,"max"),tn("max",r,t.rank);for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,t.dtype),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var v=l[d+p];v>h&&(h=v)}c[f]=h}return s},n.prototype.maximum=function(t,r){return te([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.max(o,i)}))},n.prototype.all=function(t,r){te(t,"all"),tn("all",r,t.rank);for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,t.dtype),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var v=l[d+p];h=h&&v}c[f]=h}return s},n.prototype.any=function(t,r){te(t,"any"),tn("any",r,t.rank);for(var o=Tt(t.shape,r),i=o[0],a=o[1],s=Ye(i,t.dtype),u=ye(a),c=this.readSync(s.dataId),l=this.readSync(t.dataId),f=0;f<c.length;++f){for(var d=f*u,h=l[d],p=0;p<u;++p){var v=l[d+p];h=h||v}c[f]=h}return s},n.prototype.squaredDifference=function(t,r){return te([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){var a=o-i;return a*a}))},n.prototype.ceil=function(t){te(t,"ceil");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.ceil(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.floor=function(t){te(t,"floor");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.floor(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.sign=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)r[i]<0?o[i]=-1:r[i]>0?o[i]=1:o[i]=0;return this.makeOutput(o,t.shape,"float32")},n.prototype.isNaN=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isNaN(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.isInf=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Math.abs(r[i])===1/0&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.isFinite=function(t){te(t,"x");for(var r=this.readSync(t.dataId),o=new Uint8Array(r.length),i=0;i<r.length;++i)Number.isFinite(r[i])&&(o[i]=1);return this.makeOutput(o,t.shape,"bool")},n.prototype.round=function(t){te(t,"round");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=Math.floor(r[i]);r[i]-a<.5?o[i]=Math.floor(r[i]):r[i]-a>.5?o[i]=Math.ceil(r[i]):o[i]=a%2==0?a:a+1}return this.makeOutput(o,t.shape,"float32")},n.prototype.exp=function(t){te(t,"exp");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.exp(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.expm1=function(t){te(t,"expm1");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=Math.expm1(r[i]);return this.makeOutput(o,t.shape,"float32")},n.prototype.log=function(t){te(t,"log");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.log1p=function(t){te(t,"log1p");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.log1p(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.sqrt=function(t){te(t,"sqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.rsqrt=function(t){te(t,"rsqrt");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i){var a=r[i];o[i]=1/Math.sqrt(a)}return this.makeOutput(o,t.shape,"float32")},n.prototype.reciprocal=function(t){te(t,"reciprocal");for(var r=this.readSync(t.dataId),o=new Float32Array(r.length),i=0;i<r.length;++i)o[i]=1/r[i];return this.makeOutput(o,t.shape,"float32")},n.prototype.linear=function(t){return t},n.prototype.relu=function(t){te(t,"relu");for(var r=Ye(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.max(0,i[a]);return r},n.prototype.relu6=function(t){te(t,"relu");for(var r=Ye(t.shape,t.dtype),o=this.readSync(r.dataId),i=this.readSync(t.dataId),a=0;a<i.length;++a)o[a]=Math.min(Math.max(0,i[a]),6);return r},n.prototype.prelu=function(t,r){return te([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return o<0?i*o:o}))},n.prototype.elu=function(t){te(t,"elu");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},n.prototype.eluDer=function(t,r){te([t,r],"eluDer");for(var o=new Float32Array(r.size),i=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(o,r.shape,"float32")},n.prototype.selu=function(t){te(t,"selu");for(var r=$l,o=Kl,i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>=0?o*u:r*(Math.exp(u)-1)}return this.makeOutput(i,t.shape,"float32")},n.prototype.clip=function(t,r,o){te(t,"clip");for(var i=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];i[s]=u>o?o:u<r?r:u}return this.makeOutput(i,t.shape,"float32")},n.prototype.abs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.abs(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<t.size;++i){var a=o[2*i],s=o[2*i+1];r[i]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},n.prototype.int=function(t){te(t,"int");for(var r=new Int32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=o[i];return this.makeOutput(r,t.shape,"int32")},n.prototype.sigmoid=function(t){te(t,"sigmoid");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=1/(1+Math.exp(-o[i]));return this.makeOutput(r,t.shape,"float32")},n.prototype.softplus=function(t){te(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a]>-r,u=i[a]<r,c=Math.exp(i[a]),l=void 0;l=u?c:s?i[a]:Math.log(1+c),o[a]=l}return this.makeOutput(o,t.shape,"float32")},n.prototype.sin=function(t){te(t,"sin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sin(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cos=function(t){te(t,"cos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cos(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tan=function(t){te(t,"tan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.tan(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asin=function(t){te(t,"asin");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asin(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acos=function(t){te(t,"acos");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acos(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan=function(t){te(t,"atan");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atan(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atan2=function(t,r){return te([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(o,i){return Math.atan2(o,i)}))},n.prototype.sinh=function(t){te(t,"sinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.sinh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.cosh=function(t){te(t,"cosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.cosh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.tanh=function(t){te(t,"tanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=R1(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.asinh=function(t){te(t,"asinh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.asinh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.acosh=function(t){te(t,"acosh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.acosh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.atanh=function(t){te(t,"atanh");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i)r[i]=Math.atanh(o[i]);return this.makeOutput(r,t.shape,"float32")},n.prototype.erf=function(t){te(t,"erf");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=Math.sign(o[i]),s=Math.abs(o[i]),u=1/(1+.3275911*s);r[i]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},n.prototype.step=function(t,r){r===void 0&&(r=0),te(t,"step");for(var o=new Float32Array(t.size),i=this.readSync(t.dataId),a=0;a<i.length;++a){var s=i[a];isNaN(s)?o[a]=NaN:o[a]=s>0?1:r}return this.makeOutput(o,t.shape,"float32")},n.prototype.fusedConv2d=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.conv2d(r,o,i);return a&&(c=this.add(c,a)),s&&(c=Qu(this,c,s,u)),c},n.prototype.conv2d=function(t,r,o){te([t,r],"conv2d");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f=o.dataFormat==="channelsLast",d=Te(o.outShape,t.dtype),h=t.strides[0],p=f?t.strides[1]:t.strides[2],v=f?t.strides[2]:1,m=f?1:t.strides[1],g=d.strides[0],b=f?d.strides[1]:d.strides[2],x=f?d.strides[2]:1,y=f?1:d.strides[1],w=this.readSync(t.dataId),_=this.readSync(r.dataId),S=d.values,R=0;R<o.batchSize;++R)for(var E=R*h,C=R*g,I=0;I<o.outHeight;++I)for(var k=C+I*b,M=I*o.strideHeight-l,P=0;P<i;P++){var L=M+P*s;if(!(L<0||L>=o.inHeight))for(var q=P*r.strides[0],V=E+L*p,F=0;F<o.outWidth;++F)for(var H=k+F*x,$=F*o.strideWidth-c,G=0;G<a;G++){var O=$+G*u;if(!(O<0||O>=o.inWidth))for(var re=V+O*v,he=q+G*r.strides[1],be=0;be<o.inChannels;++be){for(var ae=w[re+be*m],z=0;z<o.outChannels;++z)S[H+z*y]+=ae*_[he+z];he+=o.outChannels}}}return d.toTensor()},n.prototype.conv3d=function(t,r,o){for(var i=o.filterDepth,a=o.filterHeight,s=o.filterWidth,u=o.dilationDepth,c=o.dilationHeight,l=o.dilationWidth,f=o.padInfo.front,d=o.padInfo.left,h=o.padInfo.top,p=Te(o.outShape,t.dtype),v=this.readSync(t.dataId),m=this.readSync(r.dataId),g=p.values,b=0;b<o.batchSize;++b)for(var x=b*t.strides[0],y=b*p.strides[0],w=0;w<o.outDepth;++w)for(var _=y+w*p.strides[1],S=w*o.strideDepth-f,R=0;R<i;R++){var E=S+R*u;if(!(E<0||E>=o.inDepth))for(var C=R*r.strides[0],I=x+E*t.strides[1],k=0;k<o.outHeight;++k)for(var M=_+k*p.strides[2],P=k*o.strideHeight-h,L=0;L<a;L++){var q=P+L*c;if(!(q<0||q>=o.inHeight))for(var V=C+L*r.strides[1],F=I+q*t.strides[2],H=0;H<o.outWidth;++H)for(var $=M+H*o.outChannels,G=H*o.strideWidth-d,O=0;O<s;O++){var re=G+O*l;if(!(re<0||re>=o.inWidth))for(var he=V+O*r.strides[2],be=F+re*o.inChannels,ae=he,z=0;z<o.inChannels;++z){for(var Z=v[be+z],ee=0;ee<o.outChannels;++ee)g[$+ee]+=Z*m[ae+ee];ae+=o.outChannels}}}}return p.toTensor()},n.prototype.conv2dDerInput=function(t,r,o){te([t,r],"conv2dDerInput");for(var i=Te(o.inShape,"float32"),a=i.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),c=r.strides,l=c[0],f=c[1],d=c[2],h=o.batchSize,p=o.filterHeight,v=o.filterWidth,m=o.inChannels,g=o.inHeight,b=o.inWidth,x=o.outChannels,y=o.outHeight,w=o.outWidth,_=o.strideHeight,S=o.strideWidth,R=o.dataFormat,E=p-1-o.padInfo.top,C=v-1-o.padInfo.left,I=R==="channelsLast",k=i.strides[0],M=I?i.strides[1]:i.strides[2],P=I?i.strides[2]:1,L=I?1:i.strides[1],q=t.strides[0],V=I?t.strides[1]:t.strides[2],F=I?t.strides[2]:1,H=I?1:t.strides[1],$=0;$<h;++$)for(var G=0;G<m;++G)for(var O=0;O<g;++O)for(var re=O-E,he=Math.max(0,Math.ceil(re/_)),be=Math.min(y,(p+re)/_),ae=0;ae<b;++ae){for(var z=ae-C,Z=Math.max(0,Math.ceil(z/S)),ee=Math.min(w,(v+z)/S),le=0,pe=he;pe<be;++pe)for(var D=pe*_-re,N=Z;N<ee;++N)for(var U=q*$+V*pe+F*N,X=l*(p-1-D)+f*(v-1-(N*S-z))+d*G,Y=0;Y<x;++Y)le+=s[U+H*Y]*u[X+Y];a[k*$+M*O+P*ae+L*G]=le}return i.toTensor()},n.prototype.conv3dDerInput=function(t,r,o){for(var i=Te(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=s[3],d=this.readSync(t.dataId),h=t.strides,p=h[0],v=h[1],m=h[2],g=h[3],b=this.readSync(r.dataId),x=r.strides,y=x[0],w=x[1],_=x[2],S=x[3],R=o.batchSize,E=o.filterDepth,C=o.filterHeight,I=o.filterWidth,k=o.inChannels,M=o.inDepth,P=o.inHeight,L=o.inWidth,q=o.outChannels,V=o.outDepth,F=o.outHeight,H=o.outWidth,$=o.strideDepth,G=o.strideHeight,O=o.strideWidth,re=E-1-o.padInfo.front,he=C-1-o.padInfo.top,be=I-1-o.padInfo.left,ae=0;ae<R;++ae)for(var z=0;z<k;++z)for(var Z=0;Z<M;++Z)for(var ee=Z-re,le=Math.max(0,Math.ceil(ee/$)),pe=Math.min(V,(E+ee)/$),D=0;D<P;++D)for(var N=D-he,U=Math.max(0,Math.ceil(N/G)),X=Math.min(F,(C+N)/G),Y=0;Y<L;++Y){for(var J=Y-be,ce=Math.max(0,Math.ceil(J/O)),ie=Math.min(H,(I+J)/O),ue=0,ne=le;ne<pe;++ne)for(var Ce=ne*$-ee,fe=U;fe<X;++fe)for(var Ee=fe*G-N,Se=ce;Se<ie;++Se)for(var Me=p*ae+v*ne+m*fe+g*Se,We=y*(E-1-Ce)+w*(C-1-Ee)+_*(I-1-(Se*O-J))+S*z,Pe=0;Pe<q;++Pe)ue+=d[Me+Pe]*b[We+Pe];a[u*ae+c*Z+l*D+f*Y+z]=ue}return i.toTensor()},n.prototype.conv2dDerFilter=function(t,r,o){te([t,r],"conv2dDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dataFormat==="channelsLast",l=Te(o.filterShape,"float32"),f=o.padInfo.left,d=o.padInfo.top,h=this.bufferSync(t),p=this.bufferSync(r),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((d-v)/i)),g=Math.min(o.outHeight,(o.inHeight+d-v)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((f-b)/a)),y=Math.min(o.outWidth,(o.inWidth+f-b)/a),w=0;w<o.inChannels;++w)for(var _=0;_<o.outChannels;++_){for(var S=0,R=0;R<o.batchSize;++R)for(var E=m;E<g;++E)for(var C=v+E*i-d,I=x;I<y;++I){var k=b+I*a-f;S+=c?h.get(R,C,k,w)*p.get(R,E,I,_):h.get(R,w,C,k)*p.get(R,_,E,I)}l.set(S,v,b,w,_)}return l.toTensor()},n.prototype.conv3dDerFilter=function(t,r,o){for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=Te(o.filterShape,"float32"),d=f.values,h=f.strides,p=h[0],v=h[1],m=h[2],g=h[3],b=this.readSync(r.dataId),x=r.strides,y=x[0],w=x[1],_=x[2],S=x[3],R=this.readSync(t.dataId),E=t.strides,C=E[0],I=E[1],k=E[2],M=E[3],P=o.padInfo.front,L=o.padInfo.left,q=o.padInfo.top,V=0;V<u;++V)for(var F=Math.max(0,Math.ceil((P-V)/i)),H=Math.min(o.outDepth,(o.inDepth+P-V)/i),$=V*p,G=0;G<c;++G)for(var O=Math.max(0,Math.ceil((q-G)/a)),re=Math.min(o.outHeight,(o.inHeight+q-G)/a),he=G*v+$,be=0;be<l;++be)for(var ae=Math.max(0,Math.ceil((L-be)/s)),z=Math.min(o.outWidth,(o.inWidth+L-be)/s),Z=be*m+he,ee=0;ee<o.inChannels;++ee)for(var le=ee*g+Z,pe=0;pe<o.outChannels;++pe){for(var D=0,N=0;N<o.batchSize;++N)for(var U=N*C,X=N*y,Y=F;Y<H;++Y)for(var J=(V+Y*i-P)*I+U,ce=Y*w+X,ie=O;ie<re;++ie)for(var ue=(G+ie*a-q)*k+J,ne=ie*_+ce,Ce=ae;Ce<z;++Ce){var fe=Ce*S+ne;D+=R[(be+Ce*s-L)*M+ue+ee]*b[fe+pe]}d[le+pe]=D}return f.toTensor()},n.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,o=t.filter,i=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=this.depthwiseConv2D(r,o,i);return a&&(c=this.add(c,a)),s&&(c=Qu(this,c,s,u)),c},n.prototype.depthwiseConv2D=function(t,r,o){te([t,r],"depthwiseConv2D");for(var i=o.filterHeight,a=o.filterWidth,s=o.dilationHeight,u=o.dilationWidth,c=o.padInfo.left,l=o.padInfo.top,f=o.outChannels/o.inChannels,d=Te(o.outShape,t.dtype),h=this.readSync(t.dataId),p=this.readSync(r.dataId),v=d.values,m=0;m<o.batchSize;++m)for(var g=m*t.strides[0],b=m*d.strides[0],x=0;x<o.outHeight;++x)for(var y=b+x*d.strides[1],w=x*o.strideHeight-c,_=0;_<i;++_){var S=w+_*s;if(!(S<0||S>=o.inHeight))for(var R=_*r.strides[0],E=g+S*t.strides[1],C=0;C<o.outWidth;++C)for(var I=y+C*d.strides[2],k=C*o.strideWidth-l,M=0;M<a;++M){var P=k+M*u;if(!(P<0||P>=o.inWidth))for(var L=R+M*r.strides[1],q=E+P*o.inChannels,V=I,F=L,H=0;H<o.inChannels;++H){for(var $=h[q+H],G=0;G<f;++G)v[V+G]+=$*p[F+G];V+=f,F+=f}}}return d.toTensor()},n.prototype.depthwiseConv2DDerInput=function(t,r,o){te([t,r],"depthwiseConv2DDerInput");for(var i=Te(o.inShape,"float32"),a=i.values,s=i.strides,u=s[0],c=s[1],l=s[2],f=this.readSync(t.dataId),d=t.strides,h=d[0],p=d[1],v=d[2],m=this.readSync(r.dataId),g=r.strides,b=g[0],x=g[1],y=g[2],w=o.batchSize,_=o.filterHeight,S=o.filterWidth,R=o.inChannels,E=o.inHeight,C=o.inWidth,I=o.outChannels,k=o.outHeight,M=o.outWidth,P=o.strideHeight,L=o.strideWidth,q=_-1-o.padInfo.top,V=S-1-o.padInfo.left,F=I/R,H=0;H<w;++H)for(var $=0;$<R;++$)for(var G=0;G<E;++G)for(var O=G-q,re=Math.max(0,Math.ceil(O/P)),he=Math.min(k,(_+O)/P),be=0;be<C;++be){for(var ae=be-V,z=Math.max(0,Math.ceil(ae/L)),Z=Math.min(M,(S+ae)/L),ee=0,le=re;le<he;++le)for(var pe=le*P-O,D=z;D<Z;++D)for(var N=h*H+p*le+v*D,U=b*(_-1-pe)+x*(S-1-(D*L-ae))+y*$,X=0;X<F;++X)ee+=f[N+($*F+X)]*m[U+X];a[u*H+c*G+l*be+$]=ee}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(t,r,o){te([t,r],"depthwiseConv2DDerFilter");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=Te(o.filterShape,"float32"),l=o.padInfo.left,f=o.padInfo.top,d=o.outChannels/o.inChannels,h=this.bufferSync(t),p=this.bufferSync(r),v=0;v<s;++v)for(var m=Math.max(0,Math.ceil((f-v)/i)),g=Math.min(o.outHeight,(o.inHeight+f-v)/i),b=0;b<u;++b)for(var x=Math.max(0,Math.ceil((l-b)/a)),y=Math.min(o.outWidth,(o.inWidth+l-b)/a),w=0;w<o.outChannels;++w){for(var _=Math.trunc(w/d),S=w%d,R=0,E=0;E<o.batchSize;++E)for(var C=m;C<g;++C)for(var I=v+C*i-f,k=x;k<y;++k){var M=b+k*a-l;R+=h.get(E,I,M,_)*p.get(E,C,k,w)}c.set(R,v,b,_,S)}return c.toTensor()},n.prototype.tile=function(t,r){return te(t,"tile"),eg(this.bufferSync(t),r)},n.prototype.pad=function(t,r,o){te(t,"pad");var i=r.map((function(d,h){return d[0]+t.shape[h]+d[1]})),a=r.map((function(d){return d[0]})),s=this.bufferSync(t),u=Te(i,t.dtype);o!==0&&u.values.fill(o);for(var c=0;c<t.size;c++){var l=s.indexToLoc(c),f=l.map((function(d,h){return d+a[h]}));u.set.apply(u,[s.get.apply(s,l)].concat(f))}return u.toTensor()},n.prototype.transpose=function(t,r){te(t,"transpose");for(var o=new Array(t.rank),i=0;i<o.length;i++)o[i]=t.shape[r[i]];var a=this.readSync(t.dataId),s=Te(o,t.dtype),u=this.bufferSync(t);for(i=0;i<t.size;++i){for(var c=u.indexToLoc(i),l=new Array(c.length),f=0;f<l.length;f++)l[f]=c[r[f]];var d=s.locToIndex(l);s.values[d]=a[i]}return s.toTensor()},n.prototype.gather=function(t,r,o){te([t,r],"gather");var i=t.shape.slice(),a=this.readSync(r.dataId);i[o]=a.length;for(var s=Te(i,t.dtype),u=this.bufferSync(t),c=0;c<s.size;++c){var l=s.indexToLoc(c),f=l.slice();f[o]=a[l[o]];var d=u.locToIndex(f);s.values[c]=u.values[d]}return s.toTensor()},n.prototype.batchToSpaceND=function(t,r,o){te([t],"batchToSpaceND");var i=r.reduce((function(f,d){return f*d})),a=vs(t.shape,r,i),s=ms(a.length,r.length),u=gs(t.shape,r,i),c=Um(o,r.length),l=zm(u,o,r.length);return t.reshape(a).transpose(s).reshape(u).slice(c,l)},n.prototype.spaceToBatchND=function(t,r,o){te([t],"spaceToBatchND");var i=r.reduce((function(d,h){return d*h})),a=[[0,0]];a.push.apply(a,o);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),c=vs(u.shape,r,i,!1),l=ms(c.length,r.length,!1),f=gs(u.shape,r,i,!1);return u.reshape(c).transpose(l).reshape(f)},n.prototype.pool=function(t,r,o){te(t,"pool");for(var i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,h=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,p=this.readSync(t.dataId),v=Te(r.outShape,t.dtype),m=v.values,g=r.outShape[1]*r.outShape[2]*r.outShape[3],b=r.outShape[2]*r.outShape[3],x=r.outShape[3],y=0;y<r.batchSize;++y)for(var w=y*g,_=y*t.strides[0],S=0;S<r.inChannels;++S)for(var R=0;R<r.outHeight;++R)for(var E=R*i-f,C=Math.max(0,E),I=Math.min(r.inHeight,c+E),k=w+R*b,M=0;M<r.outWidth;++M){for(var P=M*a-d,L=Math.max(0,P),q=Math.min(r.inWidth,l+P),V=h,F=0,H=0,$=C;$<I;$+=s){for(var G=_+$*t.strides[1],O=L;O<q;O+=u){var re=p[G+O*t.strides[2]+S];o==="max"&&re>V?V=re:o==="avg"&&(F+=re,H++)}if(isNaN(V))break}m[k+M*x+S]=o==="avg"?F/H:V}return v.toTensor()},n.prototype.maxPool=function(t,r){return this.pool(t,r,"max")},n.prototype.maxPoolPositions=function(t,r){for(var o=Te(r.outShape,"int32"),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,f=r.padInfo.top,d=r.padInfo.left,h=this.bufferSync(t),p=0;p<r.batchSize;++p)for(var v=0;v<r.inChannels;++v)for(var m=0;m<r.outHeight;++m){for(var g=m*i-f,b=g;b<0;)b+=s;for(var x=Math.min(r.inHeight,c+g),y=0;y<r.outWidth;++y){for(var w=y*a-d,_=w;_<0;)_+=u;for(var S=Math.min(r.inWidth,l+w),R=Number.NEGATIVE_INFINITY,E=-1,C=b;C<x;C+=s)for(var I=C-g,k=_;k<S;k+=u){var M=k-w,P=h.get(p,C,k,v);P>R&&(R=P,E=I*l+M)}o.set(E,p,m,y,v)}}return o.toTensor()},n.prototype.maxPoolBackprop=function(t,r,o,i){te([r,o],"maxPoolBackprop");for(var a=this.maxPoolPositions(r,i),s=i.strideHeight,u=i.strideWidth,c=i.dilationHeight,l=i.dilationWidth,f=i.effectiveFilterHeight,d=i.effectiveFilterWidth,h=d-1-i.padInfo.left,p=f-1-i.padInfo.top,v=Te(r.shape,"float32"),m=this.bufferSync(a),g=this.bufferSync(t),b=0;b<i.batchSize;++b)for(var x=0;x<i.inChannels;++x)for(var y=0;y<i.inHeight;++y)for(var w=0;w<i.inWidth;++w){for(var _=y-p,S=w-h,R=0,E=0;E<f;E+=c){var C=(_+E)/s;if(!(C<0||C>=i.outHeight||Math.floor(C)!==C))for(var I=0;I<d;I+=l){var k=(S+I)/u;if(!(k<0||k>=i.outWidth||Math.floor(k)!==k)){var M=f*d-1-m.get(b,C,k,x)===E*d+I?1:0;M!==0&&(R+=g.get(b,C,k,x)*M)}}}v.set(R,b,y,w,x)}return v.toTensor()},n.prototype.avgPoolBackprop=function(t,r,o){te([t,r],"avgPoolBackprop");for(var i=o.strideHeight,a=o.strideWidth,s=o.filterHeight,u=o.filterWidth,c=o.dilationHeight,l=o.dilationWidth,f=o.effectiveFilterHeight,d=o.effectiveFilterWidth,h=d-1-o.padInfo.left,p=f-1-o.padInfo.top,v=Te(r.shape,"float32"),m=1/(s*u),g=this.bufferSync(t),b=0;b<o.batchSize;++b)for(var x=0;x<o.inChannels;++x)for(var y=0;y<o.inHeight;++y)for(var w=0;w<o.inWidth;++w){for(var _=y-p,S=w-h,R=0,E=0;E<f;E+=c){var C=(_+E)/i;if(!(C<0||C>=o.outHeight||Math.floor(C)!==C))for(var I=0;I<d;I+=l){var k=(S+I)/a;k<0||k>=o.outWidth||Math.floor(k)!==k||(R+=g.get(b,C,k,x))}}v.set(R*m,b,y,w,x)}return v.toTensor()},n.prototype.pool3d=function(t,r,o){te(t,"pool3d");for(var i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,m=r.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=this.readSync(t.dataId),x=Te(r.outShape,t.dtype),y=x.values,w=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],_=r.outShape[2]*r.outShape[3]*r.outShape[4],S=r.outShape[3]*r.outShape[4],R=r.outShape[4],E=0;E<r.batchSize;++E)for(var C=E*w,I=E*t.strides[0],k=0;k<r.inChannels;++k)for(var M=0;M<r.outDepth;++M){for(var P=M*i-p,L=P;L<0;)L+=u;for(var q=Math.min(r.inDepth,f+P),V=C+M*_,F=0;F<r.outHeight;++F){for(var H=F*a-v,$=H;$<0;)$+=c;for(var G=Math.min(r.inHeight,d+H),O=V+F*S,re=0;re<r.outWidth;++re){for(var he=re*s-m,be=he;be<0;)be+=l;for(var ae=Math.min(r.inWidth,h+he),z=O+re*R,Z=g,ee=0,le=0,pe=L;pe<q;pe+=u){for(var D=I+pe*t.strides[1],N=$;N<G;N+=c){for(var U=D+N*t.strides[2],X=be;X<ae;X+=l){var Y=b[U+X*t.strides[3]+k];if(o==="max"&&Y>Z?Z=Y:o==="avg"&&(ee+=Y,le++),isNaN(Z))break}if(isNaN(Z))break}if(isNaN(Z))break}y[z+k]=o==="avg"?ee/le:Z}}}return x.toTensor()},n.prototype.avgPool3d=function(t,r){return te(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},n.prototype.avgPool3dBackprop=function(t,r,o){te([t,r],"avgPool3dBackprop");for(var i=o.strideDepth,a=o.strideHeight,s=o.strideWidth,u=o.filterDepth,c=o.filterHeight,l=o.filterWidth,f=o.dilationDepth,d=o.dilationHeight,h=o.dilationWidth,p=o.effectiveFilterDepth,v=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=p-1-o.padInfo.front,b=m-1-o.padInfo.left,x=v-1-o.padInfo.top,y=Te(r.shape,"float32"),w=1/(u*c*l),_=this.bufferSync(t),S=0;S<o.batchSize;++S)for(var R=0;R<o.inChannels;++R)for(var E=0;E<o.inDepth;++E)for(var C=0;C<o.inHeight;++C)for(var I=0;I<o.inWidth;++I){for(var k=E-g,M=C-x,P=I-b,L=0,q=0;q<p;q+=f){var V=(k+q)/i;if(!(V<0||V>=o.outDepth||Math.floor(V)!==V))for(var F=0;F<v;F+=d){var H=(M+F)/a;if(!(H<0||H>=o.outHeight||Math.floor(H)!==H))for(var $=0;$<m;$+=h){var G=(P+$)/s;G<0||G>=o.outWidth||Math.floor(G)!==G||(L+=_.get(S,V,H,G,R))}}}y.set(L*w,S,E,C,I,R)}return y.toTensor()},n.prototype.maxPool3d=function(t,r){return te(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},n.prototype.maxPool3dPositions=function(t,r){for(var o=Te(r.outShape,"int32"),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterDepth,d=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.front,v=r.padInfo.top,m=r.padInfo.left,g=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var x=0;x<r.inChannels;++x)for(var y=0;y<r.outDepth;++y){for(var w=y*i-p,_=w;_<0;)_+=u;for(var S=Math.min(r.inDepth,f+w),R=0;R<r.outHeight;++R){for(var E=R*a-v,C=E;C<0;)C+=c;for(var I=Math.min(r.inHeight,d+E),k=0;k<r.outWidth;++k){for(var M=k*s-m,P=M;P<0;)P+=l;for(var L=Math.min(r.inWidth,h+M),q=Number.NEGATIVE_INFINITY,V=-1,F=_;F<S;F+=u)for(var H=F-w,$=C;$<I;$+=c)for(var G=$-E,O=P;O<L;O+=l){var re=O-M,he=g.get(b,F,$,O,x);he>=q&&(q=he,V=H*d*h+G*d+re)}o.set(V,b,y,R,k,x)}}}return o.toTensor()},n.prototype.maxPool3dBackprop=function(t,r,o,i){te([r,o],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,i),s=i.strideDepth,u=i.strideHeight,c=i.strideWidth,l=i.dilationDepth,f=i.dilationHeight,d=i.dilationWidth,h=i.effectiveFilterDepth,p=i.effectiveFilterHeight,v=i.effectiveFilterWidth,m=h-1-i.padInfo.front,g=v-1-i.padInfo.left,b=p-1-i.padInfo.top,x=Te(r.shape,"float32"),y=this.bufferSync(a),w=this.bufferSync(t),_=0;_<i.batchSize;++_)for(var S=0;S<i.inChannels;++S)for(var R=0;R<i.inDepth;++R)for(var E=0;E<i.inHeight;++E)for(var C=0;C<i.inWidth;++C){for(var I=R-m,k=E-b,M=C-g,P=0,L=0;L<h;L+=l){var q=(I+L)/s;if(!(q<0||q>=i.outDepth||Math.floor(q)!==q))for(var V=0;V<p;V+=f){var F=(k+V)/u;if(!(F<0||F>=i.outHeight||Math.floor(F)!==F))for(var H=0;H<v;H+=d){var $=(M+H)/c;if(!($<0||$>=i.outWidth||Math.floor($)!==$)){var G=h*p*v-1-y.get(_,q,F,$,S)===L*p*v+V*v+H?1:0;G!==0&&(P+=w.get(_,q,F,$,S)*G)}}}}x.set(P,_,R,E,C,S)}return x.toTensor()},n.prototype.cast=function(t,r){return Ym(t,r,this)},n.prototype.reshape=function(t,r){return $c(t,r)},n.prototype.avgPool=function(t,r){return te(t,"avgPool"),this.pool(t,r,"avg").toFloat()},n.prototype.resizeBilinear=function(t,r,o,i){te(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),d=new Float32Array(ye([s,r,o,l])),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=0,m=h[0]/p[0],g=h[1]/p[1],b=0;b<s;b++)for(var x=0;x<r;x++)for(var y=m*x,w=Math.floor(y),_=y-w,S=Math.min(u-1,Math.ceil(y)),R=b*t.strides[0]+w*t.strides[1],E=b*t.strides[0]+S*t.strides[1],C=0;C<o;C++)for(var I=g*C,k=Math.floor(I),M=I-k,P=Math.min(c-1,Math.ceil(I)),L=R+k*t.strides[2],q=E+k*t.strides[2],V=R+P*t.strides[2],F=E+P*t.strides[2],H=0;H<l;H++){var $=f[L+H],G=f[q+H],O=$+(f[V+H]-$)*M,re=O+(G+(f[F+H]-G)*M-O)*_;d[v++]=re}return kt(d,[s,r,o,l])},n.prototype.resizeBilinearBackprop=function(t,r,o){te([t,r],"resizeBilinearBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],d=l[2],h=new Float32Array(a*s*u*c),p=[o&&f>1?s-1:s,o&&d>1?u-1:u],v=[o&&f>1?f-1:f,o&&d>1?d-1:d],m=p[0]/v[0],g=p[1]/v[1],b=this.readSync(t.dataId),x=0,y=0;y<a;y++)for(var w=y*r.strides[0],_=0;_<f;_++)for(var S=_*m,R=Math.floor(S),E=Math.min(Math.ceil(S),s-1),C=w+R*r.strides[1],I=w+E*r.strides[1],k=S-R,M=1-k,P=0;P<d;P++)for(var L=P*g,q=Math.floor(L),V=Math.min(Math.ceil(L),u-1),F=L-q,H=1-F,$=C+q*r.strides[2],G=C+V*r.strides[2],O=I+q*r.strides[2],re=I+V*r.strides[2],he=M*H,be=M*F,ae=k*H,z=k*F,Z=0;Z<c;Z++){var ee=b[x++];h[$+Z]+=ee*he,h[G+Z]+=ee*be,h[O+Z]+=ee*ae,h[re+Z]+=ee*z}return jt(h,[a,u,s,c],r.dtype)},n.prototype.resizeNearestNeighbor=function(t,r,o,i){te(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],f=this.readSync(t.dataId),d=new Float32Array(s*r*o*l),h=[i&&r>1?u-1:u,i&&o>1?c-1:c],p=[i&&r>1?r-1:r,i&&o>1?o-1:o],v=h[0]/p[0],m=h[1]/p[1],g=0,b=0;b<s;b++)for(var x=b*t.strides[0],y=0;y<r;y++)for(var w=v*y,_=x+Math.min(u-1,i?Math.round(w):Math.floor(w))*t.strides[1],S=0;S<o;S++)for(var R=m*S,E=_+Math.min(c-1,i?Math.round(R):Math.floor(R))*t.strides[2],C=0;C<l;C++){var I=f[E+C];d[g++]=I}return kt(d,[s,r,o,l],t.dtype)},n.prototype.resizeNearestNeighborBackprop=function(t,r,o){te([t,r],"resizeNearestNeighborBackprop");for(var i=r.shape,a=i[0],s=i[1],u=i[2],c=i[3],l=t.shape,f=l[1],d=l[2],h=new Float32Array(a*s*u*c),p=this.readSync(t.dataId),v=[o&&f>1?s-1:s,o&&d>1?u-1:u],m=[o&&f>1?f-1:f,o&&d>1?d-1:d],g=v[0]/m[0],b=v[1]/m[1],x=1/g,y=1/b,w=2*Math.ceil(x)+2,_=2*Math.ceil(y)+2,S=0;S<a;S++)for(var R=S*r.strides[0],E=0;E<s;E++)for(var C=R+E*r.strides[1],I=Math.floor(E*x),k=Math.floor(I-w/2),M=0;M<u;M++)for(var P=C+M*r.strides[2],L=Math.floor(M*y),q=Math.floor(L-_/2),V=0;V<c;V++){for(var F=0,H=0;H<w;H++){var $=H+k;if(!($<0||$>=f)){var G=R+$*t.strides[1],O=$*g;if(E===Math.min(s-1,o?Math.round(O):Math.floor(O)))for(var re=0;re<_;re++){var he=re+q;if(!(he<0||he>=d)){var be=G+he*t.strides[2],ae=he*b;M===Math.min(u-1,o?Math.round(ae):Math.floor(ae))&&(F+=p[be+V])}}}}h[P+V]=F}return jt(h,r.shape,r.dtype)},n.prototype.batchNormalization=function(t,r,o,i,a,s){te([t,r,o,a,s],"batchNorm");for(var u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=this.readSync(o.dataId),f=a?this.readSync(a.dataId):new Float32Array([1]),d=s?this.readSync(s.dataId):new Float32Array([0]),h=new Float32Array(u.length),p=d.length,v=f.length,m=l.length,g=c.length,b=0,x=0,y=0,w=0,_=0;_<u.length;++_)h[_]=d[b++]+(u[_]-c[x++])*f[y++]/Math.sqrt(l[w++]+i),b>=p&&(b=0),x>=g&&(x=0),y>=v&&(y=0),w>=m&&(w=0);return jt(h,t.shape)},n.prototype.localResponseNormalization4D=function(t,r,o,i,a){te(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,c=this.readSync(t.dataId),l=t.size,f=new Float32Array(l);function d(m){for(var g=m%s,b=m-g+Math.max(0,g-r),x=m-g+Math.min(g+r,u),y=0;b<=x;b++){var w=c[b];y+=w*w}return y}for(var h=0;h<l;h++){var p=d(h),v=c[h]*Math.pow(o+i*p,-a);f[h]=v}return jt(f,t.shape)},n.prototype.LRNGrad=function(t,r,o,i,a,s,u){te(t,"LRNGrad");for(var c=t.shape[3],l=this.readSync(t.dataId),f=this.readSync(r.dataId),d=this.readSync(o.dataId),h=new Float32Array(t.size),p=t.size,v=0;v<p;v++){for(var m=v%c,g=v-m+Math.max(0,m-i),b=v-m+Math.min(c,m+i+1),x=0,y=g;y<b;y++)x+=Math.pow(f[y],2);for(x=s*x+a,y=g;y<b;y++){var w=-2*s*u*f[y]*d[v]/x;v===y&&(w+=Math.pow(x,-u)),w*=l[v],h[y]+=w}}return jt(h,t.shape)},n.prototype.multinomial=function(t,r,o,i){te(t,"multinomial");for(var a=r?t:wr(t),s=a.shape[0],u=a.shape[1],c=Ye([s,o],"int32"),l=this.readSync(c.dataId),f=this.readSync(a.dataId),d=0;d<s;++d){var h=d*u,p=new Float32Array(u-1);p[0]=f[h];for(var v=1;v<p.length;++v)p[v]=p[v-1]+f[h+v];for(var m=Zs(i.toString()),g=d*o,b=0;b<o;++b){var x=m();l[g+b]=p.length;for(var y=0;y<p.length;y++)if(x<p[y]){l[g+b]=y;break}}}return c},n.prototype.oneHot=function(t,r,o,i){te(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(i);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=o);return Ur(a,[t.size,r],"int32")},n.prototype.nonMaxSuppression=function(t,r,o,i,a){return te(t,"nonMaxSuppression"),ql(this.readSync(t.dataId),this.readSync(r.dataId),o,i,a)},n.prototype.fft=function(t){return this.fftBatch(t,!1)},n.prototype.ifft=function(t){return this.fftBatch(t,!0)},n.prototype.fftBatch=function(t,r){for(var o=t.shape[0],i=t.shape[1],a=Te(t.shape,"float32"),s=Te(t.shape,"float32"),u=yn(t).as2D(o,i),c=qn(t).as2D(o,i),l=0;l<o;l++)for(var f=u.slice([l,0],[1,i]),d=c.slice([l,0],[1,i]),h=St(f,d),p=this.readSync(this.fftImpl(h,r).dataId),v=0;v<i;v++){var m=lh(p,v);a.values[l*i+v]=m.real,s.values[l*i+v]=m.imag}return St(a.toTensor(),s.toTensor()).as2D(o,i)},n.prototype.fftImpl=function(t,r){var o=t.as1D(),i=o.size;if(this.isExponentOf2(i)){var a=this.fftRadix2(o,i,r).as2D(t.shape[0],t.shape[1]);return r&&(a=St(yn(a).div(de(i)),qn(a).div(de(i)))),a}var s=this.readSync(t.dataId),u=(function(c){for(var l=new Float32Array(c.length/2),f=new Float32Array(c.length/2),d=0;d<c.length;d+=2)l[d/2]=c[d],f[d/2]=c[d+1];return{real:l,imag:f}})(this.fourierTransformByMatmul(s,i,r));return St(u.real,u.imag).as2D(t.shape[0],t.shape[1])},n.prototype.isExponentOf2=function(t){return(t&t-1)==0},n.prototype.fftRadix2=function(t,r,o){if(r===1)return t;var i=this.readSync(t.dataId),a=r/2,s=(function(g){for(var b=Math.ceil(g.length/4),x=new Float32Array(b),y=new Float32Array(b),w=0;w<g.length;w+=4)x[Math.floor(w/4)]=g[w],y[Math.floor(w/4)]=g[w+1];return{real:x,imag:y}})(i),u=St(s.real,s.imag).as1D(),c=(function(g){for(var b=Math.floor(g.length/4),x=new Float32Array(b),y=new Float32Array(b),w=2;w<g.length;w+=4)x[Math.floor(w/4)]=g[w],y[Math.floor(w/4)]=g[w+1];return{real:x,imag:y}})(i),l=St(c.real,c.imag).as1D();u=this.fftRadix2(u,a,o),l=this.fftRadix2(l,a,o);var f=(function(g,b){for(var x=new Float32Array(g/2),y=new Float32Array(g/2),w=0;w<Math.ceil(g/2);w++){var _=(b?2:-2)*Math.PI*(w/g);x[w]=Math.cos(_),y[w]=Math.sin(_)}return{real:x,imag:y}})(r,o),d=St(f.real,f.imag).mul(l),h=u.add(d),p=u.sub(d),v=yn(h).concat(yn(p)),m=qn(h).concat(qn(p));return St(v,m).as1D()},n.prototype.fourierTransformByMatmul=function(t,r,o){for(var i=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,c=0;c<r;c++){var l=i2(a*c,r,o),f=lh(t,c);s+=f.real*l.real-f.imag*l.imag,u+=f.real*l.imag+f.imag*l.real}o&&(s/=r,u/=r),o2(i,s,u,a)}return i},n.prototype.depthToSpace=function(t,r,o){T(o==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o})),T(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var i=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],c=a*r,l=s*r,f=u/(r*r),d=this.readSync(t.dataId),h=new Float32Array(i*c*l*f),p=0,v=0;v<i;++v)for(var m=0;m<c;++m)for(var g=Math.floor(m/r),b=m%r,x=0;x<l;++x)for(var y=Math.floor(x/r),w=(b*r+x%r)*f,_=0;_<f;++_){var S=_+w+u*(y+s*(g+a*v));h[p++]=d[S]}return jt(h,[i,c,l,f])},n.prototype.broadcastedBinaryOp=function(t,r,o,i){var a=Be(t.shape,r.shape),s=Te(a,o),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=Lr(t.shape,a),f=Lr(r.shape,a),d=s.values;if(l.length+f.length===0)for(var h=0;h<d.length;++h)d[h]=i(u[h%u.length],c[h%c.length]);else{var p=this.bufferSync(t),v=this.bufferSync(r),m=function(g){var b=s.indexToLoc(g),x=b.slice(-t.rank);l.forEach((function(S){return x[S]=0}));var y=p.locToIndex(x),w=b.slice(-r.rank);f.forEach((function(S){return w[S]=0}));var _=v.locToIndex(w);d[g]=i(u[y],c[_])};for(h=0;h<d.length;++h)m(h)}return s.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(t,r,o){var i=Be(t.shape,r.shape),a=Te(i,"float32"),s=Te(i,"float32"),u=this.readSync(t.dataId),c=this.readSync(r.dataId),l=Lr(t.shape,i),f=Lr(r.shape,i),d=a.values,h=s.values;if(l.length+f.length===0)for(var p=0;p<d.length;p++){var v=p%u.length,m=p%c.length,g=o(u[2*v],u[2*v+1],c[2*m],c[2*m+1]);d[p]=g.real,h[p]=g.imag}else{var b=this.bufferSync(this.data.get(t.dataId).complexTensors.real),x=this.bufferSync(this.data.get(r.dataId).complexTensors.real),y=function(w){var _=a.indexToLoc(w),S=_.slice(-t.rank);l.forEach((function(k){return S[k]=0}));var R=b.locToIndex(S),E=_.slice(-r.rank);f.forEach((function(k){return E[k]=0}));var C=x.locToIndex(E),I=o(u[2*R],u[2*R+1],c[2*C],c[2*C+1]);d[w]=I.real,h[w]=I.imag};for(p=0;p<d.length;p++)y(p)}return this.complex(a.toTensor(),s.toTensor())},n.prototype.split=function(t,r,o){return Zm(t,r,o)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(t,r,o,i,a,s){for(var u=t.shape,c=u[0],l=u[1],f=u[2],d=u[3],h=r.shape[0],p=i[0],v=i[1],m=Te([h,p,v,d],"float32"),g=this.readSync(r.dataId),b=this.readSync(o.dataId),x=this.readSync(t.dataId),y=t.strides,w=m.strides,_=0;_<h;_++){var S=4*_,R=g[S],E=g[S+1],C=g[S+2],I=g[S+3],k=b[_];if(!(k>=c))for(var M=p>1?(C-R)*(l-1)/(p-1):0,P=v>1?(I-E)*(f-1)/(v-1):0,L=0;L<p;L++){var q=p>1?R*(l-1)+L*M:.5*(R+C)*(l-1);if(q<0||q>l-1)for(var V=0;V<v;V++)for(var F=0;F<d;F++){var H=F+V*w[2]+L*w[1]+_*w[0];m.values[H]=s}else if(a==="bilinear"){var $=Math.floor(q),G=Math.ceil(q),O=q-$;for(V=0;V<v;V++)if((pe=v>1?E*(f-1)+V*P:.5*(E+I)*(f-1))<0||pe>f-1)for(F=0;F<d;F++)H=F+V*w[2]+L*w[1]+_*w[0],m.values[H]=s;else{var re=Math.floor(pe),he=Math.ceil(pe),be=pe-re;for(F=0;F<d;F++){var ae=x[H=F+re*y[2]+$*y[1]+k*y[0]],z=x[H=F+he*y[2]+$*y[1]+k*y[0]],Z=x[H=F+re*y[2]+G*y[1]+k*y[0]],ee=ae+(z-ae)*be,le=Z+(x[H=F+he*y[2]+G*y[1]+k*y[0]]-Z)*be;H=F+V*w[2]+L*w[1]+_*w[0],m.values[H]=ee+(le-ee)*O}}}else for(V=0;V<v;++V){var pe;if((pe=v>1?E*(f-1)+V*P:.5*(E+I)*(f-1))<0||pe>f-1)for(F=0;F<d;F++)H=F+V*w[2]+L*w[1]+_*w[0],m.values[H]=s;else{var D=Math.round(pe),N=Math.round(q);for(F=0;F<d;F++){var U=F+D*y[2]+N*y[1]+k*y[0],X=F+V*w[2]+L*w[1]+_*w[0];m.values[X]=x[U]}}}}}return m.toTensor()},n.prototype.sparseToDense=function(t,r,o,i){var a=ys(0,t,o),s=a.sliceRank,u=a.numUpdates,c=a.sliceSize,l=a.strides,f=a.outputSize;return this.scatter(t,r,o,f,c,u,s,l,i,!1)},n.prototype.gatherND=function(t,r){var o=r.shape,i=o[o.length-1],a=qm(t,r),s=a[0],u=a[1],c=a[2],l=a[3];if(u===0)return kt([],s,t.dtype);for(var f=new Qi([u,c],t.dtype),d=this.readSync(r.dataId),h=this.readSync(t.dataId),p=0;p<u;p++){for(var v=[],m=0,g=0;g<i;g++){var b=d[p*i+g];m+=b*l[g],v.push(b)}if(m<0||m>=t.size/c)throw new Error("Invalid indices: "+v+" does not index into "+t.shape);for(var x=0;x<c;x++)f.values[p*c+x]=h[m*c+x]}return f.toTensor().reshape(s)},n.prototype.scatterND=function(t,r,o){var i=ys(0,t,o),a=i.sliceRank,s=i.numUpdates,u=i.sliceSize,c=i.strides,l=i.outputSize,f=de(0);return this.scatter(t,r,o,l,u,s,a,c,f,!0)},n.prototype.fill=function(t,r,o){var i=us(o=o||sa(r),ye(t));return i.fill(r),W.makeTensor(i,t,o,this)},n.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},n.prototype.zerosLike=function(t){var r=us(t.dtype,ye(t.shape));return this.makeOutput(r,t.shape,t.dtype)},n.prototype.linspace=function(t,r,o){return Qm(t,r,o)},n.prototype.scatter=function(t,r,o,i,a,s,u,c,l,f){var d=[i/a,a],h=this.readSync(t.dataId),p=this.readSync(r.dataId);if(i===0)return kt([],o,r.dtype);var v=new Qi(d,r.dtype);v.values.fill(this.readSync(l.dataId)[0]);for(var m=0;m<s;m++){for(var g=[],b=0,x=0;x<u;x++){var y=h[m*u+x];g.push(y),b+=y*c[x]}if(b<0||b>=i/a)throw new Error("Invalid indices: "+g+" does not index into "+o);for(var w=0;w<a;w++)f?v.values[b*a+w]+=p[m*a+w]:v.values[b*a+w]=r.rank===0?p[0]:p[m*a+w]}return v.toTensor().reshape(o)},n})(Km);W.registerBackend("cpu",(function(){return new SR}),1);for(var Ju=0,Nh=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=t;te(i,"NonMaxSuppressionWithScore");var h=Hl(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,o=t;te(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:ea,backendName:"cpu",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,o=r.a,i=r.b,a=t;te([o,i],ea);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=(function(d,h,p,v,m,g){var b=Be(d,h),x=b.length,y=Xn(b),w=Yi(m,ye(b)),_=d.length,S=h.length,R=Xn(d),E=Xn(h),C=Lr(d,b),I=Lr(h,b);if(C.length+I.length===0)for(var k=0;k<w.length;++k)w[k]=g(p[k%p.length],v[k%v.length]);else{var M=function(P){var L=M1(P,x,y),q=L.slice(-_);C.forEach((function($){return q[$]=0}));var V=th(q,_,R),F=L.slice(-S);I.forEach((function($){return F[$]=0}));var H=th(F,S,E);w[P]=g(p[V],v[H])};for(k=0;k<w.length;++k)M(k)}return[w,b]})(o.shape,i.shape,s,u,o.dtype,(function(d,h){var p=d-h;return p*p})),l=c[0],f=c[1];return{dataId:a.write(l,f,o.dtype),shape:f,dtype:o.dtype}}}];Ju<Nh.length;Ju++)_m(Nh[Ju]);var Po,RR=function(e){this.variableNames=["A"];var n=Pt(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+n.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},kR=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Pt(),t=e[0],r=e[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+n.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+n.output+` = result;
      }
    `};for(var Zu=0,Fh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs,o=n.pixels,i=r.numChannels,a=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],f=[l,c],d=[l,c,i];(s||a)&&(Po==null&&(Po=document.createElement("canvas").getContext("2d")),Po.canvas.width=c,Po.canvas.height=l,Po.drawImage(o,0,0,c,l),o=Po.canvas);var h=t.makeTensorInfo(f,"int32");t.texData.get(h.dataId).usage=sn.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(h.dataId),o);var p=Q().getBool("WEBGL_PACK")?new kR(d):new RR(d),v=t.runWebGLProgram(p,[h],"int32");return t.disposeData(h.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=e.attrs;ds("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=n,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,f=s.softNmsSigma,d=t,h=Hl(d.readSync(i.dataId),d.readSync(a.dataId),u,c,l,f);return[h.selectedIndices,h.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n.x,o=t,i=new Fe(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:ea,backendName:"webgl",kernelFunc:function(e){var n=e.inputs,t=e.backend,r=n,o=r.a,i=r.b,a=t,s=Q().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new sr("return (a - b) * (a - b);",o.shape,i.shape):new tt("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Zu<Fh.length;Zu++)_m(Fh[Zu]);for(var ec=0,Ph=[{kernelName:"Square",gradFunc:function(e,n){var t=n[0];return{x:function(){return e.mul(t.toFloat().mul(2))}}}},{kernelName:ea,gradFunc:function(e,n){var t=n[0],r=n[1],o=de(2);return{a:function(){return Ot(e,Ot(o,mt(t,r)))},b:function(){return Ot(e,Ot(o,mt(r,t)))}}}}];ec<Ph.length;ec++)E1(Ph[ec]);var IR=(function(){function e(){}return e.prototype.fetch=function(n,t){return fetch(n,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return new TextDecoder(t).decode(n)},e})();Q().get("IS_BROWSER")&&Q().setPlatform("browser",new IR);var tc,AR=function(){return require("node-fetch")},TR=(function(){function e(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(n,t){return Q().global.fetch!=null?Q().global.fetch(n,t):(tc==null&&(tc=AR()),tc(n,t))},e.prototype.now=function(){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6},e.prototype.encode=function(n,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(n)},e.prototype.decode=function(n,t){return n.length===0?"":new this.util.TextDecoder(t).decode(n)},e})();Q().get("IS_NODE")&&Q().setPlatform("node",new TR);var Yc={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ss=4;function Gg(e,n){for(var t={},r=0,o=function(s){var u=s.name,c=s.dtype,l=s.shape,f=ye(l),d=void 0;if("quantization"in s){var h=s.quantization;if(h.dtype!=="uint8"&&h.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+h.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var p=Yc[h.dtype],v=e.slice(r,r+f*p),m=h.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(c==="float32")d=Float32Array.from(m,(function(_){return _*h.scale+h.min}));else{if(c!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=Int32Array.from(m,(function(_){return Math.round(_*h.scale+h.min)}))}r+=f*p}else if(c==="string"){var g=ye(s.shape);d=[];for(var b=0;b<g;b++){var x=new Uint32Array(e.slice(r,r+Ss))[0];r+=Ss;var y=new Uint8Array(e.slice(r,r+x));d.push(y),r+=x}}else{var w=Yc[c];if(v=e.slice(r,r+f*w),c==="float32")d=new Float32Array(v);else if(c==="int32")d=new Int32Array(v);else{if(c!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+c);d=new Uint8Array(v)}r+=f*w}t[u]=kt(d,l,c)},i=0,a=n;i<a.length;i++)o(a[i]);return t}function DR(e){if(e===null)throw new Error("Invalid input value: "+JSON.stringify(e));var n=0,t=[];e.forEach((function(i){if(n+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)}));var r=new Uint8Array(n),o=0;return t.forEach((function(i){r.set(new Uint8Array(i.buffer),o),o+=i.byteLength})),r.buffer}var Qc=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Mh(e){return Qc?Buffer.byteLength(e):new Blob([e]).size}function lf(e){var n=0;e.forEach((function(o){n+=o.byteLength}));var t=new Uint8Array(n),r=0;return e.forEach((function(o){t.set(new Uint8Array(o),r),r+=o.byteLength})),t.buffer}function Oh(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var n=e.split("/");return n[n.length-1]}function pa(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:e.modelTopology==null?0:Mh(JSON.stringify(e.modelTopology)),weightSpecsBytes:e.weightSpecs==null?0:Mh(JSON.stringify(e.weightSpecs)),weightDataBytes:e.weightData==null?0:e.weightData.byteLength}}var un=(function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerSaveRouter=function(n){e.getInstance().saveRouters.push(n)},e.registerLoadRouter=function(n){e.getInstance().loadRouters.push(n)},e.getSaveHandlers=function(n){return e.getHandlers(n,"save")},e.getLoadHandlers=function(n,t){return e.getHandlers(n,"load",t)},e.getHandlers=function(n,t,r){var o=[];return(t==="load"?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(i){var a=i(n,r);a!==null&&o.push(a)})),o},e})(),ti="://",zr=(function(){function e(){this.managers={}}return e.getInstance=function(){return e.instance==null&&(e.instance=new e),e.instance},e.registerManager=function(n,t){T(n!=null,(function(){return"scheme must not be undefined or null."})),n.endsWith(ti)&&(n=n.slice(0,n.indexOf(ti))),T(n.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();T(r.managers[n]==null,(function(){return"A model store manager is already registered for scheme '"+n+"'."})),r.managers[n]=t},e.getManager=function(n){var t=this.getInstance().managers[n];if(t==null)throw new Error("Cannot find model manager for scheme '"+n+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e})();function Ga(e){if(e.indexOf(ti)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+zr.getSchemes().join(","));return{scheme:e.split(ti)[0],path:e.split(ti)[1]}}function Bh(e,n,t){return t===void 0&&(t=!1),me(this,void 0,void 0,(function(){var r,o,i,a,s,u,c,l,f;return ge(this,(function(d){switch(d.label){case 0:return T(e!==n,(function(){return"Old path and new path are the same: '"+e+"'"})),T((r=un.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),T(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),o=r[0],T((i=un.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+n+"."})),T(i.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+n+"."})),a=i[0],s=Ga(e).scheme,u=Ga(e).path,c=s===Ga(e).scheme,[4,o.load()];case 1:return l=d.sent(),t&&c?[4,zr.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return f=d.sent(),!t||c?[3,6]:[4,zr.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,f.modelArtifactsInfo]}}))}))}var co="models_store",Wr="model_info_store";function jg(){if(!Q().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,n=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function Jc(e){var n=e.result;n.createObjectStore(co,{keyPath:"modelPath"}),n.createObjectStore(Wr,{keyPath:"modelPath"})}var ni=(function(){function e(n){if(this.indexedDB=jg(),n==null||!n)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=n}return e.prototype.save=function(n){return me(this,void 0,void 0,(function(){return ge(this,(function(t){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,n)]}))}))},e.prototype.load=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(n){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(n,t){var r=this;return new Promise((function(o,i){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return Jc(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(co,"readonly"),c=u.objectStore(co).get(r.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));o(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var l,f=pa(t),d=s.transaction(Wr,"readwrite"),h=d.objectStore(Wr),p=h.put({modelPath:r.modelPath,modelArtifactsInfo:f});p.onsuccess=function(){var v=(l=s.transaction(co,"readwrite")).objectStore(co).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});v.onsuccess=function(){return o({modelArtifactsInfo:f})},v.onerror=function(m){var g=(h=d.objectStore(Wr)).delete(r.modelPath);g.onsuccess=function(){return s.close(),i(v.error)},g.onerror=function(b){return s.close(),i(v.error)}}},p.onerror=function(v){return s.close(),i(p.error)},d.oncomplete=function(){l==null?s.close():l.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return i(a.error)}}))},e.URL_SCHEME="indexeddb://",e})(),Lh=function(e){return Q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ni.URL_SCHEME)?(n=e.slice(ni.URL_SCHEME.length),new ni(n)):null;var n};un.registerSaveRouter(Lh),un.registerLoadRouter(Lh);var NR=(function(){function e(){this.indexedDB=jg()}return e.prototype.listModels=function(){return me(this,void 0,void 0,(function(){var n=this;return ge(this,(function(t){return[2,new Promise((function(r,o){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return Jc(i)},i.onsuccess=function(){var a=i.result,s=a.transaction(Wr,"readonly"),u=s.objectStore(Wr).getAll();u.onsuccess=function(){for(var c={},l=0,f=u.result;l<f.length;l++){var d=f[l];c[d.modelPath]=d.modelArtifactsInfo}r(c)},u.onerror=function(c){return a.close(),o(u.error)},s.oncomplete=function(){return a.close()}},i.onerror=function(a){return o(i.error)}}))]}))}))},e.prototype.removeModel=function(n){return me(this,void 0,void 0,(function(){var t=this;return ge(this,(function(r){var o;return n=(o=n).startsWith(ni.URL_SCHEME)?o.slice(ni.URL_SCHEME.length):o,[2,new Promise((function(i,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return Jc(s)},s.onsuccess=function(){var u,c=s.result,l=c.transaction(Wr,"readwrite"),f=l.objectStore(Wr),d=f.get(n);d.onsuccess=function(){if(d.result==null)return c.close(),a(new Error("Cannot find model with path '"+n+"' in IndexedDB."));var h=f.delete(n),p=function(){var v=(u=c.transaction(co,"readwrite")).objectStore(co).delete(n);v.onsuccess=function(){return i(d.result.modelArtifactsInfo)},v.onerror=function(m){return a(d.error)}};h.onsuccess=p,h.onerror=function(v){return p(),c.close(),a(d.error)}},d.onerror=function(h){return c.close(),a(d.error)},l.oncomplete=function(){u==null?c.close():u.oncomplete=function(){return c.close()}}},s.onerror=function(u){return a(s.error)}}))]}))}))},e})();if(Q().getBool("IS_BROWSER"))try{zr.registerManager(ni.URL_SCHEME,new NR)}catch{}var pr="/",Ho="tensorflowjs_models",$g="info",FR="model_topology",PR="weight_specs",MR="weight_data",OR="model_metadata";function Kg(e){return{info:[Ho,e,$g].join(pr),topology:[Ho,e,FR].join(pr),weightSpecs:[Ho,e,PR].join(pr),weightData:[Ho,e,MR].join(pr),modelMetadata:[Ho,e,OR].join(pr)}}function BR(e){var n=e.split(pr);if(n.length<3)throw new Error("Invalid key format: "+e);return n.slice(1,n.length-1).join(pr)}var ri=(function(){function e(n){if(!Q().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,n==null||!n)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=n,this.keys=Kg(this.modelPath)}return e.prototype.save=function(n){return me(this,void 0,void 0,(function(){var t,r,o;return ge(this,(function(i){if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(n.modelTopology),r=JSON.stringify(n.weightSpecs),o=pa(n);try{return this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(a){if(Qc)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",c=0,l=s.length;c<l;c++)u+=String.fromCharCode(s[c]);return btoa(u)})(n.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata})),[2,{modelArtifactsInfo:o}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+o.modelTopologyBytes+", weightSpecsBytes="+o.weightSpecsBytes+", weightDataBytes="+o.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return me(this,void 0,void 0,(function(){var n,t,r,o,i,a,s;return ge(this,(function(u){if((n=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(n.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(o=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=o,(i=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(i),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(c){if(Qc){var l=Buffer.from(c,"base64");return l.buffer.slice(l.byteOffset,l.byteOffset+l.byteLength)}for(var f=atob(c),d=new Uint8Array(f.length),h=0;h<f.length;++h)d.set([f.charCodeAt(h)],h);return d.buffer})(s),[2,t]}))}))},e.URL_SCHEME="localstorage://",e})(),Wh=function(e){return Q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ri.URL_SCHEME)?(n=e.slice(ri.URL_SCHEME.length),new ri(n)):null;var n};un.registerSaveRouter(Wh),un.registerLoadRouter(Wh);var LR=(function(){function e(){T(Q().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),T(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return me(this,void 0,void 0,(function(){var n,t,r,o,i,a;return ge(this,(function(s){for(n={},t=Ho+pr,r=pr+$g,o=0;o<this.LS.length;++o)(i=this.LS.key(o)).startsWith(t)&&i.endsWith(r)&&(a=BR(i),n[a]=JSON.parse(this.LS.getItem(i)));return[2,n]}))}))},e.prototype.removeModel=function(n){return me(this,void 0,void 0,(function(){var t,r;return ge(this,(function(o){var i;if(n=(i=n).startsWith(ri.URL_SCHEME)?i.slice(ri.URL_SCHEME.length):i,t=Kg(n),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+n+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},e})();if(Q().getBool("IS_BROWSER"))try{zr.registerManager(ri.URL_SCHEME,new LR)}catch{}var WR="model",VR=".json",UR=".weights.bin";function Vh(e){return new Promise((function(n){return setTimeout(n)})).then(e)}var nc=(function(){function e(n){if(!Q().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");n.startsWith(e.URL_SCHEME)&&(n=n.slice(e.URL_SCHEME.length)),n!=null&&n.length!==0||(n=WR),this.modelTopologyFileName=n+VR,this.weightDataFileName=n+UR}return e.prototype.save=function(n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s;return ge(this,(function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([n.weightData],{type:"application/octet-stream"})),!(n.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:r},i=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=i,[4,Vh((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return u.sent(),n.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,Vh((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:pa(n)}]}}))}))},e.URL_SCHEME="downloads://",e})(),zR=(function(){function e(n){if(n==null||n.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+n);this.files=n}return e.prototype.load=function(){return me(this,void 0,void 0,(function(){var n,t,r=this;return ge(this,(function(o){return n=this.files[0],t=this.files.slice(1),[2,new Promise((function(i,a){var s=new FileReader;s.onload=function(u){var c=JSON.parse(u.target.result),l=c.modelTopology;if(l!=null){t.length===0&&i({modelTopology:l});var f=c.weightsManifest;if(f!=null){var d;try{d=r.checkManifestAndWeightFiles(f,t)}catch(m){return void a(m)}var h=[],p=[],v=[];f.forEach((function(m){m.paths.forEach((function(g){p.push(g),v.push(null)})),h.push.apply(h,m.weights)})),f.forEach((function(m){m.paths.forEach((function(g){var b=new FileReader;b.onload=function(x){var y=x.target.result,w=p.indexOf(g);v[w]=y,v.indexOf(null)===-1&&i({modelTopology:l,weightSpecs:h,weightData:lf(v),format:c.format,generatedBy:c.generatedBy,convertedBy:c.convertedBy,userDefinedMetadata:c.userDefinedMetadata})},b.onerror=function(x){return a("Failed to weights data from file of path '"+g+"'.")},b.readAsArrayBuffer(d[g])}))}))}else a(new Error("weightManifest field is missing from file "+n.name))}else a(new Error("modelTopology field is missing from file "+n.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+n.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(n)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(n,t){for(var r=[],o=t.map((function(u){return Oh(u.name)})),i={},a=0,s=n;a<s.length;a++)s[a].paths.forEach((function(u){var c=Oh(u);if(r.indexOf(c)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+c+"'");if(r.push(c),o.indexOf(c)===-1)throw new Error("Weight file with basename '"+c+"' is not provided.");i[u]=t[o.indexOf(c)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return i},e})();function Uh(e,n,t,r){(function(i){T(i!=null&&Array.isArray(i)&&i.length>0,(function(){return"promises must be a none empty array"}))})(e),(function(i,a){T(i>=0&&i<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+i})),T(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a})),T(a>=i,(function(){return"startFraction must be no more than endFraction, but got startFraction "+i+" and endFraction "+a}))})(t=t??0,r=r??1);var o=0;return Promise.all(e.map((function(i){return i.then((function(a){var s=t+ ++o/e.length*(r-t);return n(s),a})),i})))}function Xg(e,n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l;return ge(this,(function(f){switch(f.label){case 0:return n==null&&(n={}),t=n.fetchFunc==null?Q().platform.fetch:n.fetchFunc,r=e.map((function(d){return t(d,n.requestInit,{isBinary:!0})})),o=0,i=.5,n.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=f.sent(),[3,4];case 2:return[4,Uh(r,n.onProgress,o,i)];case 3:a=f.sent(),f.label=4;case 4:return s=a.map((function(d){return d.arrayBuffer()})),u=.5,c=1,n.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return l=f.sent(),[3,8];case 6:return[4,Uh(s,n.onProgress,u,c)];case 7:l=f.sent(),f.label=8;case 8:return[2,l]}}))}))}function zh(e){var n=this;return function(t,r,o){return r===void 0&&(r=""),me(n,void 0,void 0,(function(){var i,a,s,u,c,l,f,d,h,p;return ge(this,(function(v){switch(v.label){case 0:if(i=t.map((function(){return!1})),a={},s=o!=null?o.map((function(){return!1})):[],u=[],t.forEach((function(m,g){var b=0;m.weights.forEach((function(x){var y="quantization"in x?x.quantization.dtype:x.dtype,w=Yc[y]*ye(x.shape),_=function(){i[g]=!0,a[g]==null&&(a[g]=[]),a[g].push({manifestEntry:x,groupOffset:b,sizeBytes:w})};o!=null?o.forEach((function(S,R){S===x.name&&(_(),s[R]=!0)})):_(),u.push(x.name),b+=w}))})),!s.every((function(m){return m})))throw c=o.filter((function(m,g){return!s[g]})),new Error("Could not find weights in manifest with names: "+c.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return l=i.reduce((function(m,g,b){return g&&m.push(b),m}),[]),f=[],l.forEach((function(m){t[m].paths.forEach((function(g){var b=r+(r.endsWith("/")?"":"/")+g;f.push(b)}))})),[4,e(f)];case 1:return d=v.sent(),h={},p=0,l.forEach((function(m){for(var g=t[m].paths.length,b=0,x=0;x<g;x++)b+=d[p+x].byteLength;for(var y=new ArrayBuffer(b),w=new Uint8Array(y),_=0,S=0;S<g;S++){var R=new Uint8Array(d[p+S]);w.set(R,_),_+=R.byteLength}a[m].forEach((function(E){var C=Gg(y.slice(E.groupOffset,E.groupOffset+E.sizeBytes),[E.manifestEntry]);for(var I in C)h[I]=C[I]})),p+=g})),[2,h]}}))}))}}un.registerSaveRouter((function(e){return Q().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(nc.URL_SCHEME)?(function(n){return n===void 0&&(n="model"),new nc(n)})(e.slice(nc.URL_SCHEME.length)):null}));var Yg=(function(){function e(n,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(T(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=Q().platform.fetch,T(n!=null&&n.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(n)&&T(n.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+n.length+")."})),this.path=n,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(n){return me(this,void 0,void 0,(function(){var t,r,o,i;return ge(this,(function(a){switch(a.label){case 0:if(n.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:n.weightSpecs}],o={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,userDefinedMetadata:n.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(o)],{type:"application/json"}),"model.json"),n.weightData!=null&&t.body.append("model.weights.bin",new Blob([n.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((i=a.sent()).ok)return[2,{modelArtifactsInfo:pa(n),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+i.status+".")}}))}))},e.prototype.load=function(){return me(this,void 0,void 0,(function(){var n,t,r,o,i,a,s,u,c,l,f,d;return ge(this,(function(h){switch(h.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(n=h.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+n.status+". Please verify this URL points to the model JSON of the model to load.");h.label=2;case 2:return h.trys.push([2,4,,5]),[4,n.json()];case 3:return t=h.sent(),[3,5];case 4:throw h.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(o=t.modelTopology,i=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,c=t.userDefinedMetadata,o==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return i==null?[3,7]:[4,this.loadWeights(i)];case 6:d=h.sent(),l=d[0],f=d[1],h.label=7;case 7:return[2,{modelTopology:o,weightSpecs:l,weightData:f,userDefinedMetadata:c,generatedBy:a,convertedBy:s,format:u}]}}))}))},e.prototype.loadWeights=function(n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f,d;return ge(this,(function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(p){var v=p.lastIndexOf("/"),m=p.lastIndexOf("?"),g=p.substring(0,v),b=m>v?p.substring(m):"";return[g+"/",b]})(t),o=r[0],i=r[1],a=this.weightPathPrefix||o,s=[],u=0,c=n;u<c.length;u++)l=c[u],s.push.apply(s,l.weights);return f=[],n.forEach((function(p){p.paths.forEach((function(v){f.push(a+v+i)}))})),[4,Xg(f,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return d=h.sent(),[2,[s,lf(d)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e})();function Zc(e){return e.match(Yg.URL_SCHEME_REGEX)!=null}var qh=function(e,n){return typeof fetch>"u"?null:(Array.isArray(e)?e.every((function(t){return Zc(t)})):Zc(e))?el(e,{onProgress:n}):null};function el(e,n){return new Yg(e,n)}un.registerSaveRouter(qh),un.registerLoadRouter(qh);var rc=(function(){function e(n){this.modelArtifacts=n}return e.prototype.load=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(n){return[2,this.modelArtifacts]}))}))},e})(),qR=(function(){function e(n){this.saveHandler=n}return e.prototype.save=function(n){return me(this,void 0,void 0,(function(){return ge(this,(function(t){return[2,this.saveHandler(n)]}))}))},e})(),Qg=Object.freeze({browserFiles:function(e){return new zR(e)},browserHTTPRequest:function(e,n){return el(e,n)},concatenateArrayBuffers:lf,decodeWeights:Gg,encodeWeights:function(e,n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s=this;return ge(this,(function(u){switch(u.label){case 0:for(t=[],r=[],o=Array.isArray(e)?e.map((function(c){return c.name})):Object.keys(e),i=function(c){var l=o[c],f=Array.isArray(e)?e[c].tensor:e[l];if(f.dtype!=="float32"&&f.dtype!=="int32"&&f.dtype!=="bool"&&f.dtype!=="string")throw new Error("Unsupported dtype in weight '"+l+"': "+f.dtype);var d={name:l,shape:f.shape,dtype:f.dtype};if(f.dtype==="string"){var h=new Promise((function(p){return me(s,void 0,void 0,(function(){var v,m,g,b,x,y,w;return ge(this,(function(_){switch(_.label){case 0:return[4,f.bytes()];case 1:for(v=_.sent(),m=v.reduce((function(S,R){return S+R.length}),0)+Ss*v.length,g=new Uint8Array(m),b=0,x=0;x<v.length;x++)y=v[x],w=new Uint8Array(new Uint32Array([y.length]).buffer),g.set(w,b),b+=Ss,g.set(y,b),b+=y.length;return p(g),[2]}}))}))}));r.push(h)}else r.push(f.data());n!=null&&(d.group=n),t.push(d)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:DR(u.sent()),specs:t}]}}))}))},fromMemory:function(e,n,t,r){return arguments.length===1?e.modelTopology!=null||e.weightSpecs!=null?new rc(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rc({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new rc({modelTopology:e,weightSpecs:n,weightData:t,trainingConfig:r}))},getLoadHandlers:function(e,n){return un.getLoadHandlers(e,n)},getModelArtifactsInfoForJSON:pa,getSaveHandlers:function(e){return un.getSaveHandlers(e)},http:el,isHTTPScheme:Zc,loadWeights:function(e,n,t,r){return n===void 0&&(n=""),me(this,void 0,void 0,(function(){return ge(this,(function(o){return[2,zh((function(i){return Xg(i,{requestInit:r})}))(e,n,t)]}))}))},registerLoadRouter:function(e){return un.registerLoadRouter(e)},registerSaveRouter:function(e){return un.registerSaveRouter(e)},weightsLoaderFactory:zh,withSaveHandler:function(e){return new qR(e)},copyModel:function(e,n){return me(this,void 0,void 0,(function(){return ge(this,(function(t){return[2,Bh(e,n,!1)]}))}))},listModels:function(){return me(this,void 0,void 0,(function(){var e,n,t,r,o,i,a;return ge(this,(function(s){switch(s.label){case 0:e=zr.getSchemes(),n={},t=0,r=e,s.label=1;case 1:return t<r.length?(o=r[t],[4,zr.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())n[o+ti+a]=i[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,n]}}))}))},moveModel:function(e,n){return me(this,void 0,void 0,(function(){return ge(this,(function(t){return[2,Bh(e,n,!0)]}))}))},removeModel:function(e){return me(this,void 0,void 0,(function(){var n;return ge(this,(function(t){return n=Ga(e),[2,zr.getManager(n.scheme).removeModel(n.path)]}))}))}}),Mo;B({confusionMatrix_:function(e,n,t){var r=A(e,"labels","confusionMatrix"),o=A(n,"predictions","confusionMatrix");T(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),T(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),T(o.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),T(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),T(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var i=Gc(r.asType("int32"),t),a=Gc(o.asType("int32"),t);return i.transpose().matMul(a).asType("int32")}});var HR=B({fromPixels_:function(e,n){if(n===void 0&&(n=3),n>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,o=!1,i=!1,a=!1;if(e.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&e instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)i=!0;else{if(e.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(o&&o&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(wm("FromPixels",W.backendName)!=null)return W.runKernel("FromPixels",{pixels:e},{numChannels:n});var s,u,c=o?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],f=c[1];if(a?s=e.getContext("2d").getImageData(0,0,l,f).data:r||t?s=e.data:(i||o)&&(Mo==null&&(Mo=document.createElement("canvas").getContext("2d")),Mo.canvas.width=l,Mo.canvas.height=f,Mo.drawImage(e,0,0,l,f),s=Mo.getImageData(0,0,l,f).data),n===4)u=new Int32Array(s);else{var d=l*f;u=new Int32Array(d*n);for(var h=0;h<d;h++)for(var p=0;p<n;++p)u[h*n+p]=s[4*h+p]}return Ll(u,[f,l,n],"int32")}}),ff=Object.freeze({toPixels:function(e,n){return me(this,void 0,void 0,(function(){var t,r,o,i,a,s,u,c,l,f,d,h,p,v,m,g,b,x,y,w,_,S,R;return ge(this,(function(E){switch(E.label){case 0:if(t=A(e,"img","toPixels"),e instanceof Je||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),o=r[0],i=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=E.sent(),u=t.min(),c=t.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=E.sent(),f=l[0],d=l[1],h=f[0],p=d[0],u.dispose(),c.dispose(),t.dtype==="float32"){if(h<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+p+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(h<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+p+"].")}for(v=t.dtype==="float32"?255:1,m=new Uint8ClampedArray(i*o*4),g=0;g<o*i;++g)b=void 0,x=void 0,y=void 0,w=void 0,a===1?(b=s[g]*v,x=s[g]*v,y=s[g]*v,w=255):a===3?(b=s[3*g]*v,x=s[3*g+1]*v,y=s[3*g+2]*v,w=255):a===4&&(b=s[4*g]*v,x=s[4*g+1]*v,y=s[4*g+2]*v,w=s[4*g+3]*v),m[(_=4*g)+0]=Math.round(b),m[_+1]=Math.round(x),m[_+2]=Math.round(y),m[_+3]=Math.round(w);return n!=null&&(n.width=i,n.height=o,S=n.getContext("2d"),R=new ImageData(m,i,o),S.putImageData(R,0,0)),t!==e&&t.dispose(),[2,m]}}))}))},fromPixels:HR}),GR=(function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(n,t){return new n(t)},e})(),jR=(function(){function e(){this.classNameMap={}}return e.getMap=function(){return e.instance==null&&(e.instance=new e),e.instance},e.register=function(n){e.getMap().classNameMap[n.className]=[n,n.fromConfig]},e})();function Ro(e){T(e.className!=null,(function(){return"Class being registered does not have the static className property defined."})),T(typeof e.className=="string",(function(){return"className is required to be a string, but got type "+typeof e.className})),T(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),jR.register(e)}var ko=(function(e){function n(){return e!==null&&e.apply(this,arguments)||this}return Nn(n,e),n.prototype.minimize=function(t,r,o){r===void 0&&(r=!1);var i=this.computeGradients(t,o),a=i.value,s=i.grads;if(o!=null){var u=o.map((function(c){return{name:c.name,tensor:s[c.name]}}));this.applyGradients(u)}else this.applyGradients(s);return Yt(s),r?a:(a.dispose(),null)},Object.defineProperty(n.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),n.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},n.prototype.computeGradients=function(t,r){return n2(t,r)},n.prototype.dispose=function(){this.iterations_!=null&&Yt(this.iterations_)},n.prototype.saveIterations=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:de(this.iterations_,"int32")}]}))}))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},n.prototype.extractIterations=function(t){return me(this,void 0,void 0,(function(){var r;return ge(this,(function(o){switch(o.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=o.sent()[0],[2,t.slice(1)]}}))}))},n})(GR);Object.defineProperty(ko,Symbol.hasInstance,{value:function(e){return e.minimize!=null&&e.computeGradients!=null&&e.applyGradients!=null}});var $R=(function(e){function n(t,r,o){o===void 0&&(o=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=o,i.accumulatedGrads=[],i.accumulatedUpdates=[],o==null&&(i.epsilon=W.backend.epsilon()),i}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=W.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accum_grad",variable:ve((function(){return Le(a).variable(!1)}))}),r.accumulatedUpdates[i]==null&&(r.accumulatedUpdates[i]={originalName:o+"/accum_var",variable:ve((function(){return Le(a).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedGrads[i].variable,c=r.accumulatedUpdates[i].variable;ve((function(){var l=u.mul(r.rho).add(s.square().mul(1-r.rho)),f=c.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),d=c.mul(r.rho).add(f.square().mul(1-r.rho));u.assign(l),c.assign(d);var h=f.mul(-r.learningRate).add(a);a.assign(h)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Yt(this.accumulatedGrads.map((function(t){return t.variable}))),Yt(this.accumulatedUpdates.map((function(t){return t.variable}))))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){var t;return ge(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){var r;return ge(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},n.className="Adadelta",n})(ko);Ro($R);var KR=(function(e){function n(t,r){r===void 0&&(r=.1);var o=e.call(this)||this;return o.learningRate=t,o.initialAccumulatorValue=r,o.accumulatedGrads=[],o}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=W.registeredVariables[o];r.accumulatedGrads[i]==null&&(r.accumulatedGrads[i]={originalName:o+"/accumulator",variable:ve((function(){return Yn(a.shape,r.initialAccumulatorValue).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedGrads[i].variable;ve((function(){var c=u.add(s.square());u.assign(c);var l=s.div(c.add(W.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(l)}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedGrads!=null&&Yt(this.accumulatedGrads.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},n.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},n.className="Adagrad",n})(ko);Ro(KR);var XR=(function(e){function n(t,r,o,i){i===void 0&&(i=null);var a=e.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=o,a.epsilon=i,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],ve((function(){a.accBeta1=de(r).variable(),a.accBeta2=de(o).variable()})),i==null&&(a.epsilon=W.backend.epsilon()),a}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t);ve((function(){var i=mt(1,r.accBeta1),a=mt(1,r.accBeta2);o.forEach((function(s,u){var c=W.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:ve((function(){return Le(c).variable(!1)}))}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:ve((function(){return Le(c).variable(!1)}))});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,h=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=d.mul(r.beta2).add(l.square().mul(1-r.beta2)),v=h.div(i),m=p.div(a);f.assign(h),d.assign(p);var g=v.div(m.sqrt().add(r.epsilon)).mul(-r.learningRate).add(c);c.assign(g)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Yt(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&Yt(this.accumulatedSecondMoment.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){var t;return ge(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){var r,o=this;return ge(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),ve((function(){o.accBeta1.assign(Cs(o.beta1,o.iterations_+1)),o.accBeta2.assign(Cs(o.beta2,o.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},n.className="Adam",n})(ko);Ro(XR);var YR=(function(e){function n(t,r,o,i,a){i===void 0&&(i=null),a===void 0&&(a=0);var s=e.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=o,s.epsilon=i,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],ve((function(){s.iteration=de(0).variable(),s.accBeta1=de(r).variable()})),i==null&&(s.epsilon=W.backend.epsilon()),s}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this,o=Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t);ve((function(){var i=mt(1,r.accBeta1),a=Sn(-r.learningRate,r.iteration.mul(r.decay).add(1));o.forEach((function(s,u){var c=W.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Le(c).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Le(c).variable(!1)});var l=Array.isArray(t)?t[u].tensor:t[s];if(l!=null){var f=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,h=f.mul(r.beta1).add(l.mul(1-r.beta1)),p=d.mul(r.beta2),v=l.abs(),m=p.maximum(v);f.assign(h),d.assign(m);var g=a.div(i).mul(h.div(m.add(r.epsilon))).add(c);c.assign(g)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},n.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Yt(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&Yt(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},n.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},n.className="Adamax",n})(ko);Ro(YR);var Jg=(function(e){function n(t){var r=e.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=Array.isArray(t)?t[i].tensor:t[o];if(a!=null){var s=W.registeredVariables[o];ve((function(){var u=r.c.mul(a).add(s);s.assign(u)}))}})),this.incrementIterations()},n.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=m_(de(-t))},n.prototype.dispose=function(){this.c.dispose()},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate}},n.fromConfig=function(t,r){return new t(r.learningRate)},n.className="SGD",n})(ko);Ro(Jg);var QR=(function(e){function n(t,r,o){o===void 0&&(o=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=o,i.accumulations=[],i.m=de(i.momentum),i}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=W.registeredVariables[o];r.accumulations[i]==null&&(r.accumulations[i]={originalName:o+"/momentum",variable:ve((function(){return Le(a).variable(!1)}))});var s=r.accumulations[i].variable,u=Array.isArray(t)?t[i].tensor:t[o];u!=null&&ve((function(){var c,l=r.m.mul(s).add(u);c=r.useNesterov?r.c.mul(u.add(l.mul(r.m))).add(a):r.c.mul(l).add(a),s.assign(l),a.assign(c)}))})),this.incrementIterations()},n.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Yt(this.accumulations.map((function(t){return t.variable})))},n.prototype.setMomentum=function(t){this.momentum=t},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){return ge(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){return ge(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},n.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},n.className="Momentum",n})(Jg);Ro(QR);var JR=(function(e){function n(t,r,o,i,a){r===void 0&&(r=.9),o===void 0&&(o=0),i===void 0&&(i=null),a===void 0&&(a=!1);var s=e.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=o,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,i==null&&(s.epsilon=W.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Nn(n,e),n.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t)).forEach((function(o,i){var a=W.registeredVariables[o];r.accumulatedMeanSquares[i]==null&&(r.accumulatedMeanSquares[i]={originalName:o+"/rms",variable:ve((function(){return Le(a).variable(!1)}))}),r.accumulatedMoments[i]==null&&(r.accumulatedMoments[i]={originalName:o+"/momentum",variable:ve((function(){return Le(a).variable(!1)}))}),r.accumulatedMeanGrads[i]==null&&r.centered&&(r.accumulatedMeanGrads[i]={originalName:o+"/mg",variable:ve((function(){return Le(a).variable(!1)}))});var s=Array.isArray(t)?t[i].tensor:t[o];if(s!=null){var u=r.accumulatedMeanSquares[i].variable,c=r.accumulatedMoments[i].variable;ve((function(){var l=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var f=r.accumulatedMeanGrads[i].variable,d=f.mul(r.decay).add(s.mul(1-r.decay)),h=c.mul(r.momentum).add(s.mul(r.learningRate).div(l.sub(d.square().add(r.epsilon)).sqrt()));u.assign(l),f.assign(d),c.assign(h);var p=a.sub(h);a.assign(p)}else{var v=u.mul(r.decay).add(s.square().mul(1-r.decay));h=c.mul(r.momentum).add(s.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),c.assign(h),p=a.sub(h),a.assign(p)}}))}})),this.incrementIterations()},n.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Yt(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&Yt(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&Yt(this.accumulatedMoments.map((function(t){return t.variable})))},n.prototype.getWeights=function(){return me(this,void 0,void 0,(function(){var t;return ge(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(o){return{name:o.originalName,tensor:o.variable}})))]}}))}))},n.prototype.setWeights=function(t){return me(this,void 0,void 0,(function(){var r;return ge(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}))),[2]}}))}))},n.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},n.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},n.className="RMSProp",n})(ko);Ro(JR);Je.prototype.squaredDifference=function(e){return hg(this,e)},K=ER;var tl=function(e,n){return tl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])},tl(e,n)};function Ae(e,n){tl(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var Nt=function(){return Nt=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Nt.apply(this,arguments)};function we(e,n,t,r){function o(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function s(l){try{c(r.next(l))}catch(f){a(f)}}function u(l){try{c(r.throw(l))}catch(f){a(f)}}function c(l){l.done?i(l.value):o(l.value).then(s,u)}c((r=r.apply(e,[])).next())})}function _e(e,n){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,o&&(i=c[0]&2?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,o=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=n.call(e,t)}catch(l){c=[6,l],o=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function zi(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;for(var r=Array(e),o=0,n=0;n<t;n++)for(var i=arguments[n],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var oi=(function(){function e(n,t){if(!vo(n)||!vo(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:n,height:t}));this._width=n,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e})();function su(e,n){return e instanceof Je&&e.shape.length===n}function ZR(e){return su(e,2)}function uu(e){return su(e,3)}function qr(e){return su(e,4)}function ek(e){return e%1!==0}function Hh(e){return e%2===0}function tk(e,n){n===void 0&&(n=2);var t=Math.pow(10,n);return Math.floor(e*t)/t}function Gh(e){return e&&e.width&&e.height}function nk(e,n){var t=e.width,r=e.height,o=n/Math.max(r,t);return new oi(Math.round(t*o),Math.round(r*o))}function df(e){return e.reduce(function(n,t){return n.add(t)},new Ue(0,0)).div(new Ue(e.length,e.length))}function ta(e,n,t){return Array(e).fill(0).map(function(r,o){return n+o*t})}function vo(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||e===0}function jh(e){return vo(e)&&0<=e&&e<=1}var Ue=(function(){function e(n,t){this._x=n,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(n){return new e(this.x+n.x,this.y+n.y)},e.prototype.sub=function(n){return new e(this.x-n.x,this.y-n.y)},e.prototype.mul=function(n){return new e(this.x*n.x,this.y*n.y)},e.prototype.div=function(n){return new e(this.x/n.x,this.y/n.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e})(),jr=(function(){function e(n,t){t===void 0&&(t=!0);var r=n||{},o=[r.left,r.top,r.right,r.bottom].every(vo),i=[r.x,r.y,r.width,r.height].every(vo);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",t),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(n){return!!n&&[n.x,n.y,n.width,n.height].every(vo)},e.assertIsValidBox=function(n,t,r){if(r===void 0&&(r=!1),!e.isRect(n))throw new Error(t+" - invalid box: "+JSON.stringify(n)+", expected object with properties x, y, width, height");if(!r&&(n.width<0||n.height<0))throw new Error(t+" - width ("+n.width+") and height ("+n.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new Ue(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new Ue(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new Ue(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new Ue(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=n[0],r=n[1],o=n[2],i=n[3];return new e({x:t,y:r,width:o,height:i})},e.prototype.floor=function(){var n=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=n[0],r=n[1],o=n[2],i=n[3];return new e({x:t,y:r,width:o,height:i})},e.prototype.toSquare=function(){var n=this,t=n.x,r=n.y,o=n.width,i=n.height,a=Math.abs(o-i);return o<i&&(t-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new e({x:t,y:r,width:o,height:i})},e.prototype.rescale=function(n){var t=Gh(n)?n.width:n,r=Gh(n)?n.height:n;return new e({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},e.prototype.pad=function(n,t){var r=[this.x-n/2,this.y-t/2,this.width+n,this.height+t],o=r[0],i=r[1],a=r[2],s=r[3];return new e({x:o,y:i,width:a,height:s})},e.prototype.clipAtImageBorders=function(n,t){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,f=s-c,d=Math.min(l,n-u),h=Math.min(f,t-c);return new e({x:u,y:c,width:d,height:h}).floor()},e.prototype.shift=function(n,t){var r=this,o=r.width,i=r.height,a=this.x+n,s=this.y+t;return new e({x:a,y:s,width:o,height:i})},e.prototype.padAtBorders=function(n,t){var r=this.width+1,o=this.height+1,i=1,a=1,s=r,u=o,c=this.left,l=this.top,f=this.right,d=this.bottom;return f>t&&(s=-f+t+r,f=t),d>n&&(u=-d+n+o,d=n),c<1&&(u=2-c,c=1),l<1&&(u=2-l,l=1),{dy:a,edy:u,dx:i,edx:s,y:l,ey:d,x:c,ex:f,w:r,h:o}},e.prototype.calibrate=function(n){return new e({left:this.left+n.left*this.width,top:this.top+n.top*this.height,right:this.right+n.right*this.width,bottom:this.bottom+n.bottom*this.height}).toSquare().round()},e})(),cu=(function(e){Ae(n,e);function n(t,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{left:t,top:r,right:o,bottom:i},a)||this}return n})(jr),Zg=(function(){function e(n,t,r,o,i){this._imageDims=new oi(i.width,i.height),this._score=n,this._classScore=t,this._className=r,this._box=new jr(o).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new jr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:n,height:t})},e})(),nr=(function(e){Ae(n,e);function n(t,r,o){return e.call(this,t,t,"",r,o)||this}return n.prototype.forSize=function(t,r){var o=e.prototype.forSize.call(this,t,r),i=o.score,a=o.relativeBox,s=o.imageDims;return new n(i,a,s)},n})(Zg);function rk(e,n,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(e.right,n.right)-Math.max(e.left,n.left)),o=Math.max(0,Math.min(e.bottom,n.bottom)-Math.max(e.top,n.top)),i=r*o;return t?i/(e.area+n.area-i):i/Math.min(e.area,n.area)}function ok(e){var n=e.map(function(s){return s.x}),t=e.map(function(s){return s.y}),r=n.reduce(function(s,u){return u<s?u:s},1/0),o=t.reduce(function(s,u){return u<s?u:s},1/0),i=n.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new cu(r,o,i,a)}function na(e,n,t,r){r===void 0&&(r=!0);for(var o=n.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),i=[],a=function(){var s=o.pop();i.push(s);for(var u=o,c=[],l=0;l<u.length;l++){var f=u[l],d=e[s],h=e[f];c.push(rk(d,h,r))}o=o.filter(function(p,v){return c[v]<=t})};o.length>0;)a();return i}function va(e,n){return ve(function(){var t=n[0],r=n[1],o=n[2],i=Yn(zi(e.shape.slice(0,3),[1]),t),a=Yn(zi(e.shape.slice(0,3),[1]),r),s=Yn(zi(e.shape.slice(0,3),[1]),o),u=dt([i,a,s],3);return mt(e,u)})}function ik(e,n){return n===void 0&&(n=!1),ve(function(){var t=e.shape.slice(1),r=t[0],o=t[1];if(r===o)return e;var i=Math.abs(r-o),a=Math.round(i*(n?.5:1)),s=r>o?2:1,u=function(h){var p=e.shape.slice();return p[s]=h,Yn(p,0)},c=u(a),l=i-c.shape[s],f=n&&l?u(l):null,d=[f,e,c].filter(function(h){return!!h}).map(function(h){return h.toFloat()});return dt(d,s)})}function oc(e){return 1/(1+Math.exp(-e))}var hf=(function(e){Ae(n,e);function n(t,r,o,i,a){return a===void 0&&(a=!1),e.call(this,{x:t,y:r,width:o,height:i},a)||this}return n})(jr),ak=.5,sk=.43,uk=.45,Rs=(function(){function e(n,t,r){r===void 0&&(r=new Ue(0,0));var o=t.width,i=t.height;this._imgDims=new oi(o,i),this._shift=r,this._positions=n.map(function(a){return a.mul(new Ue(o,i)).add(r)})}return Object.defineProperty(e.prototype,"shift",{get:function(){return new Ue(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var n=this;return this._positions.map(function(t){return t.sub(n._shift).div(new Ue(n.imageWidth,n.imageHeight))})},enumerable:!0,configurable:!0}),e.prototype.forSize=function(n,t){return new this.constructor(this.relativePositions,{width:n,height:t})},e.prototype.shiftBy=function(n,t){return new this.constructor(this.relativePositions,this._imgDims,new Ue(n,t))},e.prototype.shiftByPoint=function(n){return this.shiftBy(n.x,n.y)},e.prototype.align=function(n,t){if(t===void 0&&(t={}),n){var r=n instanceof nr?n.box.floor():new jr(n);return this.shiftBy(r.x,r.y).align(null,t)}var o=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=o.useDlibAlignment,a=o.minBoxPadding;return i?this.alignDlib():this.alignMinBbox(a)},e.prototype.alignDlib=function(){var n=this.getRefPointsForAlignment(),t=n[0],r=n[1],o=n[2],i=function(f){return o.sub(f).magnitude()},a=(i(t)+i(r))/2,s=Math.floor(a/uk),u=df(n),c=Math.floor(Math.max(0,u.x-ak*s)),l=Math.floor(Math.max(0,u.y-sk*s));return new hf(c,l,Math.min(s,this.imageWidth+c),Math.min(s,this.imageHeight+l))},e.prototype.alignMinBbox=function(n){var t=ok(this.positions);return t.pad(t.width*n,t.height*n)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e})(),ck=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],df([t[3],t[4]])]},n})(Rs),lk=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.getJawOutline=function(){return this.positions.slice(0,17)},n.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},n.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},n.prototype.getNose=function(){return this.positions.slice(27,36)},n.prototype.getLeftEye=function(){return this.positions.slice(36,42)},n.prototype.getRightEye=function(){return this.positions.slice(42,48)},n.prototype.getMouth=function(){return this.positions.slice(48,68)},n.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(df)},n})(Rs),$h=(function(){function e(n,t){this._label=n,this._distance=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),e.prototype.toString=function(n){return n===void 0&&(n=!0),""+this.label+(n?" ("+tk(this.distance)+")":"")},e})(),Kh=(function(e){Ae(n,e);function n(t,r){var o=e.call(this,t)||this;return o._label=r,o}return n.assertIsValidLabeledBox=function(t,r){if(jr.assertIsValidBox(t,r),!vo(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),n})(jr),Da=(function(){function e(n,t){if(typeof n!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=n,this._descriptors=t}return Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),e.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(n){return Array.from(n)})}},e.fromJSON=function(n){var t=n.descriptors.map(function(r){return new Float32Array(r)});return new e(n.label,t)},e})();(function(e){Ae(n,e);function n(t,r,o,i){var a=e.call(this,t,r)||this;return a._score=o,a._classScore=i,a}return n.assertIsValidPredictedBox=function(t,r){if(Kh.assertIsValidLabeledBox(t,r),!jh(t.score)||!jh(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),n})(Kh);function fk(e){return e.detection instanceof nr}function pf(e,n){var t={detection:n};return Object.assign({},e,t)}function ey(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},n=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:n}}function ty(e){var n="";if(!e)try{e=require("fs")}catch(r){n=r.toString()}var t=e?function(r){return new Promise(function(o,i){e.readFile(r,function(a,s){return a?i(a):o(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+n)};return{readFile:t}}function ny(){var e=global.Canvas||global.HTMLCanvasElement,n=global.Image||global.HTMLImageElement,t=function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(n)return new n;throw new Error("createImageElement - missing Image implementation for nodejs environment")},o=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},i=ty();return Nt({Canvas:e||(function(){function a(){}return a})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function a(){}return a})(),Image:n||(function(){function a(){}return a})(),ImageData:global.ImageData||(function(){function a(){}return a})(),Video:global.HTMLVideoElement||(function(){function a(){}return a})(),createCanvasElement:t,createImageElement:r,fetch:o},i)}function ry(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function oy(){return typeof global=="object"&&typeof require=="function"&&typeof Jy<"u"&&typeof process<"u"&&!!process.version}var lt;function dk(){if(!lt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return lt}function nl(e){lt=e}function vf(){ry()&&nl(ey()),oy()&&nl(ny())}function hk(e){if(lt||vf(),!lt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var n=e.Canvas,t=n===void 0?lt.Canvas:n,r=e.Image,o=r===void 0?lt.Image:r;lt.Canvas=t,lt.Image=o,lt.createCanvasElement=e.createCanvasElement||(function(){return new t}),lt.createImageElement=e.createImageElement||(function(){return new o}),lt.ImageData=e.ImageData||lt.ImageData,lt.Video=e.Video||lt.Video,lt.fetch=e.fetch||lt.fetch,lt.readFile=e.readFile||lt.readFile}var Lt={getEnv:dk,setEnv:nl,initialize:vf,createBrowserEnv:ey,createFileSystem:ty,createNodejsEnv:ny,monkeyPatch:hk,isBrowser:ry,isNodejs:oy};vf();function iy(e){return!Lt.isNodejs()&&typeof e=="string"?document.getElementById(e):e}function wo(e){var n=Lt.getEnv(),t=n.Canvas,r=n.CanvasRenderingContext2D;if(e instanceof r)return e;var o=iy(e);if(!(o instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=o.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}var Xh;(function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Xh||(Xh={}));function ay(e){var n=Lt.getEnv(),t=n.Image,r=n.Video;return e instanceof t&&e.complete||e instanceof r&&e.readyState>=3}function pk(e){return new Promise(function(n,t){if(e instanceof Lt.getEnv().Canvas||ay(e))return n();function r(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),n(i))}function o(i){i.currentTarget&&(i.currentTarget.removeEventListener("load",r),i.currentTarget.removeEventListener("error",o),t(i))}e.addEventListener("load",r),e.addEventListener("error",o)})}function sy(e){var n=Lt.getEnv(),t=n.Image,r=n.Video;return e instanceof t?new oi(e.naturalWidth,e.naturalHeight):e instanceof r?new oi(e.videoWidth,e.videoHeight):new oi(e.width,e.height)}function lu(e){var n=e.width,t=e.height,r=Lt.getEnv().createCanvasElement,o=r();return o.width=n,o.height=t,o}function mf(e,n){var t=Lt.getEnv().ImageData;if(!(e instanceof t)&&!ay(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=sy(e),o=r.width,i=r.height,a=lu({width:o,height:i});return e instanceof t?wo(a).putImageData(e,0,0):wo(a).drawImage(e,0,0,o,i),a}function vk(e,n){return we(this,void 0,void 0,function(){var t,r,o,i,a,s;return _e(this,function(u){switch(u.label){case 0:return t=Lt.getEnv().createCanvasElement(),r=e.shape.slice(qr(e)?1:0),o=r[0],i=r[1],a=r[2],s=ve(function(){return e.as3D(o,i,a).toInt()}),[4,ff.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function Yh(e){var n=Lt.getEnv(),t=n.Image,r=n.Canvas,o=n.Video;return e instanceof t||e instanceof r||e instanceof o}function mk(e,n,t){t===void 0&&(t=!1);var r=Lt.getEnv(),o=r.Image,i=r.Canvas;if(!(e instanceof o||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=sy(e),s=n/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=lu({width:n,height:n}),f=e instanceof i?e:mf(e),d=Math.abs(u-c)/2,h=t&&u<c?d:0,p=t&&c<u?d:0;return wo(l).drawImage(f,h,p,u,c),l}var ks=(function(){function e(n,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(n))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+n);this._treatAsBatchInput=t,this._batchSize=n.length,n.forEach(function(o,i){if(uu(o)){r._imageTensors[i]=o,r._inputDimensions[i]=o.shape;return}if(qr(o)){var a=o.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[i]=o,r._inputDimensions[i]=o.shape.slice(1);return}var s=o instanceof Lt.getEnv().Canvas?o:mf(o);r._canvases[i]=s,r._inputDimensions[i]=[s.height,s.width,3]})}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var n=this;return ta(this.batchSize,0,1).map(function(t,r){return n.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),e.prototype.getInput=function(n){return this.canvases[n]||this.imageTensors[n]},e.prototype.getInputDimensions=function(n){return this._inputDimensions[n]},e.prototype.getInputHeight=function(n){return this._inputDimensions[n][0]},e.prototype.getInputWidth=function(n){return this._inputDimensions[n][1]},e.prototype.getReshapedInputDimensions=function(n){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(n),r=this.getInputHeight(n);return nk({width:t,height:r},this.inputSize)},e.prototype.toBatchTensor=function(n,t){var r=this;return t===void 0&&(t=!0),this._inputSize=n,ve(function(){var o=ta(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Je){var u=qr(s)?s:s.expandDims();return u=ik(u,t),(u.shape[1]!==n||u.shape[2]!==n)&&(u=of.resizeBilinear(u,[n,n])),u.as3D(n,n,3)}if(s instanceof Lt.getEnv().Canvas)return ff.fromPixels(mk(s,n,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),i=ln(o.map(function(a){return a.toFloat()})).as4D(r.batchSize,n,n,3);return i})},e})();function _t(e){return we(this,void 0,void 0,function(){var n,t,r;return _e(this,function(o){switch(o.label){case 0:if(e instanceof ks)return[2,e];if(n=Array.isArray(e)?e:[e],!n.length)throw new Error("toNetInput - empty array passed as input");return t=function(i){return Array.isArray(e)?" at input index "+i+":":""},r=n.map(iy),r.forEach(function(i,a){if(!Yh(i)&&!uu(i)&&!qr(i))throw typeof n[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+n[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(qr(i)){var s=i.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(i){return Yh(i)&&pk(i)}))];case 1:return o.sent(),[2,new ks(r,Array.isArray(e))]}})})}function gf(e,n){return we(this,void 0,void 0,function(){var t,r,o,i,a,s,u;return _e(this,function(c){switch(c.label){case 0:return t=Lt.getEnv().Canvas,r=e,e instanceof t?[3,5]:[4,_t(e)];case 1:if(o=c.sent(),o.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return i=o.getInput(0),i instanceof t?(a=i,[3,4]):[3,2];case 2:return[4,vk(i)];case 3:a=c.sent(),c.label=4;case 4:r=a,c.label=5;case 5:return s=wo(r),u=n.map(function(l){return l instanceof nr?l.forSize(r.width,r.height).box.floor():l}).map(function(l){return l.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(l){var f=l.x,d=l.y,h=l.width,p=l.height,v=lu({width:h,height:p});return wo(v).putImageData(s.getImageData(f,d,h,p),0,0),v})]}})})}function yf(e,n){return we(this,void 0,void 0,function(){return _e(this,function(t){if(!uu(e)&&!qr(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(qr(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,ve(function(){var r=e.shape.slice(qr(e)?1:0),o=r[0],i=r[1],a=r[2],s=n.map(function(c){return c instanceof nr?c.forSize(i,o).box:c}).map(function(c){return c.clipAtImageBorders(i,o)}),u=s.map(function(c){var l=c.x,f=c.y,d=c.width,h=c.height;return Pg(e.as3D(o,i,a),[f,l,0],[h,d,a])});return u})]})})}function gk(e,n){return we(this,void 0,void 0,function(){var t,r;return _e(this,function(o){switch(o.label){case 0:return t=Lt.getEnv().fetch,[4,t(e,n)];case 1:if(r=o.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function yk(e){return we(this,void 0,void 0,function(){return _e(this,function(n){switch(n.label){case 0:return[4,gk(e)];case 1:return[2,n.sent().json()]}})})}function uy(e,n){var t=n+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:t};if(e==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"";e=e.replace(r,"");var o=e.split("/").filter(function(s){return s}),i=e.endsWith(".json")?o[o.length-1]:t,a=r+(e.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return a=e.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+i:a+"/"+i}}function bk(e,n){return we(this,void 0,void 0,function(){var t,r,o,i;return _e(this,function(a){switch(a.label){case 0:return t=uy(e,n),r=t.manifestUri,o=t.modelBaseUri,[4,yk(r)];case 1:return i=a.sent(),[2,Qg.loadWeights(i,o)]}})})}var Cr=(function(){function e(n){this._name=n,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(n){var t=this.traversePropertyPath(n),r=t.obj,o=t.objProp;return r[o]},e.prototype.reassignParamFromPath=function(n,t){var r=this.traversePropertyPath(n),o=r.obj,i=r.objProp;o[i].dispose(),o[i]=t},e.prototype.getParamList=function(){var n=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:n.getParamFromPath(r)}})},e.prototype.getTrainableParams=function(){return this.getParamList().filter(function(n){return n.tensor instanceof di})},e.prototype.getFrozenParams=function(){return this.getParamList().filter(function(n){return!(n.tensor instanceof di)})},e.prototype.variable=function(){var n=this;this.getFrozenParams().forEach(function(t){var r=t.path,o=t.tensor;n.reassignParamFromPath(r,o.variable())})},e.prototype.freeze=function(){var n=this;this.getTrainableParams().forEach(function(t){var r=t.path,o=t.tensor,i=kt(o.dataSync());o.dispose(),n.reassignParamFromPath(r,i)})},e.prototype.dispose=function(n){n===void 0&&(n=!0),this.getParamList().forEach(function(t){if(n&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(n){var t=n.tensor;return Array.from(t.dataSync())}).reduce(function(n,t){return n.concat(t)}))},e.prototype.load=function(n){return we(this,void 0,void 0,function(){return _e(this,function(t){switch(t.label){case 0:return n instanceof Float32Array?(this.extractWeights(n),[2]):[4,this.loadFromUri(n)];case 1:return t.sent(),[2]}})})},e.prototype.loadFromUri=function(n){return we(this,void 0,void 0,function(){var t;return _e(this,function(r){switch(r.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,bk(n,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},e.prototype.loadFromDisk=function(n){return we(this,void 0,void 0,function(){var t,r,o,i,a,s,u,c,l,f;return _e(this,function(d){switch(d.label){case 0:if(n&&typeof n!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=Lt.getEnv().readFile,r=uy(n,this.getDefaultModelName()),o=r.manifestUri,i=r.modelBaseUri,a=function(h){return Promise.all(h.map(function(p){return t(p).then(function(v){return v.buffer})}))},s=Qg.weightsLoaderFactory(a),l=(c=JSON).parse,[4,t(o)];case 1:return u=l.apply(c,[d.sent().toString()]),[4,s(u,i)];case 2:return f=d.sent(),this.loadFromWeightMap(f),[2]}})})},e.prototype.loadFromWeightMap=function(n){var t=this.extractParamsFromWeigthMap(n),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},e.prototype.extractWeights=function(n){var t=this.extractParams(n),r=t.paramMappings,o=t.params;this._paramMappings=r,this._params=o},e.prototype.traversePropertyPath=function(n){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=n.split("/").reduce(function(i,a){if(!i.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+n);return{obj:i.nextObj,objProp:a,nextObj:i.nextObj[a]}},{nextObj:this.params}),r=t.obj,o=t.objProp;if(!r||!o||!(r[o]instanceof Je))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+n);return{obj:r,objProp:o}},e})();function cn(e,n,t){return ve(function(){var r=Zl(e,n.depthwise_filter,n.pointwise_filter,t,"same");return r=Oe(r,n.bias),r})}function ic(e,n,t){return t===void 0&&(t=!1),ve(function(){var r=Ze(t?Oe(Cn(e,n.conv0.filters,[2,2],"same"),n.conv0.bias):cn(e,n.conv0,[2,2])),o=cn(r,n.conv1,[1,1]),i=Ze(Oe(r,o)),a=cn(i,n.conv2,[1,1]);return Ze(Oe(r,Oe(o,a)))})}function Na(e,n,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),ve(function(){var o=Ze(t?Oe(Cn(e,n.conv0.filters,r?[2,2]:[1,1],"same"),n.conv0.bias):cn(e,n.conv0,r?[2,2]:[1,1])),i=cn(o,n.conv1,[1,1]),a=Ze(Oe(o,i)),s=cn(a,n.conv2,[1,1]),u=Ze(Oe(o,Oe(i,s))),c=cn(u,n.conv3,[1,1]);return Ze(Oe(o,Oe(i,Oe(s,c))))})}function In(e,n,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),ve(function(){var o=Oe(Cn(e,n.filters,[1,1],t),n.bias);return r?Ze(o):o})}function Er(e,n){Object.keys(e).forEach(function(t){n.some(function(r){return r.originalPath===t})||e[t].dispose()})}function fu(e,n){return function(t,r,o,i){var a=jt(e(t*r*o*o),[o,o,t,r]),s=st(e(r));return n.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function bf(e,n){return function(t,r,o){var i=Ur(e(t*r),[t,r]),a=st(e(r));return n.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var cy=(function(){function e(n,t,r){this.depthwise_filter=n,this.pointwise_filter=t,this.bias=r}return e})();function xf(e,n){return function(t,r,o){var i=jt(e(9*t),[3,3,t,1]),a=jt(e(t*r),[1,1,t,r]),s=st(e(r));return n.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new cy(i,a,s)}}function wf(e){return function(n){var t=e(n+"/depthwise_filter",4),r=e(n+"/pointwise_filter",4),o=e(n+"/bias",1);return new cy(t,r,o)}}function Yr(e,n){return function(t,r,o){var i=e[t];if(!su(i,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+i);return n.push({originalPath:t,paramPath:o||t}),i}}function Sr(e){var n=e;function t(o){var i=n.slice(0,o);return n=n.slice(o),i}function r(){return n}return{extractWeights:t,getRemainingWeights:r}}function ly(e,n){var t=fu(e,n),r=xf(e,n);function o(a,s,u,c){c===void 0&&(c=!1);var l=c?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),f=r(s,s,u+"/conv1"),d=r(s,s,u+"/conv2");return{conv0:l,conv1:f,conv2:d}}function i(a,s,u,c){c===void 0&&(c=!1);var l=o(a,s,u,c),f=l.conv0,d=l.conv1,h=l.conv2,p=r(s,s,u+"/conv3");return{conv0:f,conv1:d,conv2:h,conv3:p}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function xk(e){var n=[],t=Sr(e),r=t.extractWeights,o=t.getRemainingWeights,i=ly(r,n).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}function fy(e){return function(n){var t=e(n+"/filters",4),r=e(n+"/bias",1);return{filters:t,bias:r}}}function dy(e,n){var t=Yr(e,n),r=fy(t),o=wf(t);function i(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),f=o(s+"/conv2");return{conv0:c,conv1:l,conv2:f}}function a(s,u){u===void 0&&(u=!1);var c=u?r(s+"/conv0"):o(s+"/conv0"),l=o(s+"/conv1"),f=o(s+"/conv2"),d=o(s+"/conv3");return{conv0:c,conv1:l,conv2:f,conv3:d}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:a}}function wk(e){var n=[],t=dy(e,n).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return Er(e,n),{params:r,paramMappings:n}}var hy=(function(e){Ae(n,e);function n(){return e.call(this,"FaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return ve(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=va(o,i).div(de(255)),s=Na(a,r.dense0,!0);return s=Na(s,r.dense1),s=Na(s,r.dense2),s=Na(s,r.dense3),s=ha(s,[7,7],[2,2],"valid"),s})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},n.prototype.extractParamsFromWeigthMap=function(t){return wk(t)},n.prototype.extractParams=function(t){return xk(t)},n})(Cr);function jn(e,n){return ve(function(){return Oe(ou(e,n.weights),n.bias)})}function _k(e,n,t){var r=[],o=Sr(e),i=o.extractWeights,a=o.getRemainingWeights,s=bf(i,r),u=s(n,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function Ck(e){var n=[],t=Yr(e,n);function r(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:r("fc")};return Er(e,n),{params:o,paramMappings:n}}function py(e){var n={},t={};return Object.keys(e).forEach(function(r){var o=r.startsWith("fc")?t:n;o[r]=e[r]}),{featureExtractorMap:n,classifierMap:t}}var vy=(function(e){Ae(n,e);function n(t,r){var o=e.call(this,t)||this;return o._faceFeatureExtractor=r,o}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ve(function(){var i=t instanceof ks?r.faceFeatureExtractor.forwardInput(t):t;return jn(i.as2D(i.shape[0],-1),o.fc)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(t){return _k(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},n.prototype.extractParamsFromWeigthMap=function(t){var r=py(t),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Ck(i)},n.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),o=this.getClassifierChannelsOut(),i=o*r+o,a=t.slice(0,t.length-i),s=t.slice(t.length-i);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},n})(Cr),Qh=["neutral","happy","sad","angry","fearful","disgusted","surprised"],Ek=(function(){function e(n){var t=this;if(n.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+n.length);Qh.forEach(function(r,o){t[r]=n[o]})}return e.prototype.asSortedArray=function(){var n=this;return Qh.map(function(t){return{expression:t,probability:n[t]}}).sort(function(t,r){return r.probability-t.probability})},e})(),Sk=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new hy),e.call(this,"FaceExpressionNet",t)||this}return n.prototype.forwardInput=function(t){var r=this;return ve(function(){return wr(r.runNet(t))})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictExpressions=function(t){return we(this,void 0,void 0,function(){var r,o,i,a,s=this;return _e(this,function(u){switch(u.label){case 0:return[4,_t(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return o=u.sent(),[4,Promise.all(ht(o).map(function(c){return we(s,void 0,void 0,function(){var l;return _e(this,function(f){switch(f.label){case 0:return[4,c.data()];case 1:return l=f.sent(),c.dispose(),[2,l]}})})}))];case 3:return i=u.sent(),o.dispose(),a=i.map(function(c){return new Ek(c)}),[2,r.isBatchInput?a:a[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_expression_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n.prototype.getClassifierChannelsOut=function(){return 7},n})(vy);function my(e,n){var t={expressions:n};return Object.assign({},e,t)}function Rk(e){return fk(e)&&e.landmarks instanceof Rs&&e.unshiftedLandmarks instanceof Rs&&e.alignedRect instanceof nr}function _f(e,n){var t=e.detection.box,r=n.shiftBy(t.x,t.y),o=r.align(),i=e.detection.imageDims,a=new nr(e.detection.score,o.rescale(i.reverse()),i),s={landmarks:r,unshiftedLandmarks:n,alignedRect:a};return Object.assign({},e,s)}function kk(e,n){var t=fu(e,n),r=xf(e,n);function o(a,s,u){var c=r(a,s,u+"/separable_conv0"),l=r(s,s,u+"/separable_conv1"),f=t(a,s,1,u+"/expansion_conv");return{separable_conv0:c,separable_conv1:l,expansion_conv:f}}function i(a,s){var u=r(a,a,s+"/separable_conv0"),c=r(a,a,s+"/separable_conv1"),l=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:o,extractMainBlockParams:i}}function Ik(e,n){var t=[],r=Sr(e),o=r.extractWeights,i=r.getRemainingWeights,a=kk(o,t),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,f=s(3,32,3,"entry_flow/conv_in"),d=c(32,64,"entry_flow/reduction_block_0"),h=c(64,128,"entry_flow/reduction_block_1"),p={conv_in:f,reduction_block_0:d,reduction_block_1:h},v={};ta(n,0,1).forEach(function(x){v["main_block_"+x]=l(128,"middle_flow/main_block_"+x)});var m=c(128,256,"exit_flow/reduction_block"),g=u(256,512,"exit_flow/separable_conv"),b={reduction_block:m,separable_conv:g};if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:t,params:{entry_flow:p,middle_flow:v,exit_flow:b}}}function Ak(e,n){var t=Yr(e,n),r=fy(t),o=wf(t);function i(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:c,expansion_conv:l}}function a(s){var u=o(s+"/separable_conv0"),c=o(s+"/separable_conv1"),l=o(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:c,separable_conv2:l}}return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:i,extractMainBlockParams:a}}function Tk(e,n){var t=[],r=Ak(e,t),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=o("entry_flow/conv_in"),c=a("entry_flow/reduction_block_0"),l=a("entry_flow/reduction_block_1"),f={conv_in:u,reduction_block_0:c,reduction_block_1:l},d={};ta(n,0,1).forEach(function(m){d["main_block_"+m]=s("middle_flow/main_block_"+m)});var h=a("exit_flow/reduction_block"),p=i("exit_flow/separable_conv"),v={reduction_block:h,separable_conv:p};return Er(e,t),{params:{entry_flow:f,middle_flow:d,exit_flow:v},paramMappings:t}}function gy(e,n,t){return Oe(Cn(e,n.filters,t,"same"),n.bias)}function ac(e,n,t){t===void 0&&(t=!0);var r=t?Ze(e):e;return r=cn(r,n.separable_conv0,[1,1]),r=cn(Ze(r),n.separable_conv1,[1,1]),r=bt(r,[3,3],[2,2],"same"),r=Oe(r,gy(e,n.expansion_conv,[2,2])),r}function Dk(e,n){var t=cn(Ze(e),n.separable_conv0,[1,1]);return t=cn(Ze(t),n.separable_conv1,[1,1]),t=cn(Ze(t),n.separable_conv2,[1,1]),t=Oe(t,e),t}var Nk=(function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return n.prototype.forwardInput=function(t){var r=this,o=this.params;if(!o)throw new Error("TinyXception - load model before inference");return ve(function(){var i=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=va(i,a).div(de(256)),u=Ze(gy(s,o.entry_flow.conv_in,[2,2]));return u=ac(u,o.entry_flow.reduction_block_0,!1),u=ac(u,o.entry_flow.reduction_block_1),ta(r._numMainBlocks,0,1).forEach(function(c){u=Dk(u,o.middle_flow["main_block_"+c])}),u=ac(u,o.exit_flow.reduction_block),u=Ze(cn(u,o.exit_flow.separable_conv,[1,1])),u})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"tiny_xception_model"},n.prototype.extractParamsFromWeigthMap=function(t){return Tk(t,this._numMainBlocks)},n.prototype.extractParams=function(t){return Ik(t,this._numMainBlocks)},n})(Cr);function Fk(e){var n=[],t=Sr(e),r=t.extractWeights,o=t.getRemainingWeights,i=bf(r,n),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{fc:{age:a,gender:s}}}}function Pk(e){var n=[],t=Yr(e,n);function r(i){var a=t(i+"/weights",2),s=t(i+"/bias",1);return{weights:a,bias:s}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return Er(e,n),{params:o,paramMappings:n}}var Is;(function(e){e.FEMALE="female",e.MALE="male"})(Is||(Is={}));var Mk=(function(e){Ae(n,e);function n(t){t===void 0&&(t=new Nk(2));var r=e.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(n.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),n.prototype.runNet=function(t){var r=this,o=this.params;if(!o)throw new Error(this._name+" - load model before inference");return ve(function(){var i=t instanceof ks?r.faceFeatureExtractor.forwardInput(t):t,a=ha(i,[7,7],[2,2],"valid").as2D(i.shape[0],-1),s=jn(a,o.fc.age).as1D(),u=jn(a,o.fc.gender);return{age:s,gender:u}})},n.prototype.forwardInput=function(t){var r=this;return ve(function(){var o=r.runNet(t),i=o.age,a=o.gender;return{age:i,gender:wr(a)}})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.predictAgeAndGender=function(t){return we(this,void 0,void 0,function(){var r,o,i,a,s,u,c=this;return _e(this,function(l){switch(l.label){case 0:return[4,_t(t)];case 1:return r=l.sent(),[4,this.forwardInput(r)];case 2:return o=l.sent(),i=ht(o.age),a=ht(o.gender),s=i.map(function(f,d){return{ageTensor:f,genderTensor:a[d]}}),[4,Promise.all(s.map(function(f){var d=f.ageTensor,h=f.genderTensor;return we(c,void 0,void 0,function(){var p,v,m,g,b;return _e(this,function(x){switch(x.label){case 0:return[4,d.data()];case 1:return p=x.sent()[0],[4,h.data()];case 2:return v=x.sent()[0],m=v>.5,g=m?Is.MALE:Is.FEMALE,b=m?v:1-v,d.dispose(),h.dispose(),[2,{age:p,gender:g,genderProbability:b}]}})})}))];case 3:return u=l.sent(),o.age.dispose(),o.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},n.prototype.getDefaultModelName=function(){return"age_gender_model"},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},n.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),o=r.params,i=r.paramMappings;this._params=o,this._paramMappings=i},n.prototype.extractClassifierParams=function(t){return Fk(t)},n.prototype.extractParamsFromWeigthMap=function(t){var r=py(t),o=r.featureExtractorMap,i=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(o),Pk(i)},n.prototype.extractParams=function(t){var r=1539,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},n})(Cr),yy=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.postProcess=function(t,r,o){var i=o.map(function(s){var u=s.width,c=s.height,l=r/Math.max(c,u);return{width:u*l,height:c*l}}),a=i.length;return ve(function(){var s=function(d,h){return ln([Yn([68],d),Yn([68],h)],1).as2D(1,136).as1D()},u=function(d,h){var p=i[d],v=p.width,m=p.height;return h(v,m)?Math.abs(v-m)/2:0},c=function(d){return u(d,function(h,p){return h<p})},l=function(d){return u(d,function(h,p){return p<h})},f=t.mul(Yn([a,136],r)).sub(ln(Array.from(Array(a),function(d,h){return s(c(h),l(h))}))).div(ln(Array.from(Array(a),function(d,h){return s(i[h].width,i[h].height)})));return f})},n.prototype.forwardInput=function(t){var r=this;return ve(function(){var o=r.runNet(t);return r.postProcess(o,t.inputSize,t.inputDimensions.map(function(i){var a=i[0],s=i[1];return{height:a,width:s}}))})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.detectLandmarks=function(t){return we(this,void 0,void 0,function(){var r,o,i,a=this;return _e(this,function(s){switch(s.label){case 0:return[4,_t(t)];case 1:return r=s.sent(),o=ve(function(){return ht(a.forwardInput(r))}),[4,Promise.all(o.map(function(u,c){return we(a,void 0,void 0,function(){var l,f,d,h,p;return _e(this,function(v){switch(v.label){case 0:return d=(f=Array).from,[4,u.data()];case 1:return l=d.apply(f,[v.sent()]),h=l.filter(function(m,g){return Hh(g)}),p=l.filter(function(m,g){return!Hh(g)}),[2,new lk(Array(68).fill(0).map(function(m,g){return new Ue(h[g],p[g])}),{height:r.getInputHeight(c),width:r.getInputWidth(c)})]}})})}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getClassifierChannelsOut=function(){return 136},n})(vy),by=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new hy),e.call(this,"FaceLandmark68Net",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},n.prototype.getClassifierChannelsIn=function(){return 256},n})(yy);function Ok(e){var n=[],t=dy(e,n).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return Er(e,n),{params:r,paramMappings:n}}function Bk(e){var n=[],t=Sr(e),r=t.extractWeights,o=t.getRemainingWeights,i=ly(r,n).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:n,params:{dense0:a,dense1:s,dense2:u}}}var Lk=(function(e){Ae(n,e);function n(){return e.call(this,"TinyFaceFeatureExtractor")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return ve(function(){var o=t.toBatchTensor(112,!0),i=[122.782,117.001,104.298],a=va(o,i).div(de(255)),s=ic(a,r.dense0,!0);return s=ic(s,r.dense1),s=ic(s,r.dense2),s=ha(s,[14,14],[2,2],"valid"),s})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},n.prototype.extractParamsFromWeigthMap=function(t){return Ok(t)},n.prototype.extractParams=function(t){return Bk(t)},n})(Cr),Wk=(function(e){Ae(n,e);function n(t){return t===void 0&&(t=new Lk),e.call(this,"FaceLandmark68TinyNet",t)||this}return n.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},n.prototype.getClassifierChannelsIn=function(){return 128},n})(yy);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(by);function Vk(e,n){return Oe(Ot(e,n.weights),n.biases)}function Cf(e,n,t,r,o){o===void 0&&(o="same");var i=n.conv,a=i.filters,s=i.bias,u=Cn(e,a,t,o);return u=Oe(u,s),u=Vk(u,n.scale),r?Ze(u):u}function Uk(e,n){return Cf(e,n,[1,1],!0)}function xy(e,n){return Cf(e,n,[1,1],!1)}function wy(e,n){return Cf(e,n,[2,2],!0,"valid")}function zk(e,n){function t(s,u,c){var l=e(s),f=l.length/(u*c*c);if(ek(f))throw new Error("depth has to be an integer: "+f+", weights.length: "+l.length+", numFilters: "+u+", filterSize: "+c);return ve(function(){return Gr(jt(l,[u,f,c,c]),[2,3,1,0])})}function r(s,u,c,l){var f=t(s,u,c),d=st(e(u));return n.push({paramPath:l+"/filters"},{paramPath:l+"/bias"}),{filters:f,bias:d}}function o(s,u){var c=st(e(s)),l=st(e(s));return n.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:c,biases:l}}function i(s,u,c,l){var f=r(s,u,c,l+"/conv"),d=o(u,l+"/scale");return{conv:f,scale:d}}function a(s,u,c,l,f){f===void 0&&(f=!1);var d=i((f?.5:1)*s,u,c,l+"/conv1"),h=i(s,u,c,l+"/conv2");return{conv1:d,conv2:h}}return{extractConvLayerParams:i,extractResidualLayerParams:a}}function qk(e){var n=Sr(e),t=n.extractWeights,r=n.getRemainingWeights,o=[],i=zk(t,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),f=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),h=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),x=s(589824,256,3,"conv256_down",!0),y=s(589824,256,3,"conv256_1"),w=s(589824,256,3,"conv256_2"),_=s(589824,256,3,"conv256_down_out"),S=ve(function(){return Gr(Ur(t(256*128),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var R={conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:f,conv64_down:d,conv64_1:h,conv64_2:p,conv64_3:v,conv128_down:m,conv128_1:g,conv128_2:b,conv256_down:x,conv256_1:y,conv256_2:w,conv256_down_out:_,fc:S};return{params:R,paramMappings:o}}function Hk(e,n){var t=Yr(e,n);function r(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function o(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),c=r(a);return{conv:{filters:s,bias:u},scale:c}}function i(a){return{conv1:o(a+"/conv1"),conv2:o(a+"/conv2")}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function Gk(e){var n=[],t=Hk(e,n),r=t.extractConvLayerParams,o=t.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),f=o("conv64_2"),d=o("conv64_3"),h=o("conv128_down"),p=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),g=o("conv256_1"),b=o("conv256_2"),x=o("conv256_down_out"),y=e.fc;if(n.push({originalPath:"fc",paramPath:"fc"}),!ZR(y))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+y);var w={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:f,conv64_3:d,conv128_down:h,conv128_1:p,conv128_2:v,conv256_down:m,conv256_1:g,conv256_2:b,conv256_down_out:x,fc:y};return Er(e,n),{params:w,paramMappings:n}}function On(e,n){var t=Uk(e,n.conv1);return t=xy(t,n.conv2),t=Oe(t,e),t=Ze(t),t}function Fa(e,n){var t=wy(e,n.conv1);t=xy(t,n.conv2);var r=ha(e,2,2,"valid"),o=Ye(r.shape),i=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=zi(t.shape);s[1]=1;var u=Ye(s);t=dt([t,u],1);var c=zi(t.shape);c[2]=1;var l=Ye(c);t=dt([t,l],2)}return r=i?dt([r,o],3):r,t=Oe(r,t),t=Ze(t),t}var jk=(function(e){Ae(n,e);function n(){return e.call(this,"FaceRecognitionNet")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return ve(function(){var o=t.toBatchTensor(150,!0).toFloat(),i=[122.782,117.001,104.298],a=va(o,i).div(de(256)),s=wy(a,r.conv32_down);s=bt(s,3,2,"valid"),s=On(s,r.conv32_1),s=On(s,r.conv32_2),s=On(s,r.conv32_3),s=Fa(s,r.conv64_down),s=On(s,r.conv64_1),s=On(s,r.conv64_2),s=On(s,r.conv64_3),s=Fa(s,r.conv128_down),s=On(s,r.conv128_1),s=On(s,r.conv128_2),s=Fa(s,r.conv256_down),s=On(s,r.conv256_1),s=On(s,r.conv256_2),s=Fa(s,r.conv256_down_out);var u=s.mean([1,2]),c=ou(u,r.fc);return c})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.computeFaceDescriptor=function(t){return we(this,void 0,void 0,function(){var r,o,i,a=this;return _e(this,function(s){switch(s.label){case 0:return[4,_t(t)];case 1:return r=s.sent(),o=ve(function(){return ht(a.forwardInput(r))}),[4,Promise.all(o.map(function(u){return u.data()}))];case 2:return i=s.sent(),o.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?i:i[0]]}})})},n.prototype.getDefaultModelName=function(){return"face_recognition_model"},n.prototype.extractParamsFromWeigthMap=function(t){return Gk(t)},n.prototype.extractParams=function(t){return qk(t)},n})(Cr);function _y(e,n){var t={descriptor:n};return Object.assign({},e,t)}function Cy(e,n){var t={age:n};return Object.assign({},e,t)}function Ey(e,n,t){var r={gender:n,genderProbability:t};return Object.assign({},e,r)}var Sy=(function(){function e(n){var t=n===void 0?{}:n,r=t.minFaceSize,o=t.scaleFactor,i=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=o||.709,this._maxNumScales=i||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e})();function $k(e,n){function t(u,c){var l=jt(e(9*u),[3,3,u,1]),f=st(e(u)),d=st(e(u)),h=st(e(u)),p=st(e(u));return n.push({paramPath:c+"/filters"},{paramPath:c+"/batch_norm_scale"},{paramPath:c+"/batch_norm_offset"},{paramPath:c+"/batch_norm_mean"},{paramPath:c+"/batch_norm_variance"}),{filters:l,batch_norm_scale:f,batch_norm_offset:d,batch_norm_mean:h,batch_norm_variance:p}}function r(u,c,l,f,d){var h=jt(e(u*c*l*l),[l,l,u,c]),p=st(e(c));return n.push({paramPath:f+"/filters"},{paramPath:f+"/"+(d?"batch_norm_offset":"bias")}),{filters:h,bias:p}}function o(u,c,l,f){var d=r(u,c,l,f,!0),h=d.filters,p=d.bias;return{filters:h,batch_norm_offset:p}}function i(u,c,l){var f=t(u,l+"/depthwise_conv"),d=o(u,c,1,l+"/pointwise_conv");return{depthwise_conv:f,pointwise_conv:d}}function a(){var u=o(3,32,3,"mobilenetv1/conv_0"),c=i(32,64,"mobilenetv1/conv_1"),l=i(64,128,"mobilenetv1/conv_2"),f=i(128,128,"mobilenetv1/conv_3"),d=i(128,256,"mobilenetv1/conv_4"),h=i(256,256,"mobilenetv1/conv_5"),p=i(256,512,"mobilenetv1/conv_6"),v=i(512,512,"mobilenetv1/conv_7"),m=i(512,512,"mobilenetv1/conv_8"),g=i(512,512,"mobilenetv1/conv_9"),b=i(512,512,"mobilenetv1/conv_10"),x=i(512,512,"mobilenetv1/conv_11"),y=i(512,1024,"mobilenetv1/conv_12"),w=i(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:c,conv_2:l,conv_3:f,conv_4:d,conv_5:h,conv_6:p,conv_7:v,conv_8:m,conv_9:g,conv_10:b,conv_11:x,conv_12:y,conv_13:w}}function s(){var u=o(1024,256,1,"prediction_layer/conv_0"),c=o(256,512,3,"prediction_layer/conv_1"),l=o(512,128,1,"prediction_layer/conv_2"),f=o(128,256,3,"prediction_layer/conv_3"),d=o(256,128,1,"prediction_layer/conv_4"),h=o(128,256,3,"prediction_layer/conv_5"),p=o(256,64,1,"prediction_layer/conv_6"),v=o(64,128,3,"prediction_layer/conv_7"),m=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),g=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),b=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),x=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),y=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),w=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),_=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),S=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),R=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),E=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),C=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),I=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),k={box_encoding_predictor:m,class_predictor:g},M={box_encoding_predictor:b,class_predictor:x},P={box_encoding_predictor:y,class_predictor:w},L={box_encoding_predictor:_,class_predictor:S},q={box_encoding_predictor:R,class_predictor:E},V={box_encoding_predictor:C,class_predictor:I};return{conv_0:u,conv_1:c,conv_2:l,conv_3:f,conv_4:d,conv_5:h,conv_6:p,conv_7:v,box_predictor_0:k,box_predictor_1:M,box_predictor_2:P,box_predictor_3:L,box_predictor_4:q,box_predictor_5:V}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function Kk(e){var n=[],t=Sr(e),r=t.extractWeights,o=t.getRemainingWeights,i=$k(r,n),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l=Ll(r(5118*4),[1,5118,4]),f={extra_dim:l};if(n.push({paramPath:"output_layer/extra_dim"}),o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:f},paramMappings:n}}function Xk(e,n){var t=Yr(e,n);function r(c,l,f){var d=t(c+"/Conv2d_"+l+"_pointwise/weights",4,f+"/filters"),h=t(c+"/Conv2d_"+l+"_pointwise/convolution_bn_offset",1,f+"/batch_norm_offset");return{filters:d,batch_norm_offset:h}}function o(c){var l="mobilenetv1/conv_"+c,f="MobilenetV1/Conv2d_"+c+"_depthwise",d=l+"/depthwise_conv",h=l+"/pointwise_conv",p=t(f+"/depthwise_weights",4,d+"/filters"),v=t(f+"/BatchNorm/gamma",1,d+"/batch_norm_scale"),m=t(f+"/BatchNorm/beta",1,d+"/batch_norm_offset"),g=t(f+"/BatchNorm/moving_mean",1,d+"/batch_norm_mean"),b=t(f+"/BatchNorm/moving_variance",1,d+"/batch_norm_variance");return{depthwise_conv:{filters:p,batch_norm_scale:v,batch_norm_offset:m,batch_norm_mean:g,batch_norm_variance:b},pointwise_conv:r("MobilenetV1",c,h)}}function i(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}}function a(c,l){var f=t(c+"/weights",4,l+"/filters"),d=t(c+"/biases",1,l+"/bias");return{filters:f,bias:d}}function s(c){var l=a("Prediction/BoxPredictor_"+c+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+c+"/box_encoding_predictor"),f=a("Prediction/BoxPredictor_"+c+"/ClassPredictor","prediction_layer/box_predictor_"+c+"/class_predictor");return{box_encoding_predictor:l,class_predictor:f}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:u}}function Yk(e){var n=[],t=Xk(e,n),r=t.extractMobilenetV1Params,o=t.extractPredictionLayerParams,i=e["Output/extra_dim"];if(n.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!uu(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return Er(e,n),{params:a,paramMappings:n}}function Wn(e,n,t){return ve(function(){var r=Cn(e,n.filters,t,"same");return r=Oe(r,n.batch_norm_offset),Xl(r,0,6)})}var Qk=.0010000000474974513;function Jk(e,n,t){return ve(function(){var r=ru(e,n.filters,t,"same");return r=bg(r,n.batch_norm_mean,n.batch_norm_variance,n.batch_norm_offset,n.batch_norm_scale,Qk),Xl(r,0,6)})}function Zk(e){return[2,4,6,12].some(function(n){return n===e})?[2,2]:[1,1]}function eI(e,n){return ve(function(){var t=null,r=Wn(e,n.conv_0,[2,2]),o=[n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13];if(o.forEach(function(i,a){var s=a+1,u=Zk(s);r=Jk(r,i.depthwise_conv,u),r=Wn(r,i.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function tI(e,n,t,r,o){var i=e.shape[0],a=Math.min(t,i),s=n.map(function(l,f){return{score:l,boxIndex:f}}).filter(function(l){return l.score>o}).sort(function(l,f){return f.score-l.score}),u=function(l){return l<=r?1:0},c=[];return s.forEach(function(l){if(!(c.length>=a)){for(var f=l.score,d=c.length-1;d>=0;--d){var h=nI(e,l.boxIndex,c[d]);if(h!==0&&(l.score*=u(h),l.score<=o))break}f===l.score&&c.push(l.boxIndex)}}),c}function nI(e,n,t){var r=e.arraySync(),o=Math.min(r[n][0],r[n][2]),i=Math.min(r[n][1],r[n][3]),a=Math.max(r[n][0],r[n][2]),s=Math.max(r[n][1],r[n][3]),u=Math.min(r[t][0],r[t][2]),c=Math.min(r[t][1],r[t][3]),l=Math.max(r[t][0],r[t][2]),f=Math.max(r[t][1],r[t][3]),d=(a-o)*(s-i),h=(l-u)*(f-c);if(d<=0||h<=0)return 0;var p=Math.max(o,u),v=Math.max(i,c),m=Math.min(a,l),g=Math.min(s,f),b=Math.max(m-p,0)*Math.max(g-v,0);return b/(d+h-b)}function rI(e){var n=ht(Gr(e,[1,0])),t=[mt(n[2],n[0]),mt(n[3],n[1])],r=[Oe(n[0],Sn(t[0],de(2))),Oe(n[1],Sn(t[1],de(2)))];return{sizes:t,centers:r}}function oI(e,n){var t=rI(e),r=t.sizes,o=t.centers,i=ht(Gr(n,[1,0])),a=Sn(Ot(Xc(Sn(i[2],de(5))),r[0]),de(2)),s=Oe(Ot(Sn(i[0],de(10)),r[0]),o[0]),u=Sn(Ot(Xc(Sn(i[3],de(5))),r[1]),de(2)),c=Oe(Ot(Sn(i[1],de(10)),r[1]),o[1]);return Gr(ln([mt(s,a),mt(c,u),Oe(s,a),Oe(c,u)]),[1,0])}function iI(e,n,t){return ve(function(){var r=e.shape[0],o=oI(Rn(Zo(t.extra_dim,[r,1,1]),[-1,4]),Rn(e,[-1,4]));o=Rn(o,[r,o.shape[0]/r,4]);var i=vg(Qn(n,[0,0,1],[-1,-1,-1])),a=Qn(i,[0,0,0],[-1,-1,1]);a=Rn(a,[r,a.shape[1]]);var s=ht(o),u=ht(a);return{boxes:s,scores:u}})}function Oo(e,n){return ve(function(){var t=e.shape[0],r=Rn(In(e,n.box_encoding_predictor),[t,-1,1,4]),o=Rn(In(e,n.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:o}})}function aI(e,n,t){return ve(function(){var r=Wn(e,t.conv_0,[1,1]),o=Wn(r,t.conv_1,[2,2]),i=Wn(o,t.conv_2,[1,1]),a=Wn(i,t.conv_3,[2,2]),s=Wn(a,t.conv_4,[1,1]),u=Wn(s,t.conv_5,[2,2]),c=Wn(u,t.conv_6,[1,1]),l=Wn(c,t.conv_7,[2,2]),f=Oo(n,t.box_predictor_0),d=Oo(e,t.box_predictor_1),h=Oo(o,t.box_predictor_2),p=Oo(a,t.box_predictor_3),v=Oo(u,t.box_predictor_4),m=Oo(l,t.box_predictor_5),g=dt([f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),b=dt([f.classPrediction,d.classPrediction,h.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1);return{boxPredictions:g,classPredictions:b}})}var du=(function(){function e(n){var t=n===void 0?{}:n,r=t.minConfidence,o=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=o||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e})(),Ry=(function(e){Ae(n,e);function n(){return e.call(this,"SsdMobilenetv1")||this}return n.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return ve(function(){var o=t.toBatchTensor(512,!1).toFloat(),i=mt(Ot(o,de(.007843137718737125)),de(1)),a=eI(i,r.mobilenetv1),s=aI(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,c=s.classPredictions;return iI(u,c,r.output_layer)})},n.prototype.forward=function(t){return we(this,void 0,void 0,function(){var r;return _e(this,function(o){switch(o.label){case 0:return r=this.forwardInput,[4,_t(t)];case 1:return[2,r.apply(this,[o.sent()])]}})})},n.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),we(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,v,m,g,b,x,y,w,_,S,R;return _e(this,function(E){switch(E.label){case 0:return o=new du(r),i=o.maxResults,a=o.minConfidence,[4,_t(t)];case 1:for(s=E.sent(),u=this.forwardInput(s),c=u.boxes,l=u.scores,f=c[0],d=l[0],h=1;h<c.length;h++)c[h].dispose(),l[h].dispose();return m=(v=Array).from,[4,d.data()];case 2:return p=m.apply(v,[E.sent()]),g=.5,b=tI(f,p,i,g,a),x=s.getReshapedInputDimensions(0),y=s.inputSize,w=y/x.width,_=y/x.height,S=f.arraySync(),R=b.map(function(C){var I=[Math.max(0,S[C][0]),Math.min(1,S[C][2])].map(function(V){return V*_}),k=I[0],M=I[1],P=[Math.max(0,S[C][1]),Math.min(1,S[C][3])].map(function(V){return V*w}),L=P[0],q=P[1];return new nr(p[C],new hf(L,k,q-L,M-k),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),f.dispose(),d.dispose(),[2,R]}})})},n.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},n.prototype.extractParamsFromWeigthMap=function(t){return Yk(t)},n.prototype.extractParams=function(t){return Kk(t)},n})(Cr);(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n})(Ry);var sI=.4,uI=[new Ue(.738768,.874946),new Ue(2.42204,2.65704),new Ue(4.30971,7.04493),new Ue(10.246,4.59428),new Ue(12.6868,11.8741)],cI=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],lI=[117.001,114.697,97.404],fI="tiny_yolov2_model",dI="tiny_yolov2_separable_conv_model",Pa=function(e){return typeof e=="number"};function hI(e){if(!e)throw new Error("invalid config: "+e);if(typeof e.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!Pa(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(n){return typeof n=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(n){return n||{}}).every(function(n){return Pa(n.x)&&Pa(n.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||e.meanRgb.length!==3||!e.meanRgb.every(Pa)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}function Ef(e){return ve(function(){var n=Ot(e,de(.10000000149011612));return Oe(Ze(mt(e,n)),n)})}function Ir(e,n){return ve(function(){var t=Eo(e,[[0,0],[1,1],[1,1],[0,0]]);return t=Cn(t,n.conv.filters,[1,1],"valid"),t=mt(t,n.bn.sub),t=Ot(t,n.bn.truediv),t=Oe(t,n.conv.bias),Ef(t)})}function Ar(e,n){return ve(function(){var t=Eo(e,[[0,0],[1,1],[1,1],[0,0]]);return t=Zl(t,n.depthwise_filter,n.pointwise_filter,[1,1],"valid"),t=Oe(t,n.bias),Ef(t)})}function pI(e,n){var t=fu(e,n);function r(a,s){var u=st(e(a)),c=st(e(a));return n.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:c}}function o(a,s,u){var c=t(a,s,3,u+"/conv"),l=r(s,u+"/bn");return{conv:c,bn:l}}var i=xf(e,n);return{extractConvParams:t,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function vI(e,n,t,r){var o=Sr(e),i=o.extractWeights,a=o.getRemainingWeights,s=[],u=pI(i,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,f=u.extractSeparableConvParams,d;if(n.withSeparableConvs){var h=r[0],p=r[1],v=r[2],m=r[3],g=r[4],b=r[5],x=r[6],y=r[7],w=r[8],_=n.isFirstLayerConv2d?c(h,p,3,"conv0"):f(h,p,"conv0"),S=f(p,v,"conv1"),R=f(v,m,"conv2"),E=f(m,g,"conv3"),C=f(g,b,"conv4"),I=f(b,x,"conv5"),k=y?f(x,y,"conv6"):void 0,M=w?f(y,w,"conv7"):void 0,P=c(w||y||x,5*t,1,"conv8");d={conv0:_,conv1:S,conv2:R,conv3:E,conv4:C,conv5:I,conv6:k,conv7:M,conv8:P}}else{var h=r[0],p=r[1],v=r[2],m=r[3],g=r[4],b=r[5],x=r[6],y=r[7],w=r[8],_=l(h,p,"conv0"),S=l(p,v,"conv1"),R=l(v,m,"conv2"),E=l(m,g,"conv3"),C=l(g,b,"conv4"),I=l(b,x,"conv5"),k=l(x,y,"conv6"),M=l(y,w,"conv7"),P=c(w,5*t,1,"conv8");d={conv0:_,conv1:S,conv2:R,conv3:E,conv4:C,conv5:I,conv6:k,conv7:M,conv8:P}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:d,paramMappings:s}}function mI(e,n){var t=Yr(e,n);function r(s){var u=t(s+"/sub",1),c=t(s+"/truediv",1);return{sub:u,truediv:c}}function o(s){var u=t(s+"/filters",4),c=t(s+"/bias",1);return{filters:u,bias:c}}function i(s){var u=o(s+"/conv"),c=r(s+"/bn");return{conv:u,bn:c}}var a=wf(t);return{extractConvParams:o,extractConvWithBatchNormParams:i,extractSeparableConvParams:a}}function gI(e,n){var t=[],r=mI(e,t),o=r.extractConvParams,i=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(n.withSeparableConvs){var u=n.filterSizes&&n.filterSizes.length||9;s={conv0:n.isFirstLayerConv2d?o("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:o("conv8")}}else s={conv0:i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:i("conv6"),conv7:i("conv7"),conv8:o("conv8")};return Er(e,t),{params:s,paramMappings:t}}var Jh;(function(e){e[e.XS=224]="XS",e[e.SM=320]="SM",e[e.MD=416]="MD",e[e.LG=608]="LG"})(Jh||(Jh={}));var Sf=(function(){function e(n){var t=n===void 0?{}:n,r=t.inputSize,o=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=o||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e})(),ky=(function(e){Ae(n,e);function n(t){var r=e.call(this,"TinyYolov2")||this;return hI(t),r._config=t,r}return Object.defineProperty(n.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),n.prototype.runTinyYolov2=function(t,r){var o=Ir(t,r.conv0);return o=bt(o,[2,2],[2,2],"same"),o=Ir(o,r.conv1),o=bt(o,[2,2],[2,2],"same"),o=Ir(o,r.conv2),o=bt(o,[2,2],[2,2],"same"),o=Ir(o,r.conv3),o=bt(o,[2,2],[2,2],"same"),o=Ir(o,r.conv4),o=bt(o,[2,2],[2,2],"same"),o=Ir(o,r.conv5),o=bt(o,[2,2],[1,1],"same"),o=Ir(o,r.conv6),o=Ir(o,r.conv7),In(o,r.conv8,"valid",!1)},n.prototype.runMobilenet=function(t,r){var o=this.config.isFirstLayerConv2d?Ef(In(t,r.conv0,"valid",!1)):Ar(t,r.conv0);return o=bt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv1),o=bt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv2),o=bt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv3),o=bt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv4),o=bt(o,[2,2],[2,2],"same"),o=Ar(o,r.conv5),o=bt(o,[2,2],[1,1],"same"),o=r.conv6?Ar(o,r.conv6):o,o=r.conv7?Ar(o,r.conv7):o,In(o,r.conv8,"valid",!1)},n.prototype.forwardInput=function(t,r){var o=this,i=this.params;if(!i)throw new Error("TinyYolov2 - load model before inference");return ve(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=o.config.meanRgb?va(a,o.config.meanRgb):a,a=a.div(de(256)),o.config.withSeparableConvs?o.runMobilenet(a,i):o.runTinyYolov2(a,i)})},n.prototype.forward=function(t,r){return we(this,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,_t(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent()]}})})},n.prototype.detect=function(t,r){return r===void 0&&(r={}),we(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,v,m,g,b=this;return _e(this,function(x){switch(x.label){case 0:return o=new Sf(r),i=o.inputSize,a=o.scoreThreshold,[4,_t(t)];case 1:return s=x.sent(),[4,this.forwardInput(s,i)];case 2:return u=x.sent(),c=ve(function(){return ht(u)[0].expandDims()}),l={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(c,s.getReshapedInputDimensions(0),a)];case 3:return f=x.sent(),u.dispose(),c.dispose(),d=f.map(function(y){return y.box}),h=f.map(function(y){return y.score}),p=f.map(function(y){return y.classScore}),v=f.map(function(y){return b.config.classes[y.label]}),m=na(d.map(function(y){return y.rescale(i)}),h,this.config.iouThreshold,!0),g=m.map(function(y){return new Zg(h[y],p[y],v[y],d[y],l)}),[2,g]}})})},n.prototype.getDefaultModelName=function(){return""},n.prototype.extractParamsFromWeigthMap=function(t){return gI(t,this.config)},n.prototype.extractParams=function(t){var r=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,o=r?r.length:void 0;if(o!==7&&o!==8&&o!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+o+" filterSizes in config");return vI(t,this.config,this.boxEncodingSize,r)},n.prototype.extractBoxes=function(t,r,o){return we(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,v,m,g,b,x,y,w,_,S,R,E,C,I,k,M,P,L,q,V,F=this;return _e(this,function(H){switch(H.label){case 0:return i=r.width,a=r.height,s=Math.max(i,a),u=s/i,c=s/a,l=t.shape[1],f=this.config.anchors.length,d=ve(function(){var $=t.reshape([l,l,f,F.boxEncodingSize]),G=$.slice([0,0,0,0],[l,l,f,4]),O=$.slice([0,0,0,4],[l,l,f,1]),re=F.withClassScores?wr($.slice([0,0,0,5],[l,l,f,F.config.classes.length]),3):de(0);return[G,O,re]}),h=d[0],p=d[1],v=d[2],m=[],[4,p.array()];case 1:return g=H.sent(),[4,h.array()];case 2:b=H.sent(),x=0,H.label=3;case 3:if(!(x<l))return[3,12];y=0,H.label=4;case 4:if(!(y<l))return[3,11];w=0,H.label=5;case 5:return w<f?(_=oc(g[x][y][w][0]),!o||_>o?(S=(y+oc(b[x][y][w][0]))/l*u,R=(x+oc(b[x][y][w][1]))/l*c,E=Math.exp(b[x][y][w][2])*this.config.anchors[w].x/l*u,C=Math.exp(b[x][y][w][3])*this.config.anchors[w].y/l*c,I=S-E/2,k=R-C/2,M={row:x,col:y,anchor:w},this.withClassScores?[4,this.extractPredictedClass(v,M)]:[3,7]):[3,9]):[3,10];case 6:return V=H.sent(),[3,8];case 7:V={classScore:1,label:0},H.label=8;case 8:P=V,L=P.classScore,q=P.label,m.push(Nt({box:new cu(I,k,I+E,k+C),score:_,classScore:_*L,label:q},M)),H.label=9;case 9:return w++,[3,5];case 10:return y++,[3,4];case 11:return x++,[3,3];case 12:return h.dispose(),p.dispose(),v.dispose(),[2,m]}})})},n.prototype.extractPredictedClass=function(t,r){return we(this,void 0,void 0,function(){var o,i,a,s;return _e(this,function(u){switch(u.label){case 0:return o=r.row,i=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(c,l){return s[o][i][a][l]}).map(function(c,l){return{classScore:c,label:l}}).reduce(function(c,l){return c.classScore>l.classScore?c:l})]}})})},n.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],n})(Cr),yI=(function(e){Ae(n,e);function n(t){t===void 0&&(t=!0);var r=this,o=Object.assign({},{withSeparableConvs:t,iouThreshold:sI,classes:["face"]},t?{anchors:cI,meanRgb:lI}:{anchors:uI,withClassScores:!0});return r=e.call(this,o)||this,r}return Object.defineProperty(n.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return we(this,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new nr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return this.withSeparableConvs?dI:fI},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n})(ky),bI=(function(e){Ae(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return n})(Sf),ma=(function(){function e(){}return e.prototype.then=function(n){return we(this,void 0,void 0,function(){var t;return _e(this,function(r){switch(r.label){case 0:return t=n,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},e.prototype.run=function(){return we(this,void 0,void 0,function(){return _e(this,function(n){throw new Error("ComposableTask - run is not implemented")})})},e})();function hu(e,n,t,r,o){return o===void 0&&(o=function(i){var a=i.alignedRect;return a}),we(this,void 0,void 0,function(){var i,a,s,u,c;return _e(this,function(l){switch(l.label){case 0:return i=e.map(function(f){return Rk(f)?o(f):f.detection}),s=r,s?[3,5]:n instanceof Je?[4,yf(n,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,gf(n,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return a=s,[4,t(a)];case 6:return c=l.sent(),a.forEach(function(f){return f instanceof Je&&f.dispose()}),[2,c]}})})}function Rf(e,n,t,r,o){return we(this,void 0,void 0,function(){var i=this;return _e(this,function(a){return[2,hu([e],n,function(s){return we(i,void 0,void 0,function(){return _e(this,function(u){return[2,t(s[0])]})})},r,o)]})})}function xI(e){return ve(function(){return ln(ht(e,3).reverse(),3)})}var Ma=2,As=12;function wI(e,n){var t=fu(e,n),r=bf(e,n);function o(c,l){var f=st(e(c));return n.push({paramPath:l}),f}function i(c,l,f){f===void 0&&(f=!1);var d=t(c[0],c[1],3,l+"/conv1"),h=o(c[1],l+"/prelu1_alpha"),p=t(c[1],c[2],3,l+"/conv2"),v=o(c[2],l+"/prelu2_alpha"),m=t(c[2],c[3],f?2:3,l+"/conv3"),g=o(c[3],l+"/prelu3_alpha");return{conv1:d,prelu1_alpha:h,conv2:p,prelu2_alpha:v,conv3:m,prelu3_alpha:g}}function a(){var c=i([3,10,16,32],"pnet"),l=t(32,2,1,"pnet/conv4_1"),f=t(32,4,1,"pnet/conv4_2");return Nt(Nt({},c),{conv4_1:l,conv4_2:f})}function s(){var c=i([3,28,48,64],"rnet",!0),l=r(576,128,"rnet/fc1"),f=o(128,"rnet/prelu4_alpha"),d=r(128,2,"rnet/fc2_1"),h=r(128,4,"rnet/fc2_2");return Nt(Nt({},c),{fc1:l,prelu4_alpha:f,fc2_1:d,fc2_2:h})}function u(){var c=i([3,32,64,64],"onet"),l=t(64,128,2,"onet/conv4"),f=o(128,"onet/prelu4_alpha"),d=r(1152,256,"onet/fc1"),h=o(256,"onet/prelu5_alpha"),p=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),m=r(256,10,"onet/fc2_3");return Nt(Nt({},c),{conv4:l,prelu4_alpha:f,fc1:d,prelu5_alpha:h,fc2_1:p,fc2_2:v,fc2_3:m})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function _I(e){var n=Sr(e),t=n.extractWeights,r=n.getRemainingWeights,o=[],i=wI(t,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),f=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:f},paramMappings:o}}function CI(e,n){var t=Yr(e,n);function r(l){var f=t(l+"/weights",4,l+"/filters"),d=t(l+"/bias",1);return{filters:f,bias:d}}function o(l){var f=t(l+"/weights",2),d=t(l+"/bias",1);return{weights:f,bias:d}}function i(l){return t(l,1)}function a(l){var f=r(l+"/conv1"),d=i(l+"/prelu1_alpha"),h=r(l+"/conv2"),p=i(l+"/prelu2_alpha"),v=r(l+"/conv3"),m=i(l+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:h,prelu2_alpha:p,conv3:v,prelu3_alpha:m}}function s(){var l=a("pnet"),f=r("pnet/conv4_1"),d=r("pnet/conv4_2");return Nt(Nt({},l),{conv4_1:f,conv4_2:d})}function u(){var l=a("rnet"),f=o("rnet/fc1"),d=i("rnet/prelu4_alpha"),h=o("rnet/fc2_1"),p=o("rnet/fc2_2");return Nt(Nt({},l),{fc1:f,prelu4_alpha:d,fc2_1:h,fc2_2:p})}function c(){var l=a("onet"),f=r("onet/conv4"),d=i("onet/prelu4_alpha"),h=o("onet/fc1"),p=i("onet/prelu5_alpha"),v=o("onet/fc2_1"),m=o("onet/fc2_2"),g=o("onet/fc2_3");return Nt(Nt({},l),{conv4:f,prelu4_alpha:d,fc1:h,prelu5_alpha:p,fc2_1:v,fc2_2:m,fc2_3:g})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:c}}function EI(e){var n=[],t=CI(e,n),r=t.extractPNetParams,o=t.extractRNetParams,i=t.extractONetParams,a=r(),s=o(),u=i();return Er(e,n),{params:{pnet:a,rnet:s,onet:u},paramMappings:n}}function rl(e,n){var t=n[0],r=n[1];return{height:Math.floor(t*e),width:Math.floor(r*e)}}function SI(e,n,t){for(var r=t[0],o=t[1],i=As/e,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(n,u)),s=s*n,u+=1;return a}var kf=(function(e){Ae(n,e);function n(t,r,o,i){return e.call(this,{left:t,top:r,right:o,bottom:i},!0)||this}return n})(jr);function Iy(e){return ve(function(){return Ot(mt(e,de(127.5)),de(.0078125))})}function ii(e,n){return ve(function(){return Oe(Ze(e),Ot(n,_s(Ze(_s(e)))))})}function If(e,n,t){return t===void 0&&(t=!1),ve(function(){var r=In(e,n.conv1,"valid");return r=ii(r,n.prelu1_alpha),r=bt(r,t?[2,2]:[3,3],[2,2],"same"),r=In(r,n.conv2,"valid"),r=ii(r,n.prelu2_alpha),r=t?r:bt(r,[3,3],[2,2],"valid"),r=In(r,n.conv3,"valid"),r=ii(r,n.prelu3_alpha),r})}function RI(e,n){return ve(function(){var t=If(e,n,!0),r=In(t,n.conv4_1,"valid"),o=gn(iu(r,3),3),i=wr(mt(r,o),3),a=In(t,n.conv4_2,"valid");return{prob:i,regions:a}})}function kI(e,n){return ve(function(){var t=rl(n,e.shape.slice(1)),r=t.height,o=t.width,i=of.resizeBilinear(e,[r,o]),a=Iy(i);return Gr(a,[0,2,1,3])})}function II(e,n,t,r){for(var o=[],i=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)i[a][s]>=r&&o.push(new Ue(s,a));var u=o.map(function(c){var l=new cu(Math.round((c.y*Ma+1)/t),Math.round((c.x*Ma+1)/t),Math.round((c.y*Ma+As)/t),Math.round((c.x*Ma+As)/t)),f=i[c.y][c.x],d=n.arraySync(),h=new kf(d[c.y][c.x][0],d[c.y][c.x][1],d[c.y][c.x][2],d[c.y][c.x][3]);return{cell:l,score:f,region:h}});return u}function AI(e,n,t,r,o){o.stage1=[];var i=n.map(function(d){return ve(function(){var h={scale:d},p=kI(e,d),v=Date.now(),m=RI(p,r),g=m.prob,b=m.regions;h.pnet=Date.now()-v;var x=ht(ht(g,3)[1])[0],y=ht(b)[0];return{scoresTensor:x,regionsTensor:y,scale:d,statsForScale:h}})}),a=i.map(function(d){var h=d.scoresTensor,p=d.regionsTensor,v=d.scale,m=d.statsForScale,g=II(h,p,v,t);if(h.dispose(),p.dispose(),!g.length)return o.stage1.push(m),[];var b=Date.now(),x=na(g.map(function(y){return y.cell}),g.map(function(y){return y.score}),.5);return m.nms=Date.now()-b,m.numBoxes=x.length,o.stage1.push(m),x.map(function(y){return g[y]})}),s=a.reduce(function(d,h){return d.concat(h)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),f=na(s.map(function(d){return d.cell}),s.map(function(d){return d.score}),.7);o.stage1_nms=Date.now()-l,c=f.map(function(d){return s[d].score}),u=f.map(function(d){return s[d]}).map(function(d){var h=d.cell,p=d.region;return new cu(h.left+p.left*h.width,h.top+p.top*h.height,h.right+p.right*h.width,h.bottom+p.bottom*h.height).toSquare().round()})}return{boxes:u,scores:c}}function Ay(e,n,t){var r=t.width,o=t.height;return we(this,void 0,void 0,function(){var i,a,s,u=this;return _e(this,function(c){switch(c.label){case 0:return i=wo(e),[4,Promise.all(n.map(function(l){return we(u,void 0,void 0,function(){var f,d,h,p,v,m,g,b;return _e(this,function(x){return f=l.padAtBorders(e.height,e.width),d=f.y,h=f.ey,p=f.x,v=f.ex,m=p-1,g=d-1,b=i.getImageData(m,g,v-m,h-g),[2,Lt.isNodejs()?mf(b):createImageBitmap(b)]})})}))];case 1:return a=c.sent(),s=[],a.forEach(function(l){var f=lu({width:r,height:o}),d=wo(f);d.drawImage(l,0,0,r,o);for(var h=d.getImageData(0,0,r,o).data,p=[],v=0;v<h.length;v+=4)p.push(h[v+2]),p.push(h[v+1]),p.push(h[v]);s.push(p)}),[2,s.map(function(l){var f=ve(function(){var d=Gr(jt(l,[1,r,o,3]),[0,2,1,3]).toFloat();return Iy(d)});return f})]}})})}function TI(e,n){return ve(function(){var t=If(e,n),r=Rn(t,[t.shape[0],n.fc1.weights.shape[0]]),o=jn(r,n.fc1),i=ii(o,n.prelu4_alpha),a=jn(i,n.fc2_1),s=gn(iu(a,1),1),u=wr(mt(a,s),1),c=jn(i,n.fc2_2),l=ht(u,1)[1];return{scores:l,regions:c}})}function DI(e,n,t,r,o){return we(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,v,m,g,b;return _e(this,function(x){switch(x.label){case 0:return i=Date.now(),[4,Ay(e,n,{width:24,height:24})];case 1:return a=x.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(y){var w=TI(y,r);return y.dispose(),w}),o.stage2_rnet=Date.now()-i,u=s.length>1?dt(s.map(function(y){return y.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[x.sent()]),u.dispose(),d=c.map(function(y,w){return{score:y,idx:w}}).filter(function(y){return y.score>t}).map(function(y){var w=y.idx;return w}),h=d.map(function(y){return n[y]}),p=d.map(function(y){return c[y]}),v=[],m=[],h.length>0&&(i=Date.now(),g=na(h,p,.7),o.stage2_nms=Date.now()-i,b=g.map(function(y){var w=s[d[y]].regions.arraySync();return new kf(w[0][0],w[0][1],w[0][2],w[0][3])}),m=g.map(function(y){return p[y]}),v=g.map(function(y,w){return h[y].calibrate(b[w])})),s.forEach(function(y){y.regions.dispose(),y.scores.dispose()}),[2,{boxes:v,scores:m}]}})})}function NI(e,n){return ve(function(){var t=If(e,n);t=bt(t,[2,2],[2,2],"same"),t=In(t,n.conv4,"valid"),t=ii(t,n.prelu4_alpha);var r=Rn(t,[t.shape[0],n.fc1.weights.shape[0]]),o=jn(r,n.fc1),i=ii(o,n.prelu5_alpha),a=jn(i,n.fc2_1),s=gn(iu(a,1),1),u=wr(mt(a,s),1),c=jn(i,n.fc2_2),l=jn(i,n.fc2_3),f=ht(u,1)[1];return{scores:f,regions:c,points:l}})}function FI(e,n,t,r,o){return we(this,void 0,void 0,function(){var i,a,s,u,c,l,f,d,h,p,v,m,g,b,x;return _e(this,function(y){switch(y.label){case 0:return i=Date.now(),[4,Ay(e,n,{width:48,height:48})];case 1:return a=y.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(w){var _=NI(w,r);return w.dispose(),_}),o.stage3_onet=Date.now()-i,u=s.length>1?dt(s.map(function(w){return w.scores})):s[0].scores,f=(l=Array).from,[4,u.data()];case 2:return c=f.apply(l,[y.sent()]),u.dispose(),d=c.map(function(w,_){return{score:w,idx:_}}).filter(function(w){return w.score>t}).map(function(w){var _=w.idx;return _}),h=d.map(function(w){var _=s[w].regions.arraySync();return new kf(_[0][0],_[0][1],_[0][2],_[0][3])}),p=d.map(function(w,_){return n[w].calibrate(h[_])}),v=d.map(function(w){return c[w]}),m=[],g=[],b=[],p.length>0&&(i=Date.now(),x=na(p,v,.7,!1),o.stage3_nms=Date.now()-i,m=x.map(function(w){return p[w]}),g=x.map(function(w){return v[w]}),b=x.map(function(w,_){return Array(5).fill(0).map(function(S,R){var E=s[w].points.arraySync();return new Ue(E[0][R]*(m[_].width+1)+m[_].left,E[0][R+5]*(m[_].height+1)+m[_].top)})})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose(),w.points.dispose()}),[2,{boxes:m,scores:g,points:b}]}})})}var PI=(function(e){Ae(n,e);function n(){return e.call(this,"Mtcnn")||this}return n.prototype.load=function(t){return we(this,void 0,void 0,function(){return _e(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]})})},n.prototype.loadFromDisk=function(t){return we(this,void 0,void 0,function(){return _e(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]})})},n.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),we(this,void 0,void 0,function(){var o,i,a,s,u,c,l,f,d,h,p,v,m,g,b,x,y,w,_,S,R;return _e(this,function(E){switch(E.label){case 0:if(o=this.params,!o)throw new Error("Mtcnn - load model before inference");if(i=t.canvases[0],!i)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=ve(function(){return xI(gn(ff.fromPixels(i)).toFloat())}),c=function(C){return u.dispose(),a.total=Date.now()-s,C},l=u.shape.slice(1),f=l[0],d=l[1],h=new Sy(r),p=h.minFaceSize,v=h.scaleFactor,m=h.maxNumScales,g=h.scoreThresholds,b=h.scaleSteps,x=(b||SI(p,v,[f,d])).filter(function(C){var I=rl(C,[f,d]);return Math.min(I.width,I.height)>As}).slice(0,m),a.scales=x,a.pyramid=x.map(function(C){return rl(C,[f,d])}),y=Date.now(),[4,AI(u,x,g[0],o.pnet,a)];case 1:return w=E.sent(),a.total_stage1=Date.now()-y,w.boxes.length?(a.stage2_numInputBoxes=w.boxes.length,y=Date.now(),[4,DI(i,w.boxes,g[1],o.rnet,a)]):[2,c({results:[],stats:a})];case 2:return _=E.sent(),a.total_stage2=Date.now()-y,_.boxes.length?(a.stage3_numInputBoxes=_.boxes.length,y=Date.now(),[4,FI(i,_.boxes,g[2],o.onet,a)]):[2,c({results:[],stats:a})];case 3:return S=E.sent(),a.total_stage3=Date.now()-y,R=S.boxes.map(function(C,I){return _f(pf({},new nr(S.scores[I],new hf(C.left/d,C.top/f,C.width/d,C.height/f),{height:f,width:d})),new ck(S.points[I].map(function(k){return k.sub(new Ue(C.left,C.top)).div(new Ue(C.width,C.height))}),{width:C.width,height:C.height}))}),[2,c({results:R,stats:a})]}})})},n.prototype.forward=function(t,r){return r===void 0&&(r={}),we(this,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,_t(t)];case 1:return[4,o.apply(this,[i.sent(),r])];case 2:return[2,i.sent().results]}})})},n.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),we(this,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return o=this.forwardInput,[4,_t(t)];case 1:return[2,o.apply(this,[i.sent(),r])]}})})},n.prototype.getDefaultModelName=function(){return"mtcnn_model"},n.prototype.extractParamsFromWeigthMap=function(t){return EI(t)},n.prototype.extractParams=function(t){return _I(t)},n})(Cr),MI=.4,OI=[new Ue(1.603231,2.094468),new Ue(6.041143,7.080126),new Ue(2.882459,3.518061),new Ue(4.266906,5.178857),new Ue(9.041765,10.66308)],BI=[117.001,114.697,97.404],LI=(function(e){Ae(n,e);function n(){var t=this,r={withSeparableConvs:!0,iouThreshold:MI,classes:["face"],anchors:OI,meanRgb:BI,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=e.call(this,r)||this,t}return Object.defineProperty(n.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),n.prototype.locateFaces=function(t,r){return we(this,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return[4,this.detect(t,r)];case 1:return o=i.sent(),[2,o.map(function(a){return new nr(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},n.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},n.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},n})(ky),xt={ssdMobilenetv1:new Ry,tinyFaceDetector:new LI,tinyYolov2:new yI,mtcnn:new PI,faceLandmark68Net:new by,faceLandmark68TinyNet:new Wk,faceRecognitionNet:new jk,faceExpressionNet:new Sk,ageGenderNet:new Mk},Ty=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return n})(ma),Af=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o=this;return _e(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,hu(t,this.input,function(a){return we(o,void 0,void 0,function(){return _e(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return xt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){return my(a,r[s])})]}})})},n.prototype.withAgeAndGender=function(){return new Ff(this,this.input)},n})(Ty),Tf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r;return _e(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,Rf(t,this.input,function(i){return xt.faceExpressionNet.predictExpressions(i)},this.extractedFaces)]:[2];case 2:return r=o.sent(),[2,my(t,r)]}})})},n.prototype.withAgeAndGender=function(){return new Pf(this,this.input)},n})(Ty),Df=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Mf(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Bf(this,this.input)},n})(Af),Nf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withAgeAndGender=function(){return new Of(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Lf(this,this.input)},n})(Tf),Dy=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.extractedFaces=o,i}return n})(ma),Ff=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o=this;return _e(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,hu(t,this.input,function(a){return we(o,void 0,void 0,function(){return _e(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return xt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=i.sent(),[2,t.map(function(a,s){var u=r[s],c=u.age,l=u.gender,f=u.genderProbability;return Cy(Ey(a,l,f),c)})]}})})},n.prototype.withFaceExpressions=function(){return new Af(this,this.input)},n})(Dy),Pf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o,i,a;return _e(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,Rf(t,this.input,function(u){return xt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),o=r.age,i=r.gender,a=r.genderProbability,[2,Cy(Ey(t,i,a),o)]}})})},n.prototype.withFaceExpressions=function(){return new Tf(this,this.input)},n})(Dy),Mf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Df(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Bf(this,this.input)},n})(Ff),Of=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.withFaceExpressions=function(){return new Nf(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Lf(this,this.input)},n})(Pf),Ny=(function(e){Ae(n,e);function n(t,r){var o=e.call(this)||this;return o.parentTask=t,o.input=r,o}return n})(ma),Bf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r;return _e(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,hu(t,this.input,function(i){return Promise.all(i.map(function(a){return xt.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=o.sent(),[2,r.map(function(i,a){return _y(t[a],i)})]}})})},n.prototype.withFaceExpressions=function(){return new Df(this,this.input)},n.prototype.withAgeAndGender=function(){return new Mf(this,this.input)},n})(Ny),Lf=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r;return _e(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),t?[4,Rf(t,this.input,function(i){return xt.faceRecognitionNet.computeFaceDescriptor(i)},null,function(i){return i.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=o.sent(),[2,_y(t,r)]}})})},n.prototype.withFaceExpressions=function(){return new Nf(this,this.input)},n.prototype.withAgeAndGender=function(){return new Of(this,this.input)},n})(Ny),Fy=(function(e){Ae(n,e);function n(t,r,o){var i=e.call(this)||this;return i.parentTask=t,i.input=r,i.useTinyLandmarkNet=o,i}return Object.defineProperty(n.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?xt.faceLandmark68TinyNet:xt.faceLandmark68Net},enumerable:!0,configurable:!0}),n})(ma),WI=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o,i,a,s=this;return _e(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(c){return c.detection}),this.input instanceof Je?[4,yf(this.input,r)]:[3,3];case 2:return i=u.sent(),[3,5];case 3:return[4,gf(this.input,r)];case 4:i=u.sent(),u.label=5;case 5:return o=i,[4,Promise.all(o.map(function(c){return s.landmarkNet.detectLandmarks(c)}))];case 6:return a=u.sent(),o.forEach(function(c){return c instanceof Je&&c.dispose()}),[2,t.map(function(c,l){return _f(c,a[l])})]}})})},n.prototype.withFaceExpressions=function(){return new Df(this,this.input)},n.prototype.withAgeAndGender=function(){return new Mf(this,this.input)},n.prototype.withFaceDescriptors=function(){return new Bf(this,this.input)},n})(Fy),VI=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o,i,a;return _e(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof Je?[4,yf(this.input,[r])]:[3,3]):[2];case 2:return i=s.sent(),[3,5];case 3:return[4,gf(this.input,[r])];case 4:i=s.sent(),s.label=5;case 5:return o=i,[4,this.landmarkNet.detectLandmarks(o[0])];case 6:return a=s.sent(),o.forEach(function(u){return u instanceof Je&&u.dispose()}),[2,_f(t,a)]}})})},n.prototype.withFaceExpressions=function(){return new Nf(this,this.input)},n.prototype.withAgeAndGender=function(){return new Of(this,this.input)},n.prototype.withFaceDescriptor=function(){return new Lf(this,this.input)},n})(Fy),Py=(function(e){Ae(n,e);function n(t,r){r===void 0&&(r=new du);var o=e.call(this)||this;return o.input=t,o.options=r,o}return n})(ma),UI=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r,o,i;return _e(this,function(a){switch(a.label){case 0:return t=this,r=t.input,o=t.options,o instanceof Sy?[4,xt.mtcnn.forward(r,o)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(i=o instanceof bI?function(s){return xt.tinyFaceDetector.locateFaces(s,o)}:o instanceof du?function(s){return xt.ssdMobilenetv1.locateFaces(s,o)}:o instanceof Sf?function(s){return xt.tinyYolov2.locateFaces(s,o)}:null,!i)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,i(r)]}})})},n.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return we(t,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o.map(function(a){return pf({},a)}))]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new WI(this.runAndExtendWithFaceDetections(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Af(this.runAndExtendWithFaceDetections(),this.input)},n.prototype.withAgeAndGender=function(){return new Ff(this.runAndExtendWithFaceDetections(),this.input)},n})(Py),zI=(function(e){Ae(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.run=function(){return we(this,void 0,void 0,function(){var t,r;return _e(this,function(o){switch(o.label){case 0:return[4,new UI(this.input,this.options)];case 1:return t=o.sent(),r=t[0],t.forEach(function(i){i.score>r.score&&(r=i)}),[2,r]}})})},n.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return we(t,void 0,void 0,function(){var o;return _e(this,function(i){switch(i.label){case 0:return[4,this.run()];case 1:return o=i.sent(),[2,r(o?pf({},o):void 0)]}})})})},n.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new VI(this.runAndExtendWithFaceDetection(),this.input,t)},n.prototype.withFaceExpressions=function(){return new Tf(this.runAndExtendWithFaceDetection(),this.input)},n.prototype.withAgeAndGender=function(){return new Pf(this.runAndExtendWithFaceDetection(),this.input)},n})(Py);function ja(e,n){return n===void 0&&(n=new du),new zI(e,n)}function Ts(e,n){if(e.length!==n.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(e),r=Array.from(n);return Math.sqrt(t.map(function(o,i){return o-r[i]}).reduce(function(o,i){return o+Math.pow(i,2)},0))}(function(){function e(n,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(n)?n:[n];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var o=1,i=function(){return"person "+o++};this._labeledDescriptors=r.map(function(a){if(a instanceof Da)return a;if(a instanceof Float32Array)return new Da(i(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new Da(i(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(e.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),e.prototype.computeMeanDistance=function(n,t){return t.map(function(r){return Ts(r,n)}).reduce(function(r,o){return r+o},0)/(t.length||1)},e.prototype.matchDescriptor=function(n){var t=this;return this.labeledDescriptors.map(function(r){var o=r.descriptors,i=r.label;return new $h(i,t.computeMeanDistance(n,o))}).reduce(function(r,o){return r.distance<o.distance?r:o})},e.prototype.findBestMatch=function(n){var t=this.matchDescriptor(n);return t.distance<this.distanceThreshold?t:new $h("unknown",t.distance)},e.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(n){return n.toJSON()})}},e.fromJSON=function(n){var t=n.labeledDescriptors.map(function(r){return Da.fromJSON(r)});return new e(t,n.distanceThreshold)},e})();const qI=en({name:"QAvatar",props:{...Tl,fontSize:String,color:String,textColor:String,icon:String,square:Boolean,rounded:Boolean},setup(e,{slots:n}){const t=Dl(e),r=oe(()=>"q-avatar"+(e.color?` bg-${e.color}`:"")+(e.textColor?` text-${e.textColor} q-chip--colored`:"")+(e.square===!0?" q-avatar--square":e.rounded===!0?" rounded-borders":"")),o=oe(()=>e.fontSize?{fontSize:e.fontSize}:null);return()=>{const i=e.icon!==void 0?[se(li,{name:e.icon})]:void 0;return se("div",{class:r.value,style:t.value},[se("div",{class:"q-avatar__content row flex-center overflow-hidden",style:o.value},Bw(n.default,i))])}}}),Jn=Re(!1);let ol;function HI(e,n){const t=/(edg|edge|edga|edgios)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(vivaldi)[\/]([\w.]+)/.exec(e)||/(chrome|crios)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+).*(version)[\/]([\w.]+).*(safari)[\/]([\w.]+)/.exec(e)||/(firefox|fxios)[\/]([\w.]+)/.exec(e)||/(webkit)[\/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[\/]([\w.]+)/.exec(e)||[];return{browser:t[5]||t[3]||t[1]||"",version:t[4]||t[2]||"0",platform:n[0]||""}}function GI(e){return/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(silk)/.exec(e)||/(android)/.exec(e)||/(win)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||/(playbook)/.exec(e)||/(bb)/.exec(e)||/(blackberry)/.exec(e)||[]}const My="ontouchstart"in window||window.navigator.maxTouchPoints>0;function jI(e){const n=e.toLowerCase(),t=GI(n),r=HI(n,t),o={mobile:!1,desktop:!1,cordova:!1,capacitor:!1,nativeMobile:!1,electron:!1,bex:!1,linux:!1,mac:!1,win:!1,cros:!1,chrome:!1,firefox:!1,opera:!1,safari:!1,vivaldi:!1,edge:!1,edgeChromium:!1,ie:!1,webkit:!1,android:!1,ios:!1,ipad:!1,iphone:!1,ipod:!1,kindle:!1,winphone:!1,blackberry:!1,playbook:!1,silk:!1};r.browser&&(o[r.browser]=!0,o.version=r.version,o.versionNumber=parseInt(r.version,10)),r.platform&&(o[r.platform]=!0);const i=o.android||o.ios||o.bb||o.blackberry||o.ipad||o.iphone||o.ipod||o.kindle||o.playbook||o.silk||o["windows phone"];if(i===!0||n.indexOf("mobile")!==-1?o.mobile=!0:o.desktop=!0,o["windows phone"]&&(o.winphone=!0,delete o["windows phone"]),o.edga||o.edgios||o.edg?(o.edge=!0,r.browser="edge"):o.crios?(o.chrome=!0,r.browser="chrome"):o.fxios&&(o.firefox=!0,r.browser="firefox"),(o.ipod||o.ipad||o.iphone)&&(o.ios=!0),o.vivaldi&&(r.browser="vivaldi",o.vivaldi=!0),(o.chrome||o.opr||o.safari||o.vivaldi||o.mobile===!0&&o.ios!==!0&&i!==!0)&&(o.webkit=!0),o.opr&&(r.browser="opera",o.opera=!0),o.safari&&(o.blackberry||o.bb?(r.browser="blackberry",o.blackberry=!0):o.playbook?(r.browser="playbook",o.playbook=!0):o.android?(r.browser="android",o.android=!0):o.kindle?(r.browser="kindle",o.kindle=!0):o.silk&&(r.browser="silk",o.silk=!0)),o.name=r.browser,o.platform=r.platform,n.indexOf("electron")!==-1)o.electron=!0;else if(document.location.href.indexOf("-extension://")!==-1)o.bex=!0;else{if(window.Capacitor!==void 0?(o.capacitor=!0,o.nativeMobile=!0,o.nativeMobileWrapper="capacitor"):(window._cordovaNative!==void 0||window.cordova!==void 0)&&(o.cordova=!0,o.nativeMobile=!0,o.nativeMobileWrapper="cordova"),Jn.value===!0&&(ol={is:{...o}}),My===!0&&o.mac===!0&&(o.desktop===!0&&o.safari===!0||o.nativeMobile===!0&&o.android!==!0&&o.ios!==!0&&o.ipad!==!0)){delete o.mac,delete o.desktop;const a=Math.min(window.innerHeight,window.innerWidth)>414?"ipad":"iphone";Object.assign(o,{mobile:!0,ios:!0,platform:a,[a]:!0})}o.mobile!==!0&&window.navigator.userAgentData&&window.navigator.userAgentData.mobile&&(delete o.desktop,o.mobile=!0)}return o}const Zh=navigator.userAgent||navigator.vendor||window.opera,$I={has:{touch:!1,webStorage:!1},within:{iframe:!1}},ft={userAgent:Zh,is:jI(Zh),has:{touch:My},within:{iframe:window.self!==window.top}},il={install(e){const{$q:n}=e;Jn.value===!0?(e.onSSRHydrated.push(()=>{Object.assign(n.platform,ft),Jn.value=!1}),n.platform=Hn(this)):n.platform=this}};{let e;mi(ft.has,"webStorage",()=>{if(e!==void 0)return e;try{if(window.localStorage)return e=!0,!0}catch{}return e=!1,!1}),Object.assign(il,ft),Jn.value===!0&&(Object.assign(il,ol,$I),ol=null)}function Oy(e,n=250,t){let r=null;function o(){const i=arguments,a=()=>{r=null,e.apply(this,i)};r!==null&&clearTimeout(r),r=setTimeout(a,n)}return o.cancel=()=>{r!==null&&clearTimeout(r)},o}const sc=["sm","md","lg","xl"],{passive:ep}=zt,KI=Qs({width:0,height:0,name:"xs",sizes:{sm:600,md:1024,lg:1440,xl:1920},lt:{sm:!0,md:!0,lg:!0,xl:!0},gt:{xs:!1,sm:!1,md:!1,lg:!1},xs:!0,sm:!1,md:!1,lg:!1,xl:!1},{setSizes:bo,setDebounce:bo,install({$q:e,onSSRHydrated:n}){if(e.screen=this,this.__installed===!0){e.config.screen!==void 0&&(e.config.screen.bodyClasses===!1?document.body.classList.remove(`screen--${this.name}`):this.__update(!0));return}const{visualViewport:t}=window,r=t||window,o=document.scrollingElement||document.documentElement,i=t===void 0||ft.is.mobile===!0?()=>[Math.max(window.innerWidth,o.clientWidth),Math.max(window.innerHeight,o.clientHeight)]:()=>[t.width*t.scale+window.innerWidth-o.clientWidth,t.height*t.scale+window.innerHeight-o.clientHeight],a=e.config.screen?.bodyClasses===!0;this.__update=f=>{const[d,h]=i();if(h!==this.height&&(this.height=h),d!==this.width)this.width=d;else if(f!==!0)return;let p=this.sizes;this.gt.xs=d>=p.sm,this.gt.sm=d>=p.md,this.gt.md=d>=p.lg,this.gt.lg=d>=p.xl,this.lt.sm=d<p.sm,this.lt.md=d<p.md,this.lt.lg=d<p.lg,this.lt.xl=d<p.xl,this.xs=this.lt.sm,this.sm=this.gt.xs===!0&&this.lt.md===!0,this.md=this.gt.sm===!0&&this.lt.lg===!0,this.lg=this.gt.md===!0&&this.lt.xl===!0,this.xl=this.gt.lg,p=this.xs===!0&&"xs"||this.sm===!0&&"sm"||this.md===!0&&"md"||this.lg===!0&&"lg"||"xl",p!==this.name&&(a===!0&&(document.body.classList.remove(`screen--${this.name}`),document.body.classList.add(`screen--${p}`)),this.name=p)};let s,u={},c=16;this.setSizes=f=>{sc.forEach(d=>{f[d]!==void 0&&(u[d]=f[d])})},this.setDebounce=f=>{c=f};const l=()=>{const f=getComputedStyle(document.body);f.getPropertyValue("--q-size-sm")&&sc.forEach(d=>{this.sizes[d]=parseInt(f.getPropertyValue(`--q-size-${d}`),10)}),this.setSizes=d=>{sc.forEach(h=>{d[h]&&(this.sizes[h]=d[h])}),this.__update(!0)},this.setDebounce=d=>{s!==void 0&&r.removeEventListener("resize",s,ep),s=d>0?Oy(this.__update,d):this.__update,r.addEventListener("resize",s,ep)},this.setDebounce(c),Object.keys(u).length!==0?(this.setSizes(u),u=void 0):this.__update(),a===!0&&this.name==="xs"&&document.body.classList.add("screen--xs")};Jn.value===!0?n.push(l):l()}}),At=Qs({isActive:!1,mode:!1},{__media:void 0,set(e){At.mode=e,e==="auto"?(At.__media===void 0&&(At.__media=window.matchMedia("(prefers-color-scheme: dark)"),At.__updateMedia=()=>{At.set("auto")},At.__media.addListener(At.__updateMedia)),e=At.__media.matches):At.__media!==void 0&&(At.__media.removeListener(At.__updateMedia),At.__media=void 0),At.isActive=e===!0,document.body.classList.remove(`body--${e===!0?"light":"dark"}`),document.body.classList.add(`body--${e===!0?"dark":"light"}`)},toggle(){At.set(At.isActive===!1)},install({$q:e,ssrContext:n}){const t=e.config.dark;e.dark=this,this.__installed!==!0&&this.set(t!==void 0?t:!1)}});function XI(e,n,t=document.body){if(typeof e!="string")throw new TypeError("Expected a string as propName");if(typeof n!="string")throw new TypeError("Expected a string as value");if(!(t instanceof Element))throw new TypeError("Expected a DOM element");t.style.setProperty(`--q-${e}`,n)}function By(e){if(e.ios===!0)return"ios";if(e.android===!0)return"android"}function YI({is:e,has:n,within:t},r){const o=[e.desktop===!0?"desktop":"mobile",`${n.touch===!1?"no-":""}touch`];if(e.mobile===!0){const i=By(e);i!==void 0&&o.push("platform-"+i)}if(e.nativeMobile===!0){const i=e.nativeMobileWrapper;o.push(i),o.push("native-mobile"),e.ios===!0&&(r[i]===void 0||r[i].iosStatusBarPadding!==!1)&&o.push("q-ios-padding")}else e.electron===!0?o.push("electron"):e.bex===!0&&o.push("bex");return t.iframe===!0&&o.push("within-iframe"),o}function QI(){const{is:e}=ft,n=document.body.className,t=new Set(n.replace(/ {2}/g," ").split(" "));if(e.nativeMobile!==!0&&e.electron!==!0&&e.bex!==!0){if(e.desktop===!0)t.delete("mobile"),t.delete("platform-ios"),t.delete("platform-android"),t.add("desktop");else if(e.mobile===!0){t.delete("desktop"),t.add("mobile"),t.delete("platform-ios"),t.delete("platform-android");const o=By(e);o!==void 0&&t.add(`platform-${o}`)}}ft.has.touch===!0&&(t.delete("no-touch"),t.add("touch")),ft.within.iframe===!0&&t.add("within-iframe");const r=Array.from(t).join(" ");n!==r&&(document.body.className=r)}function JI(e){for(const n in e)XI(n,e[n])}const ZI={install(e){if(this.__installed!==!0){if(Jn.value===!0)QI();else{const{$q:n}=e;n.config.brand!==void 0&&JI(n.config.brand);const t=YI(ft,n.config);document.body.classList.add.apply(document.body.classList,t)}ft.is.ios===!0&&document.body.addEventListener("touchstart",bo),window.addEventListener("keydown",Zw,!0)}}},Ly=()=>!0;function eA(e){return typeof e=="string"&&e!==""&&e!=="/"&&e!=="#/"}function tA(e){return e.startsWith("#")===!0&&(e=e.substring(1)),e.startsWith("/")===!1&&(e="/"+e),e.endsWith("/")===!0&&(e=e.substring(0,e.length-1)),"#"+e}function nA(e){if(e.backButtonExit===!1)return()=>!1;if(e.backButtonExit==="*")return Ly;const n=["#/"];return Array.isArray(e.backButtonExit)===!0&&n.push(...e.backButtonExit.filter(eA).map(tA)),()=>n.includes(window.location.hash)}const al={__history:[],add:bo,remove:bo,install({$q:e}){if(this.__installed===!0)return;const{cordova:n,capacitor:t}=ft.is;if(n!==!0&&t!==!0)return;const r=e.config[n===!0?"cordova":"capacitor"];if(r?.backButton===!1||t===!0&&(window.Capacitor===void 0||window.Capacitor.Plugins.App===void 0))return;this.add=a=>{a.condition===void 0&&(a.condition=Ly),this.__history.push(a)},this.remove=a=>{const s=this.__history.indexOf(a);s>=0&&this.__history.splice(s,1)};const o=nA(Object.assign({backButtonExit:!0},r)),i=()=>{if(this.__history.length){const a=this.__history[this.__history.length-1];a.condition()===!0&&(this.__history.pop(),a.handler())}else o()===!0?navigator.app.exitApp():window.history.back()};n===!0?document.addEventListener("deviceready",()=>{document.addEventListener("backbutton",i,!1)}):window.Capacitor.Plugins.App.addListener("backButton",i)}},tp={isoName:"en-US",nativeName:"English (US)",label:{clear:"Clear",ok:"OK",cancel:"Cancel",close:"Close",set:"Set",select:"Select",reset:"Reset",remove:"Remove",update:"Update",create:"Create",search:"Search",filter:"Filter",refresh:"Refresh",expand:e=>e?`Expand "${e}"`:"Expand",collapse:e=>e?`Collapse "${e}"`:"Collapse"},date:{days:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),daysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),firstDayOfWeek:0,format24h:!1,pluralDay:"days",prevMonth:"Previous month",nextMonth:"Next month",prevYear:"Previous year",nextYear:"Next year",today:"Today",prevRangeYears:e=>`Previous ${e} years`,nextRangeYears:e=>`Next ${e} years`},table:{noData:"No data available",noResults:"No matching records found",loading:"Loading...",selectedRecords:e=>e===1?"1 record selected.":(e===0?"No":e)+" records selected.",recordsPerPage:"Records per page:",allRows:"All",pagination:(e,n,t)=>e+"-"+n+" of "+t,columns:"Columns"},pagination:{first:"First page",prev:"Previous page",next:"Next page",last:"Last page"},editor:{url:"URL",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",unorderedList:"Unordered List",orderedList:"Ordered List",subscript:"Subscript",superscript:"Superscript",hyperlink:"Hyperlink",toggleFullscreen:"Toggle Fullscreen",quote:"Quote",left:"Left align",center:"Center align",right:"Right align",justify:"Justify align",print:"Print",outdent:"Decrease indentation",indent:"Increase indentation",removeFormat:"Remove formatting",formatting:"Formatting",fontSize:"Font Size",align:"Align",hr:"Insert Horizontal Rule",undo:"Undo",redo:"Redo",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",paragraph:"Paragraph",code:"Code",size1:"Very small",size2:"A bit small",size3:"Normal",size4:"Medium-large",size5:"Big",size6:"Very big",size7:"Maximum",defaultFont:"Default Font",viewSource:"View Source"},tree:{noNodes:"No nodes available",noResults:"No matching nodes found"}};function np(){const e=Array.isArray(navigator.languages)===!0&&navigator.languages.length!==0?navigator.languages[0]:navigator.language;if(typeof e=="string")return e.split(/[-_]/).map((n,t)=>t===0?n.toLowerCase():t>1||n.length<4?n.toUpperCase():n[0].toUpperCase()+n.slice(1).toLowerCase()).join("-")}const Br=Qs({__qLang:{}},{getLocale:np,set(e=tp,n){const t={...e,rtl:e.rtl===!0,getLocale:np};{if(t.set=Br.set,Br.__langConfig===void 0||Br.__langConfig.noHtmlAttrs!==!0){const r=document.documentElement;r.setAttribute("dir",t.rtl===!0?"rtl":"ltr"),r.setAttribute("lang",t.isoName)}Object.assign(Br.__qLang,t)}},install({$q:e,lang:n,ssrContext:t}){e.lang=Br.__qLang,Br.__langConfig=e.config.lang,this.__installed===!0?n!==void 0&&this.set(n):(this.props=new Proxy(this.__qLang,{get(){return Reflect.get(...arguments)},ownKeys(r){return Reflect.ownKeys(r).filter(o=>o!=="set"&&o!=="getLocale")}}),this.set(n||tp))}}),rA={name:"material-icons",type:{positive:"check_circle",negative:"warning",info:"info",warning:"priority_high"},arrow:{up:"arrow_upward",right:"arrow_forward",down:"arrow_downward",left:"arrow_back",dropdown:"arrow_drop_down"},chevron:{left:"chevron_left",right:"chevron_right"},colorPicker:{spectrum:"gradient",tune:"tune",palette:"style"},pullToRefresh:{icon:"refresh"},carousel:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down",navigationIcon:"lens"},chip:{remove:"cancel",selected:"check"},datetime:{arrowLeft:"chevron_left",arrowRight:"chevron_right",now:"access_time",today:"today"},editor:{bold:"format_bold",italic:"format_italic",strikethrough:"strikethrough_s",underline:"format_underlined",unorderedList:"format_list_bulleted",orderedList:"format_list_numbered",subscript:"vertical_align_bottom",superscript:"vertical_align_top",hyperlink:"link",toggleFullscreen:"fullscreen",quote:"format_quote",left:"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify",print:"print",outdent:"format_indent_decrease",indent:"format_indent_increase",removeFormat:"format_clear",formatting:"text_format",fontSize:"format_size",align:"format_align_left",hr:"remove",undo:"undo",redo:"redo",heading:"format_size",code:"code",size:"format_size",font:"font_download",viewSource:"code"},expansionItem:{icon:"keyboard_arrow_down",denseIcon:"arrow_drop_down"},fab:{icon:"add",activeIcon:"close"},field:{clear:"cancel",error:"error"},pagination:{first:"first_page",prev:"keyboard_arrow_left",next:"keyboard_arrow_right",last:"last_page"},rating:{icon:"grade"},stepper:{done:"check",active:"edit",error:"warning"},tabs:{left:"chevron_left",right:"chevron_right",up:"keyboard_arrow_up",down:"keyboard_arrow_down"},table:{arrowUp:"arrow_upward",warning:"warning",firstPage:"first_page",prevPage:"chevron_left",nextPage:"chevron_right",lastPage:"last_page"},tree:{icon:"play_arrow"},uploader:{done:"done",clear:"clear",add:"add_box",upload:"cloud_upload",removeQueue:"clear_all",removeUploaded:"done_all"}},Ds=Qs({iconMapFn:null,__qIconSet:{}},{set(e,n){const t={...e};t.set=Ds.set,Object.assign(Ds.__qIconSet,t)},install({$q:e,iconSet:n,ssrContext:t}){e.config.iconMapFn!==void 0&&(this.iconMapFn=e.config.iconMapFn),e.iconSet=this.__qIconSet,mi(e,"iconMapFn",()=>this.iconMapFn,r=>{this.iconMapFn=r}),this.__installed===!0?n!==void 0&&this.set(n):(this.props=new Proxy(this.__qIconSet,{get(){return Reflect.get(...arguments)},ownKeys(r){return Reflect.ownKeys(r).filter(o=>o!=="set")}}),this.set(n||rA))}}),Ns={};let Wy=!1;function oA(){Wy=!0}function ra(e){return e!==null&&typeof e=="object"&&Array.isArray(e)!==!0}const rp=[il,ZI,At,KI,al,Br,Ds];function iA(e,n){const t=jv(e);t.config.globalProperties=n.config.globalProperties;const{reload:r,...o}=n._context;return Object.assign(t._context,o),t}function op(e,n){n.forEach(t=>{t.install(e),t.__installed=!0})}function aA(e,n,t){e.config.globalProperties.$q=t.$q,e.provide(y1,t.$q),op(t,rp),n.components!==void 0&&Object.values(n.components).forEach(r=>{ra(r)===!0&&r.name!==void 0&&e.component(r.name,r)}),n.directives!==void 0&&Object.values(n.directives).forEach(r=>{ra(r)===!0&&r.name!==void 0&&e.directive(r.name,r)}),n.plugins!==void 0&&op(t,Object.values(n.plugins).filter(r=>typeof r.install=="function"&&rp.includes(r)===!1)),Jn.value===!0&&(t.$q.onSSRHydrated=()=>{t.onSSRHydrated.forEach(r=>{r()}),t.$q.onSSRHydrated=()=>{}})}const sA=function(e,n={}){const t={version:"2.18.6"};Wy===!1?(n.config!==void 0&&Object.assign(Ns,n.config),t.config={...Ns},oA()):t.config=n.config||{},aA(e,n,{parentApp:e,$q:t,lang:n.lang,iconSet:n.iconSet,onSSRHydrated:[]})};let uA=1,cA=document.body;function Vy(e,n){const t=document.createElement("div");if(t.id=n!==void 0?`q-portal--${n}--${uA++}`:e,Ns.globalNodes!==void 0){const r=Ns.globalNodes.class;r!==void 0&&(t.className=r)}return cA.appendChild(t),t}function lA(e){e.remove()}let fA=0;const $a={},Ka={},En={},Uy={},dA=/^\s*$/,zy=[],hA=[void 0,null,!0,!1,""],Wf=["top-left","top-right","bottom-left","bottom-right","top","bottom","left","right","center"],pA=["top-left","top-right","bottom-left","bottom-right"],Ai={positive:{icon:e=>e.iconSet.type.positive,color:"positive"},negative:{icon:e=>e.iconSet.type.negative,color:"negative"},warning:{icon:e=>e.iconSet.type.warning,color:"warning",textColor:"dark"},info:{icon:e=>e.iconSet.type.info,color:"info"},ongoing:{group:!1,timeout:0,spinner:!0,color:"grey-8"}};function qy(e,n,t){if(!e)return Ri("parameter required");let r;const o={textColor:"white"};if(e.ignoreDefaults!==!0&&Object.assign(o,$a),ra(e)===!1&&(o.type&&Object.assign(o,Ai[o.type]),e={message:e}),Object.assign(o,Ai[e.type||o.type],e),typeof o.icon=="function"&&(o.icon=o.icon(n)),o.spinner?(o.spinner===!0&&(o.spinner=Nl),o.spinner=Ws(o.spinner)):o.spinner=!1,o.meta={hasMedia:!!(o.spinner!==!1||o.icon||o.avatar),hasText:ip(o.message)||ip(o.caption)},o.position){if(Wf.includes(o.position)===!1)return Ri("wrong position",e)}else o.position="bottom";if(hA.includes(o.timeout)===!0)o.timeout=5e3;else{const u=Number(o.timeout);if(isNaN(u)||u<0)return Ri("wrong timeout",e);o.timeout=Number.isFinite(u)?u:0}o.timeout===0?o.progress=!1:o.progress===!0&&(o.meta.progressClass="q-notification__progress"+(o.progressClass?` ${o.progressClass}`:""),o.meta.progressStyle={animationDuration:`${o.timeout+1e3}ms`});const i=(Array.isArray(e.actions)===!0?e.actions:[]).concat(e.ignoreDefaults!==!0&&Array.isArray($a.actions)===!0?$a.actions:[]).concat(Array.isArray(Ai[e.type]?.actions)===!0?Ai[e.type].actions:[]),{closeBtn:a}=o;if(a&&i.push({label:typeof a=="string"?a:n.lang.label.close}),o.actions=i.map(({handler:u,noDismiss:c,...l})=>({flat:!0,...l,onClick:typeof u=="function"?()=>{u(),c!==!0&&s()}:()=>{s()}})),o.multiLine===void 0&&(o.multiLine=o.actions.length>1),Object.assign(o.meta,{class:`q-notification row items-stretch q-notification--${o.multiLine===!0?"multi-line":"standard"}`+(o.color!==void 0?` bg-${o.color}`:"")+(o.textColor!==void 0?` text-${o.textColor}`:"")+(o.classes!==void 0?` ${o.classes}`:""),wrapperClass:"q-notification__wrapper col relative-position border-radius-inherit "+(o.multiLine===!0?"column no-wrap justify-center":"row items-center"),contentClass:"q-notification__content row items-center"+(o.multiLine===!0?"":" col"),leftClass:o.meta.hasText===!0?"additional":"single",attrs:{role:"alert",...o.attrs}}),o.group===!1?(o.group=void 0,o.meta.group=void 0):((o.group===void 0||o.group===!0)&&(o.group=[o.message,o.caption,o.multiline].concat(o.actions.map(u=>`${u.label}*${u.icon}`)).join("|")),o.meta.group=o.group+"|"+o.position),o.actions.length===0?o.actions=void 0:o.meta.actionsClass="q-notification__actions row items-center "+(o.multiLine===!0?"justify-end":"col-auto")+(o.meta.hasMedia===!0?" q-notification__actions--with-media":""),t!==void 0){t.notif.meta.timer&&(clearTimeout(t.notif.meta.timer),t.notif.meta.timer=void 0),o.meta.uid=t.notif.meta.uid;const u=En[o.position].value.indexOf(t.notif);En[o.position].value[u]=o}else{const u=Ka[o.meta.group];if(u===void 0){if(o.meta.uid=fA++,o.meta.badge=1,["left","right","center"].indexOf(o.position)!==-1)En[o.position].value.splice(Math.floor(En[o.position].value.length/2),0,o);else{const c=o.position.indexOf("top")!==-1?"unshift":"push";En[o.position].value[c](o)}o.group!==void 0&&(Ka[o.meta.group]=o)}else{if(u.meta.timer&&(clearTimeout(u.meta.timer),u.meta.timer=void 0),o.badgePosition!==void 0){if(pA.includes(o.badgePosition)===!1)return Ri("wrong badgePosition",e)}else o.badgePosition=`top-${o.position.indexOf("left")!==-1?"right":"left"}`;o.meta.uid=u.meta.uid,o.meta.badge=u.meta.badge+1,o.meta.badgeClass=`q-notification__badge q-notification__badge--${o.badgePosition}`+(o.badgeColor!==void 0?` bg-${o.badgeColor}`:"")+(o.badgeTextColor!==void 0?` text-${o.badgeTextColor}`:"")+(o.badgeClass?` ${o.badgeClass}`:"");const c=En[o.position].value.indexOf(u);En[o.position].value[c]=Ka[o.meta.group]=o}}const s=()=>{vA(o),r=void 0};if(o.timeout>0&&(o.meta.timer=setTimeout(()=>{o.meta.timer=void 0,s()},o.timeout+1e3)),o.group!==void 0)return u=>{u!==void 0?Ri("trying to update a grouped one which is forbidden",e):s()};if(r={dismiss:s,config:e,notif:o},t!==void 0){Object.assign(t,r);return}return u=>{if(r!==void 0)if(u===void 0)r.dismiss();else{const c=Object.assign({},r.config,u,{group:!1,position:o.position});qy(c,n,r)}}}function vA(e){e.meta.timer&&(clearTimeout(e.meta.timer),e.meta.timer=void 0);const n=En[e.position].value.indexOf(e);if(n!==-1){e.group!==void 0&&delete Ka[e.meta.group];const t=zy[""+e.meta.uid];if(t){const{width:r,height:o}=getComputedStyle(t);t.style.left=`${t.offsetLeft}px`,t.style.width=r,t.style.height=o}En[e.position].value.splice(n,1),typeof e.onDismiss=="function"&&e.onDismiss()}}function ip(e){return e!=null&&dA.test(e)!==!0}function Ri(e,n){return console.error(`Notify: ${e}`,n),!1}function mA(){return en({name:"QNotifications",devtools:{hide:!0},setup(){return()=>se("div",{class:"q-notifications"},Wf.map(e=>se(yx,{key:e,class:Uy[e],tag:"div",name:`q-notification--${e}`},()=>En[e].value.map(n=>{const t=n.meta,r=[];if(t.hasMedia===!0&&(n.spinner!==!1?r.push(se(n.spinner,{class:"q-notification__spinner q-notification__spinner--"+t.leftClass,color:n.spinnerColor,size:n.spinnerSize})):n.icon?r.push(se(li,{class:"q-notification__icon q-notification__icon--"+t.leftClass,name:n.icon,color:n.iconColor,size:n.iconSize,role:"img"})):n.avatar&&r.push(se(qI,{class:"q-notification__avatar q-notification__avatar--"+t.leftClass},()=>se("img",{src:n.avatar,"aria-hidden":"true"})))),t.hasText===!0){let i;const a={class:"q-notification__message col"};if(n.html===!0)a.innerHTML=n.caption?`<div>${n.message}</div><div class="q-notification__caption">${n.caption}</div>`:n.message;else{const s=[n.message];i=n.caption?[se("div",s),se("div",{class:"q-notification__caption"},[n.caption])]:s}r.push(se("div",a,i))}const o=[se("div",{class:t.contentClass},r)];return n.progress===!0&&o.push(se("div",{key:`${t.uid}|p|${t.badge}`,class:t.progressClass,style:t.progressStyle})),n.actions!==void 0&&o.push(se("div",{class:t.actionsClass},n.actions.map(i=>se(Fl,i)))),t.badge>1&&o.push(se("div",{key:`${t.uid}|${t.badge}`,class:n.meta.badgeClass,style:n.badgeStyle},[t.badge])),se("div",{ref:i=>{zy[""+t.uid]=i},key:t.uid,class:t.class,...t.attrs},[se("div",{class:t.wrapperClass},o)])}))))}})}const ct={setDefaults(e){ra(e)===!0&&Object.assign($a,e)},registerType(e,n){ra(n)===!0&&(Ai[e]=n)},install({$q:e,parentApp:n}){if(e.notify=this.create=t=>qy(t,e),e.notify.setDefaults=this.setDefaults,e.notify.registerType=this.registerType,e.config.notify!==void 0&&this.setDefaults(e.config.notify),this.__installed!==!0){Wf.forEach(r=>{En[r]=Re([]);const o=["left","center","right"].includes(r)===!0?"center":r.indexOf("top")!==-1?"top":"bottom",i=r.indexOf("left")!==-1?"start":r.indexOf("right")!==-1?"end":"center",a=["left","right"].includes(r)?`items-${r==="left"?"start":"end"} justify-center`:r==="center"?"flex-center":`items-${i}`;Uy[r]=`q-notifications__list q-notifications__list--${o} fixed column no-wrap ${a}`});const t=Vy("q-notify");iA(mA(),n).mount(t)}}},gA={key:0,class:"text-negative q-mt-md"},yA={key:1,class:"text-positive q-mt-md"},bA={key:2,class:"text-grey q-mt-md"},xA={__name:"Asistencia",setup(e){const n=am(),t=Re(null),r=Re(""),o=Re(""),i=Re([]);let a=null;_n(()=>{const h=JSON.parse(localStorage.getItem("usuarioActual"));if(!h)return;const p="asistencias_"+h.email;i.value=JSON.parse(localStorage.getItem(p))||[],s()});async function s(){await xt.ssdMobilenetv1.loadFromUri("/models"),await xt.faceLandmark68Net.loadFromUri("/models"),await xt.faceRecognitionNet.loadFromUri("/models")}async function u(){r.value="",o.value="",await c(),setTimeout(()=>f(),2500)}async function c(){a=await navigator.mediaDevices.getUserMedia({video:!0}),t.value.srcObject=a,t.value.style.display="block"}function l(){a&&a.getTracks().forEach(h=>h.stop()),t.value.style.display="none"}async function f(){const h=JSON.parse(localStorage.getItem("usuarioActual"));if(!h||!h.faceId){o.value="No tienes registrado Face ID",l();return}const p=await ja(t.value).withFaceLandmarks().withFaceDescriptor();if(!p){o.value="No se detect tu rostro",l();return}const v=new Float32Array(h.faceId);Ts(v,p.descriptor)<.45?d():o.value="Reconocimiento facial incorrecto ",l()}function d(){const p="asistencias_"+JSON.parse(localStorage.getItem("usuarioActual")).email;let v=JSON.parse(localStorage.getItem(p))||[];const m={fecha:new Date().toLocaleDateString(),hora:new Date().toLocaleTimeString()};v.push(m),localStorage.setItem(p,JSON.stringify(v)),r.value="Asistencia marcada ",ct.create({message:"Asistencia marcada correctamente",color:"green",icon:"check"}),localStorage.removeItem("usuarioActual"),setTimeout(()=>{n.push("/")},1500)}return(h,p)=>(nn(),$s(ym,null,{default:Gn(()=>[Ne(x1,{padding:"",class:"flex flex-center column"},{default:Gn(()=>[p[0]||(p[0]=Qe("h2",{class:"text-center q-mb-lg"},"Registro de Asistencia",-1)),Ne(Fl,{label:"Marcar Asistencia",color:"primary",class:"q-mb-lg",onClick:u}),Qe("video",{ref_key:"videoRef",ref:t,autoplay:"",playsinline:"",width:"300",height:"220",style:{display:"none","border-radius":"12px",border:"2px solid #000"}},null,512),o.value?(nn(),hr("div",gA,Bo(o.value),1)):Qo("",!0),r.value?(nn(),hr("div",yA,Bo(r.value),1)):Qo("",!0),p[1]||(p[1]=Qe("h3",{class:"q-mt-xl text-center"},"Historial de Asistencias",-1)),i.value.length===0?(nn(),hr("div",bA," No hay asistencias registradas. ")):Qo("",!0),(nn(!0),hr(mn,null,rb(i.value,(v,m)=>(nn(),hr("div",{key:m,class:"q-mt-md"},[Ne(Pc,{class:"q-pa-md"},{default:Gn(()=>[Qe("h5",null,"Asistencia #"+Bo(m+1),1),Qe("p",null,"Fecha: "+Bo(v.fecha),1),Qe("p",null," Hora: "+Bo(v.hora),1)]),_:2},1024)]))),128))]),_:1})]),_:1}))}};let uc,Oa=0;const Et=new Array(256);for(let e=0;e<256;e++)Et[e]=(e+256).toString(16).substring(1);const wA=(()=>{const e=typeof crypto<"u"?crypto:typeof window<"u"?window.crypto||window.msCrypto:void 0;if(e!==void 0){if(e.randomBytes!==void 0)return e.randomBytes;if(e.getRandomValues!==void 0)return n=>{const t=new Uint8Array(n);return e.getRandomValues(t),t}}return n=>{const t=[];for(let r=n;r>0;r--)t.push(Math.floor(Math.random()*256));return t}})(),ap=4096;function sl(){(uc===void 0||Oa+16>ap)&&(Oa=0,uc=wA(ap));const e=Array.prototype.slice.call(uc,Oa,Oa+=16);return e[6]=e[6]&15|64,e[8]=e[8]&63|128,Et[e[0]]+Et[e[1]]+Et[e[2]]+Et[e[3]]+"-"+Et[e[4]]+Et[e[5]]+"-"+Et[e[6]]+Et[e[7]]+"-"+Et[e[8]]+Et[e[9]]+"-"+Et[e[10]]+Et[e[11]]+Et[e[12]]+Et[e[13]]+Et[e[14]]+Et[e[15]]}function _A(e){return e??null}function sp(e,n){return e??(n===!0?`f_${sl()}`:null)}function CA({getValue:e,required:n=!0}={}){if(Jn.value===!0){const t=Re(e!==void 0?_A(e()):null);return n===!0&&t.value===null&&_n(()=>{t.value=`f_${sl()}`}),e!==void 0&&$e(e,r=>{t.value=sp(r,n)}),t}return e!==void 0?oe(()=>sp(e(),n)):Re(`f_${sl()}`)}const up=/^on[A-Z]/;function EA(){const{attrs:e,vnode:n}=ot(),t={listeners:Re({}),attributes:Re({})};function r(){const o={},i={};for(const a in e)a!=="class"&&a!=="style"&&up.test(a)===!1&&(o[a]=e[a]);for(const a in n.props)up.test(a)===!0&&(i[a]=n.props[a]);t.attributes.value=o,t.listeners.value=i}return gv(r),r(),t}function SA({validate:e,resetValidation:n,requiresQForm:t}){const r=Xt(b1,!1);if(r!==!1){const{props:o,proxy:i}=ot();Object.assign(i,{validate:e,resetValidation:n}),$e(()=>o.disable,a=>{a===!0?(typeof n=="function"&&n(),r.unbindComponent(i)):r.bindComponent(i)}),_n(()=>{o.disable!==!0&&r.bindComponent(i)}),Qt(()=>{o.disable!==!0&&r.unbindComponent(i)})}else t===!0&&console.error("Parent QForm not found on useFormChild()!")}const cp=/^#[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/,lp=/^#[0-9a-fA-F]{4}([0-9a-fA-F]{4})?$/,fp=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})$/,Ba=/^rgb\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5])\)$/,La=/^rgba\(((0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),){2}(0|[1-9][\d]?|1[\d]{0,2}|2[\d]?|2[0-4][\d]|25[0-5]),(0|0\.[0-9]+[1-9]|0\.[1-9]+|1)\)$/,cc={date:e=>/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(e),time:e=>/^([0-1]?\d|2[0-3]):[0-5]\d$/.test(e),fulltime:e=>/^([0-1]?\d|2[0-3]):[0-5]\d:[0-5]\d$/.test(e),timeOrFulltime:e=>/^([0-1]?\d|2[0-3]):[0-5]\d(:[0-5]\d)?$/.test(e),email:e=>/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e),hexColor:e=>cp.test(e),hexaColor:e=>lp.test(e),hexOrHexaColor:e=>fp.test(e),rgbColor:e=>Ba.test(e),rgbaColor:e=>La.test(e),rgbOrRgbaColor:e=>Ba.test(e)||La.test(e),hexOrRgbColor:e=>cp.test(e)||Ba.test(e),hexaOrRgbaColor:e=>lp.test(e)||La.test(e),anyColor:e=>fp.test(e)||Ba.test(e)||La.test(e)},RA=[!0,!1,"ondemand"],kA={modelValue:{},error:{type:Boolean,default:null},errorMessage:String,noErrorIcon:Boolean,rules:Array,reactiveRules:Boolean,lazyRules:{type:[Boolean,String],default:!1,validator:e=>RA.includes(e)}};function IA(e,n){const{props:t,proxy:r}=ot(),o=Re(!1),i=Re(null),a=Re(!1);SA({validate:v,resetValidation:p});let s=0,u;const c=oe(()=>t.rules!==void 0&&t.rules!==null&&t.rules.length!==0),l=oe(()=>t.disable!==!0&&c.value===!0&&n.value===!1),f=oe(()=>t.error===!0||o.value===!0),d=oe(()=>typeof t.errorMessage=="string"&&t.errorMessage.length!==0?t.errorMessage:i.value);$e(()=>t.modelValue,()=>{a.value=!0,l.value===!0&&t.lazyRules===!1&&m()});function h(){t.lazyRules!=="ondemand"&&l.value===!0&&a.value===!0&&m()}$e(()=>t.reactiveRules,g=>{g===!0?u===void 0&&(u=$e(()=>t.rules,h,{immediate:!0,deep:!0})):u!==void 0&&(u(),u=void 0)},{immediate:!0}),$e(()=>t.lazyRules,h),$e(e,g=>{g===!0?a.value=!0:l.value===!0&&t.lazyRules!=="ondemand"&&m()});function p(){s++,n.value=!1,a.value=!1,o.value=!1,i.value=null,m.cancel()}function v(g=t.modelValue){if(t.disable===!0||c.value===!1)return!0;const b=++s,x=n.value!==!0?()=>{a.value=!0}:()=>{},y=(_,S)=>{_===!0&&x(),o.value=_,i.value=S||null,n.value=!1},w=[];for(let _=0;_<t.rules.length;_++){const S=t.rules[_];let R;if(typeof S=="function"?R=S(g,cc):typeof S=="string"&&cc[S]!==void 0&&(R=cc[S](g)),R===!1||typeof R=="string")return y(!0,R),!1;R!==!0&&R!==void 0&&w.push(R)}return w.length===0?(y(!1),!0):(n.value=!0,Promise.all(w).then(_=>{if(_===void 0||Array.isArray(_)===!1||_.length===0)return b===s&&y(!1),!0;const S=_.find(R=>R===!1||typeof R=="string");return b===s&&y(S!==void 0,S),S===void 0},_=>(b===s&&(console.error(_),y(!0)),!1)))}const m=Oy(v,0);return Qt(()=>{u?.(),m.cancel()}),Object.assign(r,{resetValidation:p,validate:v}),mi(r,"hasError",()=>f.value),{isDirtyModel:a,hasRules:c,hasError:f,errorMessage:d,validate:v,resetValidation:p}}let lo=[],oa=[];function Hy(e){oa=oa.filter(n=>n!==e)}function AA(e){Hy(e),oa.push(e)}function dp(e){Hy(e),oa.length===0&&lo.length!==0&&(lo[lo.length-1](),lo=[])}function Vf(e){oa.length===0?e():lo.push(e)}function TA(e){lo=lo.filter(n=>n!==e)}function ul(e){return e!=null&&(""+e).length!==0}const DA={...vm,...kA,label:String,stackLabel:Boolean,hint:String,hideHint:Boolean,prefix:String,suffix:String,labelColor:String,color:String,bgColor:String,filled:Boolean,outlined:Boolean,borderless:Boolean,standout:[Boolean,String],square:Boolean,loading:Boolean,labelSlot:Boolean,bottomSlots:Boolean,hideBottomSpace:Boolean,rounded:Boolean,dense:Boolean,itemAligned:Boolean,counter:Boolean,clearable:Boolean,clearIcon:String,disable:Boolean,readonly:Boolean,autofocus:Boolean,for:String},NA={...DA,maxlength:[Number,String]},FA=["update:modelValue","clear","focus","blur"];function PA({requiredForAttr:e=!0,tagProp:n,changeEvent:t=!1}={}){const{props:r,proxy:o}=ot(),i=mm(r,o.$q),a=CA({required:e,getValue:()=>r.for});return{requiredForAttr:e,changeEvent:t,tag:n===!0?oe(()=>r.tag):{value:"label"},isDark:i,editable:oe(()=>r.disable!==!0&&r.readonly!==!0),innerLoading:Re(!1),focused:Re(!1),hasPopupOpen:!1,splitAttrs:EA(),targetUid:a,rootRef:Re(null),targetRef:Re(null),controlRef:Re(null)}}function MA(e){const{props:n,emit:t,slots:r,attrs:o,proxy:i}=ot(),{$q:a}=i;let s=null;e.hasValue===void 0&&(e.hasValue=oe(()=>ul(n.modelValue))),e.emitValue===void 0&&(e.emitValue=F=>{t("update:modelValue",F)}),e.controlEvents===void 0&&(e.controlEvents={onFocusin:E,onFocusout:C}),Object.assign(e,{clearValue:I,onControlFocusin:E,onControlFocusout:C,focus:S}),e.computedCounter===void 0&&(e.computedCounter=oe(()=>{if(n.counter!==!1){const F=typeof n.modelValue=="string"||typeof n.modelValue=="number"?(""+n.modelValue).length:Array.isArray(n.modelValue)===!0?n.modelValue.length:0,H=n.maxlength!==void 0?n.maxlength:n.maxValues;return F+(H!==void 0?" / "+H:"")}}));const{isDirtyModel:u,hasRules:c,hasError:l,errorMessage:f,resetValidation:d}=IA(e.focused,e.innerLoading),h=e.floatingLabel!==void 0?oe(()=>n.stackLabel===!0||e.focused.value===!0||e.floatingLabel.value===!0):oe(()=>n.stackLabel===!0||e.focused.value===!0||e.hasValue.value===!0),p=oe(()=>n.bottomSlots===!0||n.hint!==void 0||c.value===!0||n.counter===!0||n.error!==null),v=oe(()=>n.filled===!0?"filled":n.outlined===!0?"outlined":n.borderless===!0?"borderless":n.standout?"standout":"standard"),m=oe(()=>`q-field row no-wrap items-start q-field--${v.value}`+(e.fieldClass!==void 0?` ${e.fieldClass.value}`:"")+(n.rounded===!0?" q-field--rounded":"")+(n.square===!0?" q-field--square":"")+(h.value===!0?" q-field--float":"")+(b.value===!0?" q-field--labeled":"")+(n.dense===!0?" q-field--dense":"")+(n.itemAligned===!0?" q-field--item-aligned q-item-type":"")+(e.isDark.value===!0?" q-field--dark":"")+(e.getControl===void 0?" q-field--auto-height":"")+(e.focused.value===!0?" q-field--focused":"")+(l.value===!0?" q-field--error":"")+(l.value===!0||e.focused.value===!0?" q-field--highlighted":"")+(n.hideBottomSpace!==!0&&p.value===!0?" q-field--with-bottom":"")+(n.disable===!0?" q-field--disabled":n.readonly===!0?" q-field--readonly":"")),g=oe(()=>"q-field__control relative-position row no-wrap"+(n.bgColor!==void 0?` bg-${n.bgColor}`:"")+(l.value===!0?" text-negative":typeof n.standout=="string"&&n.standout.length!==0&&e.focused.value===!0?` ${n.standout}`:n.color!==void 0?` text-${n.color}`:"")),b=oe(()=>n.labelSlot===!0||n.label!==void 0),x=oe(()=>"q-field__label no-pointer-events absolute ellipsis"+(n.labelColor!==void 0&&l.value!==!0?` text-${n.labelColor}`:"")),y=oe(()=>({id:e.targetUid.value,editable:e.editable.value,focused:e.focused.value,floatingLabel:h.value,modelValue:n.modelValue,emitValue:e.emitValue})),w=oe(()=>{const F={};return e.targetUid.value&&(F.for=e.targetUid.value),n.disable===!0&&(F["aria-disabled"]="true"),F});function _(){const F=document.activeElement;let H=e.targetRef?.value;H&&(F===null||F.id!==e.targetUid.value)&&(H.hasAttribute("tabindex")===!0||(H=H.querySelector("[tabindex]")),H!==F&&H?.focus({preventScroll:!0}))}function S(){Vf(_)}function R(){TA(_);const F=document.activeElement;F!==null&&e.rootRef.value.contains(F)&&F.blur()}function E(F){s!==null&&(clearTimeout(s),s=null),e.editable.value===!0&&e.focused.value===!1&&(e.focused.value=!0,t("focus",F))}function C(F,H){s!==null&&clearTimeout(s),s=setTimeout(()=>{s=null,!(document.hasFocus()===!0&&(e.hasPopupOpen===!0||e.controlRef===void 0||e.controlRef.value===null||e.controlRef.value.contains(document.activeElement)!==!1))&&(e.focused.value===!0&&(e.focused.value=!1,t("blur",F)),H?.())})}function I(F){Or(F),a.platform.is.mobile!==!0?(e.targetRef?.value||e.rootRef.value).focus():e.rootRef.value.contains(document.activeElement)===!0&&document.activeElement.blur(),n.type==="file"&&(e.inputRef.value.value=null),t("update:modelValue",null),e.changeEvent===!0&&t("change",null),t("clear",n.modelValue),$t(()=>{const H=u.value;d(),u.value=H})}function k(F){[13,32].includes(F.keyCode)&&I(F)}function M(){const F=[];return r.prepend!==void 0&&F.push(se("div",{class:"q-field__prepend q-field__marginal row no-wrap items-center",key:"prepend",onClick:Vo},r.prepend())),F.push(se("div",{class:"q-field__control-container col relative-position row no-wrap q-anchor--skip"},P())),l.value===!0&&n.noErrorIcon===!1&&F.push(q("error",[se(li,{name:a.iconSet.field.error,color:"negative"})])),n.loading===!0||e.innerLoading.value===!0?F.push(q("inner-loading-append",r.loading!==void 0?r.loading():[se(Nl,{color:n.color})])):n.clearable===!0&&e.hasValue.value===!0&&e.editable.value===!0&&F.push(q("inner-clearable-append",[se(li,{class:"q-field__focusable-action",name:n.clearIcon||a.iconSet.field.clear,tabindex:0,role:"button","aria-hidden":"false","aria-label":a.lang.label.clear,onKeyup:k,onClick:I})])),r.append!==void 0&&F.push(se("div",{class:"q-field__append q-field__marginal row no-wrap items-center",key:"append",onClick:Vo},r.append())),e.getInnerAppend!==void 0&&F.push(q("inner-append",e.getInnerAppend())),e.getControlChild!==void 0&&F.push(e.getControlChild()),F}function P(){const F=[];return n.prefix!==void 0&&n.prefix!==null&&F.push(se("div",{class:"q-field__prefix no-pointer-events row items-center"},n.prefix)),e.getShadowControl!==void 0&&e.hasShadow.value===!0&&F.push(e.getShadowControl()),b.value===!0&&F.push(se("div",{class:x.value},vr(r.label,n.label))),e.getControl!==void 0?F.push(e.getControl()):r.rawControl!==void 0?F.push(r.rawControl()):r.control!==void 0&&F.push(se("div",{ref:e.targetRef,class:"q-field__native row",tabindex:-1,...e.splitAttrs.attributes.value,"data-autofocus":n.autofocus===!0||void 0},r.control(y.value))),n.suffix!==void 0&&n.suffix!==null&&F.push(se("div",{class:"q-field__suffix no-pointer-events row items-center"},n.suffix)),F.concat(vr(r.default))}function L(){let F,H;l.value===!0?f.value!==null?(F=[se("div",{role:"alert"},f.value)],H=`q--slot-error-${f.value}`):(F=vr(r.error),H="q--slot-error"):(n.hideHint!==!0||e.focused.value===!0)&&(n.hint!==void 0?(F=[se("div",n.hint)],H=`q--slot-hint-${n.hint}`):(F=vr(r.hint),H="q--slot-hint"));const $=n.counter===!0||r.counter!==void 0;if(n.hideBottomSpace===!0&&$===!1&&F===void 0)return;const G=se("div",{key:H,class:"q-field__messages col"},F);return se("div",{class:"q-field__bottom row items-start q-field__bottom--"+(n.hideBottomSpace!==!0?"animated":"stale"),onClick:Vo},[n.hideBottomSpace===!0?G:se(rs,{name:"q-transition--field-message"},()=>G),$===!0?se("div",{class:"q-field__counter"},r.counter!==void 0?r.counter():e.computedCounter.value):null])}function q(F,H){return H===null?null:se("div",{key:F,class:"q-field__append q-field__marginal row no-wrap items-center q-anchor--skip"},H)}let V=!1;return zs(()=>{V=!0}),vv(()=>{V===!0&&n.autofocus===!0&&i.focus()}),n.autofocus===!0&&_n(()=>{i.focus()}),Qt(()=>{s!==null&&clearTimeout(s)}),Object.assign(i,{focus:S,blur:R}),function(){const H=e.getControl===void 0&&r.control===void 0?{...e.splitAttrs.attributes.value,"data-autofocus":n.autofocus===!0||void 0,...w.value}:w.value;return se(e.tag.value,{ref:e.rootRef,class:[m.value,o.class],style:o.style,...H},[r.before!==void 0?se("div",{class:"q-field__before q-field__marginal row no-wrap items-center",onClick:Vo},r.before()):null,se("div",{class:"q-field__inner relative-position col self-stretch"},[se("div",{ref:e.controlRef,class:g.value,tabindex:-1,...e.controlEvents},M()),p.value===!0?L():null]),r.after!==void 0?se("div",{class:"q-field__after q-field__marginal row no-wrap items-center",onClick:Vo},r.after()):null])}}const hp={date:"####/##/##",datetime:"####/##/## ##:##",time:"##:##",fulltime:"##:##:##",phone:"(###) ### - ####",card:"#### #### #### ####"},{tokenMap:pp,tokenKeys:OA}=Gy({"#":{pattern:"[\\d]",negate:"[^\\d]"},S:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]"},N:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]"},A:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleUpperCase()},a:{pattern:"[a-zA-Z]",negate:"[^a-zA-Z]",transform:e=>e.toLocaleLowerCase()},X:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleUpperCase()},x:{pattern:"[0-9a-zA-Z]",negate:"[^0-9a-zA-Z]",transform:e=>e.toLocaleLowerCase()}});function Gy(e){const n=Object.keys(e),t={};return n.forEach(r=>{const o=e[r];t[r]={...o,regex:new RegExp(o.pattern)}}),{tokenMap:t,tokenKeys:n}}function jy(e){return new RegExp("\\\\([^.*+?^${}()|([\\]])|([.*+?^${}()|[\\]])|(["+e.join("")+"])|(.)","g")}const vp=/[.*+?^${}()|[\]\\]/g,BA=jy(OA),at="",LA={mask:String,reverseFillMask:Boolean,fillMask:[Boolean,String],unmaskedValue:Boolean,maskTokens:Object};function WA(e,n,t,r){let o,i,a,s,u,c;const l=oe(()=>{if(e.maskTokens===void 0||e.maskTokens===null)return{tokenMap:pp,tokenRegexMask:BA};const{tokenMap:C}=Gy(e.maskTokens),I={...pp,...C};return{tokenMap:I,tokenRegexMask:jy(Object.keys(I))}}),f=Re(null),d=Re(p());function h(){return e.autogrow===!0||["textarea","text","search","url","tel","password"].includes(e.type)}$e(()=>e.type+e.autogrow,m),$e(()=>e.mask,C=>{if(C!==void 0)g(d.value,!0);else{const I=R(d.value);m(),e.modelValue!==I&&n("update:modelValue",I)}}),$e(()=>e.fillMask+e.reverseFillMask,()=>{f.value===!0&&g(d.value,!0)}),$e(()=>e.unmaskedValue,()=>{f.value===!0&&g(d.value)});function p(){if(m(),f.value===!0){const C=_(R(e.modelValue));return e.fillMask!==!1?E(C):C}return e.modelValue}function v(C){if(C<o.length)return o.slice(-C);let I="",k=o;const M=k.indexOf(at);if(M!==-1){for(let P=C-k.length;P>0;P--)I+=at;k=k.slice(0,M)+I+k.slice(M)}return k}function m(){if(f.value=e.mask!==void 0&&e.mask.length!==0&&h(),f.value===!1){s=void 0,o="",i="";return}const C=hp[e.mask]===void 0?e.mask:hp[e.mask],I=typeof e.fillMask=="string"&&e.fillMask.length!==0?e.fillMask.slice(0,1):"_",k=I.replace(vp,"\\$&"),M=[],P=[],L=[];let q=e.reverseFillMask===!0,V="",F="";C.replace(l.value.tokenRegexMask,(O,re,he,be,ae)=>{if(be!==void 0){const z=l.value.tokenMap[be];L.push(z),F=z.negate,q===!0&&(P.push("(?:"+F+"+)?("+z.pattern+"+)?(?:"+F+"+)?("+z.pattern+"+)?"),q=!1),P.push("(?:"+F+"+)?("+z.pattern+")?")}else if(he!==void 0)V="\\"+(he==="\\"?"":he),L.push(he),M.push("([^"+V+"]+)?"+V+"?");else{const z=re!==void 0?re:ae;V=z==="\\"?"\\\\\\\\":z.replace(vp,"\\\\$&"),L.push(z),M.push("([^"+V+"]+)?"+V+"?")}});const H=new RegExp("^"+M.join("")+"("+(V===""?".":"[^"+V+"]")+"+)?"+(V===""?"":"["+V+"]*")+"$"),$=P.length-1,G=P.map((O,re)=>re===0&&e.reverseFillMask===!0?new RegExp("^"+k+"*"+O):re===$?new RegExp("^"+O+"("+(F===""?".":F)+"+)?"+(e.reverseFillMask===!0?"$":k+"*")):new RegExp("^"+O));a=L,s=O=>{const re=H.exec(e.reverseFillMask===!0?O:O.slice(0,L.length+1));re!==null&&(O=re.slice(1).join(""));const he=[],be=G.length;for(let ae=0,z=O;ae<be;ae++){const Z=G[ae].exec(z);if(Z===null)break;z=z.slice(Z.shift().length),he.push(...Z)}return he.length!==0?he.join(""):O},o=L.map(O=>typeof O=="string"?O:at).join(""),i=o.split(at).join(I)}function g(C,I,k){const M=r.value,P=M.selectionEnd,L=M.value.length-P,q=R(C);I===!0&&m();const V=_(q,I),F=e.fillMask!==!1?E(V):V,H=d.value!==F;M.value!==F&&(M.value=F),H===!0&&(d.value=F),document.activeElement===M&&$t(()=>{if(F===i){const G=e.reverseFillMask===!0?i.length:0;M.setSelectionRange(G,G,"forward");return}if(k==="insertFromPaste"&&e.reverseFillMask!==!0){const G=M.selectionEnd;let O=P-1;for(let re=u;re<=O&&re<G;re++)o[re]!==at&&O++;x.right(M,O);return}if(["deleteContentBackward","deleteContentForward"].indexOf(k)!==-1){const G=e.reverseFillMask===!0?P===0?F.length>V.length?1:0:Math.max(0,F.length-(F===i?0:Math.min(V.length,L)+1))+1:P;M.setSelectionRange(G,G,"forward");return}if(e.reverseFillMask===!0)if(H===!0){const G=Math.max(0,F.length-(F===i?0:Math.min(V.length,L+1)));G===1&&P===1?M.setSelectionRange(G,G,"forward"):x.rightReverse(M,G)}else{const G=F.length-L;M.setSelectionRange(G,G,"backward")}else if(H===!0){const G=Math.max(0,o.indexOf(at),Math.min(V.length,P)-1);x.right(M,G)}else{const G=P-1;x.right(M,G)}});const $=e.unmaskedValue===!0?R(F):F;String(e.modelValue)!==$&&(e.modelValue!==null||$!=="")&&t($,!0)}function b(C,I,k){const M=_(R(C.value));I=Math.max(0,o.indexOf(at),Math.min(M.length,I)),u=I,C.setSelectionRange(I,k,"forward")}const x={left(C,I){const k=o.slice(I-1).indexOf(at)===-1;let M=Math.max(0,I-1);for(;M>=0;M--)if(o[M]===at){I=M,k===!0&&I++;break}if(M<0&&o[I]!==void 0&&o[I]!==at)return x.right(C,0);I>=0&&C.setSelectionRange(I,I,"backward")},right(C,I){const k=C.value.length;let M=Math.min(k,I+1);for(;M<=k;M++)if(o[M]===at){I=M;break}else o[M-1]===at&&(I=M);if(M>k&&o[I-1]!==void 0&&o[I-1]!==at)return x.left(C,k);C.setSelectionRange(I,I,"forward")},leftReverse(C,I){const k=v(C.value.length);let M=Math.max(0,I-1);for(;M>=0;M--)if(k[M-1]===at){I=M;break}else if(k[M]===at&&(I=M,M===0))break;if(M<0&&k[I]!==void 0&&k[I]!==at)return x.rightReverse(C,0);I>=0&&C.setSelectionRange(I,I,"backward")},rightReverse(C,I){const k=C.value.length,M=v(k),P=M.slice(0,I+1).indexOf(at)===-1;let L=Math.min(k,I+1);for(;L<=k;L++)if(M[L-1]===at){I=L,I>0&&P===!0&&I--;break}if(L>k&&M[I-1]!==void 0&&M[I-1]!==at)return x.leftReverse(C,k);C.setSelectionRange(I,I,"forward")}};function y(C){n("click",C),c=void 0}function w(C){if(n("keydown",C),fm(C)===!0||C.altKey===!0)return;const I=r.value,k=I.selectionStart,M=I.selectionEnd;if(C.shiftKey||(c=void 0),C.keyCode===37||C.keyCode===39){C.shiftKey&&c===void 0&&(c=I.selectionDirection==="forward"?k:M);const P=x[(C.keyCode===39?"right":"left")+(e.reverseFillMask===!0?"Reverse":"")];if(C.preventDefault(),P(I,c===k?M:k),C.shiftKey){const L=I.selectionStart;I.setSelectionRange(Math.min(c,L),Math.max(c,L),"forward")}}else C.keyCode===8&&e.reverseFillMask!==!0&&k===M?(x.left(I,k),I.setSelectionRange(I.selectionStart,M,"backward")):C.keyCode===46&&e.reverseFillMask===!0&&k===M&&(x.rightReverse(I,M),I.setSelectionRange(k,I.selectionEnd,"forward"))}function _(C,I){if(C==null||C==="")return"";if(e.reverseFillMask===!0)return S(C,I);const k=a;let M=0,P="";for(let L=0;L<k.length;L++){const q=C[M],V=k[L];if(typeof V=="string")P+=V,I===!0&&q===V&&M++;else if(q!==void 0&&V.regex.test(q))P+=V.transform!==void 0?V.transform(q):q,M++;else return P}return P}function S(C,I){const k=a,M=o.indexOf(at);let P=C.length-1,L="";for(let q=k.length-1;q>=0&&P!==-1;q--){const V=k[q];let F=C[P];if(typeof V=="string")L=V+L,I===!0&&F===V&&P--;else if(F!==void 0&&V.regex.test(F))do L=(V.transform!==void 0?V.transform(F):F)+L,P--,F=C[P];while(M===q&&F!==void 0&&V.regex.test(F));else return L}return L}function R(C){return typeof C!="string"||s===void 0?typeof C=="number"?s(""+C):C:s(C)}function E(C){return i.length-C.length<=0?C:e.reverseFillMask===!0&&C.length!==0?i.slice(0,-C.length)+C:C+i.slice(C.length)}return{innerValue:d,hasMask:f,moveCursorForPaste:b,updateMaskValue:g,onMaskedKeydown:w,onMaskedClick:y}}const VA={name:String};function UA(e){return oe(()=>e.name||e.for)}function zA(e,n){function t(){const r=e.modelValue;try{const o="DataTransfer"in window?new DataTransfer:"ClipboardEvent"in window?new ClipboardEvent("").clipboardData:void 0;return Object(r)===r&&("length"in r?Array.from(r):[r]).forEach(i=>{o.items.add(i)}),{files:o.files}}catch{return{files:void 0}}}return oe(()=>{if(e.type==="file")return t()})}const qA=/[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\uff00-\uff9f\u4e00-\u9faf\u3400-\u4dbf]/,HA=/[\u4e00-\u9fff\u3400-\u4dbf\u{20000}-\u{2a6df}\u{2a700}-\u{2b73f}\u{2b740}-\u{2b81f}\u{2b820}-\u{2ceaf}\uf900-\ufaff\u3300-\u33ff\ufe30-\ufe4f\uf900-\ufaff\u{2f800}-\u{2fa1f}]/u,GA=/[\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/,jA=/[a-z0-9_ -]$/i;function $A(e){return function(t){if(t.type==="compositionend"||t.type==="change"){if(t.target.qComposing!==!0)return;t.target.qComposing=!1,e(t)}else t.type==="compositionupdate"&&t.target.qComposing!==!0&&typeof t.data=="string"&&(ft.is.firefox===!0?jA.test(t.data)===!1:qA.test(t.data)===!0||HA.test(t.data)===!0||GA.test(t.data)===!0)===!0&&(t.target.qComposing=!0)}}const Tr=en({name:"QInput",inheritAttrs:!1,props:{...NA,...LA,...VA,modelValue:[String,Number,FileList],shadowText:String,type:{type:String,default:"text"},debounce:[String,Number],autogrow:Boolean,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...FA,"paste","change","keydown","click","animationend"],setup(e,{emit:n,attrs:t}){const{proxy:r}=ot(),{$q:o}=r,i={};let a=NaN,s,u,c=null,l;const f=Re(null),d=UA(e),{innerValue:h,hasMask:p,moveCursorForPaste:v,updateMaskValue:m,onMaskedKeydown:g,onMaskedClick:b}=WA(e,n,q,f),x=zA(e),y=oe(()=>ul(h.value)),w=$A(P),_=PA({changeEvent:!0}),S=oe(()=>e.type==="textarea"||e.autogrow===!0),R=oe(()=>S.value===!0||["text","search","url","tel","password"].includes(e.type)),E=oe(()=>{const O={..._.splitAttrs.listeners.value,onInput:P,onPaste:M,onChange:F,onBlur:H,onFocus:is};return O.onCompositionstart=O.onCompositionupdate=O.onCompositionend=w,p.value===!0&&(O.onKeydown=g,O.onClick=b),e.autogrow===!0&&(O.onAnimationend=L),O}),C=oe(()=>{const O={tabindex:0,"data-autofocus":e.autofocus===!0||void 0,rows:e.type==="textarea"?6:void 0,"aria-label":e.label,name:d.value,..._.splitAttrs.attributes.value,id:_.targetUid.value,maxlength:e.maxlength,disabled:e.disable===!0,readonly:e.readonly===!0};return S.value===!1&&(O.type=e.type),e.autogrow===!0&&(O.rows=1),O});$e(()=>e.type,()=>{f.value&&(f.value.value=e.modelValue)}),$e(()=>e.modelValue,O=>{if(p.value===!0){if(u===!0&&(u=!1,String(O)===a))return;m(O)}else h.value!==O&&(h.value=O,e.type==="number"&&i.hasOwnProperty("value")===!0&&(s===!0?s=!1:delete i.value));e.autogrow===!0&&$t(V)}),$e(()=>e.autogrow,O=>{O===!0?$t(V):f.value!==null&&t.rows>0&&(f.value.style.height="auto")}),$e(()=>e.dense,()=>{e.autogrow===!0&&$t(V)});function I(){Vf(()=>{const O=document.activeElement;f.value!==null&&f.value!==O&&(O===null||O.id!==_.targetUid.value)&&f.value.focus({preventScroll:!0})})}function k(){f.value?.select()}function M(O){if(p.value===!0&&e.reverseFillMask!==!0){const re=O.target;v(re,re.selectionStart,re.selectionEnd)}n("paste",O)}function P(O){if(!O||!O.target)return;if(e.type==="file"){n("update:modelValue",O.target.files);return}const re=O.target.value;if(O.target.qComposing===!0){i.value=re;return}if(p.value===!0)m(re,!1,O.inputType);else if(q(re),R.value===!0&&O.target===document.activeElement){const{selectionStart:he,selectionEnd:be}=O.target;he!==void 0&&be!==void 0&&$t(()=>{O.target===document.activeElement&&re.indexOf(O.target.value)===0&&O.target.setSelectionRange(he,be)})}e.autogrow===!0&&V()}function L(O){n("animationend",O),V()}function q(O,re){l=()=>{c=null,e.type!=="number"&&i.hasOwnProperty("value")===!0&&delete i.value,e.modelValue!==O&&a!==O&&(a=O,re===!0&&(u=!0),n("update:modelValue",O),$t(()=>{a===O&&(a=NaN)})),l=void 0},e.type==="number"&&(s=!0,i.value=O),e.debounce!==void 0?(c!==null&&clearTimeout(c),i.value=O,c=setTimeout(l,e.debounce)):l()}function V(){requestAnimationFrame(()=>{const O=f.value;if(O!==null){const re=O.parentNode.style,{scrollTop:he}=O,{overflowY:be,maxHeight:ae}=o.platform.is.firefox===!0?{}:window.getComputedStyle(O),z=be!==void 0&&be!=="scroll";z===!0&&(O.style.overflowY="hidden"),re.marginBottom=O.scrollHeight-1+"px",O.style.height="1px",O.style.height=O.scrollHeight+"px",z===!0&&(O.style.overflowY=parseInt(ae,10)<O.scrollHeight?"auto":"hidden"),re.marginBottom="",O.scrollTop=he}})}function F(O){w(O),c!==null&&(clearTimeout(c),c=null),l?.(),n("change",O.target.value)}function H(O){O!==void 0&&is(O),c!==null&&(clearTimeout(c),c=null),l?.(),s=!1,u=!1,delete i.value,e.type!=="file"&&setTimeout(()=>{f.value!==null&&(f.value.value=h.value!==void 0?h.value:"")})}function $(){return i.hasOwnProperty("value")===!0?i.value:h.value!==void 0?h.value:""}Qt(()=>{H()}),_n(()=>{e.autogrow===!0&&V()}),Object.assign(_,{innerValue:h,fieldClass:oe(()=>`q-${S.value===!0?"textarea":"input"}`+(e.autogrow===!0?" q-textarea--autogrow":"")),hasShadow:oe(()=>e.type!=="file"&&typeof e.shadowText=="string"&&e.shadowText.length!==0),inputRef:f,emitValue:q,hasValue:y,floatingLabel:oe(()=>y.value===!0&&(e.type!=="number"||isNaN(h.value)===!1)||ul(e.displayValue)),getControl:()=>se(S.value===!0?"textarea":"input",{ref:f,class:["q-field__native q-placeholder",e.inputClass],style:e.inputStyle,...C.value,...E.value,...e.type!=="file"?{value:$()}:x.value}),getShadowControl:()=>se("div",{class:"q-field__native q-field__shadow absolute-bottom no-pointer-events"+(S.value===!0?"":" text-no-wrap")},[se("span",{class:"invisible"},$()),se("span",e.shadowText)])});const G=MA(_);return Object.assign(r,{focus:I,select:k,getNativeElement:()=>f.value}),mi(r,"nativeEl",()=>f.value),G}});function KA(e,n,t){let r;function o(){r!==void 0&&(al.remove(r),r=void 0)}return Qt(()=>{e.value===!0&&o()}),{removeFromHistory:o,addToHistory(){r={condition:()=>t.value===!0,handler:n},al.add(r)}}}function XA(){let e=null;const n=ot();function t(){e!==null&&(clearTimeout(e),e=null)}return zs(t),Qt(t),{removeTimeout:t,registerTimeout(r,o){t(),pm(n)===!1&&(e=setTimeout(()=>{e=null,r()},o))}}}function YA(){let e;const n=ot();function t(){e=void 0}return zs(t),Qt(t),{removeTick:t,registerTick(r){e=r,$t(()=>{e===r&&(pm(n)===!1&&e(),e=void 0)})}}}const QA={modelValue:{type:Boolean,default:null},"onUpdate:modelValue":[Function,Array]},JA=["beforeShow","show","beforeHide","hide"];function ZA({showing:e,canShow:n,hideOnRouteChange:t,handleShow:r,handleHide:o,processOnMount:i}){const a=ot(),{props:s,emit:u,proxy:c}=a;let l;function f(b){e.value===!0?p(b):d(b)}function d(b){if(s.disable===!0||b?.qAnchorHandled===!0||n!==void 0&&n(b)!==!0)return;const x=s["onUpdate:modelValue"]!==void 0;x===!0&&(u("update:modelValue",!0),l=b,$t(()=>{l===b&&(l=void 0)})),(s.modelValue===null||x===!1)&&h(b)}function h(b){e.value!==!0&&(e.value=!0,u("beforeShow",b),r!==void 0?r(b):u("show",b))}function p(b){if(s.disable===!0)return;const x=s["onUpdate:modelValue"]!==void 0;x===!0&&(u("update:modelValue",!1),l=b,$t(()=>{l===b&&(l=void 0)})),(s.modelValue===null||x===!1)&&v(b)}function v(b){e.value!==!1&&(e.value=!1,u("beforeHide",b),o!==void 0?o(b):u("hide",b))}function m(b){s.disable===!0&&b===!0?s["onUpdate:modelValue"]!==void 0&&u("update:modelValue",!1):b===!0!==e.value&&(b===!0?h:v)(l)}$e(()=>s.modelValue,m),t!==void 0&&hm(a)===!0&&$e(()=>c.$route.fullPath,()=>{t.value===!0&&e.value===!0&&p()}),_n(()=>{m(s.modelValue)});const g={show:d,hide:p,toggle:f};return Object.assign(c,g),g}const eT={transitionShow:{type:String,default:"fade"},transitionHide:{type:String,default:"fade"},transitionDuration:{type:[String,Number],default:300}};function tT(e,n=()=>{},t=()=>{}){return{transitionProps:oe(()=>{const r=`q-transition--${e.transitionShow||n()}`,o=`q-transition--${e.transitionHide||t()}`;return{appear:!0,enterFromClass:`${r}-enter-from`,enterActiveClass:`${r}-enter-active`,enterToClass:`${r}-enter-to`,leaveFromClass:`${o}-leave-from`,leaveActiveClass:`${o}-leave-active`,leaveToClass:`${o}-leave-to`}}),transitionStyle:oe(()=>`--q-transition-duration: ${e.transitionDuration}ms`)}}const lc=[],nT=en({name:"QPortal",setup(e,{slots:n}){return()=>n.default()}});function rT(e){for(e=e.parent;e!=null;){if(e.type.name==="QGlobalDialog")return!0;if(e.type.name==="QDialog"||e.type.name==="QMenu")return!1;e=e.parent}return!1}function oT(e,n,t,r){const o=Re(!1),i=Re(!1);let a=null;const s={},u=rT(e);function c(f){if(f===!0){dp(s),i.value=!0;return}i.value=!1,o.value===!1&&(u===!1&&a===null&&(a=Vy(!1,r)),o.value=!0,lc.push(e.proxy),AA(s))}function l(f){if(i.value=!1,f!==!0)return;dp(s),o.value=!1;const d=lc.indexOf(e.proxy);d!==-1&&lc.splice(d,1),a!==null&&(lA(a),a=null)}return Hs(()=>{l(!0)}),e.proxy.__qPortal=!0,mi(e.proxy,"contentEl",()=>n.value),{showPortal:c,hidePortal:l,portalIsActive:o,portalIsAccessible:i,renderPortal:()=>u===!0?t():o.value===!0?[se(H0,{to:a},se(nT,t))]:void 0}}const iT=[Element,String],aT=[null,document,document.body,document.scrollingElement,document.documentElement];function sT(e,n){let t=$w(n);if(t===void 0){if(e==null)return window;t=e.closest(".scroll,.scroll-y,.overflow-auto")}return aT.includes(t)?window:t}function $y(e){return e===window?window.pageYOffset||window.scrollY||document.body.scrollTop||0:e.scrollTop}function Ky(e){return e===window?window.pageXOffset||window.scrollX||document.body.scrollLeft||0:e.scrollLeft}let Wa;function fc(){if(Wa!==void 0)return Wa;const e=document.createElement("p"),n=document.createElement("div");Fc(e,{width:"100%",height:"200px"}),Fc(n,{position:"absolute",top:"0px",left:"0px",visibility:"hidden",width:"200px",height:"150px",overflow:"hidden"}),n.appendChild(e),document.body.appendChild(n);const t=e.offsetWidth;n.style.overflow="scroll";let r=e.offsetWidth;return t===r&&(r=n.clientWidth),n.remove(),Wa=t-r,Wa}function uT(e,n=!0){return!e||e.nodeType!==Node.ELEMENT_NODE?!1:n?e.scrollHeight>e.clientHeight&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-y"])):e.scrollWidth>e.clientWidth&&(e.classList.contains("scroll")||e.classList.contains("overflow-auto")||["auto","scroll"].includes(window.getComputedStyle(e)["overflow-x"]))}let ki=0,dc,hc,Ti,pc=!1,mp,gp,yp,to=null;function cT(e){lT(e)&&Or(e)}function lT(e){if(e.target===document.body||e.target.classList.contains("q-layout__backdrop"))return!0;const n=Yw(e),t=e.shiftKey&&!e.deltaX,r=!t&&Math.abs(e.deltaX)<=Math.abs(e.deltaY),o=t||r?e.deltaY:e.deltaX;for(let i=0;i<n.length;i++){const a=n[i];if(uT(a,r))return r?o<0&&a.scrollTop===0?!0:o>0&&a.scrollTop+a.clientHeight===a.scrollHeight:o<0&&a.scrollLeft===0?!0:o>0&&a.scrollLeft+a.clientWidth===a.scrollWidth}return!0}function bp(e){e.target===document&&(document.scrollingElement.scrollTop=document.scrollingElement.scrollTop)}function Va(e){pc!==!0&&(pc=!0,requestAnimationFrame(()=>{pc=!1;const{height:n}=e.target,{clientHeight:t,scrollTop:r}=document.scrollingElement;(Ti===void 0||n!==window.innerHeight)&&(Ti=t-n,document.scrollingElement.scrollTop=r),r>Ti&&(document.scrollingElement.scrollTop-=Math.ceil((r-Ti)/8))}))}function xp(e){const n=document.body,t=window.visualViewport!==void 0;if(e==="add"){const{overflowY:r,overflowX:o}=window.getComputedStyle(n);dc=Ky(window),hc=$y(window),mp=n.style.left,gp=n.style.top,yp=window.location.href,n.style.left=`-${dc}px`,n.style.top=`-${hc}px`,o!=="hidden"&&(o==="scroll"||n.scrollWidth>window.innerWidth)&&n.classList.add("q-body--force-scrollbar-x"),r!=="hidden"&&(r==="scroll"||n.scrollHeight>window.innerHeight)&&n.classList.add("q-body--force-scrollbar-y"),n.classList.add("q-body--prevent-scroll"),document.qScrollPrevented=!0,ft.is.ios===!0&&(t===!0?(window.scrollTo(0,0),window.visualViewport.addEventListener("resize",Va,zt.passiveCapture),window.visualViewport.addEventListener("scroll",Va,zt.passiveCapture),window.scrollTo(0,0)):window.addEventListener("scroll",bp,zt.passiveCapture))}ft.is.desktop===!0&&ft.is.mac===!0&&window[`${e}EventListener`]("wheel",cT,zt.notPassive),e==="remove"&&(ft.is.ios===!0&&(t===!0?(window.visualViewport.removeEventListener("resize",Va,zt.passiveCapture),window.visualViewport.removeEventListener("scroll",Va,zt.passiveCapture)):window.removeEventListener("scroll",bp,zt.passiveCapture)),n.classList.remove("q-body--prevent-scroll"),n.classList.remove("q-body--force-scrollbar-x"),n.classList.remove("q-body--force-scrollbar-y"),document.qScrollPrevented=!1,n.style.left=mp,n.style.top=gp,window.location.href===yp&&window.scrollTo(dc,hc),Ti=void 0)}function fT(e){let n="add";if(e===!0){if(ki++,to!==null){clearTimeout(to),to=null;return}if(ki>1)return}else{if(ki===0||(ki--,ki>0))return;if(n="remove",ft.is.ios===!0&&ft.is.nativeMobile===!0){to!==null&&clearTimeout(to),to=setTimeout(()=>{xp(n),to=null},100);return}}xp(n)}function dT(){let e;return{preventBodyScroll(n){n!==e&&(e!==void 0||n===!0)&&(e=n,fT(n))}}}const mo=[];let vi;function hT(e){vi=e.keyCode===27}function pT(){vi===!0&&(vi=!1)}function vT(e){vi===!0&&(vi=!1,as(e,27)===!0&&mo[mo.length-1](e))}function Xy(e){window[e]("keydown",hT),window[e]("blur",pT),window[e]("keyup",vT),vi=!1}function mT(e){ft.is.desktop===!0&&(mo.push(e),mo.length===1&&Xy("addEventListener"))}function wp(e){const n=mo.indexOf(e);n!==-1&&(mo.splice(n,1),mo.length===0&&Xy("removeEventListener"))}const go=[];function Yy(e){go[go.length-1](e)}function gT(e){ft.is.desktop===!0&&(go.push(e),go.length===1&&document.body.addEventListener("focusin",Yy))}function _p(e){const n=go.indexOf(e);n!==-1&&(go.splice(n,1),go.length===0&&document.body.removeEventListener("focusin",Yy))}let Ua=0;const yT={standard:"fixed-full flex-center",top:"fixed-top justify-center",bottom:"fixed-bottom justify-center",right:"fixed-right items-center",left:"fixed-left items-center"},Cp={standard:["scale","scale"],top:["slide-down","slide-up"],bottom:["slide-up","slide-down"],right:["slide-left","slide-right"],left:["slide-right","slide-left"]},Ep=en({name:"QDialog",inheritAttrs:!1,props:{...QA,...eT,transitionShow:String,transitionHide:String,persistent:Boolean,autoClose:Boolean,allowFocusOutside:Boolean,noEscDismiss:Boolean,noBackdropDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,noShake:Boolean,seamless:Boolean,maximized:Boolean,fullWidth:Boolean,fullHeight:Boolean,square:Boolean,backdropFilter:String,position:{type:String,default:"standard",validator:e=>["standard","top","bottom","left","right"].includes(e)}},emits:[...JA,"shake","click","escapeKey"],setup(e,{slots:n,emit:t,attrs:r}){const o=ot(),i=Re(null),a=Re(!1),s=Re(!1);let u=null,c=null,l,f;const d=oe(()=>e.persistent!==!0&&e.noRouteDismiss!==!0&&e.seamless!==!0),{preventBodyScroll:h}=dT(),{registerTimeout:p}=XA(),{registerTick:v,removeTick:m}=YA(),{transitionProps:g,transitionStyle:b}=tT(e,()=>Cp[e.position][0],()=>Cp[e.position][1]),x=oe(()=>b.value+(e.backdropFilter!==void 0?`;backdrop-filter:${e.backdropFilter};-webkit-backdrop-filter:${e.backdropFilter}`:"")),{showPortal:y,hidePortal:w,portalIsAccessible:_,renderPortal:S}=oT(o,i,be,"dialog"),{hide:R}=ZA({showing:a,hideOnRouteChange:d,handleShow:L,handleHide:q,processOnMount:!0}),{addToHistory:E,removeFromHistory:C}=KA(a,R,d),I=oe(()=>`q-dialog__inner flex no-pointer-events q-dialog__inner--${e.maximized===!0?"maximized":"minimized"} q-dialog__inner--${e.position} ${yT[e.position]}`+(s.value===!0?" q-dialog__inner--animating":"")+(e.fullWidth===!0?" q-dialog__inner--fullwidth":"")+(e.fullHeight===!0?" q-dialog__inner--fullheight":"")+(e.square===!0?" q-dialog__inner--square":"")),k=oe(()=>a.value===!0&&e.seamless!==!0),M=oe(()=>e.autoClose===!0?{onClick:O}:{}),P=oe(()=>[`q-dialog fullscreen no-pointer-events q-dialog--${k.value===!0?"modal":"seamless"}`,r.class]);$e(()=>e.maximized,ae=>{a.value===!0&&G(ae)}),$e(k,ae=>{h(ae),ae===!0?(gT(he),mT(H)):(_p(he),wp(H))});function L(ae){E(),c=e.noRefocus===!1&&document.activeElement!==null?document.activeElement:null,G(e.maximized),y(),s.value=!0,e.noFocus!==!0?(document.activeElement?.blur(),v(V)):m(),p(()=>{if(o.proxy.$q.platform.is.ios===!0){if(e.seamless!==!0&&document.activeElement){const{top:z,bottom:Z}=document.activeElement.getBoundingClientRect(),{innerHeight:ee}=window,le=window.visualViewport!==void 0?window.visualViewport.height:ee;z>0&&Z>le/2&&(document.scrollingElement.scrollTop=Math.min(document.scrollingElement.scrollHeight-le,Z>=ee?1/0:Math.ceil(document.scrollingElement.scrollTop+Z-le/2))),document.activeElement.scrollIntoView()}f=!0,i.value.click(),f=!1}y(!0),s.value=!1,t("show",ae)},e.transitionDuration)}function q(ae){m(),C(),$(!0),s.value=!0,w(),c!==null&&(((ae?.type.indexOf("key")===0?c.closest('[tabindex]:not([tabindex^="-"])'):void 0)||c).focus(),c=null),p(()=>{w(!0),s.value=!1,t("hide",ae)},e.transitionDuration)}function V(ae){Vf(()=>{let z=i.value;if(z!==null){if(ae!==void 0){const Z=z.querySelector(ae);if(Z!==null){Z.focus({preventScroll:!0});return}}z.contains(document.activeElement)!==!0&&(z=z.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||z.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||z.querySelector("[autofocus], [data-autofocus]")||z,z.focus({preventScroll:!0}))}})}function F(ae){ae&&typeof ae.focus=="function"?ae.focus({preventScroll:!0}):V(),t("shake");const z=i.value;z!==null&&(z.classList.remove("q-animate--scale"),z.classList.add("q-animate--scale"),u!==null&&clearTimeout(u),u=setTimeout(()=>{u=null,i.value!==null&&(z.classList.remove("q-animate--scale"),V())},170))}function H(){e.seamless!==!0&&(e.persistent===!0||e.noEscDismiss===!0?e.maximized!==!0&&e.noShake!==!0&&F():(t("escapeKey"),R()))}function $(ae){u!==null&&(clearTimeout(u),u=null),(ae===!0||a.value===!0)&&(G(!1),e.seamless!==!0&&(h(!1),_p(he),wp(H))),ae!==!0&&(c=null)}function G(ae){ae===!0?l!==!0&&(Ua<1&&document.body.classList.add("q-body--dialog"),Ua++,l=!0):l===!0&&(Ua<2&&document.body.classList.remove("q-body--dialog"),Ua--,l=!1)}function O(ae){f!==!0&&(R(ae),t("click",ae))}function re(ae){e.persistent!==!0&&e.noBackdropDismiss!==!0?R(ae):e.noShake!==!0&&F()}function he(ae){e.allowFocusOutside!==!0&&_.value===!0&&Kw(i.value,ae.target)!==!0&&V('[tabindex]:not([tabindex="-1"])')}Object.assign(o.proxy,{focus:V,shake:F,__updateRefocusTarget(ae){c=ae||null}}),Qt($);function be(){return se("div",{role:"dialog","aria-modal":k.value===!0?"true":"false",...r,class:P.value},[se(rs,{name:"q-transition--fade",appear:!0},()=>k.value===!0?se("div",{class:"q-dialog__backdrop fixed-full",style:x.value,"aria-hidden":"true",tabindex:-1,onClick:re}):null),se(rs,g.value,()=>a.value===!0?se("div",{ref:i,class:I.value,style:b.value,tabindex:-1,...M.value},vr(n.default)):null)])}return S}}),vn={__name:"buttonPrincipal",props:{color:{type:String,default:"black"},textColor:{type:String,default:"white"},label:{type:String,required:!0},type:{type:String,default:"button"}},emits:["accionBoton"],setup(e,{emit:n}){const t=n,r=e;return(o,i)=>(nn(),$s(Fl,{color:r.color,"text-color":r.textColor,label:r.label,type:r.type,onClick:i[0]||(i[0]=a=>t("accionBoton"))},null,8,["color","text-color","label","type"]))}},bT={class:"principal"},xT={class:"botones"},wT={class:"formularios"},_T={key:0,class:"formulario"},CT={key:1,class:"formulario"},ET={key:2,class:"formulario"},ST={__name:"Login",setup(e){const n=am(),t=Re("login"),r=Re(""),o=Re(""),i=Re(""),a=Re(""),s=Re("");function u(){return JSON.parse(localStorage.getItem("usuarios"))||[]}function c($){localStorage.setItem("usuarios",JSON.stringify($))}function l(){if(!r.value||!o.value||!i.value||!s.value||a.value.length<8){ct.create({message:"Completa todos los campos",color:"red",icon:"error"});return}let $=u();if($.some(he=>he.documento===s.value)){ct.create({message:"Este documento ya est registrado",color:"red",icon:"warning"});return}if($.some(he=>he.email===i.value)){ct.create({message:"Este correo ya est registrado",color:"red",icon:"warning"});return}const re={nombre:r.value,apellido:o.value,email:i.value,documento:s.value,password:a.value,faceId:JSON.parse(localStorage.getItem("faceTemp"))||null};localStorage.removeItem("faceTemp"),$.push(re),c($),ct.create({message:"Usuario creado correctamente",color:"green",icon:"check"}),r.value="",o.value="",i.value="",s.value="",a.value="",t.value="login"}function f(){const G=u().find(O=>O.documento===s.value&&O.password===a.value);G?(ct.create({message:`Bienvenido, ${G.nombre}`,color:"green",icon:"check"}),localStorage.setItem("usuarioActual",JSON.stringify(G)),n.push("/asistencia")):ct.create({message:"Documento o contrasea incorrectos",color:"red",icon:"error"})}function d(){}function h(){t.value="login"}function p(){t.value="registro"}function v(){t.value="consultar"}const m=Re(!1),g=Re(null);async function b(){m.value=!0,await x(),y()}async function x(){await Promise.all([xt.ssdMobilenetv1.loadFromUri("/models"),xt.faceLandmark68Net.loadFromUri("/models"),xt.faceRecognitionNet.loadFromUri("/models")])}async function y(){const $=await navigator.mediaDevices.getUserMedia({video:!0});g.value.srcObject=$}async function w(){const $=await ja(g.value).withFaceLandmarks().withFaceDescriptor();if(!$){ct.create({message:"No se detect un rostro",color:"red",icon:"error"});return}localStorage.setItem("faceTemp",JSON.stringify(Array.from($.descriptor))),ct.create({message:"Rostro registrado correctamente",color:"green",icon:"check"}),m.value=!1}const _=Re(!1),S=Re(null);let R=null;async function E(){_.value=!0,await x(),C()}async function C(){R=await navigator.mediaDevices.getUserMedia({video:!0}),S.value.srcObject=R}function I(){_.value=!1,R&&R.getTracks().forEach($=>$.stop())}async function k(){const $=u(),G=await ja(S.value).withFaceLandmarks().withFaceDescriptor();if(!G){ct.create({message:"No se detect rostro",color:"red"});return}const O=G.descriptor;for(const re of $){if(!re.faceId)continue;if(Ts(new Float32Array(re.faceId),O)<.45){ct.create({message:`Bienvenido, ${re.nombre}`,color:"green",icon:"check"}),localStorage.setItem("usuarioActual",JSON.stringify(re)),I(),n.push("/asistencia");return}}ct.create({message:"Rostro no coincide",color:"red"})}const M=Re(""),P=Re(null);let L=null;async function q(){await x(),await V(),setTimeout(()=>F(),800)}async function V(){try{L=await navigator.mediaDevices.getUserMedia({video:!0}),P.value.srcObject=L,P.value.style.display="block",await P.value.play()}catch{ct.create({message:"No se pudo acceder a la cmara",color:"red"})}}async function F(){const $=u(),G=await ja(P.value).withFaceLandmarks().withFaceDescriptor();if(!G){ct.create({message:"No se detect rostro",color:"red"}),H();return}const O=$.find(he=>he.documento===M.value);if(!O){ct.create({message:"No existe usuario con ese documento",color:"red"}),H();return}if(!O.faceId){ct.create({message:"Ese usuario no tiene Face ID registrado",color:"red"}),H();return}Ts(new Float32Array(O.faceId),G.descriptor)<.45?ct.create({message:`Usuario encontrado: ${O.nombre} ${O.apellido}`,color:"green",icon:"check"}):ct.create({message:"El rostro NO coincide con el documento ingresado",color:"red"}),H()}function H(){L&&L.getTracks().forEach($=>$.stop()),P.value&&(P.value.style.display="none")}return($,G)=>(nn(),hr("div",bT,[G[16]||(G[16]=Qe("div",{class:"titulo"},[Qe("h1",null,"REGISTRO DE USUARIOS")],-1)),Qe("div",xT,[Ne(vn,{label:"Iniciar Sesin",color:"black",textColor:"white",onAccionBoton:h}),Ne(vn,{label:"Registrarse",color:"black",textColor:"white",onAccionBoton:p}),Ne(vn,{label:"Consultar",color:"black",textColor:"white",onAccionBoton:v})]),Qe("div",wT,[t.value==="login"?(nn(),hr("div",_T,[G[11]||(G[11]=Qe("h2",null,"Iniciar Sesin",-1)),Qe("form",{onSubmit:ku(f,["prevent"])},[Ne(Tr,{filled:"",modelValue:s.value,"onUpdate:modelValue":G[0]||(G[0]=O=>s.value=O),type:"text",label:"Documento",rules:[O=>!!O||"El documento es obligatorio"]},null,8,["modelValue","rules"]),Ne(Tr,{filled:"",modelValue:a.value,"onUpdate:modelValue":G[1]||(G[1]=O=>a.value=O),label:"Contrasea",type:"password",rules:[O=>!!O||"La contrasea es obligatoria",O=>O.length>=8||"Debe tener mnimo 8 caracteres"]},null,8,["modelValue","rules"]),Ne(vn,{label:"Entrar",color:"black",textColor:"white",onAccionBoton:f}),Ne(vn,{label:"Iniciar con Face ID",color:"secondary",class:"q-mt-md full-width",onClick:E})],32)])):Qo("",!0),Ne(Ep,{modelValue:_.value,"onUpdate:modelValue":G[2]||(G[2]=O=>_.value=O),persistent:""},{default:Gn(()=>[Ne(Pc,{style:{width:"360px",padding:"20px"}},{default:Gn(()=>[G[12]||(G[12]=Qe("h4",{class:"text-center"},"Validar Rostro",-1)),Qe("video",{ref_key:"videoLoginRef",ref:S,autoplay:"",playsinline:"",width:"300",height:"220",style:{"border-radius":"10px",border:"2px solid #000",margin:"10px auto"}},null,512),Ne(vn,{label:"Validar Rostro",color:"green",class:"full-width q-mt-md",onClick:k}),Ne(vn,{label:"Cancelar",flat:"",class:"full-width q-mt-sm",onClick:I})]),_:1})]),_:1},8,["modelValue"]),t.value==="registro"?(nn(),hr("div",CT,[G[13]||(G[13]=Qe("h2",null,"Registrarse",-1)),Qe("form",{onSubmit:ku(l,["prevent"])},[Ne(Tr,{filled:"",modelValue:r.value,"onUpdate:modelValue":G[3]||(G[3]=O=>r.value=O),type:"text",label:"Nombres",rules:[O=>!!O||"El nombre es obligatorio"]},null,8,["modelValue","rules"]),Ne(Tr,{filled:"",modelValue:o.value,"onUpdate:modelValue":G[4]||(G[4]=O=>o.value=O),type:"text",label:"Apellidos",rules:[O=>!!O||"El apellido es obligatorio"]},null,8,["modelValue","rules"]),Ne(Tr,{filled:"",modelValue:s.value,"onUpdate:modelValue":G[5]||(G[5]=O=>s.value=O),type:"text",label:"Documento",rules:[O=>!!O||"El documento es obligatorio"]},null,8,["modelValue","rules"]),Ne(Tr,{filled:"",modelValue:i.value,"onUpdate:modelValue":G[6]||(G[6]=O=>i.value=O),type:"email",label:"Correo de la institucin",rules:[O=>!!O||"El correo es obligatorio"]},null,8,["modelValue","rules"]),Ne(Tr,{filled:"",modelValue:a.value,"onUpdate:modelValue":G[7]||(G[7]=O=>a.value=O),type:"password",label:"Contrasea",rules:[O=>!!O||"La contrasea es obligatoria",O=>O.length>=8||"Debe tener mnimo 8 caracteres"]},null,8,["modelValue","rules"]),Ne(vn,{label:"Crear Cuenta",color:"black",textColor:"white",onAccionBoton:l}),Ne(vn,{label:"Registrar Face ID",color:"primary",class:"q-mt-md",onClick:b})],32)])):Qo("",!0),Ne(Ep,{modelValue:m.value,"onUpdate:modelValue":G[9]||(G[9]=O=>m.value=O),persistent:""},{default:Gn(()=>[Ne(Pc,{style:{width:"350px",padding:"20px"}},{default:Gn(()=>[G[14]||(G[14]=Qe("h4",{class:"text-center"},"Registrar Rostro",-1)),Qe("video",{ref_key:"videoRef",ref:g,autoplay:"",playsinline:"",width:"300",height:"220",style:{"border-radius":"10px",border:"2px solid #000"}},null,512),Ne(vn,{label:"Guardar Rostro",color:"green",class:"full-width q-mt-md",onClick:w}),Ne(vn,{label:"Cancelar",flat:"",class:"full-width q-mt-sm",onClick:G[8]||(G[8]=O=>m.value=!1)})]),_:1})]),_:1},8,["modelValue"]),t.value==="consultar"?(nn(),hr("div",ET,[G[15]||(G[15]=Qe("h2",null,"Consultar Usuario",-1)),Qe("form",{onSubmit:ku(d,["prevent"])},[Ne(Tr,{filled:"",modelValue:s.value,"onUpdate:modelValue":G[10]||(G[10]=O=>s.value=O),type:"text",label:"Documento",rules:[O=>!!O||"El documento es obligatorio"]},null,8,["modelValue","rules"]),Ne(vn,{label:"Consultar con face Id",color:"primary",class:"q-mt-md",onClick:q})],32),Qe("video",{ref_key:"videoConsultaRef",ref:P,autoplay:"",playsinline:"",width:"300",height:"220",style:{display:"none","margin-top":"15px"}},null,512)])):Qo("",!0)])]))}},RT=[{path:"/",component:ST},{path:"/asistencia",component:xA}],kT=Mw({history:hw(),routes:RT}),IT={name:"Quasar",version:"2.18.6",install:sA,lang:Br,iconSet:Ds},{passive:Sp}=zt,AT=["both","horizontal","vertical"],TT=en({name:"QScrollObserver",props:{axis:{type:String,validator:e=>AT.includes(e),default:"vertical"},debounce:[String,Number],scrollTarget:iT},emits:["scroll"],setup(e,{emit:n}){const t={position:{top:0,left:0},direction:"down",directionChanged:!1,delta:{top:0,left:0},inflectionPoint:{top:0,left:0}};let r=null,o,i;$e(()=>e.scrollTarget,()=>{u(),s()});function a(){r?.();const f=Math.max(0,$y(o)),d=Ky(o),h={top:f-t.position.top,left:d-t.position.left};if(e.axis==="vertical"&&h.top===0||e.axis==="horizontal"&&h.left===0)return;const p=Math.abs(h.top)>=Math.abs(h.left)?h.top<0?"up":"down":h.left<0?"left":"right";t.position={top:f,left:d},t.directionChanged=t.direction!==p,t.delta=h,t.directionChanged===!0&&(t.direction=p,t.inflectionPoint=t.position),n("scroll",{...t})}function s(){o=sT(i,e.scrollTarget),o.addEventListener("scroll",c,Sp),c(!0)}function u(){o!==void 0&&(o.removeEventListener("scroll",c,Sp),o=void 0)}function c(f){if(f===!0||e.debounce===0||e.debounce==="0")a();else if(r===null){const[d,h]=e.debounce?[setTimeout(a,e.debounce),clearTimeout]:[requestAnimationFrame(a),cancelAnimationFrame];r=()=>{h(d),r=null}}}const{proxy:l}=ot();return $e(()=>l.$q.lang.rtl,a),_n(()=>{i=l.$el.parentNode,s()}),Qt(()=>{r?.(),u()}),Object.assign(l,{trigger:c,getPosition:()=>t}),bo}});function DT(){const e=Re(!Jn.value);return e.value===!1&&_n(()=>{e.value=!0}),{isHydrated:e}}const Qy=typeof ResizeObserver<"u",Rp=Qy===!0?{}:{style:"display:block;position:absolute;top:0;left:0;right:0;bottom:0;height:100%;width:100%;overflow:hidden;pointer-events:none;z-index:-1;",url:"about:blank"},kp=en({name:"QResizeObserver",props:{debounce:{type:[String,Number],default:100}},emits:["resize"],setup(e,{emit:n}){let t=null,r,o={width:-1,height:-1};function i(u){u===!0||e.debounce===0||e.debounce==="0"?a():t===null&&(t=setTimeout(a,e.debounce))}function a(){if(t!==null&&(clearTimeout(t),t=null),r){const{offsetWidth:u,offsetHeight:c}=r;(u!==o.width||c!==o.height)&&(o={width:u,height:c},n("resize",o))}}const{proxy:s}=ot();if(s.trigger=i,Qy===!0){let u;const c=l=>{r=s.$el.parentNode,r?(u=new ResizeObserver(i),u.observe(r),a()):l!==!0&&$t(()=>{c(!0)})};return _n(()=>{c()}),Qt(()=>{t!==null&&clearTimeout(t),u!==void 0&&(u.disconnect!==void 0?u.disconnect():r&&u.unobserve(r))}),bo}else{let u=function(){t!==null&&(clearTimeout(t),t=null),f!==void 0&&(f.removeEventListener!==void 0&&f.removeEventListener("resize",i,zt.passive),f=void 0)},c=function(){u(),r?.contentDocument&&(f=r.contentDocument.defaultView,f.addEventListener("resize",i,zt.passive),a())};const{isHydrated:l}=DT();let f;return _n(()=>{$t(()=>{r=s.$el,r&&c()})}),Qt(u),()=>{if(l.value===!0)return se("object",{class:"q--avoid-card-border",style:Rp.style,tabindex:-1,type:"text/html",data:Rp.url,"aria-hidden":"true",onLoad:c})}}}}),NT=en({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:n,emit:t}){const{proxy:{$q:r}}=ot(),o=Re(null),i=Re(r.screen.height),a=Re(e.container===!0?0:r.screen.width),s=Re({position:0,direction:"down",inflectionPoint:0}),u=Re(0),c=Re(Jn.value===!0?0:fc()),l=oe(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),f=oe(()=>e.container===!1?{minHeight:r.screen.height+"px"}:null),d=oe(()=>c.value!==0?{[r.lang.rtl===!0?"left":"right"]:`${c.value}px`}:null),h=oe(()=>c.value!==0?{[r.lang.rtl===!0?"right":"left"]:0,[r.lang.rtl===!0?"left":"right"]:`-${c.value}px`,width:`calc(100% + ${c.value}px)`}:null);function p(y){if(e.container===!0||document.qScrollPrevented!==!0){const w={position:y.position.top,direction:y.direction,directionChanged:y.directionChanged,inflectionPoint:y.inflectionPoint.top,delta:y.delta.top};s.value=w,e.onScroll!==void 0&&t("scroll",w)}}function v(y){const{height:w,width:_}=y;let S=!1;i.value!==w&&(S=!0,i.value=w,e.onScrollHeight!==void 0&&t("scrollHeight",w),g()),a.value!==_&&(S=!0,a.value=_),S===!0&&e.onResize!==void 0&&t("resize",y)}function m({height:y}){u.value!==y&&(u.value=y,g())}function g(){if(e.container===!0){const y=i.value>u.value?fc():0;c.value!==y&&(c.value=y)}}let b=null;const x={instances:{},view:oe(()=>e.view),isContainer:oe(()=>e.container),rootRef:o,height:i,containerHeight:u,scrollbarWidth:c,totalWidth:oe(()=>a.value+c.value),rows:oe(()=>{const y=e.view.toLowerCase().split(" ");return{top:y[0].split(""),middle:y[1].split(""),bottom:y[2].split("")}}),header:Hn({size:0,offset:0,space:!1}),right:Hn({size:300,offset:0,space:!1}),footer:Hn({size:0,offset:0,space:!1}),left:Hn({size:300,offset:0,space:!1}),scroll:s,animate(){b!==null?clearTimeout(b):document.body.classList.add("q-body--layout-animate"),b=setTimeout(()=>{b=null,document.body.classList.remove("q-body--layout-animate")},155)},update(y,w,_){x[y][w]=_}};if(Yo(Pl,x),fc()>0){let y=function(){S=null,R.classList.remove("hide-scrollbar")},w=function(){if(S===null){if(R.scrollHeight>r.screen.height)return;R.classList.add("hide-scrollbar")}else clearTimeout(S);S=setTimeout(y,300)},_=function(E){S!==null&&E==="remove"&&(clearTimeout(S),y()),window[`${E}EventListener`]("resize",w)},S=null;const R=document.body;$e(()=>e.container!==!0?"add":"remove",_),e.container!==!0&&_("add"),Hs(()=>{_("remove")})}return()=>{const y=Go(n.default,[se(TT,{onScroll:p}),se(kp,{onResize:v})]),w=se("div",{class:l.value,style:f.value,ref:e.container===!0?void 0:o,tabindex:-1},y);return e.container===!0?se("div",{class:"q-layout-container overflow-hidden",ref:o},[se(kp,{onResize:m}),se("div",{class:"absolute-full",style:d.value},[se("div",{class:"scroll",style:h.value},[w])])]):w}}}),FT=(e,n)=>{const t=e.__vccOpts||e;for(const[r,o]of n)t[r]=o;return t},PT={};function MT(e,n){const t=eb("router-view");return nn(),$s(NT,{view:"hHh lpR fFf"},{default:Gn(()=>[Ne(ym,null,{default:Gn(()=>[Ne(t)]),_:1})]),_:1})}const OT=FT(PT,[["render",MT]]),Uf=jv(OT);Uf.use(kT);Uf.use(IT,{plugins:{Notify:ct}});Uf.mount("#app")});export default BT();
